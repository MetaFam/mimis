import{a as m,t as _,c as xe}from"../chunks/CBNtQ0WH.js";import{Z as Ee,o as ye,m as z,n as Ce,aB as Ie,F as Z,q as j,Q as we,a1 as te,v as ke,U as ae,T as se,aw as re,av as ie,aC as oe,B as G,w as K,aD as $e,h as Ae,p as He,ag as le,b as Re,a as Se,a7 as ne,g as a,ae as Oe,s as R,c as p,aA as ce,r as i,k as Pe,t as Q,f as ve}from"../chunks/CmuRJ650.js";import{s as L}from"../chunks/Psu_3c_t.js";import{i as J}from"../chunks/CDlVdVmF.js";import{e as me,i as pe}from"../chunks/BlWq4oID.js";import{h as je}from"../chunks/JTFWKIjv.js";import{s as S}from"../chunks/BHyWXpT-.js";import{d as Le,e as Be}from"../chunks/BofLj2om.js";import{b as De}from"../chunks/C9f78Z5p.js";import{p as V}from"../chunks/DIfw8a-t.js";import{o as Me}from"../chunks/DtliY7Ov.js";import{T as Fe}from"../chunks/COzGs9ai.js";import{p as B}from"../chunks/Bc6Cz818.js";import{g as We}from"../chunks/CNr0LgH4.js";import{t as Ue}from"../chunks/9VBTw-GS.js";import{s as qe}from"../chunks/CIgYLCqT.js";const X=0,D=1,Y=2;function ze(f,n,s,T,u){z&&Ce();var h=f,x=Ee(),E=Ae,c=te,o,l,g,y=(x?ae:se)(void 0),$=(x?ae:se)(void 0),C=!1;function I(t,r){C=!0,r&&(re(e),ie(e),oe(E));try{t===X&&s&&(o?G(o):o=j(()=>s(h))),t===D&&T&&(l?G(l):l=j(()=>T(h,y))),t===Y&&u&&(g?G(g):g=j(()=>u(h,$))),t!==X&&o&&K(o,()=>o=null),t!==D&&l&&K(l,()=>l=null),t!==Y&&g&&K(g,()=>g=null)}finally{r&&(oe(null),ie(null),re(null),$e())}}var e=ye(()=>{if(c!==(c=n())){if(Ie(c)){var t=c;C=!1,t.then(r=>{t===c&&(Z(y,r),I(D,!0))},r=>{if(t===c)throw Z($,r),I(Y,!0),$.v}),z?s&&(o=j(()=>s(h))):we(()=>{C||I(X,!0)})}else Z(y,c),I(D,!1);return()=>c=te}});z&&(h=ke)}const Ze=async({path:f,limit:n=200,offset:s=0})=>{const T=We();try{const u=T.session();f=f.filter(E=>E.trim()!==""),n=parseInt(Number(n).toFixed(0)),s=parseInt(Number(s).toFixed(0));const h=f.length===0?`
        MATCH (start:Root)-[children:CONTAINS|CONNECTS]->(child)
        RETURN [] as path, children.path as container, child
      `:`
        WITH $elems as pathElems
        MATCH path = (start:Root)-[:CONTAINS|CONNECTS*]->(end)
        MATCH (end)-[children:CONTAINS|CONNECTS]->(child)
        WITH pathElems, path, children, child, [
          rel in relationships(path)
          WHERE NOT isEmpty(rel.path)
          | rel.path
        ] as elements
        WHERE size(elements) = size(pathElems)
        AND ALL(
          i IN range(0, size(pathElems) - 1)
          WHERE (
            pathElems[i] = '*'
            OR elements[i] = pathElems[i]
          )
        )
        LIMIT ${s+n}
        SKIP ${s}
        RETURN DISTINCT
          elements as path,
          children.path as container,
          child
      `,x=await u.run(h,{elems:f,limit:BigInt(n),offset:BigInt(s)});return await u.close(),x.records}finally{T.close()}};var Ge=_('<li class="svelte-11xv3gd"> <a class="button svelte-11xv3gd">⨯</a></li>'),Ke=_('<ul id="path" class="svelte-11xv3gd"></ul>'),Qe=_('<h2 class="svelte-11xv3gd">No Results</h2>'),Je=_('<h2 class="svelte-11xv3gd"> </h2> <object class="svelte-11xv3gd"><p>Could not display <a target="_blank"> </a>.</p></object>',1),Ve=(f,n,s)=>{console.debug("H!"),n(a(s).get("container"))},Xe=_('<a class="button"> </a>'),Ye=_("<li><!></li>"),et=_('<ul id="result" class="svelte-11xv3gd"></ul>'),tt=_('<h2 class="svelte-11xv3gd">Searching…</h2>'),at=_('<main class="svelte-11xv3gd"><form><input id="chip" placeholder="Path Element"> <button>Add Path Element</button></form> <!> <section id="result" class="svelte-11xv3gd"><!></section></main>');function bt(f,n){He(n,!0);let s=le(V([])),T=Pe(async()=>{try{const e=B.url.searchParams.get("limit"),t=B.url.searchParams.get("offset");return await Ze({path:a(s),limit:e?Number(e):qe.limit,offset:Number(t)})}catch(e){Fe({text:e.message,duration:16e3,close:!0,gravity:"bottom",position:"center",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}}),u=le("");Me(()=>{ne(s,V(B.params.path.split("/").filter(Boolean)));const e=B.url.hash.split("/").filter(Boolean);ne(u,V(e.slice(0,e.length-a(s).length).join("/")))});const h=e=>{e.preventDefault();const t=e.target.elements.chip;x(t.value),t.value=""},x=e=>{e=e.trim(),e&&a(s).push(e)},E=e=>{a(s).splice(e,1)},c=()=>{E(-1)};Re(()=>{const e=t=>{t.key==="ArrowLeft"&&t.target===document.body&&c()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}});var o=at();je(e=>{Oe.title="Mïmis: Search"});var l=p(o),g=p(l);De(g),ce(2),i(l);var y=R(l,2);{var $=e=>{var t=Ke();me(t,21,()=>a(s),pe,(r,M,O)=>{var A=Ge(),d=p(A),b=R(d);b.__click=()=>E(O),i(A),Q(F=>{L(d,`${a(M)??""} `),S(b,"href",F)},[()=>`${a(u)}/${a(s).toSpliced(O,1).join("/")}`]),m(r,A)}),i(t),m(e,t)};J(y,e=>{a(s).length>0&&e($)})}var C=R(y,2),I=p(C);ze(I,()=>a(T),e=>{var t=tt();m(e,t)},(e,t)=>{var r=xe(),M=ve(r);{var O=d=>{var b=Qe();m(d,b)},A=d=>{var b=et();me(b,21,()=>a(t),pe,(F,v)=>{var W=Ye(),fe=p(W);{var ue=w=>{var N=Je(),H=ve(N),U=p(H);i(H);var k=R(H,2),ee=p(k),q=R(p(ee)),de=p(q);i(q),ce(),i(ee),i(k),Q((P,_e,ge,be,Ne,Te)=>{L(U,`/${P??""}/${_e??""}`),S(k,"data",ge),S(k,"title",be),S(q,"href",Ne),L(de,`ipfs://${Te??""}`)},[()=>{var P;return(P=a(v).get("path"))==null?void 0:P.join("/")},()=>a(v).get("container"),()=>Ue({cid:a(v).get("child").properties.cid}),()=>`ipfs://${a(v).get("child").properties.cid}`,()=>`https://w3s.link/ipfs/${a(v).get("child").properties.cid}`,()=>a(v).get("child").properties.cid]),m(w,N)},he=w=>{var N=Xe();N.__click=[Ve,x,v];var H=p(N,!0);i(N),Q((U,k)=>{S(N,"href",U),L(H,k)},[()=>`${a(u)}/${a(s).join("/")}${a(s).length>0?"/":""}${a(v).get("container")}`,()=>a(v).get("container")]),m(w,N)};J(fe,w=>{a(v).get("child").labels.includes("File")?w(ue):w(he,!1)})}i(W),m(F,W)}),i(b),m(d,b)};J(M,d=>{!a(t)||a(t).length===0?d(O):d(A,!1)})}m(e,r)}),i(C),i(o),Be("submit",l,h),m(f,o),Se()}Le(["click"]);export{bt as component};
