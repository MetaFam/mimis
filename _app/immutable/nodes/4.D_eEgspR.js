import{a as m,t as _,c as Te}from"../chunks/WKN9PFEa.js";import{$ as Ee,o as ye,m as U,n as Ce,aB as Ie,J as G,q as j,S as we,a3 as te,v as ke,W as ae,V as se,ax as re,aw as ie,aC as oe,D as J,w as K,aD as $e,h as Ae,p as He,x as le,b as Se,a as Re,y as ne,g as a,af as Oe,s as S,c as p,ag as ce,r as i,k as Pe,t as V,f as fe}from"../chunks/DfCKUgPZ.js";import{s as L}from"../chunks/53w90SBh.js";import{i as Z}from"../chunks/CxvnlHYe.js";import{e as me,i as pe}from"../chunks/gZgcF4qb.js";import{h as je}from"../chunks/BURx3oLU.js";import{s as R}from"../chunks/CjRCQ7x9.js";import{d as Le,e as De}from"../chunks/eAt8-E3t.js";import{b as Me}from"../chunks/DX8gHaFg.js";import{p as Q}from"../chunks/CFwRPk26.js";import{o as We}from"../chunks/CEh56V48.js";import{T as Be}from"../chunks/CQbym6Aj.js";import{p as D}from"../chunks/DmkWyKJ7.js";import{g as Fe}from"../chunks/C_qvQzUc.js";import{t as qe}from"../chunks/BR3b6kKL.js";import{s as ze}from"../chunks/BYEvVrwl.js";const X=0,M=1,Y=2;function Ue(v,n,s,x,u){U&&Ce();var h=v,T=Ee(),E=Ae,c=te,o,l,g,y=(T?ae:se)(void 0),$=(T?ae:se)(void 0),C=!1;function I(t,r){C=!0,r&&(re(e),ie(e),oe(E));try{t===X&&s&&(o?J(o):o=j(()=>s(h))),t===M&&x&&(l?J(l):l=j(()=>x(h,y))),t===Y&&u&&(g?J(g):g=j(()=>u(h,$))),t!==X&&o&&K(o,()=>o=null),t!==M&&l&&K(l,()=>l=null),t!==Y&&g&&K(g,()=>g=null)}finally{r&&(oe(null),ie(null),re(null),$e())}}var e=ye(()=>{if(c!==(c=n())){if(Ie(c)){var t=c;C=!1,t.then(r=>{t===c&&(G(y,r),I(M,!0))},r=>{if(t===c)throw G($,r),I(Y,!0),$.v}),U?s&&(o=j(()=>s(h))):we(()=>{C||I(X,!0)})}else G(y,c),I(M,!1);return()=>c=te}});U&&(h=ke)}const Ge=async({path:v,limit:n=200,offset:s=0})=>{const x=Fe();try{const u=x.session();v=v.filter(E=>E.trim()!==""),n=parseInt(Number(n).toFixed(0)),s=parseInt(Number(s).toFixed(0));const h=v.length===0?`
        MATCH (start:Root)-[children:CONTAINS|CONNECTS]->(child)
        RETURN [] as path, children.path as container, child
      `:`
        WITH $elems as pathElems
        MATCH path = (start:Root)-[:CONTAINS|CONNECTS*]->(end)
        MATCH (end)-[children:CONTAINS|CONNECTS]->(child)
        WITH pathElems, path, children, child, [
          rel in relationships(path)
          WHERE NOT isEmpty(rel.path)
          | rel.path
        ] as elements
        WHERE size(elements) = size(pathElems)
        AND ALL(
          i IN range(0, size(pathElems) - 1)
          WHERE (
            pathElems[i] = '*'
            OR elements[i] = pathElems[i]
          )
        )
        LIMIT ${s+n}
        SKIP ${s}
        RETURN DISTINCT
          elements as path,
          children.path as container,
          child
      `,T=await u.run(h,{elems:v,limit:BigInt(n),offset:BigInt(s)});return await u.close(),T.records}finally{x.close()}};var Je=_('<li class="svelte-11xv3gd"> <a class="button svelte-11xv3gd">⨯</a></li>'),Ke=_('<ul id="path" class="svelte-11xv3gd"></ul>'),Ve=_('<h2 class="svelte-11xv3gd">No Results</h2>'),Ze=_('<h2 class="svelte-11xv3gd"> </h2> <object class="svelte-11xv3gd"><p>Could not display <a target="_blank"> </a>.</p></object>',1),Qe=(v,n,s)=>{console.debug("H!"),n(a(s).get("container"))},Xe=_('<a class="button"> </a>'),Ye=_("<li><!></li>"),et=_('<ul id="result" class="svelte-11xv3gd"></ul>'),tt=_('<h2 class="svelte-11xv3gd">Searching…</h2>'),at=_('<main class="svelte-11xv3gd"><form><input id="chip" placeholder="Path Element"> <button>Add Path Element</button></form> <!> <section id="result" class="svelte-11xv3gd"><!></section></main>');function bt(v,n){He(n,!0);let s=le(Q([])),x=Pe(async()=>{try{const e=D.url.searchParams.get("limit"),t=D.url.searchParams.get("offset");return await Ge({path:a(s),limit:e?Number(e):ze.limit,offset:Number(t)})}catch(e){Be({text:e.message,duration:16e3,close:!0,gravity:"bottom",position:"center",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}}),u=le("");We(()=>{ne(s,Q(D.params.path.split("/").filter(Boolean)));const e=D.url.hash.split("/").filter(Boolean);ne(u,Q(e.slice(0,e.length-a(s).length).join("/")))});const h=e=>{e.preventDefault();const t=e.target.elements.chip;T(t.value),t.value=""},T=e=>{e=e.trim(),e&&a(s).push(e)},E=e=>{a(s).splice(e,1)},c=()=>{E(-1)};Se(()=>{const e=t=>{t.key==="ArrowLeft"&&t.target===document.body&&c()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}});var o=at();je(e=>{Oe.title="Mïmis: Search"});var l=p(o),g=p(l);Me(g),ce(2),i(l);var y=S(l,2);{var $=e=>{var t=Ke();me(t,21,()=>a(s),pe,(r,W,O)=>{var A=Je(),d=p(A),b=S(d);b.__click=()=>E(O),i(A),V(B=>{L(d,`${a(W)??""} `),R(b,"href",B)},[()=>`${a(u)}/${a(s).toSpliced(O,1).join("/")}`]),m(r,A)}),i(t),m(e,t)};Z(y,e=>{a(s).length>0&&e($)})}var C=S(y,2),I=p(C);Ue(I,()=>a(x),e=>{var t=tt();m(e,t)},(e,t)=>{var r=Te(),W=fe(r);{var O=d=>{var b=Ve();m(d,b)},A=d=>{var b=et();me(b,21,()=>a(t),pe,(B,f)=>{var F=Ye(),ve=p(F);{var ue=w=>{var N=Ze(),H=fe(N),q=p(H);i(H);var k=S(H,2),ee=p(k),z=S(p(ee)),de=p(z);i(z),ce(),i(ee),i(k),V((P,_e,ge,be,Ne,xe)=>{L(q,`/${P??""}/${_e??""}`),R(k,"data",ge),R(k,"title",be),R(z,"href",Ne),L(de,`ipfs://${xe??""}`)},[()=>{var P;return(P=a(f).get("path"))==null?void 0:P.join("/")},()=>a(f).get("container"),()=>qe({cid:a(f).get("child").properties.cid}),()=>`ipfs://${a(f).get("child").properties.cid}`,()=>`https://w3s.link/ipfs/${a(f).get("child").properties.cid}`,()=>a(f).get("child").properties.cid]),m(w,N)},he=w=>{var N=Xe();N.__click=[Qe,T,f];var H=p(N,!0);i(N),V((q,k)=>{R(N,"href",q),L(H,k)},[()=>`${a(u)}/${a(s).join("/")}${a(s).length>0?"/":""}${a(f).get("container")}`,()=>a(f).get("container")]),m(w,N)};Z(ve,w=>{a(f).get("child").labels.includes("File")?w(ue):w(he,!1)})}i(F),m(B,F)}),i(b),m(d,b)};Z(W,d=>{!a(t)||a(t).length===0?d(O):d(A,!1)})}m(e,r)}),i(C),i(o),De("submit",l,h),m(v,o),Re()}Le(["click"]);export{bt as component};
