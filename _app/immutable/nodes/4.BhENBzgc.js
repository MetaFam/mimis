import{t as h,a as f,c as Te}from"../chunks/C8TbCyJI.js";import{V as xe,n as ye,q as z,w as Ce,aB as Ie,$ as ee,J as U,L as te,K as ae,D as K,Y as ke,A as we,ak as se,aw as re,aC as ie,b as $e,C as oe,E as G,aD as Ae,p as He,ae as ne,d as Re,a as Se,ac as Le,a5 as le,i as a,c as m,aA as ce,r as i,s as H,f as pe,k as Oe,t as J}from"../chunks/-1OJfg0W.js";import{s as P}from"../chunks/C98pv6io.js";import{i as V}from"../chunks/DCdVZ8bZ.js";import{e as fe,i as me}from"../chunks/BgzcZ9EW.js";import{h as Pe}from"../chunks/BDWLlJom.js";import{s as R}from"../chunks/Dif0L2tj.js";import{d as je,e as De}from"../chunks/sIr-e1iE.js";import{b as Me}from"../chunks/Bg4Xpit0.js";import{p as Y}from"../chunks/7ymiA-OT.js";import{o as Be}from"../chunks/DxLwQUX6.js";import{T as We}from"../chunks/COzGs9ai.js";import{p as j}from"../chunks/CFGNjSAb.js";import{g as Fe}from"../chunks/DEFpx5n1.js";import{t as qe}from"../chunks/CGwgS8Je.js";import{s as ze}from"../chunks/CU2DF7iH.js";const Z=0,D=1,Q=2;function Ue(u,l,s,N,d){z&&Ce();var _=u,E=xe(),T=$e,c=ee,o,n,w,x=(E?te:ae)(void 0),S=(E?te:ae)(void 0),y=!1;function C(t,r){y=!0,r&&(se(e),re(e),ie(T));try{t===Z&&s&&(o?oe(o):o=K(()=>s(_))),t===D&&N&&(n?oe(n):n=K(()=>N(_,x))),t!==Z&&o&&G(o,()=>o=null),t!==D&&n&&G(n,()=>n=null),t!==Q&&w&&G(w,()=>w=null)}finally{r&&(ie(null),re(null),se(null),Ae())}}var e=ye(()=>{if(c!==(c=l())){if(Ie(c)){var t=c;y=!1,t.then(r=>{t===c&&(U(x,r),C(D,!0))},r=>{if(t===c)throw U(S,r),C(Q,!0),S.v}),z?s&&(o=K(()=>s(_))):ke(()=>{y||C(Z,!0)})}else U(x,c),C(D,!1);return()=>c=ee}});z&&(_=we)}const Ke=async({path:u,limit:l=200,offset:s=0})=>{const N=Fe();try{const d=N.session();u=u.filter(T=>T.trim()!==""),l=parseInt(Number(l).toFixed(0)),s=parseInt(Number(s).toFixed(0));const _=u.length===0?`
        MATCH (start:Root)-[children:CONTAINS|CONNECTS]->(child)
        RETURN [] as path, children.path as container, child
      `:`
        WITH $elems as pathElems
        MATCH path = (start:Root)-[:CONTAINS|CONNECTS*]->(end)
        MATCH (end)-[children:CONTAINS|CONNECTS]->(child)
        WITH pathElems, path, children, child, [
          rel in relationships(path)
          WHERE NOT isEmpty(rel.path)
          | rel.path
        ] as elements
        WHERE size(elements) = size(pathElems)
        AND ALL(
          i IN range(0, size(pathElems) - 1)
          WHERE (
            pathElems[i] = '*'
            OR elements[i] = pathElems[i]
          )
        )
        LIMIT ${s+l}
        SKIP ${s}
        RETURN DISTINCT
          elements as path,
          children.path as container,
          child
      `,E=await d.run(_,{elems:u,limit:BigInt(l),offset:BigInt(s)});return await d.close(),E.records}finally{N.close()}};var Ge=h('<li class="svelte-11xv3gd"> <a class="button svelte-11xv3gd">⨯</a></li>'),Je=h('<ul id="path" class="svelte-11xv3gd"></ul>'),Ve=h('<h2 class="svelte-11xv3gd">No Results</h2>'),Ye=h('<h2 class="svelte-11xv3gd"> </h2> <object class="svelte-11xv3gd"><p>Could not display <a target="_blank"> </a>.</p></object>',1),Ze=(u,l,s)=>{console.debug("H!"),l(a(s).get("container"))},Qe=h('<a class="button"> </a>'),Xe=h("<li><!></li>"),et=h('<ul id="result" class="svelte-11xv3gd"></ul>'),tt=h('<h2 class="svelte-11xv3gd">Searching…</h2>'),at=h('<main class="svelte-11xv3gd"><form><input id="chip" placeholder="Path Element"> <button>Add Path Element</button></form> <!> <section id="result" class="svelte-11xv3gd"><!></section></main>');function bt(u,l){He(l,!0);let s=ne(Y([])),N=Oe(async()=>{try{const e=j.url.searchParams.get("limit"),t=j.url.searchParams.get("offset");return await Ke({path:a(s),limit:e?Number(e):ze.limit,offset:Number(t)})}catch(e){We({text:e.message,duration:16e3,close:!0,gravity:"bottom",position:"center",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}}),d=ne("");Be(()=>{le(s,Y(j.params.path.split("/").filter(Boolean)));const e=j.url.hash.split("/").filter(Boolean);le(d,Y(e.slice(0,e.length-a(s).length).join("/")))});const _=e=>{e.preventDefault();const t=e.target.elements.chip;E(t.value),t.value=""},E=e=>{e=e.trim(),e&&a(s).push(e)},T=e=>{a(s).splice(e,1)},c=()=>{T(-1)};Re(()=>{const e=t=>{t.key==="ArrowLeft"&&t.target===document.body&&c()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}});var o=at();Pe(e=>{Le.title="Mïmis: Search"});var n=m(o),w=m(n);Me(w),ce(2),i(n);var x=H(n,2);{var S=e=>{var t=Je();fe(t,21,()=>a(s),me,(r,M,L)=>{var $=Ge(),v=m($),g=H(v);g.__click=()=>T(L),i($),J(B=>{P(v,`${a(M)??""} `),R(g,"href",B)},[()=>`${a(d)}/${a(s).toSpliced(L,1).join("/")}`]),f(r,$)}),i(t),f(e,t)};V(x,e=>{a(s).length>0&&e(S)})}var y=H(x,2),C=m(y);Ue(C,()=>a(N),e=>{var t=tt();f(e,t)},(e,t)=>{var r=Te(),M=pe(r);{var L=v=>{var g=Ve();f(v,g)},$=v=>{var g=et();fe(g,21,()=>a(t),me,(B,p)=>{var W=Xe(),ue=m(W);{var ve=I=>{var b=Ye(),A=pe(b),F=m(A);i(A);var k=H(A,2),X=m(k),q=H(m(X)),de=m(q);i(q),ce(),i(X),i(k),J((O,_e,ge,be,Ne,Ee)=>{P(F,`/${O??""}/${_e??""}`),R(k,"data",ge),R(k,"title",be),R(q,"href",Ne),P(de,`ipfs://${Ee??""}`)},[()=>{var O;return(O=a(p).get("path"))==null?void 0:O.join("/")},()=>a(p).get("container"),()=>qe({cid:a(p).get("child").properties.cid}),()=>`ipfs://${a(p).get("child").properties.cid}`,()=>`https://w3s.link/ipfs/${a(p).get("child").properties.cid}`,()=>a(p).get("child").properties.cid]),f(I,b)},he=I=>{var b=Qe();b.__click=[Ze,E,p];var A=m(b,!0);i(b),J((F,k)=>{R(b,"href",F),P(A,k)},[()=>`${a(d)}/${a(s).join("/")}${a(s).length>0?"/":""}${a(p).get("container")}`,()=>a(p).get("container")]),f(I,b)};V(ue,I=>{a(p).get("child").labels.includes("File")?I(ve):I(he,!1)})}i(W),f(B,W)}),i(g),f(v,g)};V(M,v=>{!a(t)||a(t).length===0?v(L):v($,!1)})}f(e,r)}),i(y),i(o),De("submit",n,_),f(u,o),Se()}je(["click"]);export{bt as component};
