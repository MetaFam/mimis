import"../chunks/CWj6FrbW.js";import{o as Ie}from"../chunks/cuBqFMTW.js";import{w as Ce,B as ke,h as M,F as Re,aI as ae,I as we,J as xe,C as Ae,K as se,aa as re,V as q,Y as oe,X as ie,P as J,v as Se,L as Oe,aJ as le,aK as ne,aL as ce,e as He,O as he,Q as G,as as Le,p as $e,aj as ue,ah as Pe,g as je,f as d,b as u,c as De,$ as Me,ai as fe,l as a,d as m,y as me,r as o,s as O,aM as Be,a as de,aN as Q,t as V}from"../chunks/DyJcJ3Y7.js";import{d as Fe,b as We,e as Ye,s as B}from"../chunks/THFJsEQF.js";import{i as X}from"../chunks/CmfBeWXP.js";import{e as ve,i as pe}from"../chunks/C7Rmo30o.js";import{h as ze}from"../chunks/BgZ3Q8g3.js";import{s as H}from"../chunks/DU3eORWj.js";import{T as Ke}from"../chunks/gcQ19k91.js";import{p as F}from"../chunks/DE6mnGE-.js";import{g as Ue}from"../chunks/_6bbJwjk.js";import{t as _e}from"../chunks/D2JTxiFN.js";import{s as qe}from"../chunks/BS9QdChZ.js";const Z=0,W=1,ee=2;function Je(v,f,s,N,_){M&&Re();var i=v,E=Ce(),T=He,l=re,n,c,x,y=E?oe(void 0):ie(void 0,!1,!1),L=E?oe(void 0):ie(void 0,!1,!1),I=!1;function C(t,r){I=!0,r&&(le(e),ne(e),ce(T));try{t===Z&&s&&(n?he(n):n=J(()=>s(i))),t===W&&N&&(c?he(c):c=J(()=>N(i,y))),t!==Z&&n&&G(n,()=>n=null),t!==W&&c&&G(c,()=>c=null),t!==ee&&x&&G(x,()=>x=null)}finally{r&&(ce(null),ne(null),le(null),Le())}}var e=ke(()=>{if(l===(l=f()))return;let t=M&&ae(l)===(i.data===we);if(t&&(i=xe(),Ae(i),se(!1),t=!0),ae(l)){var r=l;I=!1,r.then(b=>{r===l&&(q(y,b),C(W,!0))},b=>{if(r===l)throw q(L,b),C(ee,!0),L.v}),M?s&&(n=J(()=>s(i))):Se(()=>{I||C(Z,!0)})}else q(y,l),C(W,!1);return t&&se(!0),()=>l=re});M&&(i=Oe)}const Ge=async({path:v,limit:f=200,offset:s=0})=>{const N=Ue();try{const _=N.session();v=v.filter(T=>T.trim()!==""),f=parseInt(Number(f).toFixed(0)),s=parseInt(Number(s).toFixed(0));const i=v.length===0?`
        MATCH (start:Root)-[children:CONTAINS|CONNECTS]->(child)
        RETURN [] as path, children.path as container, child
      `:`
        WITH $elems as pathElems
        MATCH path = (start:Root)-[:CONTAINS|CONNECTS|EMBODIED_AS*]->(end)
        MATCH (end)-[children:CONTAINS|CONNECTS|ENTRY]->(child)
        WITH pathElems, path, children, child,
          [
            rel in relationships(path)
            WHERE NOT isEmpty(rel.path)
            | rel.path
          ] as elements
        WHERE size(elements) = size(pathElems)
        AND ALL(
          i IN range(0, size(pathElems) - 1)
          WHERE (
            pathElems[i] = '*'
            OR elements[i] = pathElems[i]
          )
        )
        ORDER BY children.order
        LIMIT ${s+f}
        SKIP ${s}
        RETURN DISTINCT
          elements as path,
          children.path as container,
          child
      `,E=await _.run(i,{elems:v,limit:BigInt(f),offset:BigInt(s)});return await _.close(),E.records}finally{N.close()}};var Qe=d('<link rel="icon" href="infinity%20eyes.svg"/>'),Ve=d('<li class="svelte-165lhoa"> <a class="button svelte-165lhoa">⨯</a></li>'),Xe=d('<ul id="path" class="svelte-165lhoa"></ul>'),Ze=d('<h2 class="svelte-165lhoa">No Results</h2>'),et=d('<h2 class="svelte-165lhoa"> </h2> <object class="svelte-165lhoa"><p>Could not display <a target="_blank"> </a>.</p></object>',1),tt=(v,f,s)=>{f(a(s))},at=d('<a class="button svelte-165lhoa"> </a>'),st=d("<li><!></li>"),rt=d('<ul id="result" class="svelte-165lhoa"></ul>'),ot=d('<h2 class="svelte-165lhoa">Searching…</h2>'),it=d('<main class="svelte-165lhoa"><form><input id="chip" placeholder="Path Element"/> <button>Add Path Element</button></form> <!> <section id="result" class="svelte-165lhoa"><!></section></main>');function Et(v,f){$e(f,!0);let s=ue(Pe([])),N=Q(async()=>{try{const e=F.url.searchParams.get("limit"),t=F.url.searchParams.get("offset");return await Ge({path:a(s),limit:e?Number(e):qe.limit,offset:Number(t)})}catch(e){Ke({text:e.message,duration:16e3,close:!0,gravity:"bottom",position:"center",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}}),_=ue("");Ie(()=>{fe(s,F.params.path.split("/").filter(Boolean),!0);const e=F.url.hash.split("/").filter(Boolean);fe(_,e.slice(0,e.length-a(s).length).join("/"),!0)});const i=e=>{e.preventDefault();const t=e.target.elements.chip;E(t.value),t.value=""},E=e=>{e=e.trim(),e&&a(s).push(e)},T=e=>{a(s).splice(e,1)},l=()=>{T(-1)};je(()=>{const e=t=>{t.key==="ArrowLeft"&&t.target===document.body&&l()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}});var n=it();ze(e=>{var t=Qe();Me.title="Mïmis: Search",u(e,t)});var c=m(n),x=m(c);We(x),me(2),o(c);var y=O(c,2);{var L=e=>{var t=Xe();ve(t,21,()=>a(s),pe,(r,b,$)=>{var A=Ve(),p=m(A),g=O(p);g.__click=()=>T($),o(A),V(Y=>{B(p,`${a(b)??""} `),H(g,"href",Y)},[()=>`${a(_)}/${a(s).toSpliced($,1).join("/")}`]),u(r,A)}),o(t),u(e,t)};X(y,e=>{a(s).length>0&&e(L)})}var I=O(y,2),C=m(I);Je(C,()=>a(N),e=>{var t=ot();u(e,t)},(e,t)=>{var r=Be(),b=de(r);{var $=p=>{var g=Ze();u(p,g)},A=p=>{var g=rt();ve(g,21,()=>a(t),pe,(Y,P)=>{var z=st();const K=Q(()=>a(P).get("container"));var ge=m(z);{var Ne=k=>{var h=et();const R=Q(()=>{var D;const{cid:w}=(D=a(P).get("child"))==null?void 0:D.properties;return{cid:w}});var S=de(h),be=m(S);o(S);var j=O(S,2),te=m(j),U=O(m(te)),Te=m(U);o(U),me(),o(te),o(j),V((w,D,ye)=>{B(be,`/${w??""}/${a(K)??""}`),H(j,"data",D),H(j,"title",`ipfs://${a(R).cid}`),H(U,"href",ye),B(Te,`ipfs://${a(R).cid??""}`)},[()=>{var w;return(w=a(P).get("path"))==null?void 0:w.join("/")},()=>_e({cid:a(R).cid}),()=>_e({cid:a(R).cid})]),u(k,h)},Ee=k=>{var h=at();h.__click=[tt,E,K];var R=m(h,!0);o(h),V(S=>{H(h,"href",S),B(R,a(K))},[()=>`${a(_)}/${a(s).join("/")}${a(s).length>0?"/":""}`]),u(k,h)};X(ge,k=>{var h;(h=a(P).get("child"))!=null&&h.labels.includes("File")?k(Ne):k(Ee,!1)})}o(z),u(Y,z)}),o(g),u(p,g)};X(b,p=>{!a(t)||a(t).length===0?p($):p(A,!1)})}u(e,r)}),o(I),o(n),Ye("submit",c,i),u(v,n),De()}Fe(["click"]);export{Et as component};
