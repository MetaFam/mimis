import{a as v,t as _,c as Te}from"../chunks/Bsj-NQsI.js";import{a5 as ye,o as Ee,m as U,n as Ce,aw as Ie,N as G,q as P,K as we,a9 as te,v as ke,Y as ae,X as se,ax as re,ay as ie,az as oe,G as K,w as X,aA as $e,h as Ae,p as He,x as le,b as Re,a as Se,y as ne,g as a,ah as je,s as R,c as f,ai as ce,r as i,k as Oe,f as ue,t as Y}from"../chunks/DO4L_uWg.js";import{s as L}from"../chunks/UoIJzOOc.js";import{i as Z}from"../chunks/DW8ttwO9.js";import{e as ve,i as fe}from"../chunks/BeaQxaJF.js";import{h as Pe}from"../chunks/Bo7GBFCY.js";import{s as S}from"../chunks/BZaGwHR2.js";import{d as Le,f as Me,j as De}from"../chunks/GRvchWQq.js";import{p as J}from"../chunks/CYILlETY.js";import{o as We}from"../chunks/BEeeU2Fi.js";import{T as ze}from"../chunks/CQbym6Aj.js";import{p as M}from"../chunks/8DDgyaEb.js";import{g as Be}from"../chunks/DNkIYehj.js";import{t as Fe}from"../chunks/Y-kwivDR.js";import{s as qe}from"../chunks/CbS4niEA.js";const Q=0,D=1,V=2;function Ue(h,n,s,x,p){U&&Ce();var m=h,T=ye(),y=Ae,c=te,o,l,g,E=(T?ae:se)(void 0),$=(T?ae:se)(void 0),C=!1;function I(t,r){C=!0,r&&(re(e),ie(e),oe(y));try{t===Q&&s&&(o?K(o):o=P(()=>s(m))),t===D&&x&&(l?K(l):l=P(()=>x(m,E))),t===V&&p&&(g?K(g):g=P(()=>p(m,$))),t!==Q&&o&&X(o,()=>o=null),t!==D&&l&&X(l,()=>l=null),t!==V&&g&&X(g,()=>g=null)}finally{r&&(oe(null),ie(null),re(null),$e())}}var e=Ee(()=>{if(c!==(c=n())){if(Ie(c)){var t=c;C=!1,t.then(r=>{t===c&&(G(E,r),I(D,!0))},r=>{if(t===c)throw G($,r),I(V,!0),$.v}),U?s&&(o=P(()=>s(m))):we(()=>{C||I(Q,!0)})}else G(E,c),I(D,!1);return()=>c=te}});U&&(m=ke)}const Ge=async({path:h,limit:n=200,offset:s=0})=>{const x=Be();try{const p=x.session();h=h.filter(y=>y.trim()!==""),n=parseInt(Number(n).toFixed(0)),s=parseInt(Number(s).toFixed(0));const m=h.length===0?`
        MATCH (start:Root)-[children:CONTAINS|CONNECTS]->(child)
        RETURN [] as path, children.path as container, child
      `:`
        WITH $elems as pathElems
        MATCH path = (start:Root)-[:CONTAINS|CONNECTS*]->(end)
        MATCH (end)-[children:CONTAINS|CONNECTS]->(child)
        WITH pathElems, path, children, child, [
          rel in relationships(path)
          WHERE NOT isEmpty(rel.path)
          | rel.path
        ] as elements
        WHERE size(elements) = size(pathElems)
        AND ALL(
          i IN range(0, size(pathElems) - 1)
          WHERE (
            pathElems[i] = '*'
            OR elements[i] = pathElems[i]
          )
        )
        LIMIT ${s+n}
        SKIP ${s}
        RETURN DISTINCT
          elements as path,
          children.path as container,
          child
      `,T=await p.run(m,{elems:h,limit:BigInt(n),offset:BigInt(s)});return await p.close(),T.records}finally{x.close()}};var Ke=_('<li class="svelte-11xv3gd"> <a class="button svelte-11xv3gd">⨯</a></li>'),Xe=_('<ul id="path" class="svelte-11xv3gd"></ul>'),Ye=_('<h2 class="svelte-11xv3gd">No Results</h2>'),Ze=_('<h2 class="svelte-11xv3gd"> </h2> <object class="svelte-11xv3gd"><p>Could not display <a target="_blank"> </a>.</p></object>',1),Je=(h,n,s)=>{console.debug("H!"),n(a(s).get("container"))},Qe=_('<a class="button"> </a>'),Ve=_("<li><!></li>"),et=_('<ul id="result" class="svelte-11xv3gd"></ul>'),tt=_('<h2 class="svelte-11xv3gd">Searching…</h2>'),at=_('<main class="svelte-11xv3gd"><form><input id="chip" placeholder="Path Element"> <button>Add Path Element</button></form> <!> <section id="result" class="svelte-11xv3gd"><!></section></main>');function gt(h,n){He(n,!0);let s=le(J([])),x=Oe(async()=>{try{const e=M.url.searchParams.get("limit"),t=M.url.searchParams.get("offset");return await Ge({path:a(s),limit:e?Number(e):qe.limit,offset:Number(t)})}catch(e){ze({text:e.message,duration:16e3,close:!0,gravity:"bottom",position:"center",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}}),p=le("");We(()=>{ne(s,J(M.params.path.split("/").filter(Boolean)));const e=M.url.hash.split("/").filter(Boolean);ne(p,J(e.slice(0,e.length-a(s).length).join("/")))});const m=e=>{e.preventDefault();const t=e.target.elements.chip;T(t.value),t.value=""},T=e=>{e=e.trim(),e&&a(s).push(e)},y=e=>{a(s).splice(e,1)},c=()=>{y(-1)};Re(()=>{const e=t=>{t.key==="ArrowLeft"&&t.target===document.body&&c()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}});var o=at();Pe(e=>{je.title="Mïmis: Search"});var l=f(o),g=f(l);Me(g,!0),ce(2),i(l);var E=R(l,2);{var $=e=>{var t=Xe();ve(t,21,()=>a(s),fe,(r,W,j)=>{var A=Ke(),d=f(A),b=R(d);b.__click=()=>y(j),i(A),Y(z=>{L(d,`${a(W)??""} `),S(b,"href",z)},[()=>`${a(p)}/${a(s).toSpliced(j,1).join("/")}`]),v(r,A)}),i(t),v(e,t)};Z(E,e=>{a(s).length>0&&e($)})}var C=R(E,2),I=f(C);Ue(I,()=>a(x),e=>{var t=tt();v(e,t)},(e,t)=>{var r=Te(),W=ue(r);{var j=d=>{var b=Ye();v(d,b)},A=d=>{var b=et();ve(b,21,()=>a(t),fe,(z,u)=>{var B=Ve(),he=f(B);{var pe=w=>{var N=Ze(),H=ue(N),F=f(H);i(H);var k=R(H,2),ee=f(k),q=R(f(ee)),de=f(q);i(q),ce(),i(ee),i(k),Y((O,_e,ge,be,Ne,xe)=>{L(F,`/${O??""}/${_e??""}`),S(k,"data",ge),S(k,"title",be),S(q,"href",Ne),L(de,`ipfs://${xe??""}`)},[()=>{var O;return(O=a(u).get("path"))==null?void 0:O.join("/")},()=>a(u).get("container"),()=>Fe({cid:a(u).get("child").properties.cid}),()=>`ipfs://${a(u).get("child").properties.cid}`,()=>`https://w3s.link/ipfs/${a(u).get("child").properties.cid}`,()=>a(u).get("child").properties.cid]),v(w,N)},me=w=>{var N=Qe();N.__click=[Je,T,u];var H=f(N,!0);i(N),Y((F,k)=>{S(N,"href",F),L(H,k)},[()=>`${a(p)}/${a(s).join("/")}${a(s).length>0?"/":""}${a(u).get("container")}`,()=>a(u).get("container")]),v(w,N)};Z(he,w=>{a(u).get("child").labels.includes("File")?w(pe):w(me,!1)})}i(B),v(z,B)}),i(b),v(d,b)};Z(W,d=>{!a(t)||a(t).length===0?d(j):d(A,!1)})}v(e,r)}),i(C),i(o),De("submit",l,m),v(h,o),Se()}Le(["click"]);export{gt as component};
