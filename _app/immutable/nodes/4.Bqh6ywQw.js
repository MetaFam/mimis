import{a as v,t as _,c as Te}from"../chunks/BRSNPvHI.js";import{a3 as Ee,o as ye,m as U,n as Ce,aw as Ie,L as G,q as O,G as we,a7 as te,v as ke,W as ae,V as se,ax as re,ay as ie,az as oe,D as K,w as V,aA as $e,h as Ae,p as He,ai as le,b as Re,a as Se,ac as ne,g as a,ag as je,s as R,c as f,as as ce,r as i,k as Le,f as ue,t as Z}from"../chunks/QhIMCl9r.js";import{s as P}from"../chunks/DtgeDXES.js";import{i as J}from"../chunks/B368kSxc.js";import{e as ve,i as fe}from"../chunks/4bQanyia.js";import{h as Oe}from"../chunks/DzrHZ7o-.js";import{s as S}from"../chunks/UU1MBGZW.js";import{d as Pe,f as De,j as Me}from"../chunks/TWpPyyqi.js";import{p as Q}from"../chunks/C5ryocCe.js";import{o as We}from"../chunks/h9cROaWF.js";import{T as ze}from"../chunks/COzGs9ai.js";import{p as D}from"../chunks/CcexVjVP.js";import{g as Be}from"../chunks/CiQlUipU.js";import{t as Fe}from"../chunks/DFNcLKz5.js";import{s as qe}from"../chunks/CvHhx5eH.js";const X=0,M=1,Y=2;function Ue(p,n,s,x,h){U&&Ce();var m=p,T=Ee(),E=Ae,c=te,o,l,g,y=(T?ae:se)(void 0),$=(T?ae:se)(void 0),C=!1;function I(t,r){C=!0,r&&(re(e),ie(e),oe(E));try{t===X&&s&&(o?K(o):o=O(()=>s(m))),t===M&&x&&(l?K(l):l=O(()=>x(m,y))),t===Y&&h&&(g?K(g):g=O(()=>h(m,$))),t!==X&&o&&V(o,()=>o=null),t!==M&&l&&V(l,()=>l=null),t!==Y&&g&&V(g,()=>g=null)}finally{r&&(oe(null),ie(null),re(null),$e())}}var e=ye(()=>{if(c!==(c=n())){if(Ie(c)){var t=c;C=!1,t.then(r=>{t===c&&(G(y,r),I(M,!0))},r=>{if(t===c)throw G($,r),I(Y,!0),$.v}),U?s&&(o=O(()=>s(m))):we(()=>{C||I(X,!0)})}else G(y,c),I(M,!1);return()=>c=te}});U&&(m=ke)}const Ge=async({path:p,limit:n=200,offset:s=0})=>{const x=Be();try{const h=x.session();p=p.filter(E=>E.trim()!==""),n=parseInt(Number(n).toFixed(0)),s=parseInt(Number(s).toFixed(0));const m=p.length===0?`
        MATCH (start:Root)-[children:CONTAINS|CONNECTS]->(child)
        RETURN [] as path, children.path as container, child
      `:`
        WITH $elems as pathElems
        MATCH path = (start:Root)-[:CONTAINS|CONNECTS*]->(end)
        MATCH (end)-[children:CONTAINS|CONNECTS]->(child)
        WITH pathElems, path, children, child, [
          rel in relationships(path)
          WHERE NOT isEmpty(rel.path)
          | rel.path
        ] as elements
        WHERE size(elements) = size(pathElems)
        AND ALL(
          i IN range(0, size(pathElems) - 1)
          WHERE (
            pathElems[i] = '*'
            OR elements[i] = pathElems[i]
          )
        )
        LIMIT ${s+n}
        SKIP ${s}
        RETURN DISTINCT
          elements as path,
          children.path as container,
          child
      `,T=await h.run(m,{elems:p,limit:BigInt(n),offset:BigInt(s)});return await h.close(),T.records}finally{x.close()}};var Ke=_('<li class="svelte-11xv3gd"> <a class="button svelte-11xv3gd">⨯</a></li>'),Ve=_('<ul id="path" class="svelte-11xv3gd"></ul>'),Ze=_('<h2 class="svelte-11xv3gd">No Results</h2>'),Je=_('<h2 class="svelte-11xv3gd"> </h2> <object class="svelte-11xv3gd"><p>Could not display <a target="_blank"> </a>.</p></object>',1),Qe=(p,n,s)=>{console.debug("H!"),n(a(s).get("container"))},Xe=_('<a class="button"> </a>'),Ye=_("<li><!></li>"),et=_('<ul id="result" class="svelte-11xv3gd"></ul>'),tt=_('<h2 class="svelte-11xv3gd">Searching…</h2>'),at=_('<main class="svelte-11xv3gd"><form><input id="chip" placeholder="Path Element"> <button>Add Path Element</button></form> <!> <section id="result" class="svelte-11xv3gd"><!></section></main>');function gt(p,n){He(n,!0);let s=le(Q([])),x=Le(async()=>{try{const e=D.url.searchParams.get("limit"),t=D.url.searchParams.get("offset");return await Ge({path:a(s),limit:e?Number(e):qe.limit,offset:Number(t)})}catch(e){ze({text:e.message,duration:16e3,close:!0,gravity:"bottom",position:"center",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}}),h=le("");We(()=>{ne(s,Q(D.params.path.split("/").filter(Boolean)));const e=D.url.hash.split("/").filter(Boolean);ne(h,Q(e.slice(0,e.length-a(s).length).join("/")))});const m=e=>{e.preventDefault();const t=e.target.elements.chip;T(t.value),t.value=""},T=e=>{e=e.trim(),e&&a(s).push(e)},E=e=>{a(s).splice(e,1)},c=()=>{E(-1)};Re(()=>{const e=t=>{t.key==="ArrowLeft"&&t.target===document.body&&c()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}});var o=at();Oe(e=>{je.title="Mïmis: Search"});var l=f(o),g=f(l);De(g,!0),ce(2),i(l);var y=R(l,2);{var $=e=>{var t=Ve();ve(t,21,()=>a(s),fe,(r,W,j)=>{var A=Ke(),d=f(A),b=R(d);b.__click=()=>E(j),i(A),Z(z=>{P(d,`${a(W)??""} `),S(b,"href",z)},[()=>`${a(h)}/${a(s).toSpliced(j,1).join("/")}`]),v(r,A)}),i(t),v(e,t)};J(y,e=>{a(s).length>0&&e($)})}var C=R(y,2),I=f(C);Ue(I,()=>a(x),e=>{var t=tt();v(e,t)},(e,t)=>{var r=Te(),W=ue(r);{var j=d=>{var b=Ze();v(d,b)},A=d=>{var b=et();ve(b,21,()=>a(t),fe,(z,u)=>{var B=Ye(),pe=f(B);{var he=w=>{var N=Je(),H=ue(N),F=f(H);i(H);var k=R(H,2),ee=f(k),q=R(f(ee)),de=f(q);i(q),ce(),i(ee),i(k),Z((L,_e,ge,be,Ne,xe)=>{P(F,`/${L??""}/${_e??""}`),S(k,"data",ge),S(k,"title",be),S(q,"href",Ne),P(de,`ipfs://${xe??""}`)},[()=>{var L;return(L=a(u).get("path"))==null?void 0:L.join("/")},()=>a(u).get("container"),()=>Fe({cid:a(u).get("child").properties.cid}),()=>`ipfs://${a(u).get("child").properties.cid}`,()=>`https://w3s.link/ipfs/${a(u).get("child").properties.cid}`,()=>a(u).get("child").properties.cid]),v(w,N)},me=w=>{var N=Xe();N.__click=[Qe,T,u];var H=f(N,!0);i(N),Z((F,k)=>{S(N,"href",F),P(H,k)},[()=>`${a(h)}/${a(s).join("/")}${a(s).length>0?"/":""}${a(u).get("container")}`,()=>a(u).get("container")]),v(w,N)};J(pe,w=>{a(u).get("child").labels.includes("File")?w(he):w(me,!1)})}i(B),v(z,B)}),i(b),v(d,b)};J(W,d=>{!a(t)||a(t).length===0?d(j):d(A,!1)})}v(e,r)}),i(C),i(o),Me("submit",l,m),v(p,o),Se()}Pe(["click"]);export{gt as component};
