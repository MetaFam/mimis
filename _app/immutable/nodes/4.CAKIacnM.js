import{a as v,t as _,c as Te}from"../chunks/D4b2_asw.js";import{_ as Ee,v as ye,o as q,x as Ce,aB as Ie,L as G,C as P,G as ke,au as te,A as we,X as ae,W as se,ay as re,ax as ie,aC as oe,B as K,D as X,aD as $e,h as Ae,p as He,m as le,b as Re,a as Se,n as ne,g as a,a9 as Le,s as R,c as h,aa as ce,r as i,k as Oe,t as Z,f as ue}from"../chunks/C2cU29iA.js";import{s as j}from"../chunks/D-AJUD6o.js";import{p as J,a as Q}from"../chunks/LQSnVXXT.js";import{e as ve,i as he}from"../chunks/BXCa0iT1.js";import{h as Pe}from"../chunks/j4HOt26g.js";import{s as S}from"../chunks/DedBp538.js";import{d as je,e as De}from"../chunks/DvtKE-QB.js";import{b as Be}from"../chunks/DA6ZEFMR.js";import{o as Me}from"../chunks/B5IFr7d-.js";import{g as We,T as Fe}from"../chunks/BWr02cJ3.js";import{p as D}from"../chunks/B-ulNlni.js";import{t as ze}from"../chunks/Dia6hboS.js";import{s as Ue}from"../chunks/B0xS4FvI.js";const V=0,B=1,Y=2;function qe(p,n,s,x,f){q&&Ce();var m=p,T=Ee(),E=Ae,c=te,o,l,g,y=(T?ae:se)(void 0),$=(T?ae:se)(void 0),C=!1;function I(t,r){C=!0,r&&(re(e),ie(e),oe(E));try{t===V&&s&&(o?K(o):o=P(()=>s(m))),t===B&&x&&(l?K(l):l=P(()=>x(m,y))),t===Y&&f&&(g?K(g):g=P(()=>f(m,$))),t!==V&&o&&X(o,()=>o=null),t!==B&&l&&X(l,()=>l=null),t!==Y&&g&&X(g,()=>g=null)}finally{r&&(oe(null),ie(null),re(null),$e())}}var e=ye(()=>{if(c!==(c=n())){if(Ie(c)){var t=c;C=!1,t.then(r=>{t===c&&(G(y,r),I(B,!0))},r=>{if(t===c)throw G($,r),I(Y,!0),$.v}),q?s&&(o=P(()=>s(m))):ke(()=>{C||I(V,!0)})}else G(y,c),I(B,!1);return()=>c=te}});q&&(m=we)}const Ge=async({path:p,limit:n=200,offset:s=0})=>{const x=We();try{const f=x.session();p=p.filter(E=>E.trim()!==""),n=parseInt(Number(n).toFixed(0)),s=parseInt(Number(s).toFixed(0));const m=p.length===0?`
        MATCH (start:Root)-[children:CONTAINS|CONNECTS]->(child)
        RETURN [] as path, children.path as container, child
      `:`
        WITH $elems as pathElems
        MATCH path = (start:Root)-[:CONTAINS|CONNECTS*]->(end)
        MATCH (end)-[children:CONTAINS|CONNECTS]->(child)
        WITH pathElems, path, children, child, [
          rel in relationships(path)
          WHERE NOT isEmpty(rel.path)
          | rel.path
        ] as elements
        WHERE size(elements) = size(pathElems)
        AND ALL(
          i IN range(0, size(pathElems) - 1)
          WHERE (
            pathElems[i] = '*'
            OR elements[i] = pathElems[i]
          )
        )
        LIMIT ${s+n}
        SKIP ${s}
        RETURN DISTINCT
          elements as path,
          children.path as container,
          child
      `,T=await f.run(m,{elems:p,limit:BigInt(n),offset:BigInt(s)});return await f.close(),T.records}finally{x.close()}};var Ke=_('<li class="svelte-11xv3gd"> <a class="button svelte-11xv3gd">⨯</a></li>'),Xe=_('<ul id="path" class="svelte-11xv3gd"></ul>'),Ze=_('<h2 class="svelte-11xv3gd">No Results</h2>'),Je=_('<h2 class="svelte-11xv3gd"> </h2> <object class="svelte-11xv3gd"><p>Could not display <a target="_blank"> </a>.</p></object>',1),Qe=(p,n,s)=>{console.debug("H!"),n(a(s).get("container"))},Ve=_('<a class="button"> </a>'),Ye=_("<li><!></li>"),et=_('<ul id="result" class="svelte-11xv3gd"></ul>'),tt=_('<h2 class="svelte-11xv3gd">Searching…</h2>'),at=_('<main class="svelte-11xv3gd"><form><input id="chip" placeholder="Path Element"> <button>Add Path Element</button></form> <!> <section id="result" class="svelte-11xv3gd"><!></section></main>');function _t(p,n){He(n,!0);let s=le(J([])),x=Oe(async()=>{try{const e=D.url.searchParams.get("limit"),t=D.url.searchParams.get("offset");return await Ge({path:a(s),limit:e?Number(e):Ue.limit,offset:Number(t)})}catch(e){Fe({text:e.message,duration:16e3,close:!0,gravity:"bottom",position:"center",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}}),f=le("");Me(()=>{ne(s,J(D.params.path.split("/").filter(Boolean)));const e=D.url.hash.split("/").filter(Boolean);ne(f,J(e.slice(0,e.length-a(s).length).join("/")))});const m=e=>{e.preventDefault();const t=e.target.elements.chip;T(t.value),t.value=""},T=e=>{e=e.trim(),e&&a(s).push(e)},E=e=>{a(s).splice(e,1)},c=()=>{E(-1)};Re(()=>{const e=t=>{t.key==="ArrowLeft"&&t.target===document.body&&c()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}});var o=at();Pe(e=>{Le.title="Mïmis: Search"});var l=h(o),g=h(l);Be(g),ce(2),i(l);var y=R(l,2);{var $=e=>{var t=Xe();ve(t,21,()=>a(s),he,(r,M,L)=>{var A=Ke(),d=h(A),b=R(d);b.__click=()=>E(L),i(A),Z(W=>{j(d,`${a(M)??""} `),S(b,"href",W)},[()=>`${a(f)}/${a(s).toSpliced(L,1).join("/")}`]),v(r,A)}),i(t),v(e,t)};Q(y,e=>{a(s).length>0&&e($)})}var C=R(y,2),I=h(C);qe(I,()=>a(x),e=>{var t=tt();v(e,t)},(e,t)=>{var r=Te(),M=ue(r);{var L=d=>{var b=Ze();v(d,b)},A=d=>{var b=et();ve(b,21,()=>a(t),he,(W,u)=>{var F=Ye(),pe=h(F);{var fe=k=>{var N=Je(),H=ue(N),z=h(H);i(H);var w=R(H,2),ee=h(w),U=R(h(ee)),de=h(U);i(U),ce(),i(ee),i(w),Z((O,_e,ge,be,Ne,xe)=>{j(z,`/${O??""}/${_e??""}`),S(w,"data",ge),S(w,"title",be),S(U,"href",Ne),j(de,`ipfs://${xe??""}`)},[()=>{var O;return(O=a(u).get("path"))==null?void 0:O.join("/")},()=>a(u).get("container"),()=>ze({cid:a(u).get("child").properties.cid}),()=>`ipfs://${a(u).get("child").properties.cid}`,()=>`https://w3s.link/ipfs/${a(u).get("child").properties.cid}`,()=>a(u).get("child").properties.cid]),v(k,N)},me=k=>{var N=Ve();N.__click=[Qe,T,u];var H=h(N,!0);i(N),Z((z,w)=>{S(N,"href",z),j(H,w)},[()=>`${a(f)}/${a(s).join("/")}${a(s).length>0?"/":""}${a(u).get("container")}`,()=>a(u).get("container")]),v(k,N)};Q(pe,k=>{a(u).get("child").labels.includes("File")?k(fe):k(me,!1)})}i(F),v(W,F)}),i(b),v(d,b)};Q(M,d=>{!a(t)||a(t).length===0?d(L):d(A,!1)})}v(e,r)}),i(C),i(o),De("submit",l,m),v(p,o),Se()}je(["click"]);export{_t as component};
