import{t as p,a as h,c as Ee}from"../chunks/Br-l2XOM.js";import{x as ye,C as Ce,l as j,G as Ie,aA as V,I as we,J as ke,D as Ae,K as ee,a8 as te,U as q,X as ae,W as se,O as G,w as Se,L as $e,ax as re,aw as ie,aB as oe,b as He,N as ne,P as K,aC as Re,p as Oe,m as le,o as Le,d as Pe,a as je,af as De,n as ce,i as a,c as d,z as ue,r as i,s as H,f as fe,aD as Me,t as J}from"../chunks/eyN12E4_.js";import{s as D}from"../chunks/CbzotAth.js";import{i as X}from"../chunks/BpDf-klp.js";import{e as he,i as de}from"../chunks/BUfZNEK7.js";import{h as We}from"../chunks/C4bKyMxN.js";import{s as R}from"../chunks/B9gGqUDe.js";import{d as Be,e as ze}from"../chunks/B3QevTHV.js";import{b as Fe}from"../chunks/CXqLH41f.js";import{o as Ue}from"../chunks/CvMMwwiZ.js";import{g as qe,T as Ge}from"../chunks/0w5civ17.js";import{p as M}from"../chunks/3stBrB6o.js";import{t as Ke}from"../chunks/B-HG4tQG.js";import{s as Je}from"../chunks/BSzDp1r6.js";const Y=0,W=1,Z=2;function Xe(v,u,s,N,_){j&&Ie();var o=v,T=ye(),E=He,n=te,l,c,A,y=(T?ae:se)(void 0),O=(T?ae:se)(void 0),C=!1;function I(t,r){C=!0,r&&(re(e),ie(e),oe(E));try{t===Y&&s&&(l?ne(l):l=G(()=>s(o))),t===W&&N&&(c?ne(c):c=G(()=>N(o,y))),t!==Y&&l&&K(l,()=>l=null),t!==W&&c&&K(c,()=>c=null),t!==Z&&A&&K(A,()=>A=null)}finally{r&&(oe(null),ie(null),re(null),Re())}}var e=Ce(()=>{if(n===(n=u()))return;let t=j&&V(n)===(o.data===we);if(t&&(o=ke(),Ae(o),ee(!1),t=!0),V(n)){var r=n;C=!1,r.then(x=>{r===n&&(q(y,x),I(W,!0))},x=>{if(r===n)throw q(O,x),I(Z,!0),O.v}),j?s&&(l=G(()=>s(o))):Se(()=>{C||I(Y,!0)})}else q(y,n),I(W,!1);return t&&ee(!0),()=>n=te});j&&(o=$e)}const Ye=async({path:v,limit:u=200,offset:s=0})=>{const N=qe();try{const _=N.session();v=v.filter(E=>E.trim()!==""),u=parseInt(Number(u).toFixed(0)),s=parseInt(Number(s).toFixed(0));const o=v.length===0?`
        MATCH (start:Root)-[children:CONTAINS|CONNECTS]->(child)
        RETURN [] as path, children.path as container, child
      `:`
        WITH $elems as pathElems
        MATCH path = (start:Root)-[:CONTAINS|CONNECTS*]->(end)
        MATCH (end)-[children:CONTAINS|CONNECTS]->(child)
        WITH pathElems, path, children, child, [
          rel in relationships(path)
          WHERE NOT isEmpty(rel.path)
          | rel.path
        ] as elements
        WHERE size(elements) = size(pathElems)
        AND ALL(
          i IN range(0, size(pathElems) - 1)
          WHERE (
            pathElems[i] = '*'
            OR elements[i] = pathElems[i]
          )
        )
        LIMIT ${s+u}
        SKIP ${s}
        RETURN DISTINCT
          elements as path,
          children.path as container,
          child
      `,T=await _.run(o,{elems:v,limit:BigInt(u),offset:BigInt(s)});return await _.close(),T.records}finally{N.close()}};var Ze=p('<li class="svelte-11xv3gd"> <a class="button svelte-11xv3gd">⨯</a></li>'),Qe=p('<ul id="path" class="svelte-11xv3gd"></ul>'),Ve=p('<h2 class="svelte-11xv3gd">No Results</h2>'),et=p('<h2 class="svelte-11xv3gd"> </h2> <object class="svelte-11xv3gd"><p>Could not display <a target="_blank"> </a>.</p></object>',1),tt=(v,u,s)=>{console.debug("H!"),u(a(s).get("container"))},at=p('<a class="button"> </a>'),st=p("<li><!></li>"),rt=p('<ul id="result" class="svelte-11xv3gd"></ul>'),it=p('<h2 class="svelte-11xv3gd">Searching…</h2>'),ot=p('<main class="svelte-11xv3gd"><form><input id="chip" placeholder="Path Element"> <button>Add Path Element</button></form> <!> <section id="result" class="svelte-11xv3gd"><!></section></main>');function Tt(v,u){Oe(u,!0);let s=le(Le([])),N=Me(async()=>{try{const e=M.url.searchParams.get("limit"),t=M.url.searchParams.get("offset");return await Ye({path:a(s),limit:e?Number(e):Je.limit,offset:Number(t)})}catch(e){Ge({text:e.message,duration:16e3,close:!0,gravity:"bottom",position:"center",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}}),_=le("");Ue(()=>{ce(s,M.params.path.split("/").filter(Boolean),!0);const e=M.url.hash.split("/").filter(Boolean);ce(_,e.slice(0,e.length-a(s).length).join("/"),!0)});const o=e=>{e.preventDefault();const t=e.target.elements.chip;T(t.value),t.value=""},T=e=>{e=e.trim(),e&&a(s).push(e)},E=e=>{a(s).splice(e,1)},n=()=>{E(-1)};Pe(()=>{const e=t=>{t.key==="ArrowLeft"&&t.target===document.body&&n()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}});var l=ot();We(e=>{De.title="Mïmis: Search"});var c=d(l),A=d(c);Fe(A),ue(2),i(c);var y=H(c,2);{var O=e=>{var t=Qe();he(t,21,()=>a(s),de,(r,x,L)=>{var S=Ze(),m=d(S),g=H(m);g.__click=()=>E(L),i(S),J(B=>{D(m,`${a(x)??""} `),R(g,"href",B)},[()=>`${a(_)}/${a(s).toSpliced(L,1).join("/")}`]),h(r,S)}),i(t),h(e,t)};X(y,e=>{a(s).length>0&&e(O)})}var C=H(y,2),I=d(C);Xe(I,()=>a(N),e=>{var t=it();h(e,t)},(e,t)=>{var r=Ee(),x=fe(r);{var L=m=>{var g=Ve();h(m,g)},S=m=>{var g=rt();he(g,21,()=>a(t),de,(B,f)=>{var z=st(),ve=d(z);{var me=w=>{var b=et(),$=fe(b),F=d($);i($);var k=H($,2),Q=d(k),U=H(d(Q)),_e=d(U);i(U),ue(),i(Q),i(k),J((P,ge,be,Ne,Te,xe)=>{D(F,`/${P??""}/${ge??""}`),R(k,"data",be),R(k,"title",Ne),R(U,"href",Te),D(_e,`ipfs://${xe??""}`)},[()=>{var P;return(P=a(f).get("path"))==null?void 0:P.join("/")},()=>a(f).get("container"),()=>Ke({cid:a(f).get("child").properties.cid}),()=>`ipfs://${a(f).get("child").properties.cid}`,()=>`https://w3s.link/ipfs/${a(f).get("child").properties.cid}`,()=>a(f).get("child").properties.cid]),h(w,b)},pe=w=>{var b=at();b.__click=[tt,T,f];var $=d(b,!0);i(b),J((F,k)=>{R(b,"href",F),D($,k)},[()=>`${a(_)}/${a(s).join("/")}${a(s).length>0?"/":""}${a(f).get("container")}`,()=>a(f).get("container")]),h(w,b)};X(ve,w=>{a(f).get("child").labels.includes("File")?w(me):w(pe,!1)})}i(z),h(B,z)}),i(g),h(m,g)};X(x,m=>{!a(t)||a(t).length===0?m(L):m(S,!1)})}h(e,r)}),i(C),i(l),ze("submit",c,o),h(v,l),je()}Be(["click"]);export{Tt as component};
