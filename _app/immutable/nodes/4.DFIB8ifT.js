import{a as v,t as _,c as Te}from"../chunks/B0aKdqwy.js";import{a5 as Ee,o as ye,m as U,n as Ce,at as Ie,N as G,q as j,K as we,a9 as te,v as ke,Y as ae,X as se,au as re,av as ie,aw as oe,G as K,w as X,ax as $e,h as Ae,p as He,x as le,b as Se,a as Re,y as ne,g as a,ah as Oe,s as S,c as h,ai as ce,r as i,k as Pe,f as ue,t as Y}from"../chunks/CQfgzv8N.js";import{s as L}from"../chunks/Dt4mPaC1.js";import{i as Z}from"../chunks/CO0nzAtl.js";import{e as ve,i as he}from"../chunks/BqyEloG3.js";import{h as je}from"../chunks/CGHArPXR.js";import{s as R}from"../chunks/D1uSOVHS.js";import{d as Le,b as Me,e as De}from"../chunks/Dl6e9S1K.js";import{p as J}from"../chunks/DNA0eAxf.js";import{o as We}from"../chunks/CAkIlCIN.js";import{T as Be}from"../chunks/CQbym6Aj.js";import{p as M}from"../chunks/DiWnjXnh.js";import{g as Fe}from"../chunks/CNmKjQyg.js";import{t as qe}from"../chunks/Dh12mlPd.js";import{s as ze}from"../chunks/DUmr2o37.js";const Q=0,D=1,V=2;function Ue(p,n,s,x,f){U&&Ce();var m=p,T=Ee(),E=Ae,c=te,o,l,g,y=(T?ae:se)(void 0),$=(T?ae:se)(void 0),C=!1;function I(t,r){C=!0,r&&(re(e),ie(e),oe(E));try{t===Q&&s&&(o?K(o):o=j(()=>s(m))),t===D&&x&&(l?K(l):l=j(()=>x(m,y))),t===V&&f&&(g?K(g):g=j(()=>f(m,$))),t!==Q&&o&&X(o,()=>o=null),t!==D&&l&&X(l,()=>l=null),t!==V&&g&&X(g,()=>g=null)}finally{r&&(oe(null),ie(null),re(null),$e())}}var e=ye(()=>{if(c!==(c=n())){if(Ie(c)){var t=c;C=!1,t.then(r=>{t===c&&(G(y,r),I(D,!0))},r=>{if(t===c)throw G($,r),I(V,!0),$.v}),U?s&&(o=j(()=>s(m))):we(()=>{C||I(Q,!0)})}else G(y,c),I(D,!1);return()=>c=te}});U&&(m=ke)}const Ge=async({path:p,limit:n=200,offset:s=0})=>{const x=Fe();try{const f=x.session();p=p.filter(E=>E.trim()!==""),n=parseInt(Number(n).toFixed(0)),s=parseInt(Number(s).toFixed(0));const m=p.length===0?`
        MATCH (start:Root)-[children:CONTAINS|CONNECTS]->(child)
        RETURN [] as path, children.path as container, child
      `:`
        WITH $elems as pathElems
        MATCH path = (start:Root)-[:CONTAINS|CONNECTS*]->(end)
        MATCH (end)-[children:CONTAINS|CONNECTS]->(child)
        WITH pathElems, path, children, child, [
          rel in relationships(path)
          WHERE NOT isEmpty(rel.path)
          | rel.path
        ] as elements
        WHERE size(elements) = size(pathElems)
        AND ALL(
          i IN range(0, size(pathElems) - 1)
          WHERE (
            pathElems[i] = '*'
            OR elements[i] = pathElems[i]
          )
        )
        LIMIT ${s+n}
        SKIP ${s}
        RETURN DISTINCT
          elements as path,
          children.path as container,
          child
      `,T=await f.run(m,{elems:p,limit:BigInt(n),offset:BigInt(s)});return await f.close(),T.records}finally{x.close()}};var Ke=_('<li class="svelte-11xv3gd"> <a class="button svelte-11xv3gd">⨯</a></li>'),Xe=_('<ul id="path" class="svelte-11xv3gd"></ul>'),Ye=_('<h2 class="svelte-11xv3gd">No Results</h2>'),Ze=_('<h2 class="svelte-11xv3gd"> </h2> <object class="svelte-11xv3gd"><p>Could not display <a target="_blank"> </a>.</p></object>',1),Je=(p,n,s)=>{console.debug("H!"),n(a(s).get("container"))},Qe=_('<a class="button"> </a>'),Ve=_("<li><!></li>"),et=_('<ul id="result" class="svelte-11xv3gd"></ul>'),tt=_('<h2 class="svelte-11xv3gd">Searching…</h2>'),at=_('<main class="svelte-11xv3gd"><form><input id="chip" placeholder="Path Element"> <button>Add Path Element</button></form> <!> <section id="result" class="svelte-11xv3gd"><!></section></main>');function gt(p,n){He(n,!0);let s=le(J([])),x=Pe(async()=>{try{const e=M.url.searchParams.get("limit"),t=M.url.searchParams.get("offset");return await Ge({path:a(s),limit:e?Number(e):ze.limit,offset:Number(t)})}catch(e){Be({text:e.message,duration:16e3,close:!0,gravity:"bottom",position:"center",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}}),f=le("");We(()=>{ne(s,J(M.params.path.split("/").filter(Boolean)));const e=M.url.hash.split("/").filter(Boolean);ne(f,J(e.slice(0,e.length-a(s).length).join("/")))});const m=e=>{e.preventDefault();const t=e.target.elements.chip;T(t.value),t.value=""},T=e=>{e=e.trim(),e&&a(s).push(e)},E=e=>{a(s).splice(e,1)},c=()=>{E(-1)};Se(()=>{const e=t=>{t.key==="ArrowLeft"&&t.target===document.body&&c()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}});var o=at();je(e=>{Oe.title="Mïmis: Search"});var l=h(o),g=h(l);Me(g,!0),ce(2),i(l);var y=S(l,2);{var $=e=>{var t=Xe();ve(t,21,()=>a(s),he,(r,W,O)=>{var A=Ke(),d=h(A),b=S(d);b.__click=()=>E(O),i(A),Y(B=>{L(d,`${a(W)??""} `),R(b,"href",B)},[()=>`${a(f)}/${a(s).toSpliced(O,1).join("/")}`]),v(r,A)}),i(t),v(e,t)};Z(y,e=>{a(s).length>0&&e($)})}var C=S(y,2),I=h(C);Ue(I,()=>a(x),e=>{var t=tt();v(e,t)},(e,t)=>{var r=Te(),W=ue(r);{var O=d=>{var b=Ye();v(d,b)},A=d=>{var b=et();ve(b,21,()=>a(t),he,(B,u)=>{var F=Ve(),pe=h(F);{var fe=w=>{var N=Ze(),H=ue(N),q=h(H);i(H);var k=S(H,2),ee=h(k),z=S(h(ee)),de=h(z);i(z),ce(),i(ee),i(k),Y((P,_e,ge,be,Ne,xe)=>{L(q,`/${P??""}/${_e??""}`),R(k,"data",ge),R(k,"title",be),R(z,"href",Ne),L(de,`ipfs://${xe??""}`)},[()=>{var P;return(P=a(u).get("path"))==null?void 0:P.join("/")},()=>a(u).get("container"),()=>qe({cid:a(u).get("child").properties.cid}),()=>`ipfs://${a(u).get("child").properties.cid}`,()=>`https://w3s.link/ipfs/${a(u).get("child").properties.cid}`,()=>a(u).get("child").properties.cid]),v(w,N)},me=w=>{var N=Qe();N.__click=[Je,T,u];var H=h(N,!0);i(N),Y((q,k)=>{R(N,"href",q),L(H,k)},[()=>`${a(f)}/${a(s).join("/")}${a(s).length>0?"/":""}${a(u).get("container")}`,()=>a(u).get("container")]),v(w,N)};Z(pe,w=>{a(u).get("child").labels.includes("File")?w(fe):w(me,!1)})}i(F),v(B,F)}),i(b),v(d,b)};Z(W,d=>{!a(t)||a(t).length===0?d(O):d(A,!1)})}v(e,r)}),i(C),i(o),De("submit",l,m),v(p,o),Re()}Le(["click"]);export{gt as component};
