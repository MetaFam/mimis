import{t as v,a as u,c as Ie}from"../chunks/B3xmI3gr.js";import{o as Ce,z as Ae,l as M,C as Re,aA as ae,H as ke,F as we,A as xe,G as se,a6 as re,R as G,U as oe,T as ie,L as K,q as Se,I as He,ax as le,aw as ne,aB as ce,b as Oe,K as he,M as Z,aC as $e,p as De,ae as ue,af as Le,d as Pe,a as je,$ as Me,ad as fe,i as a,c as m,w as me,r as o,s as H,f as ve,aD as J,t as Q}from"../chunks/BvUmx899.js";import{s as B}from"../chunks/SMaB7GV9.js";import{i as V}from"../chunks/DKHvhmB-.js";import{e as de,i as pe}from"../chunks/6UAYUZxd.js";import{h as Be}from"../chunks/DyBNRPx0.js";import{s as O}from"../chunks/CVWUL3tM.js";import{d as Fe,e as We}from"../chunks/CRs1HFvY.js";import{b as ze}from"../chunks/DNnHDDRa.js";import{o as Ue}from"../chunks/CxGobTk3.js";import{g as qe,T as Ye}from"../chunks/CwkKCLNu.js";import{p as F}from"../chunks/BNVqDCsB.js";import{t as _e}from"../chunks/Cb07kC6h.js";import{s as Ge}from"../chunks/D57PE2jI.js";const X=0,W=1,ee=2;function Ke(d,f,s,E,_){M&&Re();var i=d,N=Ce(),b=Oe,l=re,n,c,w,y=(N?oe:ie)(void 0),$=(N?oe:ie)(void 0),I=!1;function C(t,r){I=!0,r&&(le(e),ne(e),ce(b));try{t===X&&s&&(n?he(n):n=K(()=>s(i))),t===W&&E&&(c?he(c):c=K(()=>E(i,y))),t!==X&&n&&Z(n,()=>n=null),t!==W&&c&&Z(c,()=>c=null),t!==ee&&w&&Z(w,()=>w=null)}finally{r&&(ce(null),ne(null),le(null),$e())}}var e=Ae(()=>{if(l===(l=f()))return;let t=M&&ae(l)===(i.data===ke);if(t&&(i=we(),xe(i),se(!1),t=!0),ae(l)){var r=l;I=!1,r.then(T=>{r===l&&(G(y,T),C(W,!0))},T=>{if(r===l)throw G($,T),C(ee,!0),$.v}),M?s&&(n=K(()=>s(i))):Se(()=>{I||C(X,!0)})}else G(y,l),C(W,!1);return t&&se(!0),()=>l=re});M&&(i=He)}const Ze=async({path:d,limit:f=200,offset:s=0})=>{const E=qe();try{const _=E.session();d=d.filter(b=>b.trim()!==""),f=parseInt(Number(f).toFixed(0)),s=parseInt(Number(s).toFixed(0));const i=d.length===0?`
        MATCH (start:Root)-[children:CONTAINS|CONNECTS]->(child)
        RETURN [] as path, children.path as container, child
      `:`
        WITH $elems as pathElems
        MATCH path = (start:Root)-[:CONTAINS|CONNECTS|EMBODIED_AS*]->(end)
        MATCH (end)-[children:CONTAINS|CONNECTS|ENTRY]->(child)
        WITH pathElems, path, children, child,
          [
            rel in relationships(path)
            WHERE NOT isEmpty(rel.path)
            | rel.path
          ] as elements
        WHERE size(elements) = size(pathElems)
        AND ALL(
          i IN range(0, size(pathElems) - 1)
          WHERE (
            pathElems[i] = '*'
            OR elements[i] = pathElems[i]
          )
        )
        ORDER BY children.order
        LIMIT ${s+f}
        SKIP ${s}
        RETURN DISTINCT
          elements as path,
          children.path as container,
          child
      `,N=await _.run(i,{elems:d,limit:BigInt(f),offset:BigInt(s)});return await _.close(),N.records}finally{E.close()}};var Je=v('<link rel="icon" href="infinity%20eyes.svg">'),Qe=v('<li class="svelte-165lhoa"> <a class="button svelte-165lhoa">⨯</a></li>'),Ve=v('<ul id="path" class="svelte-165lhoa"></ul>'),Xe=v('<h2 class="svelte-165lhoa">No Results</h2>'),et=v('<h2 class="svelte-165lhoa"> </h2> <object class="svelte-165lhoa"><p>Could not display <a target="_blank"> </a>.</p></object>',1),tt=(d,f,s)=>{f(a(s))},at=v('<a class="button svelte-165lhoa"> </a>'),st=v("<li><!></li>"),rt=v('<ul id="result" class="svelte-165lhoa"></ul>'),ot=v('<h2 class="svelte-165lhoa">Searching…</h2>'),it=v('<main class="svelte-165lhoa"><form><input id="chip" placeholder="Path Element"> <button>Add Path Element</button></form> <!> <section id="result" class="svelte-165lhoa"><!></section></main>');function Tt(d,f){De(f,!0);let s=ue(Le([])),E=J(async()=>{try{const e=F.url.searchParams.get("limit"),t=F.url.searchParams.get("offset");return await Ze({path:a(s),limit:e?Number(e):Ge.limit,offset:Number(t)})}catch(e){Ye({text:e.message,duration:16e3,close:!0,gravity:"bottom",position:"center",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}}),_=ue("");Ue(()=>{fe(s,F.params.path.split("/").filter(Boolean),!0);const e=F.url.hash.split("/").filter(Boolean);fe(_,e.slice(0,e.length-a(s).length).join("/"),!0)});const i=e=>{e.preventDefault();const t=e.target.elements.chip;N(t.value),t.value=""},N=e=>{e=e.trim(),e&&a(s).push(e)},b=e=>{a(s).splice(e,1)},l=()=>{b(-1)};Pe(()=>{const e=t=>{t.key==="ArrowLeft"&&t.target===document.body&&l()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}});var n=it();Be(e=>{var t=Je();Me.title="Mïmis: Search",u(e,t)});var c=m(n),w=m(c);ze(w),me(2),o(c);var y=H(c,2);{var $=e=>{var t=Ve();de(t,21,()=>a(s),pe,(r,T,D)=>{var x=Qe(),p=m(x),g=H(p);g.__click=()=>b(D),o(x),Q(z=>{B(p,`${a(T)??""} `),O(g,"href",z)},[()=>`${a(_)}/${a(s).toSpliced(D,1).join("/")}`]),u(r,x)}),o(t),u(e,t)};V(y,e=>{a(s).length>0&&e($)})}var I=H(y,2),C=m(I);Ke(C,()=>a(E),e=>{var t=ot();u(e,t)},(e,t)=>{var r=Ie(),T=ve(r);{var D=p=>{var g=Xe();u(p,g)},x=p=>{var g=rt();de(g,21,()=>a(t),pe,(z,L)=>{var U=st();const q=J(()=>a(L).get("container"));var ge=m(U);{var Ee=A=>{var h=et();const R=J(()=>{var j;const{cid:k}=(j=a(L).get("child"))==null?void 0:j.properties;return{cid:k}});var S=ve(h),Te=m(S);o(S);var P=H(S,2),te=m(P),Y=H(m(te)),be=m(Y);o(Y),me(),o(te),o(P),Q((k,j,ye)=>{B(Te,`/${k??""}/${a(q)??""}`),O(P,"data",j),O(P,"title",`ipfs://${a(R).cid}`),O(Y,"href",ye),B(be,`ipfs://${a(R).cid??""}`)},[()=>{var k;return(k=a(L).get("path"))==null?void 0:k.join("/")},()=>_e({cid:a(R).cid}),()=>_e({cid:a(R).cid})]),u(A,h)},Ne=A=>{var h=at();h.__click=[tt,N,q];var R=m(h,!0);o(h),Q(S=>{O(h,"href",S),B(R,a(q))},[()=>`${a(_)}/${a(s).join("/")}${a(s).length>0?"/":""}`]),u(A,h)};V(ge,A=>{var h;(h=a(L).get("child"))!=null&&h.labels.includes("File")?A(Ee):A(Ne,!1)})}o(U),u(z,U)}),o(g),u(p,g)};V(T,p=>{!a(t)||a(t).length===0?p(D):p(x,!1)})}u(e,r)}),o(I),o(n),We("submit",c,i),u(d,n),je()}Fe(["click"]);export{Tt as component};
