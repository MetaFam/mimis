var P=t=>{throw TypeError(t)};var J=(t,o,e)=>o.has(t)||P("Cannot "+e);var E=(t,o,e)=>(J(t,o,"read from private field"),e?e.call(t):o.get(t)),A=(t,o,e)=>o.has(t)?P("Cannot add the same private member more than once"):o instanceof WeakSet?o.add(t):o.set(t,e);import{a as $,t as G}from"../chunks/disclose-version.C2YwwBDH.js";import{p as X,f as Z,t as D,a as j,aC as tt,c as U,s as _,i as b,l as T,m as N,r as B,aI as et}from"../chunks/runtime.CRsO_40P.js";import{d as nt,e as F}from"../chunks/events.ttbO-_kY.js";import{h as ot}from"../chunks/svelte-head.CeQ74Cht.js";import{i as it}from"../chunks/if.C6ZCGi2N.js";import{r as st}from"../chunks/attributes.DKQOS9qK.js";import{b as rt}from"../chunks/input.CNRhtmvm.js";import{p as V}from"../chunks/proxy.C9vbjBtw.js";import{b as at}from"../chunks/this.CTuMhQSY.js";import{v as k,d as dt,a as z,C as W,b as ct,s as ut,w as ft}from"../chunks/bootstrap-icons.1fgYhea-.js";import{g as lt}from"../chunks/neo4jDriver.tQrFAidX.js";import{c as pt,g as ht}from"../chunks/_commonjsHelpers.Cpj98o6Y.js";const S={SHA2_256:18,LENGTH:32,DAG_PB:112},mt=40;function R(t,o){if(!t.length)throw new Error("Unexpected end of data");const e=k.decode(t);return o.seek(k.decode.bytes),e}function yt(t){const o=new DataView(t.buffer,t.byteOffset,t.byteLength);let e=0;return{version:2,characteristics:[o.getBigUint64(e,!0),o.getBigUint64(e+=8,!0)],dataOffset:Number(o.getBigUint64(e+=8,!0)),dataSize:Number(o.getBigUint64(e+=8,!0)),indexOffset:Number(o.getBigUint64(e+=8,!0))}}function wt(t){k.decode(t);const o=k.decode.bytes,e=k.decode(t.subarray(k.decode.bytes)),s=k.decode.bytes;return o+s+e}const C={Null:t=>t===null?t:void 0,Int:t=>Number.isInteger(t)?t:void 0,Float:t=>typeof t=="number"&&Number.isFinite(t)?t:void 0,String:t=>typeof t=="string"?t:void 0,Bool:t=>typeof t=="boolean"?t:void 0,Bytes:t=>t instanceof Uint8Array?t:void 0,Link:t=>t!==null&&typeof t=="object"&&t.asCID===t?t:void 0,List:t=>Array.isArray(t)?t:void 0,Map:t=>t!==null&&typeof t=="object"&&t.asCID!==t&&!Array.isArray(t)&&!(t instanceof Uint8Array)?t:void 0},x={"CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)":C.Link,"CarV1HeaderOrV2Pragma > roots (anon)":t=>{if(C.List(t)!==void 0){for(let o=0;o<t.length;o++){let e=t[o];if(e=x["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](e),e===void 0)return;if(e!==t[o]){const s=t.slice(0,o);for(let i=o;i<t.length;i++){let c=t[i];if(c=x["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](c),c===void 0)return;s.push(c)}return s}}return t}},Int:C.Int,CarV1HeaderOrV2Pragma:t=>{if(C.Map(t)===void 0)return;const o=Object.entries(t);let e=t,s=1;for(let i=0;i<o.length;i++){const[c,n]=o[i];switch(c){case"roots":{const r=x["CarV1HeaderOrV2Pragma > roots (anon)"](t[c]);if(r===void 0)return;if(r!==n||e!==t){if(e===t){e={};for(let d=0;d<i;d++)e[o[d][0]]=o[d][1]}e.roots=r}}break;case"version":{s--;const r=x.Int(t[c]);if(r===void 0)return;if(r!==n||e!==t){if(e===t){e={};for(let d=0;d<i;d++)e[o[d][0]]=o[d][1]}e.version=r}}break;default:return}}if(!(s>0))return e}},I={"CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)":C.Link,"CarV1HeaderOrV2Pragma > roots (anon)":t=>{if(C.List(t)!==void 0){for(let o=0;o<t.length;o++){let e=t[o];if(e=I["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](e),e===void 0)return;if(e!==t[o]){const s=t.slice(0,o);for(let i=o;i<t.length;i++){let c=t[i];if(c=I["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](c),c===void 0)return;s.push(c)}return s}}return t}},Int:C.Int,CarV1HeaderOrV2Pragma:t=>{if(C.Map(t)===void 0)return;const o=Object.entries(t);let e=t,s=1;for(let i=0;i<o.length;i++){const[c,n]=o[i];switch(c){case"roots":{const r=I["CarV1HeaderOrV2Pragma > roots (anon)"](n);if(r===void 0)return;if(r!==n||e!==t){if(e===t){e={};for(let d=0;d<i;d++)e[o[d][0]]=o[d][1]}e.roots=r}}break;case"version":{s--;const r=I.Int(n);if(r===void 0)return;if(r!==n||e!==t){if(e===t){e={};for(let d=0;d<i;d++)e[o[d][0]]=o[d][1]}e.version=r}}break;default:return}}if(!(s>0))return e}},gt={toTyped:x.CarV1HeaderOrV2Pragma,toRepresentation:I.CarV1HeaderOrV2Pragma};async function q(t,o){const e=R(await t.upTo(8),t);if(e===0)throw new Error("Invalid CAR header (zero length)");const s=await t.exactly(e,!0),i=dt(s);if(gt.toTyped(i)===void 0)throw new Error("Invalid CAR header format");if(i.version!==1&&i.version!==2||o!==void 0&&i.version!==o)throw new Error(`Invalid CAR version: ${i.version}${o!==void 0?` (expected ${o})`:""}`);if(i.version===1){if(!Array.isArray(i.roots))throw new Error("Invalid CAR header format");return i}if(i.roots!==void 0)throw new Error("Invalid CAR header format");const c=yt(await t.exactly(mt,!0));t.seek(c.dataOffset-t.pos);const n=await q(t,1);return Object.assign(n,c)}async function vt(t){const o=await t.exactly(2,!1);if(o[0]===S.SHA2_256&&o[1]===S.LENGTH){const n=await t.exactly(34,!0),r=z(n);return W.create(0,S.DAG_PB,r)}const e=R(await t.upTo(8),t);if(e!==1)throw new Error(`Unexpected CID version (${e})`);const s=R(await t.upTo(8),t),i=await t.exactly(wt(await t.upTo(8)),!0),c=z(i);return W.create(e,s,c)}async function Q(t){const o=t.pos;let e=R(await t.upTo(8),t);if(e===0)throw new Error("Invalid CAR section (zero length)");e+=t.pos-o;const s=await vt(t),i=e-Number(t.pos-o);return{cid:s,length:e,blockLength:i}}async function bt(t){const{cid:o,blockLength:e}=await Q(t);return{bytes:await t.exactly(e,!0),cid:o}}async function Ct(t){const o=t.pos,{cid:e,length:s,blockLength:i}=await Q(t),c={cid:e,length:s,blockLength:i,offset:o,blockOffset:t.pos};return t.seek(c.blockLength),c}function Et(t){const o=(async()=>{const e=await q(t);if(e.version===2){const s=t.pos-e.dataOffset;t=xt(t,e.dataSize-s)}return e})();return{header:()=>o,async*blocks(){for(await o;(await t.upTo(8)).length>0;)yield await bt(t)},async*blocksIndex(){for(await o;(await t.upTo(8)).length>0;)yield await Ct(t)}}}function kt(t){let o=0;return{async upTo(e){return t.subarray(o,o+Math.min(e,t.length-o))},async exactly(e,s=!1){if(e>t.length-o)throw new Error("Unexpected end of data");const i=t.subarray(o,o+e);return s&&(o+=e),i},seek(e){o+=e},get pos(){return o}}}function Tt(t){let o=0,e=0,s=0,i=new Uint8Array(0);const c=async n=>{e=i.length-s;const r=[i.subarray(s)];for(;e<n;){const a=await t();if(a==null)break;e<0?a.length>e&&r.push(a.subarray(-e)):r.push(a),e+=a.length}i=new Uint8Array(r.reduce((a,u)=>a+u.length,0));let d=0;for(const a of r)i.set(a,d),d+=a.length;s=0};return{async upTo(n){return i.length-s<n&&await c(n),i.subarray(s,s+Math.min(i.length-s,n))},async exactly(n,r=!1){if(i.length-s<n&&await c(n),i.length-s<n)throw new Error("Unexpected end of data");const d=i.subarray(s,s+n);return r&&(o+=n,s+=n),d},seek(n){o+=n,s+=n},get pos(){return o}}}function Nt(t){const o=t[Symbol.asyncIterator]();async function e(){const s=await o.next();return s.done?null:s.value}return Tt(e)}function xt(t,o){let e=0;return{async upTo(s){let i=await t.upTo(s);return i.length+e>o&&(i=i.subarray(0,o-e)),i},async exactly(s,i=!1){const c=await t.exactly(s,i);if(c.length+e>o)throw new Error("Unexpected end of data");return i&&(e+=s),c},seek(s){e+=s,t.seek(s)},get pos(){return t.pos}}}class It{constructor(o,e,s){this._version=o,this._roots=e,this._iterable=s,this._decoded=!1}get version(){return this._version}async getRoots(){return this._roots}}class H extends It{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");return this._decoded=!0,this._iterable[Symbol.asyncIterator]()}static async fromBytes(o){const{version:e,roots:s,iterator:i}=await Ot(o);return new H(e,s,i)}static async fromIterable(o){const{version:e,roots:s,iterator:i}=await Lt(o);return new H(e,s,i)}}async function Ot(t){if(!(t instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return K(kt(t))}async function Lt(t){if(!t||typeof t[Symbol.asyncIterator]!="function")throw new TypeError("fromIterable() requires an async iterable");return K(Nt(t))}async function K(t){const o=Et(t),{version:e,roots:s}=await o.header();return{version:e,roots:s,iterator:o.blocks()}}const At=!0,Xt=Object.freeze(Object.defineProperty({__proto__:null,prerender:At},Symbol.toStringTag,{value:"Module"}));async function*Vt(t){const o=t.getReader();try{for(;;){const{done:e,value:s}=await o.read();if(e)return;yield s}}finally{o.releaseLock()}}async function Rt(t){const o=await H.fromIterable(Vt(t.stream())),e=[],s=[],i={};let c=null;for await(const{cid:n,bytes:r}of o){c=n.toString();const d=await ct(r),{Links:a}=d;if(a.length===0){e.push(n.toString());continue}if(a.every(({Name:f})=>f==="")){s.push(n.toString());continue}const u=a.map(({Name:f,Tsize:l,Hash:p})=>({name:f,size:l,cid:p.toString()}));i[n.toString()]=u.map(f=>{const l=s.includes(f.cid)||e.includes(f.cid)?"file":"directory",p={type:l,title:f.name??`Unknown ${l}`,size:f.size??0,cid:f.cid};if(l==="directory"){const y=p.children=i[f.cid],g=y.map(({childCount:h=0})=>h);p.childCount=g.reduce((h,w)=>h+w,y.length)}return p})}if(!c)throw new Error("No nodes found.");return i[c]}async function Ht(t,o=[]){const e=lt();try{const r=await n(t,structuredClone(o));return console.info(`Mounted ${r} at /${o.join("/")}/.`),r}finally{await e.close()}async function s({dirCID:r,entryCID:d,name:a}){const u=e.session();await u.run(`
      MATCH (e:IPFS { cid: $entryCID })
      MERGE (d:IPFS:Directory { cid: $dirCID })
      MERGE (d)-[c:CONTAINS]->(e)
      SET c.path = $name
    `,{dirCID:r,entryCID:d,name:a}),await u.close()}async function i({cid:r,type:d,size:a}){const u=e.session();await u.run(`
      MERGE (e:IPFS:File { cid: $cid })
      SET e.mimetype = CASE WHEN $type IS NOT NULL THEN $type END
      SET e.size = $size
    `,{cid:r,type:d,size:a}),await u.close()}async function c({path:r,cid:d}){const a=e.session(),u=`
      MERGE (r:Mount:Root)
      RETURN elementId(r) as id
    `,{records:f}=await a.run(u);let l=f[0].get("id");for(;r.length>0;){const y=`
        MATCH (p:Mount)
        WHERE elementId(p) = $next
        MERGE (p)-[:CONTAINS {path: $elem}]->(n:Mount)
        RETURN elementId(n) as id
      `,{records:g}=await a.run(y,{next:l,elem:r.shift()});l=g[0].get("id")}await a.run(`
      MATCH (m:Mount)
      WHERE elementId(m) = $next
      MATCH (i:IPFS { cid: $cid })
      MERGE (m)-[:CONNECTS {order: 1}]->(i)
    `,{next:l,cid:d}),await a.close()}async function n(r,d=[]){if(!r.children)throw new Error(`Not A Directory: ${r.title}`);for(const a of r.children)if(!(!a.selected&&a.getSelectedNodes().length===0)){if(a.children)await n(a);else{const u=(()=>{var f;switch((f=a.title.split(".").at(-1))==null?void 0:f.toLowerCase()){case"svg":return"image/svg+xml";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";default:return null}})();await i({cid:a.data.cid,type:u,size:a.data.size})}if(r.data.cid)await s({dirCID:r.data.cid,entryCID:a.data.cid,name:a.title});else return await c({path:d,cid:a.data.cid}),a.data.cid}return r.data.cid}}var Y={exports:{}};/*!
 * Toastify js 1.12.0
 * https://github.com/apvarun/toastify-js
 * @license MIT licensed
 *
 * Copyright (C) 2018 Varun A P
 */(function(t){(function(o,e){t.exports?t.exports=e():o.Toastify=e()})(pt,function(o){var e=function(n){return new e.lib.init(n)},s="1.12.0";e.defaults={oldestFirst:!0,text:"Toastify is awesome!",node:void 0,duration:3e3,selector:void 0,callback:function(){},destination:void 0,newWindow:!1,close:!1,gravity:"toastify-top",positionLeft:!1,position:"",backgroundColor:"",avatar:"",className:"",stopOnFocus:!0,onClick:function(){},offset:{x:0,y:0},escapeMarkup:!0,ariaLive:"polite",style:{background:""}},e.lib=e.prototype={toastify:s,constructor:e,init:function(n){return n||(n={}),this.options={},this.toastElement=null,this.options.text=n.text||e.defaults.text,this.options.node=n.node||e.defaults.node,this.options.duration=n.duration===0?0:n.duration||e.defaults.duration,this.options.selector=n.selector||e.defaults.selector,this.options.callback=n.callback||e.defaults.callback,this.options.destination=n.destination||e.defaults.destination,this.options.newWindow=n.newWindow||e.defaults.newWindow,this.options.close=n.close||e.defaults.close,this.options.gravity=n.gravity==="bottom"?"toastify-bottom":e.defaults.gravity,this.options.positionLeft=n.positionLeft||e.defaults.positionLeft,this.options.position=n.position||e.defaults.position,this.options.backgroundColor=n.backgroundColor||e.defaults.backgroundColor,this.options.avatar=n.avatar||e.defaults.avatar,this.options.className=n.className||e.defaults.className,this.options.stopOnFocus=n.stopOnFocus===void 0?e.defaults.stopOnFocus:n.stopOnFocus,this.options.onClick=n.onClick||e.defaults.onClick,this.options.offset=n.offset||e.defaults.offset,this.options.escapeMarkup=n.escapeMarkup!==void 0?n.escapeMarkup:e.defaults.escapeMarkup,this.options.ariaLive=n.ariaLive||e.defaults.ariaLive,this.options.style=n.style||e.defaults.style,n.backgroundColor&&(this.options.style.background=n.backgroundColor),this},buildToast:function(){if(!this.options)throw"Toastify is not initialized";var n=document.createElement("div");n.className="toastify on "+this.options.className,this.options.position?n.className+=" toastify-"+this.options.position:this.options.positionLeft===!0?(n.className+=" toastify-left",console.warn("Property `positionLeft` will be depreciated in further versions. Please use `position` instead.")):n.className+=" toastify-right",n.className+=" "+this.options.gravity,this.options.backgroundColor&&console.warn('DEPRECATION NOTICE: "backgroundColor" is being deprecated. Please use the "style.background" property.');for(var r in this.options.style)n.style[r]=this.options.style[r];if(this.options.ariaLive&&n.setAttribute("aria-live",this.options.ariaLive),this.options.node&&this.options.node.nodeType===Node.ELEMENT_NODE)n.appendChild(this.options.node);else if(this.options.escapeMarkup?n.innerText=this.options.text:n.innerHTML=this.options.text,this.options.avatar!==""){var d=document.createElement("img");d.src=this.options.avatar,d.className="toastify-avatar",this.options.position=="left"||this.options.positionLeft===!0?n.appendChild(d):n.insertAdjacentElement("afterbegin",d)}if(this.options.close===!0){var a=document.createElement("button");a.type="button",a.setAttribute("aria-label","Close"),a.className="toast-close",a.innerHTML="&#10006;",a.addEventListener("click",(function(h){h.stopPropagation(),this.removeElement(this.toastElement),window.clearTimeout(this.toastElement.timeOutValue)}).bind(this));var u=window.innerWidth>0?window.innerWidth:screen.width;(this.options.position=="left"||this.options.positionLeft===!0)&&u>360?n.insertAdjacentElement("afterbegin",a):n.appendChild(a)}if(this.options.stopOnFocus&&this.options.duration>0){var f=this;n.addEventListener("mouseover",function(h){window.clearTimeout(n.timeOutValue)}),n.addEventListener("mouseleave",function(){n.timeOutValue=window.setTimeout(function(){f.removeElement(n)},f.options.duration)})}if(typeof this.options.destination<"u"&&n.addEventListener("click",(function(h){h.stopPropagation(),this.options.newWindow===!0?window.open(this.options.destination,"_blank"):window.location=this.options.destination}).bind(this)),typeof this.options.onClick=="function"&&typeof this.options.destination>"u"&&n.addEventListener("click",(function(h){h.stopPropagation(),this.options.onClick()}).bind(this)),typeof this.options.offset=="object"){var l=i("x",this.options),p=i("y",this.options),y=this.options.position=="left"?l:"-"+l,g=this.options.gravity=="toastify-top"?p:"-"+p;n.style.transform="translate("+y+","+g+")"}return n},showToast:function(){this.toastElement=this.buildToast();var n;if(typeof this.options.selector=="string"?n=document.getElementById(this.options.selector):this.options.selector instanceof HTMLElement||typeof ShadowRoot<"u"&&this.options.selector instanceof ShadowRoot?n=this.options.selector:n=document.body,!n)throw"Root element is not defined";var r=e.defaults.oldestFirst?n.firstChild:n.lastChild;return n.insertBefore(this.toastElement,r),e.reposition(),this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout((function(){this.removeElement(this.toastElement)}).bind(this),this.options.duration)),this},hideToast:function(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue),this.removeElement(this.toastElement)},removeElement:function(n){n.className=n.className.replace(" on",""),window.setTimeout((function(){this.options.node&&this.options.node.parentNode&&this.options.node.parentNode.removeChild(this.options.node),n.parentNode&&n.parentNode.removeChild(n),this.options.callback.call(n),e.reposition()}).bind(this),400)}},e.reposition=function(){for(var n={top:15,bottom:15},r={top:15,bottom:15},d={top:15,bottom:15},a=document.getElementsByClassName("toastify"),u,f=0;f<a.length;f++){c(a[f],"toastify-top")===!0?u="toastify-top":u="toastify-bottom";var l=a[f].offsetHeight;u=u.substr(9,u.length-1);var p=15,y=window.innerWidth>0?window.innerWidth:screen.width;y<=360?(a[f].style[u]=d[u]+"px",d[u]+=l+p):c(a[f],"toastify-left")===!0?(a[f].style[u]=n[u]+"px",n[u]+=l+p):(a[f].style[u]=r[u]+"px",r[u]+=l+p)}return this};function i(n,r){return r.offset[n]?isNaN(r.offset[n])?r.offset[n]:r.offset[n]+"px":"0px"}function c(n,r){return!n||typeof r!="string"?!1:!!(n.className&&n.className.trim().split(/\s+/gi).indexOf(r)>-1)}return e.lib.init.prototype=e.lib,e})})(Y);var _t=Y.exports;const St=ht(_t);var Mt=G('<form class="svelte-o04jkh"><input placeholder="/system/mount/point/"> <button>Neo4j Import</button></form>'),Pt=G('<form class="svelte-o04jkh"><input type="file" required accept=".car"> <button>Read CAR</button></form> <!> <div id="fs-tree" class="svelte-o04jkh"></div>',1);function Zt(t,o){var p,y,g,h;X(o,!0);class e{constructor(){A(this,y,T());A(this,g,T(!((p=this.form)!=null&&p.checkValidity())));A(this,h,T(!1))}get form(){return b(E(this,y))}set form(m){N(E(this,y),V(m))}get disabled(){return b(E(this,g))}set disabled(m){N(E(this,g),V(m))}get generating(){return b(E(this,h))}set generating(m){N(E(this,h),V(m))}}y=new WeakMap,g=new WeakMap,h=new WeakMap;let s=T(void 0),i=new e,c=T("");const n=async w=>{var L,M;w.preventDefault();const m=((L=i.form)==null?void 0:L.querySelector('input[type="file"]'))??null,v=(M=m==null?void 0:m.files)==null?void 0:M[0];if(!v)throw new Error("No file selected.");const O=await Rt(v);ut(O),N(s,V(ft({source:O,mount:"fs-tree"})))},r=async w=>{w.preventDefault();try{i.generating=!0;const m=b(c).split("/").filter(Boolean);if(!b(s))throw new Error("No tree to mount.");const v=await Ht(b(s).root,m);St({text:`Loaded: ipfs://${v.slice(0,5)}…${v.slice(-5)}`,duration:8e3,destination:`https://w3s.link/ipfs/${v}`,newWindow:!0,close:!0,gravity:"bottom",position:"center",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}finally{i.generating=!1}};var d=Pt();ot(w=>{tt.title="Upload a CAR"});var a=Z(d),u=U(a);u.__change=()=>{var w;return i.disabled=!((w=i.form)!=null&&w.checkValidity())};var f=_(u,2);B(a),at(a,w=>i.form=w,()=>i==null?void 0:i.form);var l=_(a,2);it(l,()=>!!b(s),w=>{var m=Mt(),v=U(m);st(v);var O=_(v,2);B(m),D(()=>O.disabled=i.generating),F("submit",m,r),rt(v,()=>b(c),L=>N(c,L)),$(w,m)}),et(2),D(()=>f.disabled=i.disabled),F("submit",a,n),$(t,d),j()}nt(["change"]);export{Zt as component,Xt as universal};
