var Ct=Object.defineProperty;var Je=e=>{throw TypeError(e)};var Tt=(e,t,r)=>t in e?Ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var d=(e,t,r)=>Tt(e,typeof t!="symbol"?t+"":t,r),He=(e,t,r)=>t.has(e)||Je("Cannot "+r);var Ce=(e,t,r)=>(He(e,t,"read from private field"),r?r.call(e):t.get(e)),Qe=(e,t,r)=>t.has(e)?Je("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Xe=(e,t,r,n)=>(He(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);import"../chunks/CWj6FrbW.js";import{p as Ut,f as G,s as z,a as le,b as F,c as It,ai as Bt,d as X,k as T,al as oe,r as Y,aQ as $t,t as Ye,ak as j}from"../chunks/DT345vJT.js";import{d as Nt,s as Ze}from"../chunks/CQsOHSfA.js";import{i as he}from"../chunks/BI-RejmI.js";import{h as Mt}from"../chunks/CIVYj_3Q.js";import{s as Te}from"../chunks/DFqy6DhR.js";import{C as Be,g as Ot,j as et,s as zt,a as Rt}from"../chunks/BtRcn-ld.js";import{T as Dt}from"../chunks/izcudvy4.js";import{C as Ft}from"../chunks/Cqs1gBZ8.js";import{s as jt}from"../chunks/Bclqp6kc.js";import{t as Lt}from"../chunks/B4-6h78h.js";import{m as Pt,W as Vt,P as tt,c as Gt,aO as Kt}from"../chunks/CEv0nruW.js";import{c as Wt}from"../chunks/DZjQNTLK.js";import{t as qt}from"../chunks/DZySvB-9.js";const Jt=["string","number","bigint","symbol"],Ht=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function Qt(e){if(e===null)return"null";if(e===void 0)return"undefined";if(e===!0||e===!1)return"boolean";const t=typeof e;if(Jt.includes(t))return t;if(t==="function")return"Function";if(Array.isArray(e))return"Array";if(Xt(e))return"Buffer";const r=Yt(e);return r||"Object"}function Xt(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}function Yt(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(Ht.includes(t))return t}class a{constructor(t,r,n){this.major=t,this.majorEncoded=t<<5,this.name=r,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(t){return this.major<t.major?-1:this.major>t.major?1:0}}a.uint=new a(0,"uint",!0);a.negint=new a(1,"negint",!0);a.bytes=new a(2,"bytes",!0);a.string=new a(3,"string",!0);a.array=new a(4,"array",!1);a.map=new a(5,"map",!1);a.tag=new a(6,"tag",!1);a.float=new a(7,"float",!0);a.false=new a(7,"false",!0);a.true=new a(7,"true",!0);a.null=new a(7,"null",!0);a.undefined=new a(7,"undefined",!0);a.break=new a(7,"break",!0);class f{constructor(t,r,n){this.type=t,this.value=r,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const ee=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",Zt=new TextDecoder,er=new TextEncoder;function ge(e){return ee&&globalThis.Buffer.isBuffer(e)}function lt(e){return e instanceof Uint8Array?ge(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const tr=ee?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):nt(e,t,r):(e,t,r)=>r-t>64?Zt.decode(e.subarray(t,r)):nt(e,t,r),rr=ee?e=>e.length>64?globalThis.Buffer.from(e):rt(e):e=>e.length>64?er.encode(e):rt(e),R=e=>Uint8Array.from(e),ze=ee?(e,t,r)=>ge(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),nr=ee?(e,t)=>(e=e.map(r=>r instanceof Uint8Array?r:globalThis.Buffer.from(r)),lt(globalThis.Buffer.concat(e,t))):(e,t)=>{const r=new Uint8Array(t);let n=0;for(let o of e)n+o.length>r.length&&(o=o.subarray(0,r.length-n)),r.set(o,n),n+=o.length;return r},or=ee?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function ir(e,t){if(ge(e)&&ge(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function rt(e){const t=[];let r=0;for(let n=0;n<e.length;n++){let o=e.charCodeAt(n);o<128?t[r++]=o:o<2048?(t[r++]=o>>6|192,t[r++]=o&63|128):(o&64512)===55296&&n+1<e.length&&(e.charCodeAt(n+1)&64512)===56320?(o=65536+((o&1023)<<10)+(e.charCodeAt(++n)&1023),t[r++]=o>>18|240,t[r++]=o>>12&63|128,t[r++]=o>>6&63|128,t[r++]=o&63|128):(t[r++]=o>>12|224,t[r++]=o>>6&63|128,t[r++]=o&63|128)}return t}function nt(e,t,r){const n=[];for(;t<r;){const o=e[t];let i=null,s=o>239?4:o>223?3:o>191?2:1;if(t+s<=r){let u,h,b,w;switch(s){case 1:o<128&&(i=o);break;case 2:u=e[t+1],(u&192)===128&&(w=(o&31)<<6|u&63,w>127&&(i=w));break;case 3:u=e[t+1],h=e[t+2],(u&192)===128&&(h&192)===128&&(w=(o&15)<<12|(u&63)<<6|h&63,w>2047&&(w<55296||w>57343)&&(i=w));break;case 4:u=e[t+1],h=e[t+2],b=e[t+3],(u&192)===128&&(h&192)===128&&(b&192)===128&&(w=(o&15)<<18|(u&63)<<12|(h&63)<<6|b&63,w>65535&&w<1114112&&(i=w))}}i===null?(i=65533,s=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|i&1023),n.push(i),t+=s}return sr(n)}const ot=4096;function sr(e){const t=e.length;if(t<=ot)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=ot));return r}const ar=256;class ht{constructor(t=ar){this.chunkSize=t,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(t){let r=this.chunks[this.chunks.length-1];if(this.cursor+t.length<=this.maxCursor+1){const o=r.length-(this.maxCursor-this.cursor)-1;r.set(t,o)}else{if(r){const o=r.length-(this.maxCursor-this.cursor)-1;o<r.length&&(this.chunks[this.chunks.length-1]=r.subarray(0,o),this.maxCursor=this.cursor-1)}t.length<64&&t.length<this.chunkSize?(r=or(this.chunkSize),this.chunks.push(r),this.maxCursor+=r.length,this._initReuseChunk===null&&(this._initReuseChunk=r),r.set(t,0)):(this.chunks.push(t),this.maxCursor+=t.length)}this.cursor+=t.length}toBytes(t=!1){let r;if(this.chunks.length===1){const n=this.chunks[0];t&&this.cursor>n.length/2?(r=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):r=ze(n,0,this.cursor)}else r=nr(this.chunks,this.cursor);return t&&this.reset(),r}}const l="CBOR decode error:",pt="CBOR encode error:";function te(e,t,r){if(e.length-t<r)throw new Error(`${l} not enough data for type`)}const S=[24,256,65536,4294967296,BigInt("18446744073709551616")];function K(e,t,r){te(e,t,1);const n=e[t];if(r.strict===!0&&n<S[0])throw new Error(`${l} integer encoded in more bytes than necessary (strict decode)`);return n}function W(e,t,r){te(e,t,2);const n=e[t]<<8|e[t+1];if(r.strict===!0&&n<S[1])throw new Error(`${l} integer encoded in more bytes than necessary (strict decode)`);return n}function q(e,t,r){te(e,t,4);const n=e[t]*16777216+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(r.strict===!0&&n<S[2])throw new Error(`${l} integer encoded in more bytes than necessary (strict decode)`);return n}function J(e,t,r){te(e,t,8);const n=e[t]*16777216+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],o=e[t+4]*16777216+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],i=(BigInt(n)<<BigInt(32))+BigInt(o);if(r.strict===!0&&i<S[3])throw new Error(`${l} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(r.allowBigInt===!0)return i;throw new Error(`${l} integers outside of the safe integer range are not supported`)}function cr(e,t,r,n){return new f(a.uint,K(e,t+1,n),2)}function ur(e,t,r,n){return new f(a.uint,W(e,t+1,n),3)}function fr(e,t,r,n){return new f(a.uint,q(e,t+1,n),5)}function dr(e,t,r,n){return new f(a.uint,J(e,t+1,n),9)}function H(e,t){return I(e,0,t.value)}function I(e,t,r){if(r<S[0]){const n=Number(r);e.push([t|n])}else if(r<S[1]){const n=Number(r);e.push([t|24,n])}else if(r<S[2]){const n=Number(r);e.push([t|25,n>>>8,n&255])}else if(r<S[3]){const n=Number(r);e.push([t|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{const n=BigInt(r);if(n<S[4]){const o=[t|27,0,0,0,0,0,0,0];let i=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));o[8]=i&255,i=i>>8,o[7]=i&255,i=i>>8,o[6]=i&255,i=i>>8,o[5]=i&255,o[4]=s&255,s=s>>8,o[3]=s&255,s=s>>8,o[2]=s&255,s=s>>8,o[1]=s&255,e.push(o)}else throw new Error(`${l} encountered BigInt larger than allowable range`)}}H.encodedSize=function(t){return I.encodedSize(t.value)};I.encodedSize=function(t){return t<S[0]?1:t<S[1]?2:t<S[2]?3:t<S[3]?5:9};H.compareTokens=function(t,r){return t.value<r.value?-1:t.value>r.value?1:0};function lr(e,t,r,n){return new f(a.negint,-1-K(e,t+1,n),2)}function hr(e,t,r,n){return new f(a.negint,-1-W(e,t+1,n),3)}function pr(e,t,r,n){return new f(a.negint,-1-q(e,t+1,n),5)}const Re=BigInt(-1),wt=BigInt(1);function wr(e,t,r,n){const o=J(e,t+1,n);if(typeof o!="bigint"){const i=-1-o;if(i>=Number.MIN_SAFE_INTEGER)return new f(a.negint,i,9)}if(n.allowBigInt!==!0)throw new Error(`${l} integers outside of the safe integer range are not supported`);return new f(a.negint,Re-BigInt(o),9)}function De(e,t){const r=t.value,n=typeof r=="bigint"?r*Re-wt:r*-1-1;I(e,t.type.majorEncoded,n)}De.encodedSize=function(t){const r=t.value,n=typeof r=="bigint"?r*Re-wt:r*-1-1;return n<S[0]?1:n<S[1]?2:n<S[2]?3:n<S[3]?5:9};De.compareTokens=function(t,r){return t.value<r.value?1:t.value>r.value?-1:0};function ce(e,t,r,n){te(e,t,r+n);const o=ze(e,t+r,t+r+n);return new f(a.bytes,o,r+n)}function gr(e,t,r,n){return ce(e,t,1,r)}function yr(e,t,r,n){return ce(e,t,2,K(e,t+1,n))}function mr(e,t,r,n){return ce(e,t,3,W(e,t+1,n))}function br(e,t,r,n){return ce(e,t,5,q(e,t+1,n))}function xr(e,t,r,n){const o=J(e,t+1,n);if(typeof o=="bigint")throw new Error(`${l} 64-bit integer bytes lengths not supported`);return ce(e,t,9,o)}function ye(e){return e.encodedBytes===void 0&&(e.encodedBytes=e.type===a.string?rr(e.value):e.value),e.encodedBytes}function _e(e,t){const r=ye(t);I(e,t.type.majorEncoded,r.length),e.push(r)}_e.encodedSize=function(t){const r=ye(t);return I.encodedSize(r.length)+r.length};_e.compareTokens=function(t,r){return vr(ye(t),ye(r))};function vr(e,t){return e.length<t.length?-1:e.length>t.length?1:ir(e,t)}function ue(e,t,r,n,o){const i=r+n;te(e,t,i);const s=new f(a.string,tr(e,t+r,t+i),i);return o.retainStringBytes===!0&&(s.byteValue=ze(e,t+r,t+i)),s}function Er(e,t,r,n){return ue(e,t,1,r,n)}function _r(e,t,r,n){return ue(e,t,2,K(e,t+1,n),n)}function Ar(e,t,r,n){return ue(e,t,3,W(e,t+1,n),n)}function kr(e,t,r,n){return ue(e,t,5,q(e,t+1,n),n)}function Sr(e,t,r,n){const o=J(e,t+1,n);if(typeof o=="bigint")throw new Error(`${l} 64-bit integer string lengths not supported`);return ue(e,t,9,o,n)}const Cr=_e;function re(e,t,r,n){return new f(a.array,n,r)}function Tr(e,t,r,n){return re(e,t,1,r)}function Ur(e,t,r,n){return re(e,t,2,K(e,t+1,n))}function Ir(e,t,r,n){return re(e,t,3,W(e,t+1,n))}function Br(e,t,r,n){return re(e,t,5,q(e,t+1,n))}function $r(e,t,r,n){const o=J(e,t+1,n);if(typeof o=="bigint")throw new Error(`${l} 64-bit integer array lengths not supported`);return re(e,t,9,o)}function Nr(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${l} indefinite length items not allowed`);return re(e,t,1,1/0)}function Fe(e,t){I(e,a.array.majorEncoded,t.value)}Fe.compareTokens=H.compareTokens;Fe.encodedSize=function(t){return I.encodedSize(t.value)};function ne(e,t,r,n){return new f(a.map,n,r)}function Mr(e,t,r,n){return ne(e,t,1,r)}function Or(e,t,r,n){return ne(e,t,2,K(e,t+1,n))}function zr(e,t,r,n){return ne(e,t,3,W(e,t+1,n))}function Rr(e,t,r,n){return ne(e,t,5,q(e,t+1,n))}function Dr(e,t,r,n){const o=J(e,t+1,n);if(typeof o=="bigint")throw new Error(`${l} 64-bit integer map lengths not supported`);return ne(e,t,9,o)}function Fr(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${l} indefinite length items not allowed`);return ne(e,t,1,1/0)}function je(e,t){I(e,a.map.majorEncoded,t.value)}je.compareTokens=H.compareTokens;je.encodedSize=function(t){return I.encodedSize(t.value)};function jr(e,t,r,n){return new f(a.tag,r,1)}function Lr(e,t,r,n){return new f(a.tag,K(e,t+1,n),2)}function Pr(e,t,r,n){return new f(a.tag,W(e,t+1,n),3)}function Vr(e,t,r,n){return new f(a.tag,q(e,t+1,n),5)}function Gr(e,t,r,n){return new f(a.tag,J(e,t+1,n),9)}function Le(e,t){I(e,a.tag.majorEncoded,t.value)}Le.compareTokens=H.compareTokens;Le.encodedSize=function(t){return I.encodedSize(t.value)};const Kr=20,Wr=21,qr=22,Jr=23;function Hr(e,t,r,n){if(n.allowUndefined===!1)throw new Error(`${l} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new f(a.null,null,1):new f(a.undefined,void 0,1)}function Qr(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${l} indefinite length items not allowed`);return new f(a.break,void 0,1)}function Pe(e,t,r){if(r){if(r.allowNaN===!1&&Number.isNaN(e))throw new Error(`${l} NaN values are not supported`);if(r.allowInfinity===!1&&(e===1/0||e===-1/0))throw new Error(`${l} Infinity values are not supported`)}return new f(a.float,e,t)}function Xr(e,t,r,n){return Pe(Ge(e,t+1),3,n)}function Yr(e,t,r,n){return Pe(Ke(e,t+1),5,n)}function Zr(e,t,r,n){return Pe(bt(e,t+1),9,n)}function Ve(e,t,r){const n=t.value;if(n===!1)e.push([a.float.majorEncoded|Kr]);else if(n===!0)e.push([a.float.majorEncoded|Wr]);else if(n===null)e.push([a.float.majorEncoded|qr]);else if(n===void 0)e.push([a.float.majorEncoded|Jr]);else{let o,i=!1;(!r||r.float64!==!0)&&(yt(n),o=Ge($,1),n===o||Number.isNaN(n)?($[0]=249,e.push($.slice(0,3)),i=!0):(mt(n),o=Ke($,1),n===o&&($[0]=250,e.push($.slice(0,5)),i=!0))),i||(en(n),o=bt($,1),$[0]=251,e.push($.slice(0,9)))}}Ve.encodedSize=function(t,r){const n=t.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!r||r.float64!==!0){yt(n);let o=Ge($,1);if(n===o||Number.isNaN(n))return 3;if(mt(n),o=Ke($,1),n===o)return 5}return 9};const gt=new ArrayBuffer(9),U=new DataView(gt,1),$=new Uint8Array(gt,0);function yt(e){if(e===1/0)U.setUint16(0,31744,!1);else if(e===-1/0)U.setUint16(0,64512,!1);else if(Number.isNaN(e))U.setUint16(0,32256,!1);else{U.setFloat32(0,e);const t=U.getUint32(0),r=(t&2139095040)>>23,n=t&8388607;if(r===255)U.setUint16(0,31744,!1);else if(r===0)U.setUint16(0,(e&2147483648)>>16|n>>13,!1);else{const o=r-127;o<-24?U.setUint16(0,0):o<-14?U.setUint16(0,(t&2147483648)>>16|1<<24+o,!1):U.setUint16(0,(t&2147483648)>>16|o+15<<10|n>>13,!1)}}}function Ge(e,t){if(e.length-t<2)throw new Error(`${l} not enough data for float16`);const r=(e[t]<<8)+e[t+1];if(r===31744)return 1/0;if(r===64512)return-1/0;if(r===32256)return NaN;const n=r>>10&31,o=r&1023;let i;return n===0?i=o*2**-24:n!==31?i=(o+1024)*2**(n-25):i=o===0?1/0:NaN,r&32768?-i:i}function mt(e){U.setFloat32(0,e,!1)}function Ke(e,t){if(e.length-t<4)throw new Error(`${l} not enough data for float32`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function en(e){U.setFloat64(0,e,!1)}function bt(e,t){if(e.length-t<8)throw new Error(`${l} not enough data for float64`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}Ve.compareTokens=H.compareTokens;function p(e,t,r){throw new Error(`${l} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function Ae(e){return()=>{throw new Error(`${l} ${e}`)}}const c=[];for(let e=0;e<=23;e++)c[e]=p;c[24]=cr;c[25]=ur;c[26]=fr;c[27]=dr;c[28]=p;c[29]=p;c[30]=p;c[31]=p;for(let e=32;e<=55;e++)c[e]=p;c[56]=lr;c[57]=hr;c[58]=pr;c[59]=wr;c[60]=p;c[61]=p;c[62]=p;c[63]=p;for(let e=64;e<=87;e++)c[e]=gr;c[88]=yr;c[89]=mr;c[90]=br;c[91]=xr;c[92]=p;c[93]=p;c[94]=p;c[95]=Ae("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)c[e]=Er;c[120]=_r;c[121]=Ar;c[122]=kr;c[123]=Sr;c[124]=p;c[125]=p;c[126]=p;c[127]=Ae("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)c[e]=Tr;c[152]=Ur;c[153]=Ir;c[154]=Br;c[155]=$r;c[156]=p;c[157]=p;c[158]=p;c[159]=Nr;for(let e=160;e<=183;e++)c[e]=Mr;c[184]=Or;c[185]=zr;c[186]=Rr;c[187]=Dr;c[188]=p;c[189]=p;c[190]=p;c[191]=Fr;for(let e=192;e<=215;e++)c[e]=jr;c[216]=Lr;c[217]=Pr;c[218]=Vr;c[219]=Gr;c[220]=p;c[221]=p;c[222]=p;c[223]=p;for(let e=224;e<=243;e++)c[e]=Ae("simple values are not supported");c[244]=p;c[245]=p;c[246]=p;c[247]=Hr;c[248]=Ae("simple values are not supported");c[249]=Xr;c[250]=Yr;c[251]=Zr;c[252]=p;c[253]=p;c[254]=p;c[255]=Qr;const M=[];for(let e=0;e<24;e++)M[e]=new f(a.uint,e,1);for(let e=-1;e>=-24;e--)M[31-e]=new f(a.negint,e,1);M[64]=new f(a.bytes,new Uint8Array(0),1);M[96]=new f(a.string,"",1);M[128]=new f(a.array,0,1);M[160]=new f(a.map,0,1);M[244]=new f(a.false,!1,1);M[245]=new f(a.true,!0,1);M[246]=new f(a.null,null,1);function tn(e){switch(e.type){case a.false:return R([244]);case a.true:return R([245]);case a.null:return R([246]);case a.bytes:return e.value.length?void 0:R([64]);case a.string:return e.value===""?R([96]):void 0;case a.array:return e.value===0?R([128]):void 0;case a.map:return e.value===0?R([160]):void 0;case a.uint:return e.value<24?R([Number(e.value)]):void 0;case a.negint:if(e.value>=-24)return R([31-Number(e.value)])}}const rn={float64:!1,mapSorter:sn,quickEncodeToken:tn};function nn(){const e=[];return e[a.uint.major]=H,e[a.negint.major]=De,e[a.bytes.major]=_e,e[a.string.major]=Cr,e[a.array.major]=Fe,e[a.map.major]=je,e[a.tag.major]=Le,e[a.float.major]=Ve,e}const xt=nn(),Ue=new ht;class me{constructor(t,r){this.obj=t,this.parent=r}includes(t){let r=this;do if(r.obj===t)return!0;while(r=r.parent);return!1}static createCheck(t,r){if(t&&t.includes(r))throw new Error(`${pt} object contains circular references`);return new me(r,t)}}const L={null:new f(a.null,null),undefined:new f(a.undefined,void 0),true:new f(a.true,!0),false:new f(a.false,!1),emptyArray:new f(a.array,0),emptyMap:new f(a.map,0)},V={number(e,t,r,n){return!Number.isInteger(e)||!Number.isSafeInteger(e)?new f(a.float,e):e>=0?new f(a.uint,e):new f(a.negint,e)},bigint(e,t,r,n){return e>=BigInt(0)?new f(a.uint,e):new f(a.negint,e)},Uint8Array(e,t,r,n){return new f(a.bytes,e)},string(e,t,r,n){return new f(a.string,e)},boolean(e,t,r,n){return e?L.true:L.false},null(e,t,r,n){return L.null},undefined(e,t,r,n){return L.undefined},ArrayBuffer(e,t,r,n){return new f(a.bytes,new Uint8Array(e))},DataView(e,t,r,n){return new f(a.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength))},Array(e,t,r,n){if(!e.length)return r.addBreakTokens===!0?[L.emptyArray,new f(a.break)]:L.emptyArray;n=me.createCheck(n,e);const o=[];let i=0;for(const s of e)o[i++]=pe(s,r,n);return r.addBreakTokens?[new f(a.array,e.length),o,new f(a.break)]:[new f(a.array,e.length),o]},Object(e,t,r,n){const o=t!=="Object",i=o?e.keys():Object.keys(e),s=o?e.size:i.length;if(!s)return r.addBreakTokens===!0?[L.emptyMap,new f(a.break)]:L.emptyMap;n=me.createCheck(n,e);const u=[];let h=0;for(const b of i)u[h++]=[pe(b,r,n),pe(o?e.get(b):e[b],r,n)];return on(u,r),r.addBreakTokens?[new f(a.map,s),u,new f(a.break)]:[new f(a.map,s),u]}};V.Map=V.Object;V.Buffer=V.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))V[`${e}Array`]=V.DataView;function pe(e,t={},r){const n=Qt(e),o=t&&t.typeEncoders&&t.typeEncoders[n]||V[n];if(typeof o=="function"){const s=o(e,n,t,r);if(s!=null)return s}const i=V[n];if(!i)throw new Error(`${pt} unsupported type: ${n}`);return i(e,n,t,r)}function on(e,t){t.mapSorter&&e.sort(t.mapSorter)}function sn(e,t){const r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);const o=r.type.major,i=xt[o].compareTokens(r,n);return i===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function vt(e,t,r,n){if(Array.isArray(t))for(const o of t)vt(e,o,r,n);else r[t.type.major](e,t,n)}function an(e,t,r){const n=pe(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){const o=r.quickEncodeToken(n);if(o)return o;const i=t[n.type.major];if(i.encodedSize){const s=i.encodedSize(n,r),u=new ht(s);if(i(u,n,r),u.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return lt(u.chunks[0])}}return Ue.reset(),vt(Ue,n,t,r),Ue.toBytes(!0)}function cn(e,t){return t=Object.assign({},rn,t),an(e,xt,t)}const un={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class fn{constructor(t,r={}){this._pos=0,this.data=t,this.options=r}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const t=this.data[this._pos];let r=M[t];if(r===void 0){const n=c[t];if(!n)throw new Error(`${l} no decoder for major type ${t>>>5} (byte 0x${t.toString(16).padStart(2,"0")})`);const o=t&31;r=n(this.data,this._pos,o,this.options)}return this._pos+=r.encodedLength,r}}const se=Symbol.for("DONE"),ke=Symbol.for("BREAK");function dn(e,t,r){const n=[];for(let o=0;o<e.value;o++){const i=ae(t,r);if(i===ke){if(e.value===1/0)break;throw new Error(`${l} got unexpected break to lengthed array`)}if(i===se)throw new Error(`${l} found array but not enough entries (got ${o}, expected ${e.value})`);n[o]=i}return n}function ln(e,t,r){const n=r.useMaps===!0,o=n?void 0:{},i=n?new Map:void 0;for(let s=0;s<e.value;s++){const u=ae(t,r);if(u===ke){if(e.value===1/0)break;throw new Error(`${l} got unexpected break to lengthed map`)}if(u===se)throw new Error(`${l} found map but not enough entries (got ${s} [no key], expected ${e.value})`);if(n!==!0&&typeof u!="string")throw new Error(`${l} non-string keys not supported (got ${typeof u})`);if(r.rejectDuplicateMapKeys===!0&&(n&&i.has(u)||!n&&u in o))throw new Error(`${l} found repeat map key "${u}"`);const h=ae(t,r);if(h===se)throw new Error(`${l} found map but not enough entries (got ${s} [no value], expected ${e.value})`);n?i.set(u,h):o[u]=h}return n?i:o}function ae(e,t){if(e.done())return se;const r=e.next();if(r.type===a.break)return ke;if(r.type.terminal)return r.value;if(r.type===a.array)return dn(r,e,t);if(r.type===a.map)return ln(r,e,t);if(r.type===a.tag){if(t.tags&&typeof t.tags[r.value]=="function"){const n=ae(e,t);return t.tags[r.value](n)}throw new Error(`${l} tag not supported (${r.value})`)}throw new Error("unsupported")}function hn(e,t){if(!(e instanceof Uint8Array))throw new Error(`${l} data to decode must be a Uint8Array`);t=Object.assign({},un,t);const r=t.tokenizer||new fn(e,t),n=ae(r,t);if(n===se)throw new Error(`${l} did not find any content to decode`);if(n===ke)throw new Error(`${l} got unexpected break`);return[n,e.subarray(r.pos())]}function pn(e,t){const[r,n]=hn(e,t);if(n.length>0)throw new Error(`${l} too many terminals, data makes no sense`);return r}function wn(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function We(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function gn(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var i=e.charAt(o),s=i.charCodeAt(0);if(r[s]!==255)throw new TypeError(i+" is ambiguous");r[s]=o}var u=e.length,h=e.charAt(0),b=Math.log(u)/Math.log(256),w=Math.log(256)/Math.log(u);function N(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(y.length===0)return"";for(var C=0,O=0,g=0,m=y.length;g!==m&&y[g]===0;)g++,C++;for(var x=(m-g)*w+1>>>0,v=new Uint8Array(x);g!==m;){for(var k=y[g],E=0,_=x-1;(k!==0||E<O)&&_!==-1;_--,E++)k+=256*v[_]>>>0,v[_]=k%u>>>0,k=k/u>>>0;if(k!==0)throw new Error("Non-zero carry");O=E,g++}for(var B=x-O;B!==x&&v[B]===0;)B++;for(var de=h.repeat(C);B<x;++B)de+=e.charAt(v[B]);return de}function Q(y){if(typeof y!="string")throw new TypeError("Expected String");if(y.length===0)return new Uint8Array;var C=0;if(y[C]!==" "){for(var O=0,g=0;y[C]===h;)O++,C++;for(var m=(y.length-C)*b+1>>>0,x=new Uint8Array(m);y[C];){var v=r[y.charCodeAt(C)];if(v===255)return;for(var k=0,E=m-1;(v!==0||k<g)&&E!==-1;E--,k++)v+=u*x[E]>>>0,x[E]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");g=k,C++}if(y[C]!==" "){for(var _=m-g;_!==m&&x[_]===0;)_++;for(var B=new Uint8Array(O+(m-_)),de=O;_!==m;)B[de++]=x[_++];return B}}}function fe(y){var C=Q(y);if(C)return C;throw new Error(`Non-${t} character`)}return{encode:N,decodeUnsafe:Q,decode:fe}}var yn=gn,mn=yn;class bn{constructor(t,r,n){d(this,"name");d(this,"prefix");d(this,"baseEncode");this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class xn{constructor(t,r,n){d(this,"name");d(this,"prefix");d(this,"baseDecode");d(this,"prefixCodePoint");this.name=t,this.prefix=r;const o=r.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Et(this,t)}}class vn{constructor(t){d(this,"decoders");this.decoders=t}or(t){return Et(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function Et(e,t){return new vn({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}class En{constructor(t,r,n,o){d(this,"name");d(this,"prefix");d(this,"baseEncode");d(this,"baseDecode");d(this,"encoder");d(this,"decoder");this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new bn(t,r,n),this.decoder=new xn(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}function _t({name:e,prefix:t,encode:r,decode:n}){return new En(e,t,r,n)}function Se({name:e,prefix:t,alphabet:r}){const{encode:n,decode:o}=mn(r,e);return _t({prefix:t,name:e,encode:n,decode:i=>We(o(i))})}function _n(e,t,r,n){let o=e.length;for(;e[o-1]==="=";)--o;const i=new Uint8Array(o*r/8|0);let s=0,u=0,h=0;for(let b=0;b<o;++b){const w=t[e[b]];if(w===void 0)throw new SyntaxError(`Non-${n} character`);u=u<<r|w,s+=r,s>=8&&(s-=8,i[h++]=255&u>>s)}if(s>=r||255&u<<8-s)throw new SyntaxError("Unexpected end of data");return i}function An(e,t,r){const n=t[t.length-1]==="=",o=(1<<r)-1;let i="",s=0,u=0;for(let h=0;h<e.length;++h)for(u=u<<8|e[h],s+=8;s>r;)s-=r,i+=t[o&u>>s];if(s!==0&&(i+=t[o&u<<r-s]),n)for(;i.length*r&7;)i+="=";return i}function kn(e){const t={};for(let r=0;r<e.length;++r)t[e[r]]=r;return t}function D({name:e,prefix:t,bitsPerChar:r,alphabet:n}){const o=kn(n);return _t({prefix:t,name:e,encode(i){return An(i,n,r)},decode(i){return _n(i,o,r,e)}})}const we=D({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});D({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});D({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});D({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});D({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});D({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});D({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});D({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});D({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Ie=Se({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Se({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const P=Se({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Se({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Sn=At,it=128,Cn=-128,Tn=Math.pow(2,31);function At(e,t,r){t=t||[],r=r||0;for(var n=r;e>=Tn;)t[r++]=e&255|it,e/=128;for(;e&Cn;)t[r++]=e&255|it,e>>>=7;return t[r]=e|0,At.bytes=r-n+1,t}var Un=$e,In=128,st=127;function $e(e,n){var r=0,n=n||0,o=0,i=n,s,u=e.length;do{if(i>=u)throw $e.bytes=0,new RangeError("Could not decode varint");s=e[i++],r+=o<28?(s&st)<<o:(s&st)*Math.pow(2,o),o+=7}while(s>=In);return $e.bytes=i-n,r}var Bn=Math.pow(2,7),$n=Math.pow(2,14),Nn=Math.pow(2,21),Mn=Math.pow(2,28),On=Math.pow(2,35),zn=Math.pow(2,42),Rn=Math.pow(2,49),Dn=Math.pow(2,56),Fn=Math.pow(2,63),jn=function(e){return e<Bn?1:e<$n?2:e<Nn?3:e<Mn?4:e<On?5:e<zn?6:e<Rn?7:e<Dn?8:e<Fn?9:10},Ln={encode:Sn,decode:Un,encodingLength:jn},be=Ln;function Ne(e,t=0){return[be.decode(e,t),be.decode.bytes]}function xe(e,t,r=0){return be.encode(e,t,r),t}function ve(e){return be.encodingLength(e)}function Pn(e,t){const r=t.byteLength,n=ve(e),o=n+ve(r),i=new Uint8Array(o+r);return xe(e,i,0),xe(r,i,n),i.set(t,o),new qe(e,r,t,i)}function Vn(e){const t=We(e),[r,n]=Ne(t),[o,i]=Ne(t.subarray(n)),s=t.subarray(n+i);if(s.byteLength!==o)throw new Error("Incorrect length");return new qe(r,o,s,t)}function Gn(e,t){if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&wn(e.bytes,r.bytes)}}class qe{constructor(t,r,n,o){d(this,"code");d(this,"size");d(this,"digest");d(this,"bytes");this.code=t,this.size=r,this.digest=n,this.bytes=o}}function at(e,t){const{bytes:r,version:n}=e;switch(n){case 0:return Wn(r,Me(e),t??P.encoder);default:return qn(r,Me(e),t??we.encoder)}}const ct=new WeakMap;function Me(e){const t=ct.get(e);if(t==null){const r=new Map;return ct.set(e,r),r}return t}var dt;class A{constructor(t,r,n,o){d(this,"code");d(this,"version");d(this,"multihash");d(this,"bytes");d(this,"/");d(this,dt,"CID");this.code=r,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:t,multihash:r}=this;if(t!==ie)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==Jn)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return A.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:t,digest:r}=this.multihash,n=Pn(t,r);return A.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return A.equals(this,t)}static equals(t,r){const n=r;return n!=null&&t.code===n.code&&t.version===n.version&&Gn(t.multihash,n.multihash)}toString(t){return at(this,t)}toJSON(){return{"/":at(this)}}link(){return this}[(dt=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;const r=t;if(r instanceof A)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){const{version:n,code:o,multihash:i,bytes:s}=r;return new A(n,o,i,s??ut(n,o,i.bytes))}else if(r[Hn]===!0){const{version:n,multihash:o,code:i}=r,s=Vn(o);return A.create(n,i,s)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==ie)throw new Error(`Version 0 CID must use dag-pb (code: ${ie}) block encoding`);return new A(t,r,n,n.bytes)}case 1:{const o=ut(t,r,n.bytes);return new A(t,r,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return A.create(0,ie,t)}static createV1(t,r){return A.create(1,t,r)}static decode(t){const[r,n]=A.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return r}static decodeFirst(t){const r=A.inspectBytes(t),n=r.size-r.multihashSize,o=We(t.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");const i=o.subarray(r.multihashSize-r.digestSize),s=new qe(r.multihashCode,r.digestSize,i,o);return[r.version===0?A.createV0(s):A.createV1(r.codec,s),t.subarray(r.size)]}static inspectBytes(t){let r=0;const n=()=>{const[N,Q]=Ne(t.subarray(r));return r+=Q,N};let o=n(),i=ie;if(o===18?(o=0,r=0):i=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);const s=r,u=n(),h=n(),b=r+h,w=b-s;return{version:o,codec:i,multihashCode:u,digestSize:h,multihashSize:w,size:b}}static parse(t,r){const[n,o]=Kn(t,r),i=A.decode(o);if(i.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Me(i).set(n,t),i}}function Kn(e,t){switch(e[0]){case"Q":{const r=t??P;return[P.prefix,r.decode(`${P.prefix}${e}`)]}case P.prefix:{const r=t??P;return[P.prefix,r.decode(e)]}case we.prefix:{const r=t??we;return[we.prefix,r.decode(e)]}case Ie.prefix:{const r=t??Ie;return[Ie.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}}function Wn(e,t,r){const{prefix:n}=r;if(n!==P.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const o=t.get(n);if(o==null){const i=r.encode(e).slice(1);return t.set(n,i),i}else return o}function qn(e,t,r){const{prefix:n}=r,o=t.get(n);if(o==null){const i=r.encode(e);return t.set(n,i),i}else return o}const ie=112,Jn=18;function ut(e,t,r){const n=ve(e),o=n+ve(t),i=new Uint8Array(o+r.byteLength);return xe(e,i,0),xe(t,i,n),i.set(r,o),i}const Hn=Symbol.for("@ipld/js-cid/CID"),kt=42;function St(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}function Qn(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;const t=A.asCID(e);if(!t)return null;const r=new Uint8Array(t.bytes.byteLength+1);return r.set(t.bytes,1),[new f(a.tag,kt),new f(a.bytes,r)]}function Xn(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function Yn(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const Oe={float64:!0,typeEncoders:{Object:Qn,undefined:Xn,number:Yn}},Zn={...Oe,typeEncoders:{...Oe.typeEncoders}};function eo(e){if(e[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return A.decode(e.subarray(1))}const Ee={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Ee.tags[kt]=eo;const to={...Ee,tags:Ee.tags.slice()},ro="dag-cbor",no=113,oo=e=>cn(e,Oe),io=e=>pn(St(e),Ee),so=Object.freeze(Object.defineProperty({__proto__:null,code:no,decode:io,decodeOptions:to,encode:oo,encodeOptions:Zn,name:ro,toByteView:St},Symbol.toStringTag,{value:"Module"}));Be.parse("bafybeiczsscdsbs7ffqz55ahobb37kkvllc4hikvjbgmsecgnuyzy4b4ga");class ao{constructor({log:t=null,batchSize:r=1e3,encoder:n=et}){d(this,"neo4j",Ot());d(this,"path",[]);d(this,"log",null);d(this,"batchSize",1500);d(this,"encoder",et);d(this,"carReadable",null);d(this,"carWritable",null);d(this,"carWriter",null);d(this,"blocks",[]);t!=null?this.log=t:jt.debugging&&(this.log=console.debug),this.batchSize=r,this.encoder=n;const{readable:o,writable:i}=new TransformStream;this.carReadable=o,this.carWritable=i,this.carWriter=i.getWriter();const s=this.blocks;this.carReadable.pipeTo(new WritableStream({write(u){s.push(u)}}))}async node(t){var n,o;const r=this.neo4j.session();if(t==null){const i=`
        MATCH (r:Root) RETURN elementId(r) as id
      `,{records:s}=await r.run(i),u=s.length;if(u===0)throw new Error("Couldn’t find `rootId`.");if(u>1)throw new Error(`Found ${u} \`rootId\`s.`);t=s[0].get("id")}if(t==null)throw new Error("Couldn’t get `rootId`.");if(this.path.includes(t))throw new Error(`Revisited ${t}. (¿Cycle found?)`,{cause:this.path});this.path.push(t);try{const i=`
        MATCH (start) WHERE elementId(start) = $rootId
        OPTIONAL MATCH (start)-[rel]->(node)
        ORDER BY rel.path
        RETURN
          labels(start) AS labels,
          properties(start) AS properties,
          [r IN collect({
            type: type(rel),
            properties: properties(rel),
            targetId: elementId(node)
          }) WHERE r.type IS NOT NULL] AS relations
      `,{records:s}=await r.run(i,{rootId:t});if((n=this.log)==null||n.call(this,`Found ${s.length} node${s.length===1?"":"s"} at ${t.split(":").at(-1)}`),s.length!==1)throw new Error(`Returned ${s.length} records.`);const[u]=s,h=[];for(const w of u.get("relations")??[])h.push({type:w.type,...w.properties,target:await this.node(w.targetId)});const b=await this.addToCAR({labels:u.get("labels"),properties:Object.fromEntries(Object.entries(u.get("properties")).map(([w,N])=>(w==="cid"&&typeof N=="string"&&(N=Be.parse(N)),[w,N]))),relationships:h});return this.path.pop(),(o=this.log)==null||o.call(this,{cid:b.toString()}),b}finally{await r.close()}}async addToCAR(t){const r=this.encoder.encode(t),n=await zt.digest(r),o=Be.create(1,this.encoder.code,n);if(this.carWriter==null)throw new Error("No `carWriter`.");return await this.carWriter.write({cid:o,bytes:r}),o}async carURL(){var i;(i=this.log)==null||i.call(this,"Generating CAR URL…");const t=this.blocks,r=new ReadableStream({pull(s){t.length>0?s.enqueue(t.shift()):s.close()}});if(!t||t.length===0)throw new Error("No blocks generated.");const n=t.at(-1);if(!n)throw new Error("No root block found.");const o=[];return await r.pipeThrough(new Ft([n.cid])).pipeTo(new WritableStream({write(s){o.push(s)}})),URL.createObjectURL(new Blob(o))}}async function co({log:e=null,batchSize:t=1e3,rootId:r=null}){var n,o;try{const i=so,s=new ao({log:e,batchSize:t,encoder:i});(n=s.log)==null||n.call(s,`Exporting nodes to \`${i.name}\`…`);const u=await s.node(r);return(o=s.log)==null||o.call(s,{rootCID:u}),{serializer:s,rootCID:u}}catch(i){throw console.error({"Graph Serializing Error":i}),i}}var Z;class uo{constructor(){d(this,"networks",[Pt]);d(this,"adapter",new Vt({projectId:tt,networks:this.networks}));d(this,"metadata",{name:"Mïmis",description:"Collaborative filesystem",url:"https://mimis.dhappy.org",icons:["https://avatars.githubusercontent.com/u/179229932"]});Qe(this,Z,null)}get appKit(){return Ce(this,Z)||Xe(this,Z,Gt({adapters:[this.adapter],networks:this.networks,metadata:this.metadata,projectId:tt,features:{analytics:!0,swaps:!1,onramp:!1,connectMethodsOrder:["wallet","social","email"]}})),Ce(this,Z)}async getProvider(t="eip155",{log:r}={}){await this.appKit.ready();const n=new Promise((o,i)=>{const s=this.appKit.getProvider(t);if(s)return r==null||r({"AppKit Provider":s}),o(s);this.appKit.subscribeProviders(u=>o(u[t])),this.appKit.subscribeEvents(u=>{u.data.event==="MODAL_CLOSE"&&(u.data.properties.connected||i(new Error("Modal closed without connection.")))}),this.appKit.open()});return r==null||r({"Promised Provider":n}),n}async signMessage(t,{log:r}={}){const n=await this.getProvider(void 0,{log:r});let{address:o}=this.appKit.getAccount();if(o||(o=await new Promise(i=>{this.appKit.subscribeAccount(({address:s})=>{s&&i(s)}),this.appKit.open()})),r==null||r({message:t,provider:n,address:o}),!o)throw new Error("Could not find address from provider.");return await n.request({method:"personal_sign",params:[t,o]})}}Z=new WeakMap;const ft=new uo,fo=async(e,t,r,n,o,i)=>{j(t,!0);try{const{rootCID:s,serializer:u}=await co({});j(r,!0),console.debug({acct:await Kt(ft.adapter.wagmiConfig)});const h=await ft.signMessage(s.toString(),{log:console.debug});j(r,!1),j(n,await u.addToCAR({root:s,signature:h}),!0),console.debug({final:T(n).toString(),signature:h}),j(o,await u.carURL(),!0),j(i,`mïmis.full-tree.${qt()}.car`)}catch(s){console.error({"Generation Error":s}),Dt({text:s.message,duration:16e3,close:!0,gravity:"bottom",position:"center",stopOnFocus:!0,style:{background:"linear-gradient(to right, #b09b00, #96003d)"}}).showToast()}finally{j(r,!1),j(t,!1)}};var lo=G('<link rel="icon" href="radioactive%20barrel.svg"/>'),ho=G("<button><span>Generate a CAR Archive</span></button>"),po=G("<p>Generating CAR…</p>"),wo=G("<p>Awaiting Ethereum Wallet Signature…</p>"),go=async(e,t)=>{if(!T(t))throw new Error("`carURL` isn’t set.");const r=console.debug,n=await Wt({log:r}),o=await fetch(T(t));r==null||r(`Uploading: "${T(t)}".`),await n.uploadCAR(await o.blob()),r==null||r("Upload Complete.")},yo=async(e,t)=>{if(!T(t))throw new Error("`carURL` isn’t set.");const r=console.debug,n=await Rt(),s=await(await(await fetch(T(t))).blob()).arrayBuffer();r==null||r(`Uploading: "${T(t)}".`),await n.dag.import([new Uint8Array(s)]),r==null||r("Upload Complete.")},mo=G('<hr class="svelte-1oslbmx"/> <a class="button"><span> </span></a> <hr class="svelte-1oslbmx"/> <button><span>Upload CAR To Storacha</span></button> <hr class="svelte-1oslbmx"/> <button><span>Upload CAR To Kubo</span></button>',1),bo=G('<hr class="svelte-1oslbmx"/> <a class="button" target="_blank"><span>Browse <code> </code></span></a>',1),xo=G('<heading><h1>Generate a JSON-DAG of the Graph Structure</h1></heading> <main class="svelte-1oslbmx"><!> <appkit-button></appkit-button> <!> <!></main>',3);function zo(e,t){Ut(t,!0);let r=oe(null),n=oe(null),o=oe(!1),i=oe(!1),s=oe("dl.car");var u=xo();Mt(g=>{var m=lo();Bt.title="Mïmis: Serialize",F(g,m)});var h=z(le(u),2),b=X(h);{var w=g=>{var m=ho();m.__click=[fo,o,i,r,n,s],F(g,m)},N=g=>{var m=$t(),x=le(m);{var v=E=>{var _=po();F(E,_)},k=E=>{var _=wo();F(E,_)};he(x,E=>{T(i)?E(k,!1):E(v)})}F(g,m)};he(b,g=>{T(o)?g(N,!1):g(w)})}var Q=z(b,2),fe=z(Q,2);{var y=g=>{var m=mo(),x=z(le(m),2),v=X(x),k=X(v);Y(v),Y(x);var E=z(x,4);E.__click=[go,n];var _=z(E,4);_.__click=[yo,n],Ye(()=>{Te(x,"href",T(n)),Te(x,"download",T(s)),Ze(k,`Download DAG-JSON CAR: ${T(s)??""}`)}),F(g,m)};he(fe,g=>{T(n)&&g(y)})}var C=z(fe,2);{var O=g=>{var m=bo(),x=z(le(m),2),v=X(x),k=z(X(v)),E=X(k);Y(k),Y(v),Y(x),Ye((_,B)=>{Te(x,"href",_),Ze(E,`ipfs://${B??""}`)},[()=>Lt({cid:T(r).toString()}),()=>T(r).toString()]),F(g,m)};he(C,g=>{T(r)&&g(O)})}Y(h),F(e,u),It()}Nt(["click"]);export{zo as component};
