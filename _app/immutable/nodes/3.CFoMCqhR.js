import{t as v,a as u,c as Ce}from"../chunks/CywG_ei0.js";import{x as Ie,C as xe,l as D,G as we,aA as te,I as Ae,J as ke,D as Se,K as ae,a8 as se,U as G,X as re,W as oe,O as K,w as Re,L as He,ax as ie,aw as le,aB as ne,b as $e,N as ce,P as J,aC as Oe,p as Le,m as he,o as Pe,d as je,a as De,af as Me,n as ue,i as a,c as f,z as fe,r as o,s as H,f as me,aD as X,t as Y}from"../chunks/DmvcQcn9.js";import{s as M}from"../chunks/IoC4kQTD.js";import{i as Z}from"../chunks/CD554mYx.js";import{e as pe,i as ve}from"../chunks/n9zbbAhM.js";import{h as We}from"../chunks/DXNVwOx6.js";import{s as $}from"../chunks/DTJrl2DX.js";import{d as Be,e as ze}from"../chunks/D1TnnU7R.js";import{b as Fe}from"../chunks/D1cqDF8C.js";import{o as Ue}from"../chunks/DZeSfjy1.js";import{g as qe,T as Ge}from"../chunks/BNUSnB5y.js";import{p as W}from"../chunks/B1KqbTpb.js";import{t as de}from"../chunks/BwJVXBYH.js";import{s as Ke}from"../chunks/WdWZvUfi.js";const Q=0,B=1,V=2;function Je(m,h,s,N,d){D&&we();var i=m,b=Ie(),E=$e,l=se,n,c,k,y=(b?re:oe)(void 0),O=(b?re:oe)(void 0),C=!1;function I(t,r){C=!0,r&&(ie(e),le(e),ne(E));try{t===Q&&s&&(n?ce(n):n=K(()=>s(i))),t===B&&N&&(c?ce(c):c=K(()=>N(i,y))),t!==Q&&n&&J(n,()=>n=null),t!==B&&c&&J(c,()=>c=null),t!==V&&k&&J(k,()=>k=null)}finally{r&&(ne(null),le(null),ie(null),Oe())}}var e=xe(()=>{if(l===(l=h()))return;let t=D&&te(l)===(i.data===Ae);if(t&&(i=ke(),Se(i),ae(!1),t=!0),te(l)){var r=l;C=!1,r.then(T=>{r===l&&(G(y,T),I(B,!0))},T=>{if(r===l)throw G(O,T),I(V,!0),O.v}),D?s&&(n=K(()=>s(i))):Re(()=>{C||I(Q,!0)})}else G(y,l),I(B,!1);return t&&ae(!0),()=>l=se});D&&(i=He)}const Xe=async({path:m,limit:h=200,offset:s=0})=>{const N=qe();try{const d=N.session();m=m.filter(E=>E.trim()!==""),h=parseInt(Number(h).toFixed(0)),s=parseInt(Number(s).toFixed(0));const i=m.length===0?`
        MATCH (start:Root)-[children:CONTAINS|CONNECTS]->(child)
        RETURN [] as path, children.path as container, child
      `:`
        WITH $elems as pathElems
        MATCH path = (start:Root)-[:CONTAINS|CONNECTS*]->(end)
        MATCH (end)-[children:CONTAINS|CONNECTS]->(child)
        WITH pathElems, path, children, child, [
          rel in relationships(path)
          WHERE NOT isEmpty(rel.path)
          | rel.path
        ] as elements
        WHERE size(elements) = size(pathElems)
        AND ALL(
          i IN range(0, size(pathElems) - 1)
          WHERE (
            pathElems[i] = '*'
            OR elements[i] = pathElems[i]
          )
        )
        LIMIT ${s+h}
        SKIP ${s}
        RETURN DISTINCT
          elements as path,
          children.path as container,
          child
      `,b=await d.run(i,{elems:m,limit:BigInt(h),offset:BigInt(s)});return await d.close(),b.records}finally{N.close()}};var Ye=v('<li class="svelte-165lhoa"> <a class="button svelte-165lhoa">⨯</a></li>'),Ze=v('<ul id="path" class="svelte-165lhoa"></ul>'),Qe=v('<h2 class="svelte-165lhoa">No Results</h2>'),Ve=v('<h2 class="svelte-165lhoa"> </h2> <object class="svelte-165lhoa"><p>Could not display <a target="_blank"> </a>.</p></object>',1),et=(m,h,s)=>{h(a(s))},tt=v('<a class="button svelte-165lhoa"> </a>'),at=v("<li><!></li>"),st=v('<ul id="result" class="svelte-165lhoa"></ul>'),rt=v('<h2 class="svelte-165lhoa">Searching…</h2>'),ot=v('<main class="svelte-165lhoa"><form><input id="chip" placeholder="Path Element"> <button>Add Path Element</button></form> <!> <section id="result" class="svelte-165lhoa"><!></section></main>');function bt(m,h){Le(h,!0);let s=he(Pe([])),N=X(async()=>{try{const e=W.url.searchParams.get("limit"),t=W.url.searchParams.get("offset");return await Xe({path:a(s),limit:e?Number(e):Ke.limit,offset:Number(t)})}catch(e){Ge({text:e.message,duration:16e3,close:!0,gravity:"bottom",position:"center",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}}),d=he("");Ue(()=>{ue(s,W.params.path.split("/").filter(Boolean),!0);const e=W.url.hash.split("/").filter(Boolean);ue(d,e.slice(0,e.length-a(s).length).join("/"),!0)});const i=e=>{e.preventDefault();const t=e.target.elements.chip;b(t.value),t.value=""},b=e=>{e=e.trim(),e&&a(s).push(e)},E=e=>{a(s).splice(e,1)},l=()=>{E(-1)};je(()=>{const e=t=>{t.key==="ArrowLeft"&&t.target===document.body&&l()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}});var n=ot();We(e=>{Me.title="Mïmis: Search"});var c=f(n),k=f(c);Fe(k),fe(2),o(c);var y=H(c,2);{var O=e=>{var t=Ze();pe(t,21,()=>a(s),ve,(r,T,L)=>{var S=Ye(),p=f(S),_=H(p);_.__click=()=>E(L),o(S),Y(z=>{M(p,`${a(T)??""} `),$(_,"href",z)},[()=>`${a(d)}/${a(s).toSpliced(L,1).join("/")}`]),u(r,S)}),o(t),u(e,t)};Z(y,e=>{a(s).length>0&&e(O)})}var C=H(y,2),I=f(C);Je(I,()=>a(N),e=>{var t=rt();u(e,t)},(e,t)=>{var r=Ce(),T=me(r);{var L=p=>{var _=Qe();u(p,_)},S=p=>{var _=st();pe(_,21,()=>a(t),ve,(z,P)=>{var F=at();const U=X(()=>a(P).get("container"));var _e=f(F);{var ge=x=>{var g=Ve();const w=X(()=>{const{cid:A}=a(P).get("child").properties;return{cid:A}});var R=me(g),be=f(R);o(R);var j=H(R,2),ee=f(j),q=H(f(ee)),Te=f(q);o(q),fe(),o(ee),o(j),Y((A,Ee,ye)=>{M(be,`/${A??""}/${a(U)??""}`),$(j,"data",Ee),$(j,"title",`ipfs://${a(w).cid}`),$(q,"href",ye),M(Te,`ipfs://${a(w).cid??""}`)},[()=>{var A;return(A=a(P).get("path"))==null?void 0:A.join("/")},()=>de({cid:a(w).cid}),()=>de({cid:a(w).cid})]),u(x,g)},Ne=x=>{var g=tt();g.__click=[et,b,U];var w=f(g,!0);o(g),Y(R=>{$(g,"href",R),M(w,a(U))},[()=>`${a(d)}/${a(s).join("/")}${a(s).length>0?"/":""}`]),u(x,g)};Z(_e,x=>{a(P).get("child").labels.includes("File")?x(ge):x(Ne,!1)})}o(F),u(z,F)}),o(_),u(p,_)};Z(T,p=>{!a(t)||a(t).length===0?p(L):p(S,!1)})}u(e,r)}),o(C),o(n),ze("submit",c,i),u(m,n),De()}Be(["click"]);export{bt as component};
