import{a as d,t as b,c as me}from"../chunks/Df6_adTu.js";import{a0 as ve,d as fe,h as W,g as _e,az as ge,v as z,o as O,X as be,m as Ne,E as Y,D as Z,ag as ee,aw as te,aA as ae,n as F,q,aB as xe,N as Te,p as Ee,av as se,M as ye,a as Ce,a4 as re,R as t,ap as $e,s as A,c as h,aC as ie,r as o,t as g,T as U,f as oe}from"../chunks/CkSVN3h7.js";import{s as P}from"../chunks/TzirV2Sw.js";import{i as G}from"../chunks/CRthrAod.js";import{e as ne,i as le}from"../chunks/Csp1DH7L.js";import{h as we}from"../chunks/DG8NnKi0.js";import{s as H}from"../chunks/DAZ8PjuF.js";import{d as Ie,e as ke}from"../chunks/BTxUqvk3.js";import{b as Ae}from"../chunks/DSsjvM0M.js";import{p as K}from"../chunks/DbpsKWpO.js";import{o as He}from"../chunks/BKh5lhle.js";import{g as Re,T as Se}from"../chunks/CoPGGKb1.js";import{p as j}from"../chunks/DtZ6HWnz.js";import{t as Oe}from"../chunks/C9EPMjQO.js";import{s as Pe}from"../chunks/DsdrfwAN.js";const X=0,L=1,J=2;function je(m,c,a,T,v){W&&_e();var f=m,E=ve(),y=Te,p,n,l,N,C=(E?Y:Z)(void 0),$=(E?Y:Z)(void 0),I=!1;function e(r,u){I=!0,u&&(ee(s),te(s),ae(y));try{r===X&&a&&(n?F(n):n=O(()=>a(f))),r===L&&T&&(l?F(l):l=O(()=>T(f,C))),r===J&&v&&(N?F(N):N=O(()=>v(f,$))),r!==X&&n&&q(n,()=>n=null),r!==L&&l&&q(l,()=>l=null),r!==J&&N&&q(N,()=>N=null)}finally{u&&(ae(null),te(null),ee(null),xe())}}var s=fe(()=>{if(p!==(p=c())){if(ge(p)){var r=p;I=!1,r.then(u=>{r===p&&(z(C,u),e(L,!0))},u=>{if(r===p)throw z($,u),e(J,!0),$.v}),W?a&&(n=O(()=>a(f))):be(()=>{I||e(X,!0)})}else z(C,p),e(L,!1);return()=>p=null}});W&&(f=Ne)}const Le=async({path:m,limit:c=200,offset:a=0})=>{const T=Re();try{const v=T.session();m=m.filter(y=>y.trim()!==""),c=parseInt(Number(c).toFixed(0)),a=parseInt(Number(a).toFixed(0));const f=m.length===0?`
        MATCH (start:Root)-[children:CONTAINS|CONNECTS]->(child)
        RETURN [] as path, children.path as container, child
      `:`
        WITH $elems as pathElems
        MATCH path = (start:Root)-[:CONTAINS|CONNECTS*]->(end)
        MATCH (end)-[children:CONTAINS|CONNECTS]->(child)
        WITH pathElems, path, children, child, [
          rel in relationships(path)
          WHERE NOT isEmpty(rel.path)
          | rel.path
        ] as elements
        WHERE size(elements) = size(pathElems)
        AND ALL(
          i IN range(0, size(pathElems) - 1)
          WHERE (
            pathElems[i] = '*'
            OR elements[i] = pathElems[i]
          )
        )
        LIMIT ${a+c}
        SKIP ${a}
        RETURN DISTINCT
          elements as path,
          children.path as container,
          child
      `,E=await v.run(f,{elems:m,limit:BigInt(c),offset:BigInt(a)});return await v.close(),E.records}finally{T.close()}};var Me=b('<li class="svelte-11xv3gd"> <a class="button svelte-11xv3gd">⨯</a></li>'),Be=b('<ul id="path" class="svelte-11xv3gd"></ul>'),De=b('<h2 class="svelte-11xv3gd">No Results</h2>'),We=b('<h2 class="svelte-11xv3gd"> </h2> <object class="svelte-11xv3gd"><p>Could not display <a target="_blank"> </a>.</p></object>',1),ze=(m,c,a)=>{console.debug("H!"),c(t(a).get("container"))},Fe=b('<a class="button"> </a>'),qe=b("<li><!></li>"),Ue=b('<ul id="result" class="svelte-11xv3gd"></ul>'),Ge=b('<h2 class="svelte-11xv3gd">Searching…</h2>'),Ke=b('<main class="svelte-11xv3gd"><form><input id="chip" placeholder="Path Element"> <button>Add Path Element</button></form> <!> <section id="result" class="svelte-11xv3gd"><!></section></main>');function ct(m,c){Ee(c,!0);let a=se(K([])),T=U(async()=>{try{const e=j.url.searchParams.get("limit"),s=j.url.searchParams.get("offset");return await Le({path:t(a),limit:e?Number(e):Pe.limit,offset:Number(s)})}catch(e){Se({text:e.message,duration:16e3,close:!0,gravity:"bottom",position:"center",stopOnFocus:!0,style:{background:"linear-gradient(to right, #00b09b, #96c93d)"}}).showToast()}}),v=se("");He(()=>{re(a,K(j.params.path.split("/").filter(Boolean)));const e=j.url.hash.split("/").filter(Boolean);re(v,K(e.slice(0,e.length-t(a).length).join("/")))});const f=e=>{e.preventDefault();const s=e.target.elements.chip;E(s.value),s.value=""},E=e=>{e=e.trim(),e&&t(a).push(e)},y=e=>{t(a).splice(e,1)},p=()=>{y(-1)};ye(()=>{const e=s=>{s.key==="ArrowLeft"&&s.target===document.body&&p()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}});var n=Ke();we(e=>{$e.title="Mïmis: Search"});var l=h(n),N=h(l);Ae(N),ie(2),o(l);var C=A(l,2);G(C,()=>t(a).length>0,e=>{var s=Be();ne(s,21,()=>t(a),le,(r,u,w)=>{var _=Me(),R=h(_),i=A(R);g(()=>H(i,"href",`${t(v)}/${t(a).toSpliced(w,1).join("/")}`)),i.__click=()=>y(w),o(_),g(()=>P(R,`${t(u)??""} `)),d(r,_)}),o(s),d(e,s)});var $=A(C,2),I=h($);je(I,()=>t(T),e=>{var s=Ge();d(e,s)},(e,s)=>{var r=me(),u=oe(r);G(u,()=>!t(s)||t(s).length===0,w=>{var _=De();d(w,_)},w=>{var _=Ue();ne(_,21,()=>t(s),le,(R,i)=>{var M=qe(),ce=h(M);G(ce,()=>t(i).get("child").labels.includes("File"),B=>{var x=We(),k=oe(x);const pe=U(()=>{var V;return((V=t(i).get("path"))==null?void 0:V.join("/"))??""}),ue=U(()=>t(i).get("container")??"");var de=h(k);g(()=>P(de,`/${t(pe)}/${t(ue)}`)),o(k);var S=A(k,2);g(()=>H(S,"data",Oe({cid:t(i).get("child").properties.cid}))),g(()=>H(S,"title",`ipfs://${t(i).get("child").properties.cid}`));var Q=h(S),D=A(h(Q));g(()=>H(D,"href",`https://w3s.link/ipfs/${t(i).get("child").properties.cid}`));var he=h(D);g(()=>P(he,`ipfs://${t(i).get("child").properties.cid??""}`)),o(D),ie(),o(Q),o(S),d(B,x)},B=>{var x=Fe();g(()=>H(x,"href",`${t(v)}/${t(a).join("/")}${t(a).length>0?"/":""}${t(i).get("container")}`)),x.__click=[ze,E,i];var k=h(x,!0);g(()=>P(k,t(i).get("container"))),o(x),d(B,x)}),o(M),d(R,M)}),o(_),d(w,_)}),d(e,r)}),o($),o(n),ke("submit",l,f),d(m,n),Ce()}Ie(["click"]);export{ct as component};
