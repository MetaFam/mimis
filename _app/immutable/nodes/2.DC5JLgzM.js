import"../chunks/disclose-version.Bg9kRutz.js";import{p as Ke,a4 as H,f as qe,c as V,t as B,r as P,w as S,a as We,aC as X,s as W,aE as ut,m as ft,a7 as pt}from"../chunks/runtime.BXk13jFn.js";import{s as Ne,d as je,e as gt}from"../chunks/render.BR4r8p3e.js";import{a as U,i as ee,p as Me}from"../chunks/props.DKft77Wj.js";import{e as vt,i as mt,t as yt}from"../chunks/class.ClIoSUzw.js";import{c as bt,a as T,t as A}from"../chunks/template.rShIjToA.js";import{h as wt}from"../chunks/svelte-head.DB7hvReC.js";import{a as Oe}from"../chunks/attributes.CPRq1iUu.js";const _t=!0,is=Object.freeze(Object.defineProperty({__proto__:null,prerender:_t},Symbol.toStringTag,{value:"Module"}));/*!
 * debounce & throttle, taken from https://github.com/lodash/lodash v4.17.21
 * MIT License: https://raw.githubusercontent.com/lodash/lodash/4.17.21-npm/LICENSE
 * Modified for TypeScript type annotations.
 */const Et=typeof global=="object"&&global!==null&&global.Object===Object&&global,xt=typeof globalThis=="object"&&globalThis!==null&&globalThis.Object==Object&&globalThis,kt=typeof self=="object"&&self!==null&&self.Object===Object&&self,ne=xt||Et||kt||Function("return this")();function Be(l){const e=typeof l;return l!=null&&(e==="object"||e==="function")}function ue(l,e=0,t={}){let i,s,r,n,o,a,c=0,h=!1,d=!1,p=!0;const f=!e&&e!==0&&typeof ne.requestAnimationFrame=="function";if(typeof l!="function")throw new TypeError("Expected a function");e=+e||0,Be(t)&&(h=!!t.leading,d="maxWait"in t,r=d?Math.max(+t.maxWait||0,e):r,p="trailing"in t?!!t.trailing:p);function u(w){const M=i,q=s;return i=s=void 0,c=w,n=l.apply(q,M),n}function g(w,M){return f?(ne.cancelAnimationFrame(o),ne.requestAnimationFrame(w)):setTimeout(w,M)}function y(w){if(f)return ne.cancelAnimationFrame(w);clearTimeout(w)}function b(w){return c=w,o=g(k,e),h?u(w):n}function z(w){const M=w-a,q=w-c,Ae=e-M;return d?Math.min(Ae,r-q):Ae}function N(w){const M=w-a,q=w-c;return a===void 0||M>=e||M<0||d&&q>=r}function k(){const w=Date.now();if(N(w))return _(w);o=g(k,z(w))}function _(w){return o=void 0,p&&i?u(w):(i=s=void 0,n)}function pe(){o!==void 0&&y(o),c=0,i=a=s=o=void 0}function ge(){return o===void 0?n:_(Date.now())}function ht(){return o!==void 0}function se(...w){const M=Date.now(),q=N(M);if(i=w,s=this,a=M,q){if(o===void 0)return b(a);if(d)return o=g(k,e),u(a)}return o===void 0&&(o=g(k,e)),n}return se.cancel=pe,se.flush=ge,se.pending=ht,se}function Ge(l,e=0,t={}){let i=!0,s=!0;if(typeof l!="function")throw new TypeError("Expected a function");return Be(t)&&(i="leading"in t?!!t.leading:i,s="trailing"in t?!!t.trailing:s),ue(l,e,{leading:i,trailing:s,maxWait:e})}/*!
 * Wunderbaum - util
 * Copyright (c) 2021-2024, Martin Wendt. Released under the MIT license.
 * v0.11.0, Sun, 04 Aug 2024 15:35:53 GMT (https://github.com/mar10/wunderbaum)
 */const Xe={0:"",1:"left",2:"middle",3:"right",4:"back",5:"forward"},Ct=9007199254740991,Nt=It(),Se=Nt.isMac,St=/[&<>"'/]/g,Dt=/[<>"'/]/g,Ye={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};class we extends Error{constructor(e){super(e),this.name="ValidationError"}}let Tt=class{constructor(){this.thens=[],this.catches=[],this.status=""}resolve(e){if(this.status)throw new Error("already settled");this.status="resolved",this.resolvedValue=e,this.thens.forEach(t=>t(e)),this.thens=[]}reject(e){if(this.status)throw new Error("already settled");this.status="rejected",this.rejectedError=e,this.catches.forEach(t=>t(e)),this.catches=[]}then(e){status==="resolved"?e(this.resolvedValue):this.thens.unshift(e)}catch(e){this.status==="rejected"?e(this.rejectedError):this.catches.unshift(e)}promise(){return{then:this.then,catch:this.catch}}};function v(l,e){if(!l)throw e=e||"Assertion failed.",new Error(e)}function It(){const l=navigator;return{isMac:/Mac/.test(l.platform)}}function Qe(l){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l):l()}function Lt(){return new Promise(l=>{Qe(l)})}function At(l,e){if(l==null)return l;const t=l.length;let i=0;if(typeof t=="number")for(;i<t&&e.call(l[i],i,l[i])!==!1;i++);else for(const s in l)if(e.call(l[i],s,l[s])===!1)break;return l}function x(l){throw new Error(l)}function ie(l){return(""+l).replace(St,function(e){return Ye[e]})}function G(l){return(""+l).replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function Je(l){return(""+l).replace(Dt,function(e){return Ye[e]})}function Mt(l){return l.indexOf(">")>=0&&x("Not implemented"),l}function De(l,e=!1){const t=l.tagName;let i=null;if(t==="SPAN"&&l.classList.contains("wb-col")){const s=l,r=s.querySelector("input,select");if(r)return De(r,e);s.innerText=""+i}else if(t==="INPUT"){const s=l;switch(s.type){case"button":case"reset":case"submit":case"image":break;case"checkbox":i=s.indeterminate?null:s.checked;break;case"date":case"datetime":case"datetime-local":case"month":case"time":case"week":i=e?s.valueAsDate:s.value;break;case"number":case"range":i=s.valueAsNumber;break;case"radio":{const n=s.name,o=s.parentElement.querySelector(`input[name="${n}"]:checked`);i=o?o.value:void 0}break;case"text":default:i=s.value}}else t==="SELECT"&&(i=l.value);return i}function Ze(l,e){const t=l.tagName;if(t==="SPAN"&&l.classList.contains("wb-col")){const i=l,s=i.querySelector("input,select");if(s)return Ze(s,e);i.innerText=""+e}else if(t==="INPUT"){const i=l,s=i.type;switch(s){case"checkbox":i.indeterminate=e===null,i.checked=!!e;break;case"date":case"month":case"time":case"week":case"datetime":case"datetime-local":i.valueAsDate=new Date(e);break;case"number":case"range":e==null?i.value=e:i.valueAsNumber=e;break;case"radio":x(`Not yet implemented: ${s}`);break;case"button":case"reset":case"submit":case"image":break;case"text":default:i.value=e??""}}else if(t==="SELECT"){const i=l;e==null?i.selectedIndex=-1:i.value=e}}function et(l,e){const t=Y(l).style;e?t.display==="none"&&(t.display=""):t.display===""&&(t.display="none")}function oe(l){const e=document.createElement("template");return e.innerHTML=l.trim(),e.content.firstElementChild}const Ot=new Set(["Alt","Control","Meta","Shift"]);function Y(l){return l?typeof l=="string"?document.querySelector(l):l:null}function te(l){const e=l.key,t=l.type,i=[];return l.altKey&&i.push("Alt"),l.ctrlKey&&i.push("Control"),l.metaKey&&i.push("Meta"),l.shiftKey&&i.push("Shift"),t==="click"||t==="dblclick"?i.push(Xe[l.button]+t):t==="wheel"?i.push(t):Ot.has(e)||i.push(e),i.join("+")}function O(...l){for(let e=1;e<l.length;e++){const t=l[e];if(t!=null)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(l[0][i]=t[i])}return l[0]}function J(l){return Array.isArray(l)}function _e(l){return Object.keys(l).length===0&&l.constructor===Object}function $t(l){return typeof l=="function"}function $(l){return Object.prototype.toString.call(l)==="[object Object]"}function Pt(...l){}function R(l,e,t,i){let s,r;l=Y(l),i?(s=t,r=i):(s="",r=t),e.split(" ").forEach(n=>{l.addEventListener(n,function(o){if(s){if(o.target){let a=o.target;if(a.matches(s)||(a=a.closest(s),a))return r(o)}}else return r(o)})})}function tt(l,e,t,i){let s,r;const n=i||l,o=l[e],a=(...d)=>o.apply(n,d),c=d=>o.apply(n,d),h=(...d)=>{try{return s=n._super,r=n._superApply,n._super=a,n._superApply=c,t.apply(n,d)}finally{n._super=s,n._superApply=r}};l[e]=h}function Rt(l,e){return new Promise((t,i)=>{setTimeout(()=>{try{t(l.apply(this))}catch(s){i(s)}},e)})}async function Ft(l){return new Promise(e=>setTimeout(e,l))}function zt(l,e,t){const i=Y(l);if(v(i.type==="checkbox",`Expected a checkbox: ${i.type}`),t??(t=i.classList.contains("wb-tristate")||i.indeterminate),e===void 0)switch(i.indeterminate?null:i.checked){case!0:e=!1;break;case!1:e=t?null:!0;break;case null:e=!0;break}i.indeterminate=e==null,i.checked=!!e}function ae(l,e,t=void 0){let i;l&&e.indexOf(".")>=0&&([i,e]=e.split("."),l=l[i]);const s=l?l[e]:null;return s??t}function it(l,e){const t=e.indexOf(l);return e[(t+1)%e.length]}function fe(l){if(l instanceof Set)return l;if(typeof l=="string"){const e=new Set;for(const t of l.split(" "))e.add(t.trim());return e}if(Array.isArray(l))return new Set(l);throw new Error("Cannot convert to Set<string>: "+l)}function st(...l){for(const e of l){if(typeof e=="number")return e;if(typeof e=="string"&&e.endsWith("px"))return parseInt(e,10);v(e==null,`Expected a number or string like '123px': ${e}`)}throw new Error(`Expected a string like '123px': ${l}`)}function j(...l){for(const e of l)if(e!=null)return!!e;throw new Error("No default boolean value provided")}function Vt(l){return Object.prototype.toString.call(l).replace(/^\[object (.+)\]$/,"$1").toLowerCase()}function nt(l,e){const t=Object.assign({minDelay:16,defaultDelay:200,maxDelay:5e3,delayFactor:2},e),i=Math.max(16,+t.minDelay),s=+t.maxDelay;let r=0,n=null,o=null;const a=(...c)=>{if(r)n=c,r+=1;else{r=1;const h=c;n=null;const d=Date.now();try{l.apply(this,h)}catch(g){console.error(g)}const p=Date.now()-d,f=Math.min(Math.max(i,p*t.delayFactor),s),u=Math.max(i,f-p);o=setTimeout(()=>{o=null,r=0,n!=null&&a.apply(this,n)},u)}};return a.cancel=()=>{o&&(clearTimeout(o),o=null),n=null,r=0},a.pending=()=>!!o,a.flush=()=>{throw new Error("Not implemented")},a}var rt=Object.freeze({__proto__:null,Deferred:Tt,MAX_INT:Ct,MOUSE_BUTTONS:Xe,ValidationError:we,adaptiveThrottle:nt,assert:v,debounce:ue,documentReady:Qe,documentReadyPromise:Lt,each:At,elemFromHtml:oe,elemFromSelector:Y,error:x,escapeHtml:ie,escapeRegex:G,escapeTooltip:Je,eventToString:te,extend:O,extractHtmlText:Mt,getOption:ae,getValueFromElem:De,isArray:J,isEmptyObject:_e,isFunction:$t,isMac:Se,isPlainObject:$,noop:Pt,onEvent:R,overrideMethod:tt,rotate:it,setElemDisplay:et,setTimeoutPromise:Rt,setValueToElem:Ze,sleep:Ft,throttle:Ge,toBool:j,toPixel:st,toSet:fe,toggleCheckbox:zt,type:Vt});/*!
 * Wunderbaum - types
 * Copyright (c) 2021-2024, Martin Wendt. Released under the MIT license.
 * v0.11.0, Sun, 04 Aug 2024 15:35:53 GMT (https://github.com/mar10/wunderbaum)
 */var m;(function(l){l.any="any",l.data="data",l.colStructure="colStructure",l.resize="resize",l.row="row",l.structure="structure",l.status="status",l.scroll="scroll"})(m||(m={}));var ce;(function(l){l.clearMarkup="clearMarkup",l.header="header",l.redraw="redraw",l.scroll="scroll"})(ce||(ce={}));var L;(function(l){l.ok="ok",l.loading="loading",l.error="error",l.noData="noData",l.paging="paging"})(L||(L={}));var I;(function(l){l.unknown="",l.checkbox="checkbox",l.column="column",l.expander="expander",l.icon="icon",l.prefix="prefix",l.title="title"})(I||(I={}));var D;(function(l){l.startRow="startRow",l.cell="cell",l.startCell="startCell",l.row="row"})(D||(D={}));/*!
 * Wunderbaum - wb_extension_base
 * Copyright (c) 2021-2024, Martin Wendt. Released under the MIT license.
 * v0.11.0, Sun, 04 Aug 2024 15:35:53 GMT (https://github.com/mar10/wunderbaum)
 */class Q{constructor(e,t,i){this.enabled=!0,this.tree=e,this.id=t,this.treeOpts=e.options;const s=e.options;this.treeOpts[t]===void 0?s[t]=this.extensionOpts=O({},i):(this.extensionOpts=O({},i,s[t]),s[t]=this.extensionOpts),this.enabled=this.getPluginOption("enabled",!0)}init(){this.tree.element.classList.add("wb-ext-"+this.id)}getPluginOption(e,t){var i;return(i=this.extensionOpts[e])!==null&&i!==void 0?i:t}setPluginOption(e,t){this.extensionOpts[e]=t}setEnabled(e=!0){return this.setPluginOption("enabled",!!e)}onKeyEvent(e){}onRender(e){}}/*!
 * Wunderbaum - ext-filter
 * Copyright (c) 2021-2024, Martin Wendt. Released under the MIT license.
 * v0.11.0, Sun, 04 Aug 2024 15:35:53 GMT (https://github.com/mar10/wunderbaum)
 */const Te="￷",Ie="￸",Ht=new RegExp(G(Te),"g"),Ut=new RegExp(G(Ie),"g");class Kt extends Q{constructor(e){super(e,"filter",{autoApply:!0,autoExpand:!1,matchBranch:!1,connectInput:null,fuzzy:!1,hideExpanders:!1,highlight:!0,leavesOnly:!1,mode:"dim",noData:!0}),this.lastFilterArgs=null}init(){super.init();const e=this.getPluginOption("connectInput");e&&(this.queryInput=Y(e),v(this.queryInput,`Invalid 'filter.connectInput' option: ${e}.`),R(this.queryInput,"input",ue(t=>{this.filterNodes(this.queryInput.value.trim(),{})},700)))}setPluginOption(e,t){switch(super.setPluginOption(e,t),e){case"mode":this.tree.filterMode=t==="hide"?"hide":"dim",this.tree.updateFilter();break}}_applyFilterNoUpdate(e,t){return this.tree.runWithDeferredUpdate(()=>this._applyFilterImpl(e,t))}_applyFilterImpl(e,t){let i=0;const s=Date.now(),r=this.tree,n=r.options,o=n.autoCollapse,a=O({},n.filter,t),c=a.mode==="hide",h=!!a.matchBranch,d=!!a.leavesOnly&&!h;let p,f;if(typeof e=="string"||e instanceof RegExp){if(e==="")return r.logInfo("Passing an empty string as a filter is handled as clearFilter()."),this.clearFilter(),0;if(a.fuzzy){v(typeof e=="string","fuzzy filter must be a string");const u=e.split("").map(G).reduce(function(g,y){return g+"([^"+y+"]*)"+y},"");p=new RegExp(u,"i")}else if(e instanceof RegExp)p=e,f=e;else{const u=G(e);p=new RegExp(u,"i"),f=new RegExp(u,"gi")}r.logDebug(`Filtering nodes by '${p}'`),e=u=>{if(!u.title)return!1;const g=u.title,y=p.exec(g);if(y&&a.highlight){let b;a.fuzzy?b=qt(g,y,!0):b=g.replace(f,function(z){return Te+z+Ie}),u.titleWithHighlight=ie(b).replace(Ht,"<mark>").replace(Ut,"</mark>")}return!!y}}return r.filterMode=a.mode,this.lastFilterArgs=arguments,r.element.classList.toggle("wb-ext-filter-hide",!!c),r.element.classList.toggle("wb-ext-filter-dim",!c),r.element.classList.toggle("wb-ext-filter-hide-expanders",!!a.hideExpanders),r.root.subMatchCount=0,r.visit(u=>{delete u.match,delete u.titleWithHighlight,u.subMatchCount=0}),r.setStatus(L.ok),n.autoCollapse=!1,r.visit(u=>{if(d&&u.children!=null)return;let g=e(u);if(g==="skip")return u.visit(function(b){b.match=!1},!0),"skip";let y=!1;(h||g==="branch")&&u.parent.match&&(g=!0,y=!0),g&&(i++,u.match=!0,u.visitParents(b=>{b!==u&&(b.subMatchCount+=1),a.autoExpand&&!y&&!b.expanded&&(b.setExpanded(!0,{noAnimation:!0,noEvents:!0}),b._filterAutoExpanded=!0)},!0))}),n.autoCollapse=o,i===0&&a.noData&&c&&(typeof a.noData=="string"?r.root.setStatus(L.noData,{message:a.noData}):r.root.setStatus(L.noData)),r.logDebug(`Filter '${e}' found ${i} nodes in ${Date.now()-s} ms.`),i}filterNodes(e,t){return this._applyFilterNoUpdate(e,t)}filterBranches(e,t){return v(t.matchBranch===void 0,"filterBranches() is deprecated."),t.matchBranch=!0,this._applyFilterNoUpdate(e,t)}countMatches(){let e=0;return this.tree.visit(t=>{t.match&&!t.statusNodeType&&e++}),e}updateFilter(){var e;const t=this.tree;t.filterMode&&this.lastFilterArgs&&(!((e=t.options.filter)===null||e===void 0)&&e.autoApply)?this._applyFilterNoUpdate.apply(this,this.lastFilterArgs):t.logWarn("updateFilter(): no filter active.")}clearFilter(){const e=this.tree;e.enableUpdate(!1),e.setStatus(L.ok),delete e.root.match,delete e.root.subMatchCount,e.visit(t=>{delete t.match,delete t.subMatchCount,delete t.titleWithHighlight,t._filterAutoExpanded&&t.expanded&&t.setExpanded(!1,{noAnimation:!0,noEvents:!0}),delete t._filterAutoExpanded}),e.filterMode=null,this.lastFilterArgs=null,e.element.classList.remove("wb-ext-filter-dim","wb-ext-filter-hide"),e.enableUpdate(!0)}}function qt(l,e,t=!0){const i=[];for(let r=1;r<e.length;r++){const n=e[r].length+(r===1?0:1)+(i[i.length-1]||0);i.push(n)}const s=l.split("");return t?i.forEach(function(r){s[r]=Te+s[r]+Ie}):i.forEach(function(r){s[r]="<mark>"+s[r]+"</mark>"}),s.join("")}/*!
 * Wunderbaum - ext-keynav
 * Copyright (c) 2021-2024, Martin Wendt. Released under the MIT license.
 * v0.11.0, Sun, 04 Aug 2024 15:35:53 GMT (https://github.com/mar10/wunderbaum)
 */const Wt=500;class jt extends Q{constructor(e){super(e,"keynav",{})}_getEmbeddedInputElem(e){var t;let i=null;if(e&&e.type!=null)i=e;else{const s=(t=this.tree.getActiveColElem())===null||t===void 0?void 0:t.querySelector("input,select");s&&(i=s)}return i}_isCurInputFocused(){var e;return!!((e=this.tree.getActiveColElem())===null||e===void 0?void 0:e.querySelector("input:focus,select:focus"))}onKeyEvent(e){const t=e.event,i=this.tree,s=e.options,r=!t.ctrlKey||s.autoActivate,n=this._getEmbeddedInputElem(t.target),o=n&&this._isCurInputFocused(),a=s.navigationModeOption;let c,h=te(t),d=e.node,p=!0;if(!i.isEnabled()||i._callEvent("keydown",e)===!1||i._callMethod("edit._preprocessKeyEvent",e)===!1)return!1;if(!d){const u=i.getFocusNode()||i.getActiveNode(),g=i.getFirstChild();if(!u&&g&&h==="ArrowDown"){g.logInfo("Keydown: activate first node."),g.setActive();return}c=u||g,c&&(c.setFocus(),d=i.getFocusNode(),d.logInfo("Keydown: force focus on active node."))}const f=d.isColspan();if(i.isRowNav()){if(o){switch(h){case"Enter":n.blur(),i.setFocus();break;case"Escape":d._render(),i.setFocus();break}return}if(s.quicksearch&&h.length===1&&/^\w$/.test(h)&&!n){const u=Date.now();u-i.lastQuicksearchTime>Wt&&(i.lastQuicksearchTerm=""),i.lastQuicksearchTime=u,i.lastQuicksearchTerm+=h;const g=i.findNextNode(i.lastQuicksearchTerm,i.getActiveNode());g&&g.setActive(!0,{event:t}),t.preventDefault();return}switch(h){case"Enter":d.isActive()&&(d.isExpanded()?h="Subtract":d.isExpandable(!0)&&(h="Add"));break;case"ArrowLeft":d.expanded&&(h="Subtract");break;case"ArrowRight":if(!d.expanded&&d.isExpandable(!0))h="Add";else if(a===D.startCell||a===D.startRow)return t.preventDefault(),i.setCellNav(),!1;break}switch(h){case"+":case"Add":d.setExpanded(!0);break;case"-":case"Subtract":d.setExpanded(!1);break;case" ":d.getOption("checkbox")?d.toggleSelected():d.setActive(!0,{event:t});break;case"Enter":d.setActive(!0,{event:t});break;case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"Backspace":case"End":case"Home":case"Control+End":case"Control+Home":case"Meta+ArrowDown":case"Meta+ArrowUp":case"PageDown":case"PageUp":d.navigate(h,{activate:r,event:t});break;default:p=!1}}else{const u=n?n.type||n.tagName:"",g=n&&u!=="checkbox";if(o){if(h==="Escape"){d.logDebug("Reset focused input on Escape"),n.setCustomValidity(""),d._render(),i.setFocus(),i.setColumn(i.activeColIdx);return}else if(h!=="Enter"){if(n&&n.checkValidity&&!n.checkValidity())return d.logDebug(`Ignored ${h} inside invalid input`),!1;d.logDebug(`Ignored ${h} inside focused input`);return}}else if(n&&h.length===1&&g)return n.focus(),n.value="",d.logDebug(`Focus input: ${h}`),!1;switch(h==="Tab"?(h="ArrowRight",p=!0):h==="Shift+Tab"&&(h=i.activeColIdx>0?"ArrowLeft":"",p=!0),h){case"+":case"Add":d.setExpanded(!0);break;case"-":case"Subtract":d.setExpanded(!1);break;case" ":i.activeColIdx===0&&d.getOption("checkbox")?(d.toggleSelected(),p=!0):n&&u==="checkbox"&&(n.click(),p=!0);break;case"F2":n&&!o&&g&&(n.focus(),p=!0);break;case"Enter":i.setFocus(),(i.activeColIdx===0||f)&&d.isExpandable()?(d.setExpanded(!d.isExpanded()),p=!0):n&&!o&&g&&(n.focus(),p=!0);break;case"Escape":i.setFocus(),d.log("keynav: focus tree..."),i.isCellNav()&&a!==D.cell&&(d.log("keynav: setCellNav(false)"),i.setCellNav(!1),i.setFocus(),p=!0);break;case"ArrowLeft":i.setFocus(),f&&d.isExpanded()?d.setExpanded(!1):!f&&i.activeColIdx>0?i.setColumn(i.activeColIdx-1):a!==D.cell&&i.setCellNav(!1),p=!0;break;case"ArrowRight":i.setFocus(),f&&!d.isExpanded()?d.setExpanded():!f&&i.activeColIdx<i.columns.length-1&&i.setColumn(i.activeColIdx+1),p=!0;break;case"Home":i.setFocus(),!f&&i.activeColIdx>0&&i.setColumn(0),p=!0;break;case"End":i.setFocus(),!f&&i.activeColIdx<i.columns.length-1&&i.setColumn(i.columns.length-1),p=!0;break;case"ArrowDown":case"ArrowUp":case"Backspace":case"Control+End":case"Control+Home":case"Meta+ArrowDown":case"Meta+ArrowUp":case"PageDown":case"PageUp":d.navigate(h,{activate:r,event:t}),p=!0;break;default:p=!1}}p&&t.preventDefault()}}/*!
 * Wunderbaum - ext-logger
 * Copyright (c) 2021-2024, Martin Wendt. Released under the MIT license.
 * v0.11.0, Sun, 04 Aug 2024 15:35:53 GMT (https://github.com/mar10/wunderbaum)
 */class Bt extends Q{constructor(e){super(e,"logger",{}),this.ignoreEvents=new Set(["iconBadge","render","discard"]),this.prefix=e+".ext-logger"}init(){const e=this.tree;if(e.getOption("debugLevel")>=4){const t=this.ignoreEvents,i=this.prefix;tt(e,"callEvent",function(s,r){if(t.has(s))return e._superApply(arguments);const n=Date.now(),o=e._superApply(arguments);return e.logDebug(`${i}: callEvent('${s}') took ${Date.now()-n} ms.`,arguments[1]),o})}}onKeyEvent(e){this.tree.logDebug(`${this.prefix}: onKeyEvent()`,e)}}/*!
 * Wunderbaum - common
 * Copyright (c) 2021-2024, Martin Wendt. Released under the MIT license.
 * v0.11.0, Sun, 04 Aug 2024 15:35:53 GMT (https://github.com/mar10/wunderbaum)
 */const Gt=3,C=22,re=20,$e=7,Xt=5,Yt=4,Pe=new RegExp(/\.|\//),Qt={bootstrap:{error:"bi bi-exclamation-triangle",loading:"bi bi-chevron-right wb-busy",noData:"bi bi-question-circle",expanderExpanded:"bi bi-chevron-down",expanderCollapsed:"bi bi-chevron-right",expanderLazy:"bi bi-chevron-right wb-helper-lazy-expander",checkChecked:"bi bi-check-square",checkUnchecked:"bi bi-square",checkUnknown:"bi bi-dash-square-dotted",radioChecked:"bi bi-circle-fill",radioUnchecked:"bi bi-circle",radioUnknown:"bi bi-record-circle",folder:"bi bi-folder2",folderOpen:"bi bi-folder2-open",folderLazy:"bi bi-folder-symlink",doc:"bi bi-file-earmark",colSortable:"bi bi-chevron-expand",colSortAsc:"bi bi-arrow-down",colSortDesc:"bi bi-arrow-up",colFilter:"bi bi-filter-circle",colFilterActive:"bi bi-filter-circle-fill wb-helper-invalid",colMenu:"bi bi-three-dots-vertical"},fontawesome6:{error:"fa-solid fa-triangle-exclamation",loading:"fa-solid fa-chevron-right fa-beat",noData:"fa-solid fa-circle-question",expanderExpanded:"fa-solid fa-chevron-down",expanderCollapsed:"fa-solid fa-chevron-right",expanderLazy:"fa-solid fa-chevron-right wb-helper-lazy-expander",checkChecked:"fa-regular fa-square-check",checkUnchecked:"fa-regular fa-square",checkUnknown:"fa-regular fa-square-minus",radioChecked:"fa-solid fa-circle",radioUnchecked:"fa-regular fa-circle",radioUnknown:"fa-regular fa-circle-question",folder:"fa-solid fa-folder-closed",folderOpen:"fa-regular fa-folder-open",folderLazy:"fa-solid fa-folder-plus",doc:"fa-regular fa-file",colSortable:"fa-solid fa-fw fa-sort",colSortAsc:"fa-solid fa-fw fa-sort-up",colSortDesc:"fa-solid fa-fw fa-sort-down",colFilter:"fa-solid fa-fw fa-filter",colFilterActive:"fa-solid fa-fw fa-filter wb-helper-invalid",colMenu:"fa-solid fa-fw fa-ellipsis-v"}},Jt=new Set(["_format","_keyMap","_positional","_typeList","_valueMap","_version","children","columns","types"]),Zt={" ":"toggleSelect","+":"expand",Add:"expand",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",Backspace:"parent","/":"collapseAll",Divide:"collapseAll",End:"lastCol",Home:"firstCol","Control+End":"last","Control+Home":"first","Meta+ArrowDown":"last","Meta+ArrowUp":"first","*":"expandAll",Multiply:"expandAll",PageDown:"pageDown",PageUp:"pageUp","-":"collapse",Subtract:"collapse"};function Re(l){return l instanceof RegExp?function(e){return l.test(e.title)}:(v(typeof l=="string",`Expected a string or RegExp: ${l}`),function(e){return e.title===l})}function ei(l){l=G(l);const e=new RegExp("^"+l,"i");return function(t){return e.test(t.title)}}function Ee(l,e){const t=l.title.toLowerCase(),i=e.title.toLowerCase();return t===i?0:t>i?1:-1}function ti(l){var e,t,i;const{_format:s,_keyMap:r={},_positional:n=[],children:o}=l;if(s!=="flat")throw new Error(`Expected source._format: "flat", but got ${s}`);if(n&&n.includes("children"))throw new Error(`source._positional must not include "children": ${n}`);let a=r;if(r.t){console.warn("source._keyMap maps from long to short since v0.7.0. Flip key/value!"),a={};for(const[y,b]of Object.entries(r))a[b]=y}const c=n.map(g=>a[g]),h=[],d={},p={},f=(e=a.key)!==null&&e!==void 0?e:"key",u=(t=a.children)!==null&&t!==void 0?t:"children";for(const[g,y]of o.entries()){const[b,z,N={}]=y;y[1]=null,y[2]!=null&&(y[2]=null),z.forEach((pe,ge)=>{N[c[ge]]=pe}),p[g]=N;const k=N[f];k!=null&&(d[k]=N);let _=null;if(b!==null){if(typeof b=="number"){if(_=p[b],_===void 0)throw new Error(`unflattenSource: Could not find parent node by index: ${b}.`)}else if(_=d[b],_===void 0)throw new Error(`unflattenSource: Could not find parent node by key: ${b}`)}_?((i=_[u])!==null&&i!==void 0||(_[u]=[]),_[u].push(N)):h.push(N)}l.children=h}function ii(l){let{_format:e,_version:t=1,_keyMap:i,_valueMap:s}=l;v(t===1,`Expected file version 1 instead of ${t}`);let r=i,n={};if(r)for(const[a,c]of Object.entries(r))n[c]=a;if(r&&r.t&&(console.warn("source._keyMap maps from long to short since v0.7.0. Flip key/value!"),[r,n]=[n,r]),l._typeList!=null){const a='source._typeList is deprecated since v0.7.0: use source._valueMap: {"type": [...]} instead.';if(s!=null)throw new Error(a);console.warn(a),s={type:l._typeList},delete l._typeList}e==="flat"&&ti(l),delete l._format,delete l._version,delete l._keyMap,delete l._valueMap,delete l._positional;function o(a){for(const c of a)Object.getOwnPropertyNames(c).forEach(h=>{const d=c[h];let p=h;if(i&&n[h]!=null&&(p=n[h],p!==h&&(c[p]=d,delete c[h])),s&&typeof d=="number"&&s[p]!=null){const f=s[p][d];if(f==null)throw new Error(`Expected valueMap[${p}][${d}] entry in [${s[p]}]`);c[p]=f}}),c.children&&o(c.children)}(i||s)&&o(l.children)}/*!
 * Wunderbaum - ext-dnd
 * Copyright (c) 2021-2024, Martin Wendt. Released under the MIT license.
 * v0.11.0, Sun, 04 Aug 2024 15:35:53 GMT (https://github.com/mar10/wunderbaum)
 */const ve="application/x-wunderbaum-node";class si extends Q{constructor(e){super(e,"dnd",{autoExpandMS:1500,multiSource:!1,effectAllowed:"all",dropEffectDefault:"move",guessDropEffect:!0,preventForeignNodes:!1,preventLazyParents:!0,preventNonNodes:!1,preventRecursion:!0,preventSameParent:!1,preventVoidMoves:!0,serializeClipboardData:!0,scroll:!0,scrollSensitivity:20,scrollSpeed:5,sourceCopyHook:null,dragStart:null,drag:null,dragEnd:null,dragEnter:null,dragOver:null,dragExpand:null,drop:null,dragLeave:null}),this.srcNode=null,this.lastTargetNode=null,this.lastEnterStamp=0,this.lastAllowedDropRegions=null,this.lastDropEffect=null,this.lastDropRegion=!1,this.currentScrollDir=0,this.applyScrollDirThrottled=Ge(this._applyScrollDir,50)}init(){super.init();const e=this.tree,t=e.options.dnd;t.dragStart&&R(e.element,"dragstart drag dragend",this.onDragEvent.bind(this)),t.dragEnter&&R(e.element,"dragenter dragover dragleave drop",this.onDropEvent.bind(this))}_leaveNode(){const e=this.lastTargetNode;this.lastEnterStamp=0,e&&(e.setClass("wb-drop-target wb-drop-over wb-drop-after wb-drop-before",!1),this.lastTargetNode=null)}unifyDragover(e){if(e===!1)return!1;if(e instanceof Set)return e.size>0?e:!1;if(e===!0)return new Set(["over","before","after"]);if(typeof e=="string"||J(e))return e=fe(e),e.size>0?e:!1;throw new Error("Unsupported drop region definition: "+e)}_calcDropRegion(e,t){const i=e.offsetY;return t?t.size===3?i<.25*C?"before":i>.75*C?"after":"over":t.size===1&&t.has("over")?"over":i>C/2?"after":"before":!1}_guessDropEffect(e){var t;const i=this.treeOpts.dnd,s=(t=i.effectAllowed)!==null&&t!==void 0?t:"all",r=["all","copy","copyLink","copyMove"].includes(s),n=["all","link","copyLink","linkMove"].includes(s),o=["all","move","copyMove","linkMove"].includes(s);let a=i.dropEffectDefault;return i.guessDropEffect&&(Se?(e.altKey&&r&&(a="copy"),e.metaKey&&o&&(a="move"),e.altKey&&e.metaKey&&n&&(a="link")):(e.ctrlKey&&r&&(a="copy"),e.shiftKey&&o&&(a="move"),e.altKey&&n&&(a="link"))),a}_isVoidDrop(e,t,i){return!this.treeOpts.dnd.preventVoidMoves||!t?!1:i==="before"&&e===t.getNextSibling()||i==="after"&&e===t.getPrevSibling()?!0:t===e||t.parent===e}_applyScrollDir(){if(this.isDragging()&&this.currentScrollDir){const e=this.tree.options.dnd,t=this.tree.element,i=t.scrollTop;this.currentScrollDir<0?t.scrollTop=Math.max(0,i-e.scrollSpeed):this.currentScrollDir>0&&(t.scrollTop=i+e.scrollSpeed)}}_autoScroll(e){const t=this.tree,s=t.options.dnd.scrollSensitivity,r=t.element,n=t.headerElement.clientHeight,o=r.offsetHeight,a=r.scrollTop;return this.currentScrollDir=0,a>0&&e>0&&e<=s+n?this.currentScrollDir=-1:a<r.scrollHeight-o&&e>=o-s&&(this.currentScrollDir=1),this.currentScrollDir&&this.applyScrollDirThrottled(),r.scrollTop-a}isDragging(){return!!this.srcNode}onDragEvent(e){var t;const i=this.treeOpts.dnd,s=E.getNode(e);if(!s){this.tree.logWarn(`onDragEvent.${e.type}: no node`);return}if(["dragstart","dragend"].includes(e.type)&&this.tree.logDebug(`onDragEvent.${e.type} srcNode: ${s}`,e),e.type==="dragstart"){if(e.dataTransfer.effectAllowed=i.effectAllowed,s.isEditingTitle())return s.logDebug("Prevented dragging node in edit mode."),e.preventDefault(),!1;if(!s._callEvent("dnd.dragStart",{event:e}))return e.preventDefault(),!1;const n=s.toDict(!0,o=>{o._orgKey=o.key,delete o.key});n._treeId=s.tree.id,i.serializeClipboardData&&(typeof i.serializeClipboardData=="function"?e.dataTransfer.setData(ve,i.serializeClipboardData(n,s)):e.dataTransfer.setData(ve,JSON.stringify(n))),!((t=e.dataTransfer)===null||t===void 0)&&t.types.includes("text/plain")||e.dataTransfer.setData("text/plain",s.title),this.srcNode=s,setTimeout(()=>{s.setClass("wb-drag-source")},0)}else e.type==="drag"?i.drag&&s._callEvent("dnd.drag",{event:e}):e.type==="dragend"&&(s.setClass("wb-drag-source",!1),this.srcNode=null,this.lastTargetNode&&this._leaveNode(),s._callEvent("dnd.dragEnd",{event:e}));return!0}onDropEvent(e){var t;const i=this.srcNode,s=i?i.tree:null,r=E.getNode(e),n=this.treeOpts.dnd,o=e.dataTransfer,a=this._calcDropRegion(e,this.lastAllowedDropRegions),c=(h,d)=>(h&&this.tree.log(`Prevented drop operation (${d}).`),h);if(!r){this._leaveNode();return}if(["drop"].includes(e.type)&&this.tree.logDebug(`onDropEvent.${e.type} targetNode: ${r}, ea: ${o==null?void 0:o.effectAllowed}, de: ${o==null?void 0:o.dropEffect}, cy: ${e.offsetY}, r: ${a}, srcNode: ${i}`,e),e.type==="dragenter"){if(this.lastAllowedDropRegions=null,this.lastTargetNode&&this.lastTargetNode!==r&&this._leaveNode(),this.lastTargetNode=r,this.lastEnterStamp=Date.now(),c(r.isStatusNode(),"is status node")||c(n.preventForeignNodes&&r.tree!==s,"preventForeignNodes")||c(n.preventLazyParents&&!r.isLoaded(),"preventLazyParents")||c(n.preventNonNodes&&!i,"preventNonNodes")||c(n.preventRecursion&&(i==null?void 0:i.isAncestorOf(r)),"preventRecursion")||c(n.preventSameParent&&i&&r.parent===i.parent,"preventSameParent")||c(n.preventVoidMoves&&r===i,"preventVoidMoves"))return o.dropEffect="none",!0;o.dropEffect=this._guessDropEffect(e)||"none";let h=r._callEvent("dnd.dragEnter",{event:e,sourceNode:i});return h=this.unifyDragover(h),h?(this.lastAllowedDropRegions=h,this.lastDropEffect=o.dropEffect,r.setClass("wb-drop-target"),e.preventDefault(),!1):(o.dropEffect="none",!0)}else if(e.type==="dragover"){const h=e.clientY-this.tree.element.offsetTop;this._autoScroll(h),o.dropEffect=this._guessDropEffect(e)||"none",r._callEvent("dnd.dragOver",{event:e,sourceNode:i});const d=this._calcDropRegion(e,this.lastAllowedDropRegions);return this.lastDropRegion=d,this.lastDropEffect=o.dropEffect,n.autoExpandMS>0&&r.isExpandable(!0)&&!r._isLoading&&Date.now()-this.lastEnterStamp>n.autoExpandMS&&r._callEvent("dnd.dragExpand",{event:e,sourceNode:i})!==!1&&r.setExpanded(),!d||this._isVoidDrop(r,i,d)?void 0:(r.setClass("wb-drop-over",d==="over"),r.setClass("wb-drop-before",d==="before"),r.setClass("wb-drop-after",d==="after"),e.preventDefault(),!1)}else if(e.type==="dragleave")r._callEvent("dnd.dragLeave",{event:e,sourceNode:i});else if(e.type==="drop"){e.stopPropagation(),e.preventDefault(),this._leaveNode();const h=this.lastDropRegion;let d=(t=e.dataTransfer)===null||t===void 0?void 0:t.getData(ve);d=d?JSON.parse(d):null;const p=this.srcNode,f=this.lastDropEffect;setTimeout(()=>{r._callEvent("dnd.drop",{event:e,region:h,suggestedDropMode:h==="over"?"appendChild":h,suggestedDropEffect:f,sourceNode:p,sourceNodeData:d})},10)}return!1}}/*!
 * Wunderbaum - drag_observer
 * Copyright (c) 2021-2024, Martin Wendt. Released under the MIT license.
 * v0.11.0, Sun, 04 Aug 2024 15:35:53 GMT (https://github.com/mar10/wunderbaum)
 */class ni{constructor(e){if(this.start={event:null,x:0,y:0,altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1},this.dragElem=null,this.dragging=!1,this.customData={},this.events=["mousedown","mouseup","mousemove","keydown"],!e.root)throw new Error("Missing `root` option.");this.opts=Object.assign({thresh:5},e),this.root=e.root,this._handler=this.handleEvent.bind(this),this.events.forEach(t=>{this.root.addEventListener(t,this._handler)})}disconnect(){this.events.forEach(e=>{this.root.removeEventListener(e,this._handler)})}getDragElem(){return this.dragElem}isDragging(){return this.dragging}stopDrag(e){if(this.dragging&&this.opts.dragstop&&e){e.type="dragstop";try{this.opts.dragstop(e)}catch(t){console.error("dragstop error",t)}}this.dragElem=null,this.dragging=!1,this.start.event=null,this.customData={}}handleEvent(e){const t=e.type,i=this.opts,s={type:e.type,startEvent:t==="mousedown"?e:this.start.event,event:e,customData:this.customData,dragElem:this.dragElem,dx:e.pageX-this.start.x,dy:e.pageY-this.start.y,apply:void 0};switch(t){case"keydown":this.stopDrag(s);break;case"mousedown":if(this.dragElem){this.stopDrag(s);break}if(i.selector){let r=e.target;if(r.matches(i.selector))this.dragElem=r;else if(r=r.closest(i.selector),r)this.dragElem=r;else break}this.start.event=e,this.start.x=e.pageX,this.start.y=e.pageY,this.start.altKey=e.altKey,this.start.ctrlKey=e.ctrlKey,this.start.metaKey=e.metaKey,this.start.shiftKey=e.shiftKey;break;case"mousemove":if(!this.dragElem)break;if(!this.dragging){if(i.thresh&&s.dx*s.dx+s.dy*s.dy<i.thresh*i.thresh)break;if(s.type="dragstart",i.dragstart(s)===!1){this.stopDrag(s);break}this.dragging=!0}this.dragging&&this.opts.drag&&(s.type="drag",this.opts.drag(s));break;case"mouseup":if(!this.dragging){this.stopDrag(s);break}e.button===0?s.apply=!0:s.apply=!1,this.stopDrag(s);break}}}/*!
 * Wunderbaum - ext-grid
 * Copyright (c) 2021-2024, Martin Wendt. Released under the MIT license.
 * v0.11.0, Sun, 04 Aug 2024 15:35:53 GMT (https://github.com/mar10/wunderbaum)
 */class ri extends Q{constructor(e){super(e,"grid",{}),this.observer=new ni({root:window.document,selector:"span.wb-col-resizer-active",thresh:4,dragstart:t=>{const i=E.getEventInfo(t.startEvent),s=i.colDef,r=s&&this.tree.element.contains(t.dragElem)&&j(s.resizable,e.options.columnsResizable,!1);if(this.tree.element.classList.toggle("wb-col-resizing",!!r),i.colElem.classList.toggle("wb-col-resizing",!!r),r){t.customData.colDef=s,t.customData.orgCustomWidthPx=s.customWidthPx;const n=Number.parseInt(i.colElem.style.width,10);t.customData.orgWidthPx=n,s.customWidthPx=n,this.tree.update(m.colStructure)}return r},drag:t=>this.handleDrag(t),dragstop:t=>this.handleDrag(t)})}init(){super.init()}handleDrag(e){const t=e.customData,i=t.colDef;if(e.type==="dragstop"||e.type==="drag"){if(this.tree.element.classList.remove("wb-col-resizing"),e.apply||e.type==="drag"){const s=st(i.minWidth,Yt),r=Math.max(s,t.orgWidthPx+e.dx);i.customWidthPx=r}else this.tree.log("Column resize cancelled",e),i.customWidthPx=t.orgCustomWidthPx;this.tree.update(m.colStructure)}}}/*!
 * Wunderbaum - deferred
 * Copyright (c) 2021-2024, Martin Wendt. Released under the MIT license.
 * v0.11.0, Sun, 04 Aug 2024 15:35:53 GMT (https://github.com/mar10/wunderbaum)
 */class lt{constructor(){this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}resolve(e){this._resolve(e)}reject(e){this._reject(e)}promise(){return this._promise}then(e){return this._promise.then(e)}catch(e){return this._promise.catch(e)}finally(e){return this._promise.finally(e)}}/*!
 * Wunderbaum - wunderbaum_node
 * Copyright (c) 2021-2024, Martin Wendt. Released under the MIT license.
 * v0.11.0, Sun, 04 Aug 2024 15:35:53 GMT (https://github.com/mar10/wunderbaum)
 */const ot=new Set(["checkbox","classes","expanded","icon","iconTooltip","key","lazy","_partsel","radiogroup","refKey","selected","statusNodeType","title","tooltip","type","unselectable"]),de=new Set(ot);de.delete("_partsel");de.delete("unselectable");class F{constructor(e,t,i){var s,r;this.refKey=void 0,this.children=null,this.classes=null,this.data={},this._isLoading=!1,this._requestId=0,this._errorInfo=null,this._partsel=!1,this._partload=!1,this.subMatchCount=0,this._rowIdx=0,this._rowElem=void 0,v(!t||t.tree===e,`Invalid parent: ${t}`),v(!i.children,"'children' not allowed here"),this.tree=e,this.parent=t,this.key=""+((s=i.key)!==null&&s!==void 0?s:++F.sequence),this.title=""+((r=i.title)!==null&&r!==void 0?r:"<"+this.key+">"),i.refKey!=null&&(this.refKey=""+i.refKey),i.type!=null&&(this.type=""+i.type),this.expanded=i.expanded===!0,i.icon!=null&&(this.icon=i.icon),this.lazy=i.lazy===!0,i.statusNodeType!=null&&(this.statusNodeType=""+i.statusNodeType),i.colspan!=null&&(this.colspan=!!i.colspan),i.checkbox!=null&&(this.checkbox=!!i.checkbox),i.radiogroup!=null&&(this.radiogroup=!!i.radiogroup),this.selected=i.selected===!0,i.unselectable===!0&&(this.unselectable=!0),i.classes&&this.setClass(i.classes);for(const[n,o]of Object.entries(i))ot.has(n)||(this.data[n]=o);t&&!this.statusNodeType&&e._registerNode(this)}toString(){return`WunderbaumNode@${this.key}<'${this.title}'>`}*[Symbol.iterator](){const e=this.children;if(e)for(let t=0,i=e.length;t<i;t++){const s=e[t];yield s,s.children&&(yield*s)}}_callEvent(e,t){var i;return(i=this.tree)===null||i===void 0?void 0:i._callEvent(e,O({node:this,typeInfo:this.type?this.tree.types[this.type]:{}},t))}addChildren(e,t){const i=this.tree;let{before:s=null,applyMinExpanLevel:r=!0,_level:n}=t??{};n??(n=this.getLevel());const o=[];try{i.enableUpdate(!1),$(e)&&(e=[e]);const a=r&&n<i.options.minExpandLevel;for(const c of e){const h=c.children;delete c.children;const d=new F(i,this,c);a&&!d.isUnloaded()&&(d.expanded=!0),o.push(d),h&&d.addChildren(h,{_level:n+1})}if(!this.children)this.children=o;else if(s==null||this.children.length===0)this.children=this.children.concat(o);else{s=this.findDirectChild(s);const c=this.children.indexOf(s);v(c>=0,`options.before must be a direct child of ${this}`),this.children.splice(c,0,...o)}i.update(m.structure)}finally{i.enableUpdate(!0)}return o[0]}addNode(e,t="appendChild"){switch(t==="over"&&(t="appendChild"),t){case"after":return this.parent.addChildren(e,{before:this.getNextSibling()});case"before":return this.parent.addChildren(e,{before:this});case"prependChild":return this.addChildren(e,{before:0});case"appendChild":return this.addChildren(e)}v(!1,`Invalid mode: ${t}`)}applyCommand(e,t){return this.tree.applyCommand(e,this,t)}collapseSiblings(e){for(const t of this.parent.children)t!==this&&t.expanded&&t.setExpanded(!1,e)}setClass(e,t=!0){const i=fe(e);if(t)this.classes===null&&(this.classes=new Set),i.forEach(s=>{var r;this.classes.add(s),(r=this._rowElem)===null||r===void 0||r.classList.toggle(s,t)});else{if(this.classes===null)return;i.forEach(s=>{var r;this.classes.delete(s),(r=this._rowElem)===null||r===void 0||r.classList.toggle(s,t)}),this.classes.size===0&&(this.classes=null)}}startEditTitle(){this.tree._callMethod("edit.startEditTitle",this)}async expandAll(e=!0,t){const i=this.tree,s=this.tree.options.minExpandLevel,{depth:r=99,loadLazy:n,force:o,keepActiveNodeVisible:a=!0}=t??{},c={scrollIntoView:!1,force:o,loadLazy:n};async function h(p,f){var u;if(f===0)return;const g=f==null?null:f-1,y=[];return(u=p.children)===null||u===void 0||u.forEach(b=>{if(e)if(!b.expanded&&(b.children||n&&b.lazy)){const z=b.setExpanded(!0,c);y.push(z),z.then(async()=>{await h(b,g)})}else y.push(h(b,g));else(!s||o||b.getLevel()>s)&&b.setExpanded(!1,c),h(b,g)}),new Promise(b=>{Promise.all(y).then(()=>{b(!0)})})}const d=i.logTime(`${this}.expandAll(${e})`);try{i.enableUpdate(!1),await h(this,r)}finally{i.enableUpdate(!0),i.logTimeEnd(d)}i.activeNode&&a&&i.activeNode.scrollIntoView()}findAll(e){const t=typeof e=="function"?e:Re(e),i=[];return this.visit(s=>{t(s)&&i.push(s)}),i}findDirectChild(e){const t=this.children;if(!t)return null;if(typeof e=="string"){for(let i=0,s=t.length;i<s;i++)if(t[i].key===e)return t[i]}else{if(typeof e=="number")return t[e];if(e.parent===this)return e}return null}findFirst(e){const t=typeof e=="function"?e:Re(e);let i=null;return this.visit(s=>{if(t(s))return i=s,!1}),i}findRelatedNode(e,t=!1){return this.tree.findRelatedNode(this,e,t)}*format_iter(e,t){t??(t=["    "," |  "," ╰─ "," ├─ "]),e??(e=r=>""+r);function i(r){const n=r.parent.children;return r===n[n.length-1]}const s=r=>{const n=[e(r)];n.unshift(t[i(r)?2:3]);let o=r.parent;for(;o&&o!==this;)n.unshift(t[i(o)?0:1]),o=o.parent;return n.join("")};yield e(this);for(const r of this)yield s(r)}format(e,t){const i=[];for(const s of this.format_iter(e,t))i.push(s);return i.join(`
`)}getColElem(e){var t;typeof e=="string"&&(e=this.tree.columns.findIndex(s=>s.id===e));const i=(t=this._rowElem)===null||t===void 0?void 0:t.querySelectorAll("span.wb-col");return i?i[e]:null}getCloneList(e=!1){if(!this.refKey)return[];const t=this.tree.findByRefKey(this.refKey);return e?t:[...t].filter(i=>i!==this)}getFirstChild(){return this.children?this.children[0]:null}getLastChild(){return this.children?this.children[this.children.length-1]:null}getLevel(){let e=0,t=this.parent;for(;t;)e++,t=t.parent;return e}getNextSibling(){const e=this.parent.children,t=e.indexOf(this);return e[t+1]||null}getParent(){return this.parent}getParentList(e=!1,t=!1){const i=[];let s=t?this:this.parent;for(;s;)(e||s.parent)&&i.unshift(s),s=s.parent;return i}getPath(e=!0,t="title",i="/"){let s;const r=[],n=typeof t=="function";return this.visitParents(o=>{o.parent&&(s=n?t(o):o[t],r.unshift(s))},e),r.join(i)}getPrevSibling(){const e=this.parent.children,t=e.indexOf(this);return e[t-1]||null}hasChildren(){return this.lazy?this.children==null?void 0:this.children.length===0?!1:this.children.length===1&&this.children[0].isStatusNode()?void 0:!0:!!(this.children&&this.children.length)}hasClass(e){return this.classes?this.classes.has(e):!1}hasFocus(){return this.tree.focusNode===this}isActive(){return this.tree.activeNode===this}isAncestorOf(e){return e&&e.isDescendantOf(this)}isChildOf(e){return e&&this.parent===e}isClone(){return!!this.refKey&&this.tree.findByRefKey(this.refKey).length>1}isColspan(){return!!this.getOption("colspan")}isDescendantOf(e){if(!e||e.tree!==this.tree)return!1;let t=this.parent;for(;t;){if(t===e)return!0;t===t.parent&&x(`Recursive parent link: ${t}`),t=t.parent}return!1}isExpandable(e=!1){return e&&this.expanded||this.children===!1?!1:this.children==null?!!this.lazy:this.children.length===0?!!this.tree.options.emptyChildListExpandable:!0}isEditingTitle(){return this.tree._callMethod("edit.isEditingTitle",this)}isExpanded(){return!!this.expanded}isFirstSibling(){const e=this.parent;return!e||e.children[0]===this}isLastSibling(){const e=this.parent;return!e||e.children[e.children.length-1]===this}isLazy(){return!!this.lazy}isLoaded(){return!this.lazy||this.hasChildren()!==void 0}isLoading(){return this._isLoading}isPagingNode(){return this.statusNodeType==="paging"}isParentOf(e){return e&&e.parent===this}isPartload(){return!!this._partload}isPartsel(){return!this.selected&&!!this._partsel}isRadio(){return!!this.parent.radiogroup||this.getOption("checkbox")==="radio"}isRendered(){return!!this._rowElem}isRootNode(){return this.tree.root===this}isSelected(){return this.selected?!0:this._partsel?void 0:!1}isStatusNode(){return!!this.statusNodeType}isTopLevel(){return this.tree.root===this.parent}isUnloaded(){return this.hasChildren()===void 0}isVisible(){const e=this.tree.filterMode==="hide",t=this.getParentList(!1,!1);if(e&&!this.match&&!this.subMatchCount)return!1;for(let i=0,s=t.length;i<s;i++)if(!t[i].expanded)return!1;return!0}_loadSourceObject(e,t){var i;const s=this.tree;t??(t=this.getLevel());const r=this._callEvent("receive",{response:e});r!=null&&(e=r),J(e)&&(e={children:e}),v($(e),`Expected an array or plain object: ${e}`);const n=(i=e.format)!==null&&i!==void 0?i:"nested";v(n==="nested"||n==="flat",`Expected source.format = 'nested' or 'flat': ${n}`),ii(e),v(e.children,"If `source` is an object, it must have a `children` property"),e.types&&(s.logInfo("Redefine types",e.columns),s.setTypes(e.types,!1),delete e.types),e.columns&&(s.logInfo("Redefine columns",e.columns),s.columns=e.columns,delete e.columns,s.update(m.colStructure)),this.addChildren(e.children);for(const[o,a]of Object.entries(e))Jt.has(o)||(s.data[o]=a);s.options.selectMode==="hier"&&this.fixSelection3FromEndNodes(),this.resetNativeChildOrder(),this._callEvent("load")}async _fetchWithOptions(e){var t,i;let s,r,n,o,a,c={};typeof e=="string"?(s=e,c.method="GET"):$(e)?({url:s,params:r,body:n,options:o,...a}=e,v(!a||Object.keys(a).length===0,`Unexpected source properties: ${Object.keys(a)}. Use 'options' instead.`),v(typeof s=="string","expected source.url as string"),$(o)&&(c=o),$(n)&&(v(!c.body,"options.body should be passed as source.body"),c.body=JSON.stringify(c.body),(t=c.method)!==null&&t!==void 0||(c.method="POST")),$(r)&&(s+="?"+new URLSearchParams(r),(i=c.method)!==null&&i!==void 0||(c.method="GET"))):(s="",x(`Unsupported source format: ${e}`)),this.setStatus(L.loading);const h=await fetch(s,c);return h.ok||x(`GET ${s} returned ${h.status}, ${h}`),await h.json()}async load(e){const t=this.tree,i=Date.now(),s=this.parent,r=Date.now();let n=0,o=0,a=0;this._requestId&&this.logWarn(`Recursive load request #${i} while #${this._requestId} is pending.`),this._requestId=i;try{if(typeof e=="string"?e:e.url){const h=await this._fetchWithOptions(e);if(o=Date.now()-r,this._requestId&&this._requestId>i){this.logWarn(`Ignored load response #${i} because #${this._requestId} is pending.`);return}else this.logDebug(`Received response for load request #${i}`);if(this.parent===null&&s!==null){this.logWarn("Lazy parent node was removed while loading: discarding response.");return}this.setStatus(L.ok);const d=Date.now();this._loadSourceObject(h),a=Date.now()-d}else{if(typeof e.then=="function"){const h=t.logTime(`Resolve thenable ${e}`);e=await Promise.resolve(e),t.logTimeEnd(h)}this._loadSourceObject(e),a=Date.now()-r}}catch(c){throw this.logError("Error during load()",e,c),this._callEvent("error",{error:c}),this.setStatus(L.error,{message:""+c}),c}finally{this._requestId=0,n=Date.now()-r,t.options.debugLevel>=3&&t.logInfo(`Load source took ${n/1e3} seconds (transfer: ${o/1e3}s, processing: ${a/1e3}s)`)}}async loadLazy(e=!1){const t=this.expanded;if(v(this.lazy,"load() requires a lazy node"),!(!e&&!this.isUnloaded())){if(this.isLoading()){this.logWarn("loadLazy() called while already loading: ignored.");return}this.isLoaded()&&this.resetLazy(),this.setStatus(L.loading);try{const i=await this._callEvent("lazyLoad");if(i===!1){this.setStatus(L.ok);return}v(J(i)||i&&i.url,"The lazyLoad event must return a node list, `{url: ...}`, or false."),await this.load(i),this.setStatus(L.ok),t?(this.expanded=!0,this.tree.update(m.structure)):this.update()}catch(i){this.logError("Error during loadLazy()",i),this._callEvent("error",{error:i}),this.setStatus(L.error,{message:""+i})}}}log(...e){this.tree.options.debugLevel>=4&&console.log(this.toString(),...e)}logDebug(...e){this.tree.options.debugLevel>=4&&console.debug(this.toString(),...e)}logError(...e){this.tree.options.debugLevel>=1&&console.error(this.toString(),...e)}logInfo(...e){this.tree.options.debugLevel>=3&&console.info(this.toString(),...e)}logWarn(...e){this.tree.options.debugLevel>=2&&console.warn(this.toString(),...e)}async makeVisible(e){let t;const i=new lt,s=[],r=this.getParentList(!1,!1),n=r.length,o=ae(e,"noAnimation",!1),a=ae(e,"scrollIntoView",!0);for(t=n-1;t>=0;t--){const c={noAnimation:o};s.push(r[t].setExpanded(!0,c))}return Promise.all(s).then(()=>{a&&this.tree?(this.tree.updatePendingModifications(),this.scrollIntoView().then(()=>{i.resolve()})):i.resolve()}),i.promise()}moveTo(e,t="appendChild",i){t==="over"&&(t="appendChild"),t==="prependChild"&&(e.children&&e.children.length?(t="before",e=e.children[0]):t="appendChild");let s;const r=this.tree,n=this.parent,o=t==="appendChild"?e:e.parent;if(this!==e){if(this.parent?o.isDescendantOf(this)&&x("Cannot move a node to its own descendant"):x("Cannot move system root"),o!==n&&n.triggerModifyChild("remove",this),this.parent.children.length===1){if(this.parent===o)return;this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1}else s=this.parent.children.indexOf(this),v(s>=0,"invalid source parent"),this.parent.children.splice(s,1);if(this.parent=o,o.hasChildren())switch(t){case"appendChild":o.children.push(this);break;case"before":s=o.children.indexOf(e),v(s>=0,"invalid target parent"),o.children.splice(s,0,this);break;case"after":s=o.children.indexOf(e),v(s>=0,"invalid target parent"),o.children.splice(s+1,0,this);break;default:x(`Invalid mode '${t}'.`)}else o.children=[this];i&&e.visit(i,!0),o===n?o.triggerModifyChild("move",this):o.triggerModifyChild("add",this),r!==e.tree&&(this.logWarn("Cross-tree moveTo is experimental!"),this.visit(a=>{a.tree=e.tree},!0)),setTimeout(()=>{r.update(m.any)},0)}}async navigate(e,t){e=Zt[e]||e;const i=this.findRelatedNode(e);if(!i)return this.logWarn(`Could not find related node '${e}'.`),Promise.resolve(this);try{i.makeVisible({scrollIntoView:!1})}catch{}return i.setFocus(),(t==null?void 0:t.activate)===!1?Promise.resolve(this):i.setActive(!0,{event:t==null?void 0:t.event})}remove(){const e=this.tree,t=this.parent.children.indexOf(this);this.triggerModify("remove"),this.parent.children.splice(t,1),this.visit(i=>{i.removeMarkup(),e._unregisterNode(i)},!0),e.update(m.structure)}removeChildren(){var e,t;const i=this.tree;this.children&&(!((e=i.activeNode)===null||e===void 0)&&e.isDescendantOf(this)&&i.activeNode.setActive(!1),!((t=i.focusNode)===null||t===void 0)&&t.isDescendantOf(this)&&i._setFocusNode(null),this.triggerModifyChild("remove",null),this.visit(s=>{i._unregisterNode(s)}),this.lazy?this.children=[]:this.children=null,this.isRootNode()||(this.expanded=!1),this.tree.update(m.structure))}removeMarkup(){this._rowElem&&(delete this._rowElem._wb_node,this._rowElem.remove(),this._rowElem=void 0)}_getRenderInfo(){const e={},t={},i=this.isColspan(),s=this._rowElem?this._rowElem.querySelectorAll("span.wb-col"):null;let r=0;for(const n of this.tree.columns)e[n.id]={id:n.id,idx:r,elem:s?s[r]:null,info:n},!i&&n.id!=="*"&&(t[n.id]=e[n.id]),r++;return{allColInfosById:e,renderColInfosById:t}}_createIcon(e,t,i,s){let r,n=this.getOption("icon");if(this._errorInfo?n=e.error:this._isLoading&&s&&(n=e.loading),n===!1)return null;typeof n=="string"||(this.statusNodeType?n=e[this.statusNodeType]:this.expanded?n=e.folderOpen:this.children?n=e.folder:this.lazy?n=e.folderLazy:n=e.doc),n?n.indexOf("<")>=0?r=oe(n):Pe.test(n)?r=oe(`<i class="wb-icon" style="background-image: url('${n}');">`):(r=document.createElement("i"),r.className="wb-icon "+n):(r=document.createElement("i"),r.className="wb-icon"),i?t.replaceChild(r,i):t.appendChild(r);const o=this._callEvent("iconBadge",{iconSpan:r});let a=null;if(o!=null&&o!==!1){let c="",h="";$(o)?(a=""+o.badge,c=o.badgeClass?" "+o.badgeClass:"",h=o.badgeTooltip?` title="${o.badgeTooltip}"`:""):typeof o=="number"?a=""+o:a=o,typeof a=="string"&&(a=oe(`<span class="wb-badge${c}"${h}>${ie(a)}</span>`)),a&&r.append(a)}return r}_render_markup(e){const t=this.tree,i=t.options,s=this.getOption("checkbox"),r=t.columns,n=this.getLevel(),o=t.isRowNav()?null:t.activeColIdx;let a,c=this._rowElem,h=null,d=null;const p=!c;v(p,"Expected unrendered node"),v(!p||e&&e.after,"opts.after expected, unless updating"),v(!this.isRootNode(),"Root node not allowed"),c=document.createElement("div"),c.classList.add("wb-row"),c.style.top=this._rowIdx*C+"px",this._rowElem=c,c._wb_node=this;const f=document.createElement("span");f.classList.add("wb-node","wb-col"),c.appendChild(f);let u=0;s&&(h=document.createElement("i"),h.classList.add("wb-checkbox"),(s==="radio"||this.parent.radiogroup)&&h.classList.add("wb-radio"),f.appendChild(h),u+=re);for(let N=n-1;N>0;N--)a=document.createElement("i"),a.classList.add("wb-indent"),f.appendChild(a),u+=re;(!i.minExpandLevel||n>i.minExpandLevel)&&(d=document.createElement("i"),d.classList.add("wb-expander"),f.appendChild(d),u+=re),this._createIcon(t.iconMap,f,null,!d)&&(u+=re);const y=document.createElement("span");if(y.classList.add("wb-title"),f.appendChild(y),f._ofsTitlePx=u,t.options.dnd.dragStart&&(f.draggable=!0),!this.isColspan()&&r.length>1){let N=0;for(const k of r){N++;let _;k.id==="*"?_=f:(_=document.createElement("span"),_.classList.add("wb-col"),c.appendChild(_)),N===o&&_.classList.add("wb-active"),k.classes&&_.classList.add(...k.classes.split(" ")),_.style.left=k._ofsPx+"px",_.style.width=k._widthPx+"px",p&&k.html&&typeof k.html=="string"&&(_.innerHTML=k.html)}}switch(e?e.after:"last"){case"first":t.nodeListElement.prepend(c);break;case"last":t.nodeListElement.appendChild(c);break;default:e.after.after(c)}e.isNew=!0,this._render_data(e)}_render_data(e){v(this._rowElem,"No _rowElem");const t=this.tree,i=t.options,s=this._rowElem,r=!!e.isNew,n=!!e.preventScroll,o=t.columns,a=this.isColspan(),c=s.querySelector("span.wb-node"),h=c.querySelector("span.wb-title"),d=t.element.scrollTop;this.titleWithHighlight?h.innerHTML=this.titleWithHighlight:h.textContent=this.title;const p=this.getOption("tooltip",!1);if(p&&(h.title=p===!0?this.title:p),n&&(t.element.scrollTop=d),!i.skeleton)if(a){const f=t.element.clientWidth;h.style.width=f-c._ofsTitlePx-$e+"px"}else h.style.width=o[0]._widthPx-c._ofsTitlePx-$e+"px";if(e.isDataChange=!0,this._render_status(e),this.statusNodeType)this._callEvent("renderStatusNode",{isNew:r,nodeElem:c,isColspan:a});else if(this.parent){const f=this._getRenderInfo();this._callEvent("render",{isNew:r,nodeElem:c,isColspan:a,allColInfosById:f.allColInfosById,renderColInfosById:f.renderColInfosById})}}_render_status(e){const t=this.tree,i=t.iconMap,s=t.options,r=this.type?t.types[this.type]:null,n=this._rowElem,o=n.querySelector("span.wb-node"),a=o.querySelector("i.wb-expander"),c=o.querySelector("i.wb-checkbox"),h=["wb-row"];if(this.expanded&&h.push("wb-expanded"),this.lazy&&h.push("wb-lazy"),this.selected&&h.push("wb-selected"),this._partsel&&h.push("wb-partsel"),this===t.activeNode&&h.push("wb-active"),this===t.focusNode&&h.push("wb-focus"),this._errorInfo&&h.push("wb-error"),this._isLoading&&h.push("wb-loading"),this.isColspan()&&h.push("wb-colspan"),this.statusNodeType&&h.push("wb-status-"+this.statusNodeType),this.match&&h.push("wb-match"),this.subMatchCount&&h.push("wb-submatch"),s.skeleton&&h.push("wb-skeleton"),n.className=h.join(" "),this.classes&&n.classList.add(...this.classes),r&&r.classes&&n.classList.add(...r.classes),a){let d=null;this._isLoading?d=i.loading:this.isExpandable(!1)?this.expanded?d=i.expanderExpanded:d=i.expanderCollapsed:this.lazy&&this.children==null&&(d=i.expanderLazy),d==null?a.classList.add("wb-indent"):Pe.test(d)?a.style.backgroundImage=`url('${d}')`:a.className="wb-expander "+d}if(c){let d="wb-checkbox ";this.isRadio()?(d+="wb-radio ",this.selected?d+=i.radioChecked:d+=i.radioUnchecked):this.selected?d+=i.checkChecked:this._partsel?d+=i.checkUnknown:d+=i.checkUnchecked,c.className=d}if(!e.isNew){let d=0;for(const f of n.children)f.classList.toggle("wb-active",d++===t.activeColIdx),f.classList.remove("wb-error","wb-invalid");const p=o.querySelector("i.wb-icon");p&&this._createIcon(t.iconMap,o,p,!a)}if(e.resizeCols!==!1&&!this.isColspan()){const d=n.querySelectorAll("span.wb-col");let p=0,f=0;for(const u of this.tree.columns){const g=d[p];g.style.left=`${f}px`,g.style.width=`${u._widthPx}px`,p++,f+=u._widthPx}}}_render(e){const t=Object.assign({change:m.data},e);switch(this._rowElem||(t.change=m.row),t.change){case"status":this._render_status(t);break;case"data":this._render_data(t);break;case"row":this._render_markup(t);break;default:x(`Invalid change type '${t.change}'.`)}}resetLazy(){this.removeChildren(),this.expanded=!1,this.lazy=!0,this.children=null,this.tree.update(m.structure)}toDict(e=!1,t){const i={};if(de.forEach(s=>{const r=this[s];r instanceof Set?r.size&&(i[s]=Array.prototype.join.call(r.keys()," ")):(r||r===!1||r===0)&&(i[s]=r)}),_e(this.data)||(i.data=O({},this.data),_e(i.data)&&delete i.data),t){const s=t(i,this);if(s===!1)return!1;s==="skip"&&(e=!1)}if(e&&J(this.children)){i.children=[];for(let s=0,r=this.children.length;s<r;s++){const n=this.children[s];if(!n.isStatusNode()){const o=n.toDict(!0,t);o!==!1&&i.children.push(o)}}}return i}getOption(e,t){const i=this.tree;let s=i.options;e.indexOf(".")>=0&&([s,e]=e.split("."));const r=s[e];if(typeof r=="function"){const a=r.call(i,{type:"resolve",tree:i,node:this});if(a!==void 0)return a}if(this[e]!==void 0)return this[e];const n=this.type?i.types[this.type]:void 0,o=n?n[e]:void 0;return o!==void 0?o:r??t}async scrollIntoView(e){const t=Object.assign({node:this},e);return this.tree.scrollTo(t)}async setActive(e=!0,t){const i=this.tree,s=i.getActiveNode(),r=t==null?void 0:t.retrigger,n=t==null?void 0:t.focusTree,o=t==null?void 0:t.noEvents,a=t==null?void 0:t.event,c=t==null?void 0:t.colIdx,h=t==null?void 0:t.edit;if(v(!c||i.isCellNav(),"colIdx requires cellNav"),v(!h||c!=null,"edit requires colIdx"),!o)if(e){if(s!==this||r){if((s==null?void 0:s._callEvent("deactivate",{nextNode:this,event:a}))===!1||this._callEvent("beforeActivate",{prevNode:s,event:a})===!1)return;i._setActiveNode(null),s==null||s.update(m.status)}}else(s===this||r)&&this._callEvent("deactivate",{nextNode:null,event:a});return s!==this&&(e&&i._setActiveNode(this),s==null||s.update(m.status),this.update(m.status)),this.makeVisible().then(()=>{e&&((n||h)&&(i.setFocus(),i._setFocusNode(this),i.focusNode.setFocus()),c!=null&&i.isCellNav()&&i.setColumn(c,{edit:h}),o||this._callEvent("activate",{prevNode:s,event:a}))})}async setExpanded(e=!0,t){const{force:i,scrollIntoView:s,immediate:r}=t??{},n=!(t!=null&&t.noEvents);if(!e&&this.isExpanded()&&this.getLevel()<=this.tree.getOption("minExpandLevel")&&!i){this.logDebug("Ignored collapse request below minExpandLevel.");return}if(!e==!this.expanded||n&&this._callEvent("beforeExpand",{flag:e})===!1)return;e&&this.getOption("autoCollapse")&&this.collapseSiblings(t),e&&this.lazy&&this.children==null&&await this.loadLazy(),this.expanded=e;const o={immediate:r};if(this.tree.update(m.structure,o),e&&s){const a=this.getLastChild();a&&(this.tree.updatePendingModifications(),a.scrollIntoView({topNode:this}))}n&&this._callEvent("expand",{flag:e})}setFocus(e=!0){v(!!e,"Blur is not yet implemented");const t=this.tree.focusNode;this.tree._setFocusNode(this),t==null||t.update(),this.update()}setIcon(e){this.icon=e,this.update()}setKey(e,t){throw new Error("Not yet implemented")}update(e=m.data){v(e===m.status||e===m.data,`Invalid change type ${e}`),this.tree.update(e,this)}getSelectedNodes(e=!1){const t=[];return this.visit(i=>{if(i.selected&&(t.push(i),e===!0))return"skip"}),t}toggleSelected(e){let t=this.isSelected();return t===void 0&&!this.isRadio()?t=this._anySelectable():t=!t,this.setSelected(t,e)}_anySelectable(){let e=!1;return this.visit(t=>{if(t.selected===!1&&!t.unselectable&&!t.hasChildren()&&!t.parent.radiogroup)return e=!0,!1}),e}_changeSelectStatusProps(e){let t=!1;switch(e){case!1:t=this.selected||this._partsel,this.selected=!1,this._partsel=!1;break;case!0:t=!this.selected||!this._partsel,this.selected=!0,this._partsel=!0;break;case void 0:t=this.selected||!this._partsel,this.selected=!1,this._partsel=!0;break;default:x(`Invalid state: ${e}`)}return t&&this.update(),t}fixSelection3AfterClick(e){const t=!!(e!=null&&e.force),i=this.isSelected();this.visit(s=>{if(s.radiogroup)return"skip";(t||!s.getOption("unselectable"))&&s._changeSelectStatusProps(i)}),this.fixSelection3FromEndNodes()}fixSelection3FromEndNodes(e){const t=!!(e!=null&&e.force);v(this.tree.options.selectMode==="hier","expected selectMode 'hier'");const i=s=>{let r;const n=s.children;if(n&&n.length){let o=!0,a=!1;for(let c=0,h=n.length;c<h;c++){const d=n[c],p=i(d);p!==!1&&(a=!0),p!==!0&&(o=!1)}r=o?!0:a?void 0:!1}else r=!!s.selected;return s._partsel&&!s.selected&&s.lazy&&s.children==null&&(r=void 0),(t||!s.getOption("unselectable"))&&s._changeSelectStatusProps(r),r};i(this),this.visitParents(s=>{let r;const n=s.children;let o=!0,a=!1;for(let c=0,h=n.length;c<h;c++){const d=n[c];r=!!d.selected,(r||d._partsel)&&(a=!0),r||(o=!1)}r=o?!0:a?void 0:!1,s._changeSelectStatusProps(r)})}setSelected(e=!0,t){const i=this.tree,s=!(t!=null&&t.noEvents),r=this.isSelected(),n=this.parent&&this.parent.radiogroup,o=i.options.selectMode,a=(t==null?void 0:t.force)||!this.getOption("unselectable");return e=!!e,a?t!=null&&t.propagateDown&&o==="multi"?(i.runWithDeferredUpdate(()=>{this.visit(c=>{c.setSelected(e)})}),r):(e===r||s&&this._callEvent("beforeSelect",{flag:e})===!1||(i.runWithDeferredUpdate(()=>{if(n){if(!e&&!(t!=null&&t.force))return r;for(const c of this.parent.children)c.selected=c===this}else this.selected=e,o==="hier"?this.fixSelection3AfterClick():o==="single"&&i.visit(c=>{c.selected=!1})}),s&&this._callEvent("select",{flag:e})),r):r}setStatus(e,t){const i=this.tree,s=t==null?void 0:t.message,r=t==null?void 0:t.details;let n=null;const o=()=>{const c=this.children;c&&c.length&&c[0].isStatusNode()&&c[0].remove()},a=c=>{const h=this.children,d=h?h[0]:null;return v(c.statusNodeType,"Not a status node"),v(!d||!d.isStatusNode(),"Child must not be a status node"),n=this.addNode(c,"prependChild"),n.match=!0,i.update(m.structure),n};switch(o(),e){case"ok":this._isLoading=!1,this._errorInfo=null;break;case"loading":this._isLoading=!0,this._errorInfo=null,this.parent?this.update(m.status):a({statusNodeType:e,title:i.options.strings.loading+(s?" ("+s+")":""),checkbox:!1,colspan:!0,tooltip:r});break;case"error":a({statusNodeType:e,title:i.options.strings.loadError+(s?" ("+s+")":""),checkbox:!1,colspan:!0,tooltip:r}),this._isLoading=!1,this._errorInfo={message:s,details:r};break;case"noData":a({statusNodeType:e,title:s||i.options.strings.noData,checkbox:!1,colspan:!0,tooltip:r}),this._isLoading=!1,this._errorInfo=null;break;default:x("invalid node status "+e)}return i.update(m.structure),n}setTitle(e){this.title=e,this.update()}setTooltip(e){this.tooltip=e,this.update()}_sortChildren(e,t){const i=this.children;if(i&&(i.sort(e),t))for(let s=0,r=i.length;s<r;s++)i[s].children&&i[s]._sortChildren(e,t)}sortChildren(e=Ee,t=!1){this._sortChildren(e||Ee,t),this.tree.update(m.structure)}resetNativeChildOrder(e){const{recursive:t=!0,propName:i="_nativeIndex"}=e??{};this.children&&this.children.forEach((s,r)=>{s.data[i]=r,t&&s.children&&s.resetNativeChildOrder(e)})}sortByProperty(e){var t,i,s;const{caseInsensitive:r=!0,deep:n=!0,nativeOrderPropName:o="_nativeIndex",updateColInfo:a=!1}=e;let c,h;if(a){h=this.tree._columnsById[e.colId],v(h,`Invalid colId specified: ${e.colId}`),c=(t=e.order)!==null&&t!==void 0?t:it(h.sortOrder,["asc","desc",void 0]);for(const f of this.tree.columns)f.sortOrder=f===h?c:void 0;this.tree.update(m.colStructure)}else c=(i=e.order)!==null&&i!==void 0?i:"asc";let d=(s=e.propName)!==null&&s!==void 0?s:e.colId||"";d==="*"&&(d="title"),c==null&&(d=o,c="asc"),this.logDebug(`sortByProperty(), propName=${d}, ${c}`,e),v(d,"No property name specified");const p=(f,u)=>{let g,y;return de.has(d)?(g=f[d],y=u[d]):(g=f.data[d],y=u.data[d]),r&&(typeof g=="string"&&(g=g.toLowerCase()),typeof y=="string"&&(y=y.toLowerCase())),c==="desc"?g===y?0:g>y?-1:1:g===y?0:g>y?1:-1};return this.sortChildren(p,n)}triggerModifyChild(e,t,i){this.logDebug(`modifyChild(${e})`,i,t),this.tree.options.modifyChild&&(t&&t.parent!==this&&x("child "+t+" is not a child of "+this),this._callEvent("modifyChild",O({operation:e,child:t},i)))}triggerModify(e,t){this.parent.triggerModifyChild(e,this,t)}visit(e,t=!1){let i=!0;const s=this.children;if(t===!0&&(i=e(this),i===!1||i==="skip"))return i;if(s)for(let r=0,n=s.length;r<n&&(i=s[r].visit(e,!0),i!==!1);r++);return i}visitParents(e,t=!1){if(t&&e(this)===!1)return!1;let i=this.parent;for(;i;){if(e(i)===!1)return!1;i=i.parent}return!0}visitSiblings(e,t=!1){const i=this.parent.children;for(let s=0,r=i.length;s<r;s++){const n=i[s];if((t||n!==this)&&e(n)===!1)return!1}return!0}isMatched(){return!(this.tree.filterMode&&!this.match)}}F.sequence=0;/*!
 * Wunderbaum - ext-edit
 * Copyright (c) 2021-2024, Martin Wendt. Released under the MIT license.
 * v0.11.0, Sun, 04 Aug 2024 15:35:53 GMT (https://github.com/mar10/wunderbaum)
 */class li extends Q{constructor(e){super(e,"edit",{debounce:100,minlength:1,maxlength:null,trigger:[],trim:!0,select:!0,slowClickDelay:1e3,validity:!0,beforeEdit:null,edit:null,apply:null}),this.curEditNode=null,this.relatedNode=null,this.debouncedOnChange=ue(this._onChange.bind(this),this.getPluginOption("debounce"))}async _applyChange(e,t,i,s,r){return t.log(`_applyChange(${e})`,r),i.classList.add("wb-busy"),i.classList.remove("wb-error","wb-invalid"),s.setCustomValidity(""),new Promise((n,o)=>{const a=t._callEvent(e,r);Promise.resolve(a).then(c=>{n(c)}).catch(c=>{o(c)})}).then(n=>{if(!s.checkValidity())throw t.logWarn("inputElem.checkValidity() failed: throwing...."),new we(s.validationMessage);return n}).catch(n=>{if(n instanceof we)t.logWarn("catched ",n),i.classList.add("wb-invalid"),s.setCustomValidity&&!s.validationMessage&&s.setCustomValidity(n.message),s.validationMessage&&s.reportValidity();else throw t.logError(`Error in ${e} event handler (throw e.util.ValidationError instead if this was intended)`,n),i.classList.add("wb-error"),n}).finally(()=>{i.classList.remove("wb-busy")})}_onChange(e){const t=E.getEventInfo(e),i=t.node,s=t.colElem;if(!i||t.colIdx===0){this.tree.log("Ignored change event for removed element or node title");return}this._applyChange("change",i,s,e.target,{info:t,event:e,inputElem:e.target,inputValue:E.util.getValueFromElem(e.target),inputValid:e.target.checkValidity()})}init(){super.init(),R(this.tree.element,"change",".contenteditable,input,textarea,select",e=>this._onChange(e))}_preprocessKeyEvent(e){const t=e.event,i=te(t),s=this.tree,r=this.getPluginOption("trigger");if(this.isEditingTitle()){switch(i){case"Enter":return this._stopEditTitle(!0,{event:t}),!1;case"Escape":return this._stopEditTitle(!1,{event:t}),!1}return!1}if(s.isRowNav()||s.activeColIdx===0){switch(i){case"Enter":if(r.indexOf("macEnter")>=0&&Se)return this.startEditTitle(),!1;break;case"F2":if(r.indexOf("F2")>=0)return this.startEditTitle(),!1;break}return!0}return!0}isEditingTitle(e){return e?this.curEditNode===e:!!this.curEditNode}startEditTitle(e){e=e??this.tree.getActiveNode();const t=this.getPluginOption("validity"),i=this.getPluginOption("select");if(!e)return;this.tree.logDebug(`startEditTitle(node=${e})`);let s=e._callEvent("edit.beforeEdit");if(s===!1){e.logDebug("beforeEdit canceled operation.");return}if(s===!0||!s){const o=ie(e.title);let a=this.getPluginOption("maxlength");const c=a?` maxlength="${a}"`:"";a=this.getPluginOption("minlength");const h=a?` minlength="${a}"`:"",d=a>0?" required":"";s=`<input type=text class="wb-input-edit" tabindex=-1 value="${o}" autocorrect="off"${d}${h}${c} >`}const r=e.getColElem(0).querySelector(".wb-title");r.innerHTML=s;const n=r.firstElementChild;t&&n.addEventListener("keydown",o=>{n.setCustomValidity(""),n.reportValidity()||e.logWarn(`Invalid input: '${n.value}'`)}),n.focus(),i&&n.select(),this.curEditNode=e,e._callEvent("edit.edit",{inputElem:n})}stopEditTitle(e){return this._stopEditTitle(e,{})}_stopEditTitle(e,t){var i;t??(t={});const s=document.activeElement;let r=s?De(s):null;const n=this.curEditNode,o=!!t.forceClose,a=this.getPluginOption("validity");if(r&&this.getPluginOption("trim")&&(r=r.trim()),!n){this.tree.logDebug("stopEditTitle: not in edit mode.");return}if(n.logDebug(`stopEditTitle(${e})`,t,s,r),e&&r!==null&&r!==n.title){const c=s.validationMessage;if(c)throw new Error(`Input validation failed for "${r}": ${c}.`);const h=n.getColElem(0);this._applyChange("edit.apply",n,h,s,{oldValue:n.title,newValue:r,inputElem:s,inputValid:s.checkValidity()}).then(d=>{var p;const f=s.validationMessage;if(a&&f&&d!==!1)throw new Error(`Edit apply validation failed for "${r}": ${f}.`);!o&&d===!1||(n==null||n.setTitle(r),(p=this.curEditNode)===null||p===void 0||p._render({preventScroll:!0}),this.curEditNode=null,this.relatedNode=null,this.tree.setFocus())})}else(i=this.curEditNode)===null||i===void 0||i._render({preventScroll:!0}),this.curEditNode=null,this.relatedNode=null,this.tree.setFocus()}createNode(e="after",t,i){const s=this.tree;if(t=t??s.getActiveNode(),v(t,"No node was passed, or no node is currently active."),e=e||"prependChild",i==null?i={title:""}:typeof i=="string"?i={title:i}:v($(i),`Expected a plain object: ${i}`),(e==="prependChild"||e==="appendChild")&&(t!=null&&t.isExpandable(!0))){t.setExpanded().then(()=>{this.createNode(e,t,i)});return}const r=t.addNode(i,e);r.setClass("wb-edit-new"),this.relatedNode=t,r.match=!0,r.makeVisible({noAnimation:!0}).then(()=>{this.startEditTitle(r)})}}/*!
 * wunderbaum.ts
 *
 * A treegrid control.
 *
 * Copyright (c) 2021-2024, Martin Wendt (https://wwWendt.de).
 * https://github.com/mar10/wunderbaum
 *
 * Released under the MIT license.
 * @version v0.11.0
 * @date Sun, 04 Aug 2024 15:35:53 GMT
 */class oi extends F{constructor(e){super(e,null,{key:"__root__",title:e.id})}toString(){return`WbSystemRoot@${this.key}<'${this.tree.id}'>`}}class E{get activeNode(){var e;return!((e=this._activeNode)===null||e===void 0)&&e.tree?this._activeNode:null}get focusNode(){var e;return!((e=this._focusNode)===null||e===void 0)&&e.tree?this._focusNode:null}constructor(e){this.enabled=!0,this.data={},this.extensionList=[],this.extensions={},this.keyMap=new Map,this.refKeyMap=new Map,this.treeRowCount=0,this._disableUpdateCount=0,this._disableUpdateIgnoreCount=0,this._activeNode=null,this._focusNode=null,this.types={},this.columns=[],this._columnsById={},this.pendingChangeTypes=new Set,this._util=rt,this.filterMode=null,this.activeColIdx=0,this._cellNavMode=!1,this.lastQuicksearchTime=0,this.lastQuicksearchTerm="",this.lastClickTime=0;const t=this.options=O({id:null,source:null,element:null,debugLevel:Gt,header:null,rowHeightPx:C,iconMap:"bootstrap",columns:null,types:null,enabled:!0,fixedCol:!1,showSpinner:!1,checkbox:!1,minExpandLevel:0,emptyChildListExpandable:!1,skeleton:!1,connectTopBreadcrumb:null,selectMode:"multi",navigationModeOption:null,quicksearch:!0,iconBadge:null,change:null,error:null,receive:null,strings:{loadError:"Error",loading:"Loading...",noData:"No data"}},e),i=new lt;this.ready=i.promise();let s=!1;if(this.ready.then(()=>{s=!0;try{this._callEvent("init")}catch(n){this.logError("Exception inside `init(e)` event:",n)}}).catch(n=>{if(s)throw n;this._callEvent("init",{error:n})}),this.id=t.id||"wb_"+ ++E.sequence,this.root=new oi(this),this._registerExtension(new jt(this)),this._registerExtension(new li(this)),this._registerExtension(new Kt(this)),this._registerExtension(new si(this)),this._registerExtension(new ri(this)),this._registerExtension(new Bt(this)),this._updateViewportThrottled=nt(this._updateViewportImmediately.bind(this),{}),this.columns=t.columns,delete t.columns,!this.columns||!this.columns.length){const n=typeof t.header=="string"?t.header:this.id;this.columns=[{id:"*",title:n,width:"*"}]}t.types&&this.setTypes(t.types,!0),delete t.types,this.element=Y(t.element),v(!!this.element,`Invalid 'element' option: ${t.element}`),this.element.classList.add("wunderbaum"),this.element.getAttribute("tabindex")||(this.element.tabIndex=0),this.element._wb_tree=this,this.headerElement=this.element.querySelector("div.wb-header");const r=t.header==null?this.columns.length>1:!!t.header;if(this.headerElement){v(!this.columns,"`opts.columns` must not be set if markup already contains a header"),this.columns=[];const n=this.headerElement.querySelector("div.wb-row");for(const o of n.querySelectorAll("div"))this.columns.push({id:o.dataset.id||`col_${this.columns.length}`,title:""+o.textContent,width:"*"})}else{const n="<span class='wb-col'></span>".repeat(this.columns.length);if(this.element.innerHTML=`
        <div class='wb-header'>
          <div class='wb-row'>
            ${n}
          </div>
        </div>`,!r){const o=this.element.querySelector("div.wb-header");o.style.display="none"}}this.element.innerHTML+=`
      <div class="wb-list-container">
        <div class="wb-node-list"></div>
      </div>`,this.listContainerElement=this.element.querySelector("div.wb-list-container"),this.nodeListElement=this.listContainerElement.querySelector("div.wb-node-list"),this.headerElement=this.element.querySelector("div.wb-header"),this.element.classList.toggle("wb-grid",this.columns.length>1),this._initExtensions(),["enabled","fixedCol"].forEach(n=>{t[n]!=null&&this.setOption(n,t[n])}),t.source?(t.showSpinner&&(this.nodeListElement.innerHTML="<progress class='spinner'>loading...</progress>"),this.load(t.source).then(()=>{t.navigationModeOption==null?this.isGrid()?this.setNavigationOption(D.cell):this.setNavigationOption(D.row):this.setNavigationOption(t.navigationModeOption),this.update(m.structure,{immediate:!0}),i.resolve()}).catch(n=>{i.reject(n)}).finally(()=>{var n;(n=this.element.querySelector("progress.spinner"))===null||n===void 0||n.remove(),this.element.classList.remove("wb-initializing")})):i.resolve(),this.update(m.any),this.element.addEventListener("scroll",n=>{this.update(m.scroll)}),this.resizeObserver=new ResizeObserver(n=>{this.update(m.resize)}),this.resizeObserver.observe(this.element),R(this.element,"click",".wb-button,.wb-col-icon",n=>{var o,a;const c=E.getEventInfo(n),h=(a=(o=n.target)===null||o===void 0?void 0:o.dataset)===null||a===void 0?void 0:a.command;this._callEvent("buttonClick",{event:n,info:c,command:h})}),R(this.nodeListElement,"click","div.wb-row",n=>{const o=E.getEventInfo(n),a=o.node,c=n;if(this._callEvent("click",{event:n,node:a,info:o})===!1)return this.lastClickTime=Date.now(),!1;if(a){if(c.ctrlKey){a.toggleSelected();return}const h=this.getOption("edit.trigger"),d=this.getOption("edit.slowClickDelay");h.indexOf("clickActive")>=0&&o.region==="title"&&a.isActive()&&(!d||Date.now()-this.lastClickTime<d)&&a.startEditTitle(),o.colIdx>=0?a.setActive(!0,{colIdx:o.colIdx,event:n}):a.setActive(!0,{event:n}),o.region===I.expander?a.setExpanded(!a.isExpanded(),{scrollIntoView:e.scrollIntoViewOnExpandClick!==!1}):o.region===I.checkbox&&a.toggleSelected()}this.lastClickTime=Date.now()}),R(this.nodeListElement,"dblclick","div.wb-row",n=>{const o=E.getEventInfo(n),a=o.node;if(this._callEvent("dblclick",{event:n,node:a,info:o})===!1)return!1;a&&o.colIdx===0&&a.isExpandable()&&(this._callMethod("edit._stopEditTitle"),a.setExpanded(!a.isExpanded()))}),R(this.element,"keydown",n=>{const o=E.getEventInfo(n),a=te(n),c=o.node||this.getFocusNode();this._callHook("onKeyEvent",{event:n,node:c,info:o,eventName:a})}),R(this.element,"focusin focusout",n=>{const o=n.type==="focusin",a=E.getNode(n);this._callEvent("focus",{flag:o,event:n}),o&&this.isRowNav()&&!this.isEditingTitle()&&(t.navigationModeOption===D.row?a==null||a.setActive():this.setCellNav()),o||this._callMethod("edit._stopEditTitle",!0,{event:n,forceClose:!0})})}static getTree(e){if(e instanceof E)return e;if(e instanceof F)return e.tree;if(e===void 0&&(e=0),typeof e=="number")e=document.querySelectorAll(".wunderbaum")[e];else if(typeof e=="string"){for(const t of document.querySelectorAll(".wunderbaum")){const i=t._wb_tree;if(i&&i.id===e)return i}if(e=document.querySelector(e),!e)return null}else e.target&&(e=e.target);return v(e instanceof Element,`Invalid el type: ${e}`),e.matches(".wunderbaum")||(e=e.closest(".wunderbaum")),e&&e._wb_tree?e._wb_tree:null}get iconMap(){const e=this.options.iconMap;return typeof e=="string"?Qt[e]:e}static getNode(e){if(e){if(e instanceof F)return e;e.target!==void 0&&(e=e.target)}else return null;for(;e;){if(e._wb_node)return e._wb_node;e=e.parentElement}return null}*[Symbol.iterator](){yield*this.root}_registerExtension(e){this.extensionList.push(e),this.extensions[e.id]=e}_initExtensions(){for(const e of this.extensionList)e.init()}_registerNode(e){const t=e.key;v(t!=null,`Missing key: '${e}'.`),v(!this.keyMap.has(t),`Duplicate key: '${t}': ${e}.`),this.keyMap.set(t,e);const i=e.refKey;if(i!=null){const s=this.refKeyMap.get(i);s?s.add(e):this.refKeyMap.set(i,new Set([e]))}}_unregisterNode(e){const t=e.refKey;if(t!=null){const i=this.refKeyMap.get(t);i&&i.delete(e)&&!i.size&&this.refKeyMap.delete(t)}this.keyMap.delete(e.key),e.tree=null,e.parent=null,e.removeMarkup()}_callHook(e,t={}){let i;const s=O({},{tree:this,options:this.options,result:void 0},t);for(const r of this.extensionList){if(i=r[e].call(r,s),i===!1)break;s.result!==void 0&&(i=s.result)}return i}_callMethod(e,...t){const[i,s]=e.split("."),r=s?this.extensions[i]:this,n=r[s];if(n)return n.apply(r,t);this.logError(`Calling undefined method '${e}()'.`)}_callEvent(e,t){const[i,s]=e.split("."),r=this.options,n=s?r[i][s]:r[i];if(n)return n.call(this,O({type:e,tree:this,util:this._util},t))}_getNodeByRowIdx(e){let t=null;return this.visitRows(i=>{if(i._rowIdx===e)return t=i,!1}),t}getTopmostVpNode(e=!0){const s=this.element.scrollTop;let r;return e?r=Math.ceil((s-1)/C):r=Math.floor(s/C),this._getNodeByRowIdx(r)}getLowestVpNode(e=!0){const t=this.element,i=this.headerElement.clientHeight,s=t.scrollTop,r=t.clientHeight-i;let n;return e?n=Math.floor((s+r)/C)-1:n=Math.ceil((s+r)/C)-1,n=Math.min(n,this.count(!0)-1),this._getNodeByRowIdx(n)}_getPrevNodeInView(e,t=1){return this.visitRows(i=>{if(e=i,t--<=0)return!1},{reverse:!0,start:e||this.getActiveNode()}),e}_getNextNodeInView(e,t=1){return this.visitRows(i=>{if(e=i,t--<=0)return!1},{reverse:!1,start:e||this.getActiveNode()}),e}addChildren(e,t){return this.root.addChildren(e,t)}applyCommand(e,t,i){let s,r;switch(t instanceof F?s=t:(s=this.getActiveNode(),v(i===void 0,`Unexpected options: ${i}`),i=t),e){case"moveUp":r=s.getPrevSibling(),r&&(s.moveTo(r,"before"),s.setActive());break;case"moveDown":r=s.getNextSibling(),r&&(s.moveTo(r,"after"),s.setActive());break;case"indent":r=s.getPrevSibling(),r&&(s.moveTo(r,"appendChild"),r.setExpanded(),s.setActive());break;case"outdent":s.isTopLevel()||(s.moveTo(s.getParent(),"after"),s.setActive());break;case"remove":r=s.getPrevSibling()||s.getParent(),s.remove(),r&&r.setActive();break;case"addChild":this._callMethod("edit.createNode","prependChild");break;case"addSibling":this._callMethod("edit.createNode","after");break;case"rename":s.startEditTitle();break;case"down":case"first":case"last":case"left":case"pageDown":case"pageUp":case"parent":case"right":case"up":return s.navigate(e);default:x(`Unhandled command: '${e}'`)}}clear(){this.root.removeChildren(),this.root.children=null,this.keyMap.clear(),this.refKeyMap.clear(),this.treeRowCount=0,this._activeNode=null,this._focusNode=null,this.update(m.structure)}destroy(){this.logInfo("destroy()..."),this.clear(),this.resizeObserver.disconnect(),this.element.innerHTML="",this.element.outerHTML=this.element.outerHTML}getOption(e,t){let i,s=this.options;e.indexOf(".")>=0&&([i,e]=e.split("."),s=s[i]);let r=s[e];return typeof r=="function"&&(r=r({type:"resolve",tree:this})),r??t}setOption(e,t){if(e.indexOf(".")>=0){const i=e.split(".");this.extensions[i[0]].setPluginOption(i[1],t);return}switch(this.options[e]=t,e){case"checkbox":this.update(m.any);break;case"enabled":this.setEnabled(!!t);break;case"fixedCol":this.element.classList.toggle("wb-fixed-col",!!t);break}}hasFocus(){return this.element.contains(document.activeElement)}hasHeader(){const e=this.options.header;return this.isGrid()?e!==!1:!!e}runWithDeferredUpdate(e,t=null){try{this.enableUpdate(!1);const i=e();return v(!(i instanceof Promise),`Promise return not allowed: ${i}`),i}finally{this.enableUpdate(!0)}}async expandAll(e=!0,t){await this.root.expandAll(e,t)}selectAll(e=!0){return this.root.setSelected(e,{propagateDown:!0})}toggleSelect(){this.selectAll(this.root._anySelectable())}getSelectedNodes(e=!1){return this.root.getSelectedNodes(e)}_selectRange(e){this.logDebug("_selectRange",e),x("Not yet implemented.")}count(e=!1){return e?this.treeRowCount:this.keyMap.size}_check(){let e=0;this.visit(t=>{e++}),this.keyMap.size!==e&&this.logWarn(`_check failed: ${this.keyMap.size} !== ${e}`)}findAll(e){return this.root.findAll(e)}findByRefKey(e){const t=this.refKeyMap.get(e);return t?Array.from(t):[]}findFirst(e){return this.root.findFirst(e)}findKey(e){return this.keyMap.get(e)||null}findNextNode(e,t){let i=null;const s=this.getFirstChild(),r=typeof e=="string"?ei(e):e;t=t||s;function n(o){if(r(o)&&(i=o),i||o===t)return!1}return this.visitRows(n,{start:t,includeSelf:!1}),!i&&t!==s&&this.visitRows(n,{start:s,includeSelf:!0}),i}findRelatedNode(e,t,i=!1){let s=null;const r=Math.floor(this.listContainerElement.clientHeight/C);switch(t){case"parent":e.parent&&e.parent.parent&&(s=e.parent);break;case"first":this.visit(n=>{if(n.isVisible())return s=n,!1});break;case"last":this.visit(n=>{n.isVisible()&&(s=n)});break;case"left":e.parent&&e.parent.parent&&(s=e.parent);break;case"right":e.children&&e.children.length&&(s=e.children[0]);break;case"up":s=this._getPrevNodeInView(e);break;case"down":s=this._getNextNodeInView(e);break;case"pageDown":{const n=this.getLowestVpNode();e._rowIdx<n._rowIdx?s=n:s=this._getNextNodeInView(e,r)}break;case"pageUp":if(e._rowIdx===0)s=e;else{const n=this.getTopmostVpNode();e._rowIdx>n._rowIdx?s=n:s=this._getPrevNodeInView(e,r)}break;default:this.logWarn("Unknown relation '"+t+"'.")}return s}*format_iter(e,t){yield*this.root.format_iter(e,t)}format(e,t){return this.root.format(e,t)}getActiveColElem(){return this.activeNode&&this.activeColIdx>=0?this.activeNode.getColElem(this.activeColIdx):null}getActiveNode(){return this.activeNode}getFirstChild(){return this.root.getFirstChild()}getFocusNode(){return this.focusNode}static getEventInfo(e){const t=e.target,i=t.classList,s=t.closest("span.wb-col"),r=E.getNode(t),n=r?r.tree:E.getTree(e),o={event:e,canonicalName:te(e),tree:n,node:r,region:I.unknown,colDef:void 0,colIdx:-1,colId:void 0,colElem:s};if(i.contains("wb-title"))o.region=I.title;else if(i.contains("wb-expander"))o.region=r.isExpandable()?I.expander:I.prefix;else if(i.contains("wb-checkbox"))o.region=I.checkbox;else if(i.contains("wb-icon"))o.region=I.icon;else if(i.contains("wb-node"))o.region=I.title;else if(s){o.region=I.column;const a=Array.prototype.indexOf.call(s.parentNode.children,s);o.colIdx=a}else if(i.contains("wb-row"))o.region=I.title;else return e.type!=="mousemove"&&!(e instanceof KeyboardEvent)&&(n==null||n.logWarn("getEventInfo(): not found",e,o)),o;return o.colIdx===-1&&(o.colIdx=0),o.colDef=n==null?void 0:n.columns[o.colIdx],o.colDef!=null&&(o.colId=o.colDef.id),o}toString(){return`Wunderbaum<'${this.id}'>`}isEditing(){return!!this.nodeListElement.querySelector("input:focus,select:focus")}isEditingTitle(){return this._callMethod("edit.isEditingTitle")}isLoading(){let e=!1;return this.root.visit(t=>{if(t._isLoading||t._requestId)return e=!0,!1},!0),e}log(...e){this.options.debugLevel>=4&&console.log(this.toString(),...e)}logDebug(...e){this.options.debugLevel>=4&&console.debug(this.toString(),...e)}logError(...e){this.options.debugLevel>=1&&console.error(this.toString(),...e)}logInfo(...e){this.options.debugLevel>=3&&console.info(this.toString(),...e)}logTime(e){return this.options.debugLevel>=4&&console.time(this+": "+e),e}logTimeEnd(e){this.options.debugLevel>=4&&console.timeEnd(this+": "+e)}logWarn(...e){this.options.debugLevel>=2&&console.warn(this.toString(),...e)}resetColumns(){this.columns.forEach(e=>{delete e.customWidthPx}),this.update(m.colStructure)}scrollTo(e){let i,s;e instanceof F?i=e:(s=e,i=s.node),v(i&&i._rowIdx!=null,`Invalid node: ${i}`);const r=this.element,n=this.headerElement.clientHeight,o=r.scrollTop,a=r.clientHeight,c=i._rowIdx*C+n,h=n,d=c-o,p=d+C,f=s==null?void 0:s.topNode;let u=null;d>=h?p<=a||(u=c+C-a+2):u=c-h-2,u!=null&&(this.log(`scrollTo(${c}): ${o} => ${u}`),r.scrollTop=u,f&&this.scrollTo(f))}scrollToHorz(){const e=this.columns[0]._widthPx,t=this.element.clientWidth,i=this.element.scrollLeft,s=this.getActiveColElem(),r=Number.parseInt(s==null?void 0:s.style.left,10),n=r+Number.parseInt(s==null?void 0:s.style.width,10);let o=i;r-i<e?o=r-e:n-i>t&&(o=n-t),o=Math.max(0,o),this.log(`scrollToHorz(${this.activeColIdx}): ${r}..${n}, fixedOfs=${e}, vpWidth=${t}, curLeft=${i} -> ${o}`),this.element.scrollLeft=o}setColumn(e,t){var i,s,r;const n=t==null?void 0:t.edit,o=(t==null?void 0:t.scrollIntoView)!==!1;if(v(this.isCellNav(),"Expected cellNav mode"),typeof e=="string"){const a=e;e=this.columns.findIndex(c=>c.id===e),v(e>=0,`Invalid colId: ${a}`)}if(v(0<=e&&e<this.columns.length,`Invalid colIdx: ${e}`),this.activeColIdx=e,this.hasHeader())for(const a of this.headerElement.children){let c=0;for(const h of a.children)h.classList.toggle("wb-active",c++===e)}(i=this.activeNode)===null||i===void 0||i.update(m.status);for(const a of this.nodeListElement.children){let c=0;for(const h of a.children)h.classList.toggle("wb-active",c++===e)}(o||n)&&this.scrollToHorz(),n&&this.activeNode&&(e===0?this.activeNode.startEditTitle():(r=(s=this.getActiveColElem())===null||s===void 0?void 0:s.querySelector("input,select"))===null||r===void 0||r.focus())}_setActiveNode(e){this._activeNode=e}setActiveNode(e,t=!0,i){var s;(s=this.findKey(e))===null||s===void 0||s.setActive(t,i)}setFocus(e=!0){e?this.element.focus():this.element.blur()}_setFocusNode(e){this._focusNode=e}update(e,t,i){t instanceof F||(i=t,t=void 0);const s=!!ae(i,"immediate"),r=ce,n=this.pendingChangeTypes;if(this._disableUpdateCount){this._disableUpdateIgnoreCount++;return}switch(e){case m.any:case m.colStructure:n.add(r.header),n.add(r.clearMarkup),n.add(r.redraw),n.add(r.scroll);break;case m.resize:n.add(r.header),n.add(r.redraw);break;case m.structure:n.add(r.redraw);break;case m.scroll:n.add(r.scroll);break;case m.row:case m.data:case m.status:v(t,`Option '${e}' requires a node.`),t._rowElem&&t._render({change:e});break;default:x(`Invalid change type '${e}'.`)}if(e===m.colStructure){const o=this.isGrid();this.element.classList.toggle("wb-grid",o),!o&&this.isCellNav()&&this.setCellNav(!1)}n.size>0&&(s?this._updateViewportImmediately():this._updateViewportThrottled())}setEnabled(e=!0){const t=this.enabled;return this.enabled=!!e,this.element.classList.toggle("wb-disabled",!e),t}isEnabled(){return this.enabled}isGrid(){return this.columns&&this.columns.length>1}isCellNav(){return!!this._cellNavMode}isRowNav(){return!this._cellNavMode}setCellNav(e=!0){var t;const i=this._cellNavMode;this._cellNavMode=!!e,e&&!i&&this.setColumn(0),this.element.classList.toggle("wb-cell-mode",e),(t=this.activeNode)===null||t===void 0||t.update(m.status)}setNavigationOption(e,t=!1){if(!this.isGrid()&&e!==D.row){this.logWarn("Plain trees only support row navigation mode.");return}switch(this.options.navigationModeOption=e,e){case D.cell:this.setCellNav(!0);break;case D.row:this.setCellNav(!1);break;case D.startCell:t&&this.setCellNav(!0);break;case D.startRow:t&&this.setCellNav(!1);break;default:x(`Invalid mode '${e}'.`)}}setStatus(e,t){return this.root.setStatus(e,t)}setTypes(e,t=!0){v($(e),`Expected plain objext: ${e}`),t?this.types=e:O(this.types,e);for(const i of Object.values(this.types))i.classes&&(i.classes=fe(i.classes))}sortChildren(e=Ee,t=!1){this.root.sortChildren(e,t)}sortByProperty(e){this.root.sortByProperty(e)}toDictArray(e){var t;return(t=this.root.toDict(!0,e).children)!==null&&t!==void 0?t:[]}_updateColumnWidths(){const t=this.element.clientWidth,i=1,s=this.columns,r=s[0];let n=0,o=0,a=0,c=!1;if(r.id!=="*")throw new Error(`First column must have  id '*': got '${r.id}'.`);this._columnsById={};for(const f of s){this._columnsById[f.id]=f;const u=f.customWidthPx?`${f.customWidthPx}px`:f.width;if(f.id==="*"&&f!==r)throw new Error(`Column id '*' must be defined only once: '${f.title}'.`);if(!u||u==="*")f._weight=1,o+=1;else if(typeof u=="number")f._weight=u,o+=u;else if(typeof u=="string"&&u.endsWith("px")){f._weight=0;const g=parseFloat(u.slice(0,-2));f._widthPx!=g&&(c=!0,f._widthPx=g),a+=g}else x(`Invalid column width: ${u} (expected string ending with 'px' or number, e.g. "<num>px" or <int>).`)}const h=Math.max(0,t-a);let d=0;for(const f of s){let u;if(f._weight){const g=f.minWidth;typeof g=="number"?u=g:typeof g=="string"&&g.endsWith("px")?u=parseFloat(g.slice(0,-2)):u=4;const y=Math.max(u,h*f._weight/o);f._widthPx!=y&&(c=!0,f._widthPx=y)}f._ofsPx=d,d+=f._widthPx}s[s.length-1]._widthPx-=i,n=d-i;const p=`${n}px`;return this.headerElement.style.width=p,this.listContainerElement.style.width=p,c}_insertIcon(e,t){const i=document.createElement("i");i.className=e,t.appendChild(i)}_renderHeaderMarkup(){v(this.headerElement,"Expected a headerElement");const e=this.hasHeader();if(et(this.headerElement,e),!e)return;const t=this.iconMap,i=this.columns.length,s=this.headerElement.querySelector(".wb-row");v(s,"Expected a row in header element"),s.innerHTML="<span class='wb-col'></span>".repeat(i);for(let r=0;r<i;r++){const n=this.columns[r],o=s.children[r];o.style.left=n._ofsPx+"px",o.style.width=n._widthPx+"px",typeof n.headerClasses=="string"?n.headerClasses&&o.classList.add(...n.headerClasses.split(" ")):n.classes&&o.classList.add(...n.classes.split(" "));let a="";n.tooltip&&(a=Je(n.tooltip),a=` title="${a}"`);let c="";if(j(n.menu,this.options.columnsMenu,!1)){const p=`<i data-command=menu class="wb-col-icon ${"wb-col-icon-menu "+t.colMenu}"></i>`;c+=p}if(j(n.sortable,this.options.columnsSortable,!1)){let d="wb-col-icon-sort "+t.colSortable;n.sortOrder&&(d+=`wb-col-sort-${n.sortOrder}`,d+=n.sortOrder==="asc"?t.colSortAsc:t.colSortDesc);const p=`<i data-command=sort class="wb-col-icon ${d}"></i>`;c+=p}if(j(n.filterable,this.options.columnsFilterable,!1)){o.classList.toggle("wb-col-filter",!!n.filterActive);let d="wb-col-icon-filter "+t.colFilter;n.filterActive&&(d+=t.colFilterActive);const p=`<i data-command=filter class="wb-col-icon ${d}"></i>`;c+=p}r<i-1&&(j(n.resizable,this.options.columnsResizable,!1)?c+='<span class="wb-col-resizer wb-col-resizer-active"></span>':c+='<span class="wb-col-resizer"></span>');const h=ie(n.title||n.id);o.innerHTML=`<span class="wb-col-title"${a}>${h}</span>${c}`,this.isCellNav()&&o.classList.toggle("wb-active",r===this.activeColIdx)}}updatePendingModifications(){this.pendingChangeTypes.size>0&&this._updateViewportImmediately()}_updateViewportImmediately(){var e;if(this._disableUpdateCount){this.log(`_updateViewportImmediately() IGNORED (disable level: ${this._disableUpdateCount}).`),this._disableUpdateIgnoreCount++;return}this._updateViewportThrottled.pending()&&this._updateViewportThrottled.cancel();const t=1,i=ce,s=new Set(this.pendingChangeTypes);if(this.pendingChangeTypes.clear(),s.has(i.scroll)&&s.size===1)this._updateRows({newNodesOnly:!0});else{if(this.log("_updateViewportImmediately():",s),this.options.adjustHeight!==!1){let n=this.listContainerElement.clientHeight;const o=this.headerElement.clientHeight,a=this.element.clientHeight-o-t;Math.abs(n-a)>1&&(this.listContainerElement.style.height=a+"px",n=a)}s.has(i.clearMarkup)&&this.visit(n=>{n.removeMarkup()}),s.has(i.header)&&(this._updateColumnWidths(),this._renderHeaderMarkup()),this._updateRows()}if(this.options.connectTopBreadcrumb){v(this.options.connectTopBreadcrumb.textContent!=null,"Invalid 'connectTopBreadcrumb' option (input element expected).");let n=(e=this.getTopmostVpNode(!0))===null||e===void 0?void 0:e.getPath(!1,"title"," > ");n=n?n+" >":"",this.options.connectTopBreadcrumb.textContent=n}this._callEvent("update")}_updateRows(e){e=Object.assign({newNodesOnly:!1},e);const t=!!e.newNodesOnly,i=C,s=this.element.clientHeight,r=Xt,n=this.element.scrollTop;let o=Math.max(0,n/i-r);o=Math.floor(o),o%2&&o--;let a=Math.max(0,(n+s)/i+r);a=Math.ceil(a);const c=new Set;this.nodeListElement.childNodes.forEach(u=>{const g=u;c.add(g._wb_node)});let h=0,d=0,p=!1,f="first";this.visitRows(function(u){const g=u._rowElem;u._rowIdx!==h&&(u._rowIdx=h,p=!0),h<o||h>a?g&&(f=g):g&&t?(c.delete(u),g.style.top=h*C+"px",f=g):(c.delete(u),g&&(g.style.top=h*C+"px"),u._render({top:d,after:f}),f=u._rowElem),h++,d+=i}),this.treeRowCount=h;for(const u of c)u._callEvent("discard"),u.removeMarkup();return this.nodeListElement.style.height=`${d}px`,p}visit(e){return this.root.visit(e,!1)}visitRows(e,t){if(!this.root.hasChildren())return!1;if(t&&t.reverse)return delete t.reverse,this._visitRowsUp(e,t);t=t||{};let i,s,r,n,o,a,c=0,h=t.includeSelf===!1,d=t.start||this.root.children[0];const p=!!t.includeHidden,f=!p&&this.filterMode==="hide";for(r=d.parent;r;){for(o=r.children,s=o.indexOf(d)+c,v(s>=0,`Could not find ${d} in parent's children: ${r}`),i=s;i<o.length;i++){if(d=o[i],d===a)return!1;if(!(f&&!d.statusNodeType&&!d.match&&!d.subMatchCount)&&(!h&&e(d)===!1||(h=!1,d.children&&d.children.length&&(p||d.expanded)&&(n=d.visit(u=>{if(u===a)return!1;if(f&&!u.match&&!u.subMatchCount)return"skip";if(e(u)===!1)return!1;if(!p&&u.children&&!u.expanded)return"skip"},!1),n===!1))))return!1}d=r,r=r.parent,c=1,!r&&t.wrap&&(this.logDebug("visitRows(): wrap around"),v(t.start,"`wrap` option requires `start`"),a=t.start,t.wrap=!1,r=this.root,c=0)}return!0}_visitRowsUp(e,t){let i,s,r,n=t.start||this.root.children[0];const o=!!t.includeHidden;if(t.includeSelf!==!1&&e(n)===!1)return!1;for(;;){if(r=n.parent,i=r.children,i[0]===n){if(n=r,!n.parent)break;i=r.children}else for(s=i.indexOf(n),n=i[s-1];(o||n.expanded)&&n.children&&n.children.length;)i=n.children,r=n,n=i[i.length-1];if(!(!o&&!n.isVisible())&&e(n)===!1)return!1}return!0}load(e){return this.clear(),this.root.load(e)}enableUpdate(e){e?(v(this._disableUpdateCount>0,"enableUpdate(true) was called too often"),this._disableUpdateCount--,this._disableUpdateCount===0&&(this.logDebug(`enableUpdate(): active again. Re-painting to catch up with ${this._disableUpdateIgnoreCount} ignored update requests...`),this._disableUpdateIgnoreCount=0,this.update(m.any,{immediate:!0}))):this._disableUpdateCount++}filterNodes(e,t){return this.extensions.filter.filterNodes(e,t)}countMatches(){return this.extensions.filter.countMatches()}filterBranches(e,t){return this.extensions.filter.filterBranches(e,t)}clearFilter(){return this.extensions.filter.clearFilter()}isFilterActive(){return!!this.filterMode}updateFilter(){return this.extensions.filter.updateFilter()}}E.sequence=0;E.version="v0.11.0";E.util=rt;var ai=A("<img>"),ci=A("<pre> </pre>");function di(l,e){Ke(e,!0);let t=X(void 0);const[,i]=Array.from(/([^.]+)$/.exec(e.content.name)??[]);switch(i){case"jpg":case"jpeg":case"png":case"gif":case"svg":{H(t,U(URL.createObjectURL(e.content)));break}default:H(t,void 0)}var s=bt(),r=qe(s);ee(r,()=>S(t),n=>{var o=ai();B(()=>{Oe(o,"src",S(t)),Oe(o,"alt",e.content.name)}),T(n,o)},n=>{var o=ci(),a=V(o,!0);B(()=>Ne(a,e.content.text())),P(o),T(n,o)}),T(l,s),We()}var hi=async(l,e)=>{H(e,U(await window.showDirectoryPicker()))},ui=A("<span> </span>"),fi=A("<span>No directory selected.</span>"),pi=A('<label><button type="button">Pick Directory</button> <!></label>'),gi=A('<input id="dir" type="file" webkitdirectory multiple>'),vi=A('<dialog class="svelte-11z9r9z"><h1>Import A Directory Tree</h1> <form class="svelte-11z9r9z"><!> <label><input id="gitignore" type="checkbox" checked> <span>Respect <code>.gitignore</code>s</span></label> <button>Review Import</button></form></dialog>');function mi(l,e){let t=Me(e,"open",11,!1),i=Me(e,"dirs",31,()=>U([])),s=X(void 0);const r=async c=>{c.preventDefault();const h=c.target,d=h.elements.namedItem("dir");i(S(s)?[S(s)]:Array.from(d.files??[])),console.debug({form:h,dirs:i()})};var n=vi(),o=W(V(n),2),a=V(o);ee(a,()=>window.showDirectoryPicker,c=>{var h=pi(),d=V(h);d.__click=[hi,s];var p=W(d,2);ee(p,()=>S(s),f=>{var u=ui(),g=V(u,!0);P(u),B(()=>Ne(g,S(s).name)),T(f,u)},f=>{var u=fi();T(f,u)}),P(h),T(c,h)},c=>{var h=gi();T(c,h)}),ut(4),P(o),P(n),B(()=>n.open=t()),gt("submit",o,r),T(l,n)}je(["click"]);function yi(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Fe={};function ze(l){return Array.isArray(l)?l:[l]}const xe="",Ve=" ",me="\\",bi=/^\s+$/,wi=/(?:[^\\]|^)\\$/,_i=/^\\!/,Ei=/^\\#/,xi=/\r?\n/g,ki=/^\.*\/|^\.+$/,ye="/";let at="node-ignore";typeof Symbol<"u"&&(at=Symbol.for("node-ignore"));const He=at,Ci=(l,e,t)=>Object.defineProperty(l,e,{value:t}),Ni=/([0-z])-([0-z])/g,ct=()=>!1,Si=l=>l.replace(Ni,(e,t,i)=>t.charCodeAt(0)<=i.charCodeAt(0)?e:xe),Di=l=>{const{length:e}=l;return l.slice(0,e-e%2)},Ti=[[/^\uFEFF/,()=>xe],[/((?:\\\\)*?)(\\?\s+)$/,(l,e,t)=>e+(t.indexOf("\\")===0?Ve:xe)],[/(\\+?)\s/g,(l,e)=>{const{length:t}=e;return e.slice(0,t-t%2)+Ve}],[/[\\$.|*+(){^]/g,l=>`\\${l}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return/\/(?!$)/.test(this)?"^":"(?:^|\\/)"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(l,e,t)=>e+6<t.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(l,e,t)=>{const i=t.replace(/\\\*/g,"[^\\/]*");return e+i}],[/\\\\\\(?=[$.|*+(){^])/g,()=>me],[/\\\\/g,()=>me],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(l,e,t,i,s)=>e===me?`\\[${t}${Di(i)}${s}`:s==="]"&&i.length%2===0?`[${Si(t)}${i}]`:"[]"],[/(?:[^*])$/,l=>/\/$/.test(l)?`${l}$`:`${l}(?=$|\\/$)`],[/(\^|\\\/)?\\\*$/,(l,e)=>`${e?`${e}[^/]+`:"[^/]*"}(?=$|\\/$)`]],Ue=Object.create(null),Ii=(l,e)=>{let t=Ue[l];return t||(t=Ti.reduce((i,[s,r])=>i.replace(s,r.bind(l)),l),Ue[l]=t),e?new RegExp(t,"i"):new RegExp(t)},Le=l=>typeof l=="string",Li=l=>l&&Le(l)&&!bi.test(l)&&!wi.test(l)&&l.indexOf("#")!==0,Ai=l=>l.split(xi);class Mi{constructor(e,t,i,s){this.origin=e,this.pattern=t,this.negative=i,this.regex=s}}const Oi=(l,e)=>{const t=l;let i=!1;l.indexOf("!")===0&&(i=!0,l=l.substr(1)),l=l.replace(_i,"!").replace(Ei,"#");const s=Ii(l,e);return new Mi(t,l,i,s)},$i=(l,e)=>{throw new e(l)},K=(l,e,t)=>Le(l)?l?K.isNotRelative(l)?t(`path should be a \`path.relative()\`d string, but got "${e}"`,RangeError):!0:t("path must not be empty",TypeError):t(`path must be a string, but got \`${e}\``,TypeError),dt=l=>ki.test(l);K.isNotRelative=dt;K.convert=l=>l;class Pi{constructor({ignorecase:e=!0,ignoreCase:t=e,allowRelativePaths:i=!1}={}){Ci(this,He,!0),this._rules=[],this._ignoreCase=t,this._allowRelativePaths=i,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}_addPattern(e){if(e&&e[He]){this._rules=this._rules.concat(e._rules),this._added=!0;return}if(Li(e)){const t=Oi(e,this._ignoreCase);this._added=!0,this._rules.push(t)}}add(e){return this._added=!1,ze(Le(e)?Ai(e):e).forEach(this._addPattern,this),this._added&&this._initCache(),this}addPattern(e){return this.add(e)}_testOne(e,t){let i=!1,s=!1;return this._rules.forEach(r=>{const{negative:n}=r;if(s===n&&i!==s||n&&!i&&!s&&!t)return;r.regex.test(e)&&(i=!n,s=n)}),{ignored:i,unignored:s}}_test(e,t,i,s){const r=e&&K.convert(e);return K(r,e,this._allowRelativePaths?ct:$i),this._t(r,t,i,s)}_t(e,t,i,s){if(e in t)return t[e];if(s||(s=e.split(ye)),s.pop(),!s.length)return t[e]=this._testOne(e,i);const r=this._t(s.join(ye)+ye,t,i,s);return t[e]=r.ignored?r:this._testOne(e,i)}ignores(e){return this._test(e,this._ignoreCache,!1).ignored}createFilter(){return e=>!this.ignores(e)}filter(e){return ze(e).filter(this.createFilter())}test(e){return this._test(e,this._testCache,!0)}}const he=l=>new Pi(l),Ri=l=>K(l&&K.convert(l),l,ct);he.isPathValid=Ri;he.default=he;var Fi=he;if(typeof process<"u"&&(Fe&&Fe.IGNORE_TEST_WIN32||process.platform==="win32")){const l=t=>/^\\\\\?\\/.test(t)||/["<>|\u0000-\u001F]+/u.test(t)?t:t.replace(/\\/g,"/");K.convert=l;const e=/^[a-z]:\//i;K.isNotRelative=t=>e.test(t)||dt(t)}const zi=yi(Fi);let le=[];const Vi=({statuses:l,dirs:e})=>{if(Array.isArray(e))return Promise.all(e.map(async i=>await t(i)));if(e instanceof FileSystemDirectoryHandle)return t(e);throw new Error("Invalid Input: `dirs`");async function t(i,s=""){var o,a;try{const c=await i.getFileHandle(".gitignore");if(c){const h=zi(),d=await c.getFile();h.add((await d.text()).split(`
`)),le.push({ig:h,path:s})}}catch{}const r=`${s}${i.name}/`;l.push(`Traversing: ${r}`);const n={type:"directory",title:i.name,children:[]};for await(const c of i.values()){const h=`${r}${c.name}`;if(le.some(d=>d.ig.ignores(h))){l.push(`Ignoring: ${h}`);continue}if(c.kind==="directory"){const d=await t(c,r);(o=n.children)==null||o.push(d)}else{l.push(`Leaf: ${h}`);const d={type:"file",title:c.name,handle:c};(a=n.children)==null||a.push(d)}}return le=le.filter(c=>c.path.length>s.length),n}};let Z=X(void 0),ke=X(U([])),be=X(!1),Ce=X(U([]));ft(()=>{Vi(S(Ce)).then(l=>{new E({element:document.getElementById("fs-tree"),source:[l],activate:async e=>{e.node.data.handle?H(Z,U(await e.node.data.handle.getFile())):H(Z,void 0)}})}).finally(()=>{H(ke,U([]))})});var Hi=A('<meta name="description" content="Collaborative filesystem">'),Ui=A('<li class="svelte-t6o2a1"> </li>'),Ki=A('<ol class="svelte-t6o2a1"></ol>'),qi=(l,e)=>{H(e,!0)},Wi=A('<button class="btn btn-primary bg-green">Begin A Spider</button>'),ji=A('<div id="content" class="svelte-t6o2a1"><!></div>'),Bi=A('<h1 class="svelte-t6o2a1">Mïmis: Collaborative Filesystem</h1> <main class="flex align-center svelte-t6o2a1"><!> <!> <section id="display" class="svelte-t6o2a1"><div id="fs-tree" class="svelte-t6o2a1"></div> <!></section></main>',1);function ns(l,e){Ke(e,!0);var t=Bi();wt(c=>{var h=Hi();pt.title="Mïmis",T(c,h)});var i=W(qe(t),2),s=V(i);ee(s,()=>S(ke).length>0,c=>{var h=Ki();vt(h,21,()=>S(ke).slice(-35),mt,(d,p)=>{var f=Ui(),u=V(f,!0);P(f),B(()=>Ne(u,S(p))),T(d,f)}),P(h),T(c,h)},c=>{var h=Wi();h.__click=[qi,be],T(c,h)});var r=W(s,2);mi(r,{get open(){return S(be)},set open(c){H(be,U(c))},get dirs(){return S(Ce)},set dirs(c){H(Ce,U(c))}});var n=W(r,2),o=V(n),a=W(o,2);ee(a,()=>S(Z),c=>{var h=ji(),d=V(h);di(d,{get content(){return S(Z)}}),P(h),T(c,h)}),P(n),P(i),B(()=>yt(o,"accompanied",!S(Z))),T(l,t),We()}je(["click"]);export{ns as component,is as universal};
