var mn=Object.defineProperty;var xn=(e,n,r)=>n in e?mn(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r;var y=(e,n,r)=>xn(e,typeof n!="symbol"?n+"":n,r);var ao=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const En=["string","number","bigint","symbol"],vn=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function An(e){if(e===null)return"null";if(e===void 0)return"undefined";if(e===!0||e===!1)return"boolean";const n=typeof e;if(En.includes(n))return n;if(n==="function")return"Function";if(Array.isArray(e))return"Array";if(Tn(e))return"Buffer";const r=Nn(e);return r||"Object"}function Tn(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}function Nn(e){const n=Object.prototype.toString.call(e).slice(8,-1);if(vn.includes(n))return n}class s{constructor(n,r,t){this.major=n,this.majorEncoded=n<<5,this.name=r,this.terminal=t}toString(){return`Type[${this.major}].${this.name}`}compare(n){return this.major<n.major?-1:this.major>n.major?1:0}}s.uint=new s(0,"uint",!0);s.negint=new s(1,"negint",!0);s.bytes=new s(2,"bytes",!0);s.string=new s(3,"string",!0);s.array=new s(4,"array",!1);s.map=new s(5,"map",!1);s.tag=new s(6,"tag",!1);s.float=new s(7,"float",!0);s.false=new s(7,"false",!0);s.true=new s(7,"true",!0);s.null=new s(7,"null",!0);s.undefined=new s(7,"undefined",!0);s.break=new s(7,"break",!0);class u{constructor(n,r,t){this.type=n,this.value=r,this.encodedLength=t,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const q=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",kn=new TextDecoder,Bn=new TextEncoder;function se(e){return q&&globalThis.Buffer.isBuffer(e)}function Ye(e){return e instanceof Uint8Array?se(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const $n=q?(e,n,r)=>r-n>64?globalThis.Buffer.from(e.subarray(n,r)).toString("utf8"):Re(e,n,r):(e,n,r)=>r-n>64?kn.decode(e.subarray(n,r)):Re(e,n,r),In=q?e=>e.length>64?globalThis.Buffer.from(e):Pe(e):e=>e.length>64?Bn.encode(e):Pe(e),D=e=>Uint8Array.from(e),Be=q?(e,n,r)=>se(e)?new Uint8Array(e.subarray(n,r)):e.slice(n,r):(e,n,r)=>e.slice(n,r),Sn=q?(e,n)=>(e=e.map(r=>r instanceof Uint8Array?r:globalThis.Buffer.from(r)),Ye(globalThis.Buffer.concat(e,n))):(e,n)=>{const r=new Uint8Array(n);let t=0;for(let o of e)t+o.length>r.length&&(o=o.subarray(0,r.length-t)),r.set(o,t),t+=o.length;return r},_n=q?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function Dn(e,n){if(se(e)&&se(n))return e.compare(n);for(let r=0;r<e.length;r++)if(e[r]!==n[r])return e[r]<n[r]?-1:1;return 0}function Pe(e){const n=[];let r=0;for(let t=0;t<e.length;t++){let o=e.charCodeAt(t);o<128?n[r++]=o:o<2048?(n[r++]=o>>6|192,n[r++]=o&63|128):(o&64512)===55296&&t+1<e.length&&(e.charCodeAt(t+1)&64512)===56320?(o=65536+((o&1023)<<10)+(e.charCodeAt(++t)&1023),n[r++]=o>>18|240,n[r++]=o>>12&63|128,n[r++]=o>>6&63|128,n[r++]=o&63|128):(n[r++]=o>>12|224,n[r++]=o>>6&63|128,n[r++]=o&63|128)}return n}function Re(e,n,r){const t=[];for(;n<r;){const o=e[n];let i=null,a=o>239?4:o>223?3:o>191?2:1;if(n+a<=r){let f,l,m,w;switch(a){case 1:o<128&&(i=o);break;case 2:f=e[n+1],(f&192)===128&&(w=(o&31)<<6|f&63,w>127&&(i=w));break;case 3:f=e[n+1],l=e[n+2],(f&192)===128&&(l&192)===128&&(w=(o&15)<<12|(f&63)<<6|l&63,w>2047&&(w<55296||w>57343)&&(i=w));break;case 4:f=e[n+1],l=e[n+2],m=e[n+3],(f&192)===128&&(l&192)===128&&(m&192)===128&&(w=(o&15)<<18|(f&63)<<12|(l&63)<<6|m&63,w>65535&&w<1114112&&(i=w))}}i===null?(i=65533,a=1):i>65535&&(i-=65536,t.push(i>>>10&1023|55296),i=56320|i&1023),t.push(i),n+=a}return Un(t)}const je=4096;function Un(e){const n=e.length;if(n<=je)return String.fromCharCode.apply(String,e);let r="",t=0;for(;t<n;)r+=String.fromCharCode.apply(String,e.slice(t,t+=je));return r}const zn=256;class en{constructor(n=zn){this.chunkSize=n,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(n){let r=this.chunks[this.chunks.length-1];if(this.cursor+n.length<=this.maxCursor+1){const o=r.length-(this.maxCursor-this.cursor)-1;r.set(n,o)}else{if(r){const o=r.length-(this.maxCursor-this.cursor)-1;o<r.length&&(this.chunks[this.chunks.length-1]=r.subarray(0,o),this.maxCursor=this.cursor-1)}n.length<64&&n.length<this.chunkSize?(r=_n(this.chunkSize),this.chunks.push(r),this.maxCursor+=r.length,this._initReuseChunk===null&&(this._initReuseChunk=r),r.set(n,0)):(this.chunks.push(n),this.maxCursor+=n.length)}this.cursor+=n.length}toBytes(n=!1){let r;if(this.chunks.length===1){const t=this.chunks[0];n&&this.cursor>t.length/2?(r=this.cursor===t.length?t:t.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):r=Be(t,0,this.cursor)}else r=Sn(this.chunks,this.cursor);return n&&this.reset(),r}}const d="CBOR decode error:",nn="CBOR encode error:";function K(e,n,r){if(e.length-n<r)throw new Error(`${d} not enough data for type`)}const x=[24,256,65536,4294967296,BigInt("18446744073709551616")];function F(e,n,r){K(e,n,1);const t=e[n];if(r.strict===!0&&t<x[0])throw new Error(`${d} integer encoded in more bytes than necessary (strict decode)`);return t}function P(e,n,r){K(e,n,2);const t=e[n]<<8|e[n+1];if(r.strict===!0&&t<x[1])throw new Error(`${d} integer encoded in more bytes than necessary (strict decode)`);return t}function R(e,n,r){K(e,n,4);const t=e[n]*16777216+(e[n+1]<<16)+(e[n+2]<<8)+e[n+3];if(r.strict===!0&&t<x[2])throw new Error(`${d} integer encoded in more bytes than necessary (strict decode)`);return t}function j(e,n,r){K(e,n,8);const t=e[n]*16777216+(e[n+1]<<16)+(e[n+2]<<8)+e[n+3],o=e[n+4]*16777216+(e[n+5]<<16)+(e[n+6]<<8)+e[n+7],i=(BigInt(t)<<BigInt(32))+BigInt(o);if(r.strict===!0&&i<x[3])throw new Error(`${d} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(r.allowBigInt===!0)return i;throw new Error(`${d} integers outside of the safe integer range are not supported`)}function Cn(e,n,r,t){return new u(s.uint,F(e,n+1,t),2)}function Mn(e,n,r,t){return new u(s.uint,P(e,n+1,t),3)}function Ln(e,n,r,t){return new u(s.uint,R(e,n+1,t),5)}function On(e,n,r,t){return new u(s.uint,j(e,n+1,t),9)}function H(e,n){return A(e,0,n.value)}function A(e,n,r){if(r<x[0]){const t=Number(r);e.push([n|t])}else if(r<x[1]){const t=Number(r);e.push([n|24,t])}else if(r<x[2]){const t=Number(r);e.push([n|25,t>>>8,t&255])}else if(r<x[3]){const t=Number(r);e.push([n|26,t>>>24&255,t>>>16&255,t>>>8&255,t&255])}else{const t=BigInt(r);if(t<x[4]){const o=[n|27,0,0,0,0,0,0,0];let i=Number(t&BigInt(4294967295)),a=Number(t>>BigInt(32)&BigInt(4294967295));o[8]=i&255,i=i>>8,o[7]=i&255,i=i>>8,o[6]=i&255,i=i>>8,o[5]=i&255,o[4]=a&255,a=a>>8,o[3]=a&255,a=a>>8,o[2]=a&255,a=a>>8,o[1]=a&255,e.push(o)}else throw new Error(`${d} encountered BigInt larger than allowable range`)}}H.encodedSize=function(n){return A.encodedSize(n.value)};A.encodedSize=function(n){return n<x[0]?1:n<x[1]?2:n<x[2]?3:n<x[3]?5:9};H.compareTokens=function(n,r){return n.value<r.value?-1:n.value>r.value?1:0};function Fn(e,n,r,t){return new u(s.negint,-1-F(e,n+1,t),2)}function Pn(e,n,r,t){return new u(s.negint,-1-P(e,n+1,t),3)}function Rn(e,n,r,t){return new u(s.negint,-1-R(e,n+1,t),5)}const $e=BigInt(-1),rn=BigInt(1);function jn(e,n,r,t){const o=j(e,n+1,t);if(typeof o!="bigint"){const i=-1-o;if(i>=Number.MIN_SAFE_INTEGER)return new u(s.negint,i,9)}if(t.allowBigInt!==!0)throw new Error(`${d} integers outside of the safe integer range are not supported`);return new u(s.negint,$e-BigInt(o),9)}function Ie(e,n){const r=n.value,t=typeof r=="bigint"?r*$e-rn:r*-1-1;A(e,n.type.majorEncoded,t)}Ie.encodedSize=function(n){const r=n.value,t=typeof r=="bigint"?r*$e-rn:r*-1-1;return t<x[0]?1:t<x[1]?2:t<x[2]?3:t<x[3]?5:9};Ie.compareTokens=function(n,r){return n.value<r.value?1:n.value>r.value?-1:0};function ee(e,n,r,t){K(e,n,r+t);const o=Be(e,n+r,n+r+t);return new u(s.bytes,o,r+t)}function Hn(e,n,r,t){return ee(e,n,1,r)}function Gn(e,n,r,t){return ee(e,n,2,F(e,n+1,t))}function Vn(e,n,r,t){return ee(e,n,3,P(e,n+1,t))}function qn(e,n,r,t){return ee(e,n,5,R(e,n+1,t))}function Kn(e,n,r,t){const o=j(e,n+1,t);if(typeof o=="bigint")throw new Error(`${d} 64-bit integer bytes lengths not supported`);return ee(e,n,9,o)}function ae(e){return e.encodedBytes===void 0&&(e.encodedBytes=e.type===s.string?In(e.value):e.value),e.encodedBytes}function we(e,n){const r=ae(n);A(e,n.type.majorEncoded,r.length),e.push(r)}we.encodedSize=function(n){const r=ae(n);return A.encodedSize(r.length)+r.length};we.compareTokens=function(n,r){return Xn(ae(n),ae(r))};function Xn(e,n){return e.length<n.length?-1:e.length>n.length?1:Dn(e,n)}function ne(e,n,r,t,o){const i=r+t;K(e,n,i);const a=new u(s.string,$n(e,n+r,n+i),i);return o.retainStringBytes===!0&&(a.byteValue=Be(e,n+r,n+i)),a}function Jn(e,n,r,t){return ne(e,n,1,r,t)}function Qn(e,n,r,t){return ne(e,n,2,F(e,n+1,t),t)}function Wn(e,n,r,t){return ne(e,n,3,P(e,n+1,t),t)}function Zn(e,n,r,t){return ne(e,n,5,R(e,n+1,t),t)}function Yn(e,n,r,t){const o=j(e,n+1,t);if(typeof o=="bigint")throw new Error(`${d} 64-bit integer string lengths not supported`);return ne(e,n,9,o,t)}const er=we;function X(e,n,r,t){return new u(s.array,t,r)}function nr(e,n,r,t){return X(e,n,1,r)}function rr(e,n,r,t){return X(e,n,2,F(e,n+1,t))}function tr(e,n,r,t){return X(e,n,3,P(e,n+1,t))}function or(e,n,r,t){return X(e,n,5,R(e,n+1,t))}function ir(e,n,r,t){const o=j(e,n+1,t);if(typeof o=="bigint")throw new Error(`${d} 64-bit integer array lengths not supported`);return X(e,n,9,o)}function sr(e,n,r,t){if(t.allowIndefinite===!1)throw new Error(`${d} indefinite length items not allowed`);return X(e,n,1,1/0)}function Se(e,n){A(e,s.array.majorEncoded,n.value)}Se.compareTokens=H.compareTokens;Se.encodedSize=function(n){return A.encodedSize(n.value)};function J(e,n,r,t){return new u(s.map,t,r)}function ar(e,n,r,t){return J(e,n,1,r)}function cr(e,n,r,t){return J(e,n,2,F(e,n+1,t))}function fr(e,n,r,t){return J(e,n,3,P(e,n+1,t))}function ur(e,n,r,t){return J(e,n,5,R(e,n+1,t))}function dr(e,n,r,t){const o=j(e,n+1,t);if(typeof o=="bigint")throw new Error(`${d} 64-bit integer map lengths not supported`);return J(e,n,9,o)}function lr(e,n,r,t){if(t.allowIndefinite===!1)throw new Error(`${d} indefinite length items not allowed`);return J(e,n,1,1/0)}function _e(e,n){A(e,s.map.majorEncoded,n.value)}_e.compareTokens=H.compareTokens;_e.encodedSize=function(n){return A.encodedSize(n.value)};function hr(e,n,r,t){return new u(s.tag,r,1)}function wr(e,n,r,t){return new u(s.tag,F(e,n+1,t),2)}function pr(e,n,r,t){return new u(s.tag,P(e,n+1,t),3)}function yr(e,n,r,t){return new u(s.tag,R(e,n+1,t),5)}function gr(e,n,r,t){return new u(s.tag,j(e,n+1,t),9)}function De(e,n){A(e,s.tag.majorEncoded,n.value)}De.compareTokens=H.compareTokens;De.encodedSize=function(n){return A.encodedSize(n.value)};const mr=20,xr=21,br=22,Er=23;function vr(e,n,r,t){if(t.allowUndefined===!1)throw new Error(`${d} undefined values are not supported`);return t.coerceUndefinedToNull===!0?new u(s.null,null,1):new u(s.undefined,void 0,1)}function Ar(e,n,r,t){if(t.allowIndefinite===!1)throw new Error(`${d} indefinite length items not allowed`);return new u(s.break,void 0,1)}function Ue(e,n,r){if(r){if(r.allowNaN===!1&&Number.isNaN(e))throw new Error(`${d} NaN values are not supported`);if(r.allowInfinity===!1&&(e===1/0||e===-1/0))throw new Error(`${d} Infinity values are not supported`)}return new u(s.float,e,n)}function Tr(e,n,r,t){return Ue(Ce(e,n+1),3,t)}function Nr(e,n,r,t){return Ue(Me(e,n+1),5,t)}function kr(e,n,r,t){return Ue(an(e,n+1),9,t)}function ze(e,n,r){const t=n.value;if(t===!1)e.push([s.float.majorEncoded|mr]);else if(t===!0)e.push([s.float.majorEncoded|xr]);else if(t===null)e.push([s.float.majorEncoded|br]);else if(t===void 0)e.push([s.float.majorEncoded|Er]);else{let o,i=!1;(!r||r.float64!==!0)&&(on(t),o=Ce(k,1),t===o||Number.isNaN(t)?(k[0]=249,e.push(k.slice(0,3)),i=!0):(sn(t),o=Me(k,1),t===o&&(k[0]=250,e.push(k.slice(0,5)),i=!0))),i||(Br(t),o=an(k,1),k[0]=251,e.push(k.slice(0,9)))}}ze.encodedSize=function(n,r){const t=n.value;if(t===!1||t===!0||t===null||t===void 0)return 1;if(!r||r.float64!==!0){on(t);let o=Ce(k,1);if(t===o||Number.isNaN(t))return 3;if(sn(t),o=Me(k,1),t===o)return 5}return 9};const tn=new ArrayBuffer(9),v=new DataView(tn,1),k=new Uint8Array(tn,0);function on(e){if(e===1/0)v.setUint16(0,31744,!1);else if(e===-1/0)v.setUint16(0,64512,!1);else if(Number.isNaN(e))v.setUint16(0,32256,!1);else{v.setFloat32(0,e);const n=v.getUint32(0),r=(n&2139095040)>>23,t=n&8388607;if(r===255)v.setUint16(0,31744,!1);else if(r===0)v.setUint16(0,(e&2147483648)>>16|t>>13,!1);else{const o=r-127;o<-24?v.setUint16(0,0):o<-14?v.setUint16(0,(n&2147483648)>>16|1<<24+o,!1):v.setUint16(0,(n&2147483648)>>16|o+15<<10|t>>13,!1)}}}function Ce(e,n){if(e.length-n<2)throw new Error(`${d} not enough data for float16`);const r=(e[n]<<8)+e[n+1];if(r===31744)return 1/0;if(r===64512)return-1/0;if(r===32256)return NaN;const t=r>>10&31,o=r&1023;let i;return t===0?i=o*2**-24:t!==31?i=(o+1024)*2**(t-25):i=o===0?1/0:NaN,r&32768?-i:i}function sn(e){v.setFloat32(0,e,!1)}function Me(e,n){if(e.length-n<4)throw new Error(`${d} not enough data for float32`);const r=(e.byteOffset||0)+n;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function Br(e){v.setFloat64(0,e,!1)}function an(e,n){if(e.length-n<8)throw new Error(`${d} not enough data for float64`);const r=(e.byteOffset||0)+n;return new DataView(e.buffer,r,8).getFloat64(0,!1)}ze.compareTokens=H.compareTokens;function h(e,n,r){throw new Error(`${d} encountered invalid minor (${r}) for major ${e[n]>>>5}`)}function pe(e){return()=>{throw new Error(`${d} ${e}`)}}const c=[];for(let e=0;e<=23;e++)c[e]=h;c[24]=Cn;c[25]=Mn;c[26]=Ln;c[27]=On;c[28]=h;c[29]=h;c[30]=h;c[31]=h;for(let e=32;e<=55;e++)c[e]=h;c[56]=Fn;c[57]=Pn;c[58]=Rn;c[59]=jn;c[60]=h;c[61]=h;c[62]=h;c[63]=h;for(let e=64;e<=87;e++)c[e]=Hn;c[88]=Gn;c[89]=Vn;c[90]=qn;c[91]=Kn;c[92]=h;c[93]=h;c[94]=h;c[95]=pe("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)c[e]=Jn;c[120]=Qn;c[121]=Wn;c[122]=Zn;c[123]=Yn;c[124]=h;c[125]=h;c[126]=h;c[127]=pe("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)c[e]=nr;c[152]=rr;c[153]=tr;c[154]=or;c[155]=ir;c[156]=h;c[157]=h;c[158]=h;c[159]=sr;for(let e=160;e<=183;e++)c[e]=ar;c[184]=cr;c[185]=fr;c[186]=ur;c[187]=dr;c[188]=h;c[189]=h;c[190]=h;c[191]=lr;for(let e=192;e<=215;e++)c[e]=hr;c[216]=wr;c[217]=pr;c[218]=yr;c[219]=gr;c[220]=h;c[221]=h;c[222]=h;c[223]=h;for(let e=224;e<=243;e++)c[e]=pe("simple values are not supported");c[244]=h;c[245]=h;c[246]=h;c[247]=vr;c[248]=pe("simple values are not supported");c[249]=Tr;c[250]=Nr;c[251]=kr;c[252]=h;c[253]=h;c[254]=h;c[255]=Ar;const S=[];for(let e=0;e<24;e++)S[e]=new u(s.uint,e,1);for(let e=-1;e>=-24;e--)S[31-e]=new u(s.negint,e,1);S[64]=new u(s.bytes,new Uint8Array(0),1);S[96]=new u(s.string,"",1);S[128]=new u(s.array,0,1);S[160]=new u(s.map,0,1);S[244]=new u(s.false,!1,1);S[245]=new u(s.true,!0,1);S[246]=new u(s.null,null,1);function $r(e){switch(e.type){case s.false:return D([244]);case s.true:return D([245]);case s.null:return D([246]);case s.bytes:return e.value.length?void 0:D([64]);case s.string:return e.value===""?D([96]):void 0;case s.array:return e.value===0?D([128]):void 0;case s.map:return e.value===0?D([160]):void 0;case s.uint:return e.value<24?D([Number(e.value)]):void 0;case s.negint:if(e.value>=-24)return D([31-Number(e.value)])}}const Ir={float64:!1,mapSorter:Dr,quickEncodeToken:$r};function Sr(){const e=[];return e[s.uint.major]=H,e[s.negint.major]=Ie,e[s.bytes.major]=we,e[s.string.major]=er,e[s.array.major]=Se,e[s.map.major]=_e,e[s.tag.major]=De,e[s.float.major]=ze,e}const cn=Sr(),me=new en;class ce{constructor(n,r){this.obj=n,this.parent=r}includes(n){let r=this;do if(r.obj===n)return!0;while(r=r.parent);return!1}static createCheck(n,r){if(n&&n.includes(r))throw new Error(`${nn} object contains circular references`);return new ce(r,n)}}const C={null:new u(s.null,null),undefined:new u(s.undefined,void 0),true:new u(s.true,!0),false:new u(s.false,!1),emptyArray:new u(s.array,0),emptyMap:new u(s.map,0)},L={number(e,n,r,t){return!Number.isInteger(e)||!Number.isSafeInteger(e)?new u(s.float,e):e>=0?new u(s.uint,e):new u(s.negint,e)},bigint(e,n,r,t){return e>=BigInt(0)?new u(s.uint,e):new u(s.negint,e)},Uint8Array(e,n,r,t){return new u(s.bytes,e)},string(e,n,r,t){return new u(s.string,e)},boolean(e,n,r,t){return e?C.true:C.false},null(e,n,r,t){return C.null},undefined(e,n,r,t){return C.undefined},ArrayBuffer(e,n,r,t){return new u(s.bytes,new Uint8Array(e))},DataView(e,n,r,t){return new u(s.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength))},Array(e,n,r,t){if(!e.length)return r.addBreakTokens===!0?[C.emptyArray,new u(s.break)]:C.emptyArray;t=ce.createCheck(t,e);const o=[];let i=0;for(const a of e)o[i++]=oe(a,r,t);return r.addBreakTokens?[new u(s.array,e.length),o,new u(s.break)]:[new u(s.array,e.length),o]},Object(e,n,r,t){const o=n!=="Object",i=o?e.keys():Object.keys(e),a=o?e.size:i.length;if(!a)return r.addBreakTokens===!0?[C.emptyMap,new u(s.break)]:C.emptyMap;t=ce.createCheck(t,e);const f=[];let l=0;for(const m of i)f[l++]=[oe(m,r,t),oe(o?e.get(m):e[m],r,t)];return _r(f,r),r.addBreakTokens?[new u(s.map,a),f,new u(s.break)]:[new u(s.map,a),f]}};L.Map=L.Object;L.Buffer=L.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))L[`${e}Array`]=L.DataView;function oe(e,n={},r){const t=An(e),o=n&&n.typeEncoders&&n.typeEncoders[t]||L[t];if(typeof o=="function"){const a=o(e,t,n,r);if(a!=null)return a}const i=L[t];if(!i)throw new Error(`${nn} unsupported type: ${t}`);return i(e,t,n,r)}function _r(e,n){n.mapSorter&&e.sort(n.mapSorter)}function Dr(e,n){const r=Array.isArray(e[0])?e[0][0]:e[0],t=Array.isArray(n[0])?n[0][0]:n[0];if(r.type!==t.type)return r.type.compare(t.type);const o=r.type.major,i=cn[o].compareTokens(r,t);return i===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function fn(e,n,r,t){if(Array.isArray(n))for(const o of n)fn(e,o,r,t);else r[n.type.major](e,n,t)}function Ur(e,n,r){const t=oe(e,r);if(!Array.isArray(t)&&r.quickEncodeToken){const o=r.quickEncodeToken(t);if(o)return o;const i=n[t.type.major];if(i.encodedSize){const a=i.encodedSize(t,r),f=new en(a);if(i(f,t,r),f.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${t} was wrong`);return Ye(f.chunks[0])}}return me.reset(),fn(me,t,n,r),me.toBytes(!0)}function zr(e,n){return n=Object.assign({},Ir,n),Ur(e,cn,n)}const Cr={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Mr{constructor(n,r={}){this._pos=0,this.data=n,this.options=r}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const n=this.data[this._pos];let r=S[n];if(r===void 0){const t=c[n];if(!t)throw new Error(`${d} no decoder for major type ${n>>>5} (byte 0x${n.toString(16).padStart(2,"0")})`);const o=n&31;r=t(this.data,this._pos,o,this.options)}return this._pos+=r.encodedLength,r}}const Z=Symbol.for("DONE"),ye=Symbol.for("BREAK");function Lr(e,n,r){const t=[];for(let o=0;o<e.value;o++){const i=Y(n,r);if(i===ye){if(e.value===1/0)break;throw new Error(`${d} got unexpected break to lengthed array`)}if(i===Z)throw new Error(`${d} found array but not enough entries (got ${o}, expected ${e.value})`);t[o]=i}return t}function Or(e,n,r){const t=r.useMaps===!0,o=t?void 0:{},i=t?new Map:void 0;for(let a=0;a<e.value;a++){const f=Y(n,r);if(f===ye){if(e.value===1/0)break;throw new Error(`${d} got unexpected break to lengthed map`)}if(f===Z)throw new Error(`${d} found map but not enough entries (got ${a} [no key], expected ${e.value})`);if(t!==!0&&typeof f!="string")throw new Error(`${d} non-string keys not supported (got ${typeof f})`);if(r.rejectDuplicateMapKeys===!0&&(t&&i.has(f)||!t&&f in o))throw new Error(`${d} found repeat map key "${f}"`);const l=Y(n,r);if(l===Z)throw new Error(`${d} found map but not enough entries (got ${a} [no value], expected ${e.value})`);t?i.set(f,l):o[f]=l}return t?i:o}function Y(e,n){if(e.done())return Z;const r=e.next();if(r.type===s.break)return ye;if(r.type.terminal)return r.value;if(r.type===s.array)return Lr(r,e,n);if(r.type===s.map)return Or(r,e,n);if(r.type===s.tag){if(n.tags&&typeof n.tags[r.value]=="function"){const t=Y(e,n);return n.tags[r.value](t)}throw new Error(`${d} tag not supported (${r.value})`)}throw new Error("unsupported")}function Fr(e,n){if(!(e instanceof Uint8Array))throw new Error(`${d} data to decode must be a Uint8Array`);n=Object.assign({},Cr,n);const r=n.tokenizer||new Mr(e,n),t=Y(r,n);if(t===Z)throw new Error(`${d} did not find any content to decode`);if(t===ye)throw new Error(`${d} got unexpected break`);return[t,e.subarray(r.pos())]}function Pr(e,n){const[r,t]=Fr(e,n);if(t.length>0)throw new Error(`${d} too many terminals, data makes no sense`);return r}const Rr=new Uint8Array(0);function co(e){const n=e.match(/../g);return n!=null?new Uint8Array(n.map(r=>parseInt(r,16))):Rr}function jr(e,n){if(e===n)return!0;if(e.byteLength!==n.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==n[r])return!1;return!0}function Le(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function Hr(e,n){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),t=0;t<r.length;t++)r[t]=255;for(var o=0;o<e.length;o++){var i=e.charAt(o),a=i.charCodeAt(0);if(r[a]!==255)throw new TypeError(i+" is ambiguous");r[a]=o}var f=e.length,l=e.charAt(0),m=Math.log(f)/Math.log(256),w=Math.log(256)/Math.log(f);function G(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var b=0,O=0,T=0,B=p.length;T!==B&&p[T]===0;)T++,b++;for(var $=(B-T)*w+1>>>0,E=new Uint8Array($);T!==B;){for(var I=p[T],z=0,N=$-1;(I!==0||z<O)&&N!==-1;N--,z++)I+=256*E[N]>>>0,E[N]=I%f>>>0,I=I/f>>>0;if(I!==0)throw new Error("Non-zero carry");O=z,T++}for(var _=$-O;_!==$&&E[_]===0;)_++;for(var te=l.repeat(b);_<$;++_)te+=e.charAt(E[_]);return te}function re(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var b=0;if(p[b]!==" "){for(var O=0,T=0;p[b]===l;)O++,b++;for(var B=(p.length-b)*m+1>>>0,$=new Uint8Array(B);p[b];){var E=r[p.charCodeAt(b)];if(E===255)return;for(var I=0,z=B-1;(E!==0||I<T)&&z!==-1;z--,I++)E+=f*$[z]>>>0,$[z]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");T=I,b++}if(p[b]!==" "){for(var N=B-T;N!==B&&$[N]===0;)N++;for(var _=new Uint8Array(O+(B-N)),te=O;N!==B;)_[te++]=$[N++];return _}}}function gn(p){var b=re(p);if(b)return b;throw new Error(`Non-${n} character`)}return{encode:G,decodeUnsafe:re,decode:gn}}var Gr=Hr,Vr=Gr;class qr{constructor(n,r,t){y(this,"name");y(this,"prefix");y(this,"baseEncode");this.name=n,this.prefix=r,this.baseEncode=t}encode(n){if(n instanceof Uint8Array)return`${this.prefix}${this.baseEncode(n)}`;throw Error("Unknown type, must be binary type")}}class Kr{constructor(n,r,t){y(this,"name");y(this,"prefix");y(this,"baseDecode");y(this,"prefixCodePoint");this.name=n,this.prefix=r;const o=r.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=t}decode(n){if(typeof n=="string"){if(n.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(n)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(n.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(n){return un(this,n)}}class Xr{constructor(n){y(this,"decoders");this.decoders=n}or(n){return un(this,n)}decode(n){const r=n[0],t=this.decoders[r];if(t!=null)return t.decode(n);throw RangeError(`Unable to decode multibase string ${JSON.stringify(n)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function un(e,n){return new Xr({...e.decoders??{[e.prefix]:e},...n.decoders??{[n.prefix]:n}})}class Jr{constructor(n,r,t,o){y(this,"name");y(this,"prefix");y(this,"baseEncode");y(this,"baseDecode");y(this,"encoder");y(this,"decoder");this.name=n,this.prefix=r,this.baseEncode=t,this.baseDecode=o,this.encoder=new qr(n,r,t),this.decoder=new Kr(n,r,o)}encode(n){return this.encoder.encode(n)}decode(n){return this.decoder.decode(n)}}function dn({name:e,prefix:n,encode:r,decode:t}){return new Jr(e,n,r,t)}function ge({name:e,prefix:n,alphabet:r}){const{encode:t,decode:o}=Vr(r,e);return dn({prefix:n,name:e,encode:t,decode:i=>Le(o(i))})}function Qr(e,n,r,t){const o={};for(let w=0;w<n.length;++w)o[n[w]]=w;let i=e.length;for(;e[i-1]==="=";)--i;const a=new Uint8Array(i*r/8|0);let f=0,l=0,m=0;for(let w=0;w<i;++w){const G=o[e[w]];if(G===void 0)throw new SyntaxError(`Non-${t} character`);l=l<<r|G,f+=r,f>=8&&(f-=8,a[m++]=255&l>>f)}if(f>=r||255&l<<8-f)throw new SyntaxError("Unexpected end of data");return a}function Wr(e,n,r){const t=n[n.length-1]==="=",o=(1<<r)-1;let i="",a=0,f=0;for(let l=0;l<e.length;++l)for(f=f<<8|e[l],a+=8;a>r;)a-=r,i+=n[o&f>>a];if(a!==0&&(i+=n[o&f<<r-a]),t)for(;i.length*r&7;)i+="=";return i}function U({name:e,prefix:n,bitsPerChar:r,alphabet:t}){return dn({prefix:n,name:e,encode(o){return Wr(o,t,r)},decode(o){return Qr(o,t,r,e)}})}const ie=U({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});U({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});U({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});U({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});U({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});U({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});U({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});U({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});U({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const xe=ge({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});ge({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const M=ge({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});ge({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Zr=ln,He=128,Yr=127,et=~Yr,nt=Math.pow(2,31);function ln(e,n,r){n=n||[],r=r||0;for(var t=r;e>=nt;)n[r++]=e&255|He,e/=128;for(;e&et;)n[r++]=e&255|He,e>>>=7;return n[r]=e|0,ln.bytes=r-t+1,n}var rt=be,tt=128,Ge=127;function be(e,t){var r=0,t=t||0,o=0,i=t,a,f=e.length;do{if(i>=f)throw be.bytes=0,new RangeError("Could not decode varint");a=e[i++],r+=o<28?(a&Ge)<<o:(a&Ge)*Math.pow(2,o),o+=7}while(a>=tt);return be.bytes=i-t,r}var ot=Math.pow(2,7),it=Math.pow(2,14),st=Math.pow(2,21),at=Math.pow(2,28),ct=Math.pow(2,35),ft=Math.pow(2,42),ut=Math.pow(2,49),dt=Math.pow(2,56),lt=Math.pow(2,63),ht=function(e){return e<ot?1:e<it?2:e<st?3:e<at?4:e<ct?5:e<ft?6:e<ut?7:e<dt?8:e<lt?9:10},wt={encode:Zr,decode:rt,encodingLength:ht},fe=wt;function Ee(e,n=0){return[fe.decode(e,n),fe.decode.bytes]}function ue(e,n,r=0){return fe.encode(e,n,r),n}function de(e){return fe.encodingLength(e)}function pt(e,n){const r=n.byteLength,t=de(e),o=t+de(r),i=new Uint8Array(o+r);return ue(e,i,0),ue(r,i,t),i.set(n,o),new Oe(e,r,n,i)}function yt(e){const n=Le(e),[r,t]=Ee(n),[o,i]=Ee(n.subarray(t)),a=n.subarray(t+i);if(a.byteLength!==o)throw new Error("Incorrect length");return new Oe(r,o,a,n)}function gt(e,n){if(e===n)return!0;{const r=n;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&jr(e.bytes,r.bytes)}}class Oe{constructor(n,r,t,o){y(this,"code");y(this,"size");y(this,"digest");y(this,"bytes");this.code=n,this.size=r,this.digest=t,this.bytes=o}}function Ve(e,n){const{bytes:r,version:t}=e;switch(t){case 0:return xt(r,ve(e),n??M.encoder);default:return bt(r,ve(e),n??ie.encoder)}}const qe=new WeakMap;function ve(e){const n=qe.get(e);if(n==null){const r=new Map;return qe.set(e,r),r}return n}var Ze;class g{constructor(n,r,t,o){y(this,"code");y(this,"version");y(this,"multihash");y(this,"bytes");y(this,"/");y(this,Ze,"CID");this.code=r,this.version=n,this.multihash=t,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:n,multihash:r}=this;if(n!==Q)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==Et)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return g.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:n,digest:r}=this.multihash,t=pt(n,r);return g.createV1(this.code,t)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(n){return g.equals(this,n)}static equals(n,r){const t=r;return t!=null&&n.code===t.code&&n.version===t.version&&gt(n.multihash,t.multihash)}toString(n){return Ve(this,n)}toJSON(){return{"/":Ve(this)}}link(){return this}[(Ze=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(n){if(n==null)return null;const r=n;if(r instanceof g)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){const{version:t,code:o,multihash:i,bytes:a}=r;return new g(t,o,i,a??Ke(t,o,i.bytes))}else if(r[vt]===!0){const{version:t,multihash:o,code:i}=r,a=yt(o);return g.create(t,i,a)}else return null}static create(n,r,t){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(t.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(n){case 0:{if(r!==Q)throw new Error(`Version 0 CID must use dag-pb (code: ${Q}) block encoding`);return new g(n,r,t,t.bytes)}case 1:{const o=Ke(n,r,t.bytes);return new g(n,r,t,o)}default:throw new Error("Invalid version")}}static createV0(n){return g.create(0,Q,n)}static createV1(n,r){return g.create(1,n,r)}static decode(n){const[r,t]=g.decodeFirst(n);if(t.length!==0)throw new Error("Incorrect length");return r}static decodeFirst(n){const r=g.inspectBytes(n),t=r.size-r.multihashSize,o=Le(n.subarray(t,t+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");const i=o.subarray(r.multihashSize-r.digestSize),a=new Oe(r.multihashCode,r.digestSize,i,o);return[r.version===0?g.createV0(a):g.createV1(r.codec,a),n.subarray(r.size)]}static inspectBytes(n){let r=0;const t=()=>{const[G,re]=Ee(n.subarray(r));return r+=re,G};let o=t(),i=Q;if(o===18?(o=0,r=0):i=t(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);const a=r,f=t(),l=t(),m=r+l,w=m-a;return{version:o,codec:i,multihashCode:f,digestSize:l,multihashSize:w,size:m}}static parse(n,r){const[t,o]=mt(n,r),i=g.decode(o);if(i.version===0&&n[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return ve(i).set(t,n),i}}function mt(e,n){switch(e[0]){case"Q":{const r=n??M;return[M.prefix,r.decode(`${M.prefix}${e}`)]}case M.prefix:{const r=n??M;return[M.prefix,r.decode(e)]}case ie.prefix:{const r=n??ie;return[ie.prefix,r.decode(e)]}case xe.prefix:{const r=n??xe;return[xe.prefix,r.decode(e)]}default:{if(n==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],n.decode(e)]}}}function xt(e,n,r){const{prefix:t}=r;if(t!==M.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const o=n.get(t);if(o==null){const i=r.encode(e).slice(1);return n.set(t,i),i}else return o}function bt(e,n,r){const{prefix:t}=r,o=n.get(t);if(o==null){const i=r.encode(e);return n.set(t,i),i}else return o}const Q=112,Et=18;function Ke(e,n,r){const t=de(e),o=t+de(n),i=new Uint8Array(o+r.byteLength);return ue(e,i,0),ue(n,i,t),i.set(r,o),i}const vt=Symbol.for("@ipld/js-cid/CID"),hn=42;function At(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}function Tt(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;const n=g.asCID(e);if(!n)return null;const r=new Uint8Array(n.bytes.byteLength+1);return r.set(n.bytes,1),[new u(s.tag,hn),new u(s.bytes,r)]}function Nt(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function kt(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const Ae={float64:!0,typeEncoders:{Object:Tt,undefined:Nt,number:kt}};({...Ae,typeEncoders:{...Ae.typeEncoders}});function Bt(e){if(e[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return g.decode(e.subarray(1))}const le={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};le.tags[hn]=Bt;({...le,tags:le.tags.slice()});const fo=e=>zr(e,Ae),uo=e=>Pr(At(e),le);var $t=Te,Xe=128,It=127,St=~It,_t=Math.pow(2,31);function Te(e,n,r){if(Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw Te.bytes=0,new RangeError("Could not encode varint");n=n||[],r=r||0;for(var t=r;e>=_t;)n[r++]=e&255|Xe,e/=128;for(;e&St;)n[r++]=e&255|Xe,e>>>=7;return n[r]=e|0,Te.bytes=r-t+1,n}var Dt=Ne,Ut=128,Je=127;function Ne(e,t){var r=0,t=t||0,o=0,i=t,a,f=e.length;do{if(i>=f||o>49)throw Ne.bytes=0,new RangeError("Could not decode varint");a=e[i++],r+=o<28?(a&Je)<<o:(a&Je)*Math.pow(2,o),o+=7}while(a>=Ut);return Ne.bytes=i-t,r}var zt=Math.pow(2,7),Ct=Math.pow(2,14),Mt=Math.pow(2,21),Lt=Math.pow(2,28),Ot=Math.pow(2,35),Ft=Math.pow(2,42),Pt=Math.pow(2,49),Rt=Math.pow(2,56),jt=Math.pow(2,63),Ht=function(e){return e<zt?1:e<Ct?2:e<Mt?3:e<Lt?4:e<Ot?5:e<Ft?6:e<Pt?7:e<Rt?8:e<jt?9:10},Gt={encode:$t,decode:Dt,encodingLength:Ht};const lo=bn(Gt),Vt=new TextDecoder;function Fe(e,n){let r=0;for(let t=0;;t+=7){if(t>=64)throw new Error("protobuf: varint overflow");if(n>=e.length)throw new Error("protobuf: unexpected end of data");const o=e[n++];if(r+=t<28?(o&127)<<t:(o&127)*2**t,o<128)break}return[r,n]}function he(e,n){let r;[r,n]=Fe(e,n);const t=n+r;if(r<0||t<0)throw new Error("protobuf: invalid length");if(t>e.length)throw new Error("protobuf: unexpected end of data");return[e.subarray(n,t),t]}function wn(e,n){let r;return[r,n]=Fe(e,n),[r&7,r>>3,n]}function qt(e){const n={},r=e.length;let t=0;for(;t<r;){let o,i;if([o,i,t]=wn(e,t),i===1){if(n.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(o!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Hash`);if(n.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(n.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[n.Hash,t]=he(e,t)}else if(i===2){if(n.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(o!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Name`);if(n.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let a;[a,t]=he(e,t),n.Name=Vt.decode(a)}else if(i===3){if(n.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(o!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Tsize`);[n.Tsize,t]=Fe(e,t)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`)}if(t>r)throw new Error("protobuf: (PBLink) unexpected end of data");return n}function Kt(e){const n=e.length;let r=0,t,o=!1,i;for(;r<n;){let f,l;if([f,l,r]=wn(e,r),f!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${f}`);if(l===1){if(i)throw new Error("protobuf: (PBNode) duplicate Data section");[i,r]=he(e,r),t&&(o=!0)}else if(l===2){if(o)throw new Error("protobuf: (PBNode) duplicate Links section");t||(t=[]);let m;[m,r]=he(e,r),t.push(qt(m))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${l}`)}if(r>n)throw new Error("protobuf: (PBNode) unexpected end of data");const a={};return i&&(a.Data=i),a.Links=t||[],a}const pn=new TextEncoder,Qe=2**32,Xt=2**31;function Jt(e,n){let r=n.length;if(typeof e.Tsize=="number"){if(e.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(e.Tsize))throw new Error("Tsize too large for encoding");r=W(n,r,e.Tsize)-1,n[r]=24}if(typeof e.Name=="string"){const t=pn.encode(e.Name);r-=t.length,n.set(t,r),r=W(n,r,t.length)-1,n[r]=18}return e.Hash&&(r-=e.Hash.length,n.set(e.Hash,r),r=W(n,r,e.Hash.length)-1,n[r]=10),n.length-r}function Qt(e){const n=Zt(e),r=new Uint8Array(n);let t=n;if(e.Data&&(t-=e.Data.length,r.set(e.Data,t),t=W(r,t,e.Data.length)-1,r[t]=10),e.Links)for(let o=e.Links.length-1;o>=0;o--){const i=Jt(e.Links[o],r.subarray(0,t));t-=i,t=W(r,t,i)-1,r[t]=18}return r}function Wt(e){let n=0;if(e.Hash){const r=e.Hash.length;n+=1+r+V(r)}if(typeof e.Name=="string"){const r=pn.encode(e.Name).length;n+=1+r+V(r)}return typeof e.Tsize=="number"&&(n+=1+V(e.Tsize)),n}function Zt(e){let n=0;if(e.Data){const r=e.Data.length;n+=1+r+V(r)}if(e.Links)for(const r of e.Links){const t=Wt(r);n+=1+t+V(t)}return n}function W(e,n,r){n-=V(r);const t=n;for(;r>=Xt;)e[n++]=r&127|128,r/=128;for(;r>=128;)e[n++]=r&127|128,r>>>=7;return e[n]=r,t}function V(e){return e%2===0&&e++,Math.floor((Yt(e)+6)/7)}function Yt(e){let n=0;return e>=Qe&&(e=Math.floor(e/Qe),n=32),e>=65536&&(e>>>=16,n+=16),e>=256&&(e>>>=8,n+=8),n+eo[e]}const eo=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],no=["Data","Links"],ro=["Hash","Name","Tsize"],ke=new TextEncoder;function yn(e,n){if(e===n)return 0;const r=e.Name?ke.encode(e.Name):[],t=n.Name?ke.encode(n.Name):[];let o=r.length,i=t.length;for(let a=0,f=Math.min(o,i);a<f;++a)if(r[a]!==t[a]){o=r[a],i=t[a];break}return o<i?-1:i<o?1:0}function We(e,n){return!Object.keys(e).some(r=>!n.includes(r))}function to(e){if(typeof e.asCID=="object"){const r=g.asCID(e);if(!r)throw new TypeError("Invalid DAG-PB form");return{Hash:r}}if(typeof e!="object"||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");const n={};if(e.Hash){let r=g.asCID(e.Hash);try{r||(typeof e.Hash=="string"?r=g.parse(e.Hash):e.Hash instanceof Uint8Array&&(r=g.decode(e.Hash)))}catch(t){throw new TypeError(`Invalid DAG-PB form: ${t.message}`)}r&&(n.Hash=r)}if(!n.Hash)throw new TypeError("Invalid DAG-PB form");return typeof e.Name=="string"&&(n.Name=e.Name),typeof e.Tsize=="number"&&(n.Tsize=e.Tsize),n}function ho(e){if((e instanceof Uint8Array||typeof e=="string")&&(e={Data:e}),typeof e!="object"||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");const n={};if(e.Data!==void 0)if(typeof e.Data=="string")n.Data=ke.encode(e.Data);else if(e.Data instanceof Uint8Array)n.Data=e.Data;else throw new TypeError("Invalid DAG-PB form");if(e.Links!==void 0)if(Array.isArray(e.Links))n.Links=e.Links.map(to),n.Links.sort(yn);else throw new TypeError("Invalid DAG-PB form");else n.Links=[];return n}function oo(e){if(!e||typeof e!="object"||Array.isArray(e)||e instanceof Uint8Array||e["/"]&&e["/"]===e.bytes)throw new TypeError("Invalid DAG-PB form");if(!We(e,no))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(e.Data!==void 0&&!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let n=0;n<e.Links.length;n++){const r=e.Links[n];if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!We(r,ro))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(r.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(r.Hash==null||!r.Hash["/"]||r.Hash["/"]!==r.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(r.Name!==void 0&&typeof r.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(r.Tsize!==void 0){if(typeof r.Tsize!="number"||r.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(r.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(n>0&&yn(r,e.Links[n-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function io(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}const wo=112;function po(e){oo(e);const n={};return e.Links&&(n.Links=e.Links.map(r=>{const t={};return r.Hash&&(t.Hash=r.Hash.bytes),r.Name!==void 0&&(t.Name=r.Name),r.Tsize!==void 0&&(t.Tsize=r.Tsize),t})),e.Data&&(n.Data=e.Data),Qt(n)}function yo(e){const n=io(e),r=Kt(n),t={};return r.Data&&(t.Data=r.Data),r.Links&&(t.Links=r.Links.map(o=>{const i={};try{i.Hash=g.decode(o.Hash)}catch{}if(!i.Hash)throw new Error("Invalid Hash field found in link, expected CID");return o.Name!==void 0&&(i.Name=o.Name),o.Tsize!==void 0&&(i.Tsize=o.Tsize),i})),t}export{g as C,wo as a,pt as b,ao as c,yo as d,po as e,co as f,bn as g,Le as h,fo as i,uo as j,yt as k,Sr as m,ho as p,lo as v};
