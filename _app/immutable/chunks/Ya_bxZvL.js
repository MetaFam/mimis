import{Y as b,Z as k,_ as x,$ as T,a0 as D,a1 as F,a2 as E,a3 as G,a4 as w,a5 as I,a6 as R,a7 as _,a8 as j,a9 as m,aa as C,ab as y,ac as L,ad as M,ae as v,af as H,ag as U,ah as B,ai as A,aj as z}from"./Dw6aEOe4.js";function J(a){const{abi:n,data:e}=a,s=b(e,0,4),t=n.find(o=>o.type==="function"&&s===k(x(o)));if(!t)throw new T(s,{docsPath:"/docs/contract/decodeFunctionData"});return{functionName:t.name,args:"inputs"in t&&t.inputs&&t.inputs.length>0?D(t.inputs,b(e,4)):void 0}}const p="/docs/contract/encodeErrorResult";function O(a){const{abi:n,errorName:e,args:s}=a;let t=n[0];if(e){const u=F({abi:n,args:s,name:e});if(!u)throw new E(e,{docsPath:p});t=u}if(t.type!=="error")throw new E(void 0,{docsPath:p});const o=x(t),r=k(o);let c="0x";if(s&&s.length>0){if(!t.inputs)throw new G(t.name,{docsPath:p});c=w(t.inputs,s)}return I([r,c])}const h="/docs/contract/encodeFunctionResult";function W(a){const{abi:n,functionName:e,result:s}=a;let t=n[0];if(e){const r=F({abi:n,name:e});if(!r)throw new R(e,{docsPath:h});t=r}if(t.type!=="function")throw new R(void 0,{docsPath:h});if(!t.outputs)throw new _(t.name,{docsPath:h});const o=(()=>{if(t.outputs.length===0)return[];if(t.outputs.length===1)return[s];if(Array.isArray(s))return s;throw new j(s)})();return w(t.outputs,o)}const P="x-batch-gateway:true";async function S(a){const{data:n,ccipRequest:e}=a,{args:[s]}=J({abi:m,data:n}),t=[],o=[];return await Promise.all(s.map(async(r,c)=>{try{o[c]=r.urls.includes(P)?await S({data:r.data,ccipRequest:e}):await e(r),t[c]=!1}catch(u){t[c]=!0,o[c]=Y(u)}})),W({abi:m,functionName:"query",result:[t,o]})}function Y(a){return a.name==="HttpRequestError"&&a.status?O({abi:m,errorName:"HttpError",args:[a.status,a.shortMessage]}):O({abi:[C],errorName:"Error",args:["shortMessage"in a?a.shortMessage:a.message]})}class Z extends y{constructor({callbackSelector:n,cause:e,data:s,extraData:t,sender:o,urls:r}){var c;super(e.shortMessage||"An error occurred while fetching for an offchain result.",{cause:e,metaMessages:[...e.metaMessages||[],(c=e.metaMessages)!=null&&c.length?"":[],"Offchain Gateway Call:",r&&["  Gateway URL(s):",...r.map(u=>`    ${L(u)}`)],`  Sender: ${o}`,`  Data: ${s}`,`  Callback selector: ${n}`,`  Extra data: ${t}`].flat(),name:"OffchainLookupError"})}}class K extends y{constructor({result:n,url:e}){super("Offchain gateway response is malformed. Response data must be a hex value.",{metaMessages:[`Gateway URL: ${L(e)}`,`Response: ${M(n)}`],name:"OffchainLookupResponseMalformedError"})}}class Q extends y{constructor({sender:n,to:e}){super("Reverted sender address does not match target contract address (`to`).",{metaMessages:[`Contract address: ${e}`,`OffchainLookup sender address: ${n}`],name:"OffchainLookupSenderMismatchError"})}}const V="0x556f1830",N={name:"OffchainLookup",type:"error",inputs:[{name:"sender",type:"address"},{name:"urls",type:"string[]"},{name:"callData",type:"bytes"},{name:"callbackFunction",type:"bytes4"},{name:"extraData",type:"bytes"}]};async function X(a,{blockNumber:n,blockTag:e,data:s,to:t}){const{args:o}=v({data:s,abi:[N]}),[r,c,u,f,d]=o,{ccipRead:i}=a,g=i&&typeof(i==null?void 0:i.request)=="function"?i.request:$;try{if(!H(t,r))throw new Q({sender:r,to:t});const l=c.includes(P)?await S({data:u,ccipRequest:g}):await g({data:u,sender:r,urls:c}),{data:q}=await U(a,{blockNumber:n,blockTag:e,data:B([f,w([{type:"bytes"},{type:"bytes"}],[l,d])]),to:t});return q}catch(l){throw new Z({callbackSelector:f,cause:l,data:s,extraData:d,sender:r,urls:c})}}async function $({data:a,sender:n,urls:e}){var t;let s=new Error("An unknown error occurred.");for(let o=0;o<e.length;o++){const r=e[o],c=r.includes("{data}")?"GET":"POST",u=c==="POST"?{data:a,sender:n}:void 0,f=c==="POST"?{"Content-Type":"application/json"}:{};try{const d=await fetch(r.replace("{sender}",n.toLowerCase()).replace("{data}",a),{body:JSON.stringify(u),headers:f,method:c});let i;if((t=d.headers.get("Content-Type"))!=null&&t.startsWith("application/json")?i=(await d.json()).data:i=await d.text(),!d.ok){s=new A({body:u,details:i!=null&&i.error?M(i.error):d.statusText,headers:d.headers,status:d.status,url:r});continue}if(!z(i)){s=new K({result:i,url:r});continue}return i}catch(d){s=new A({body:u,details:d.message,url:r})}}throw s}const et=Object.freeze(Object.defineProperty({__proto__:null,ccipRequest:$,offchainLookup:X,offchainLookupAbiItem:N,offchainLookupSignature:V},Symbol.toStringTag,{value:"Module"}));export{W as a,N as b,$ as c,J as d,O as e,V as f,et as g,P as l,X as o};
