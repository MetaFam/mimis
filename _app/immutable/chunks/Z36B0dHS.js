import{C as l,m as z,q as W,d as G,a as U,e as F}from"./C6yTcgQs.js";import{g as J}from"./CE1G-McA.js";import{v as d}from"./2Ml8XYcV.js";const f=[];for(let e=0;e<256;++e)f.push((e+256).toString(16).slice(1));function K(e,n=0){return(f[e[n+0]]+f[e[n+1]]+f[e[n+2]]+f[e[n+3]]+"-"+f[e[n+4]]+f[e[n+5]]+"-"+f[e[n+6]]+f[e[n+7]]+"-"+f[e[n+8]]+f[e[n+9]]+"-"+f[e[n+10]]+f[e[n+11]]+f[e[n+12]]+f[e[n+13]]+f[e[n+14]]+f[e[n+15]]).toLowerCase()}let x;const Q=new Uint8Array(16);function Y(){if(!x){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");x=crypto.getRandomValues.bind(crypto)}return x(Q)}const C={};function Ie(e,n,t){let r;{const i=Date.now(),o=Y();X(C,i,o),r=Z(o,C.msecs,C.seq,n,t)}return n??K(r)}function X(e,n,t){return e.msecs??=-1/0,e.seq??=0,n>e.msecs?(e.seq=t[6]<<23|t[7]<<16|t[8]<<8|t[9],e.msecs=n):(e.seq=e.seq+1|0,e.seq===0&&e.msecs++),e}function Z(e,n,t,r,i=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(!r)r=new Uint8Array(16),i=0;else if(i<0||i+16>r.length)throw new RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`);return n??=Date.now(),t??=e[6]*127<<24|e[7]<<16|e[8]<<8|e[9],r[i++]=n/1099511627776&255,r[i++]=n/4294967296&255,r[i++]=n/16777216&255,r[i++]=n/65536&255,r[i++]=n/256&255,r[i++]=n&255,r[i++]=112|t>>>28&15,r[i++]=t>>>20&255,r[i++]=128|t>>>14&63,r[i++]=t>>>6&255,r[i++]=t<<2&255|e[10]&3,r[i++]=e[11],r[i++]=e[12],r[i++]=e[13],r[i++]=e[14],r[i++]=e[15],r}function w({enumerable:e=!0,configurable:n=!1}={}){return{enumerable:e,configurable:n,writable:!1}}function*j(e,n){if(n!=null&&typeof n=="object")if(Array.isArray(n))for(const[t,r]of n.entries()){const i=[...e,t],o=l.asCID(r);o!=null?yield[i.join("/"),o]:typeof r=="object"&&(yield*A(r,i))}else{const t=l.asCID(n);t!=null?yield[e.join("/"),t]:yield*A(n,e)}}function*A(e,n){if(e==null||e instanceof Uint8Array)return;const t=l.asCID(e);t!=null&&(yield[n.join("/"),t]);for(const[r,i]of Object.entries(e)){const o=[...n,r];yield*j(o,i)}}function*ee(e,n){if(Array.isArray(n))for(const[t,r]of n.entries()){const i=[...e,t];yield i.join("/"),typeof r=="object"&&l.asCID(r)==null&&(yield*V(r,i))}else yield*V(n,e)}function*V(e,n){if(!(e==null||typeof e!="object"))for(const[t,r]of Object.entries(e)){const i=[...n,t];yield i.join("/"),r!=null&&!(r instanceof Uint8Array)&&typeof r=="object"&&l.asCID(r)==null&&(yield*ee(i,r))}}function te(e,n){let t=e;for(const[r,i]of n.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${n.slice(0,r+1).map(a=>`[${JSON.stringify(a)}]`).join("")}`);const o=l.asCID(t);if(o!=null)return{value:o,remaining:n.slice(r+1).join("/")}}return{value:t}}class ne{cid;bytes;value;asBlock;constructor({cid:n,bytes:t,value:r}){if(n==null||t==null||typeof r>"u")throw new Error("Missing required argument");this.cid=n,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:w(),bytes:w(),value:w(),asBlock:w()})}links(){return A(this.value,[])}tree(){return V(this.value,[])}get(n="/"){return te(this.value,n.split("/").filter(Boolean))}}function ke({bytes:e,cid:n,value:t,codec:r}){const i=t!==void 0?t:r?.decode(e);if(i===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new ne({cid:n,bytes:e,value:i})}function Ae(){const e={};return e.promise=new Promise((n,t)=>{e.resolve=n,e.reject=t}),e}var R={},E,B;function re(){if(B)return E;B=1;function e(n,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return E=e,e.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},e.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},e.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var t=new Date().getTime();if(n&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var i=this;return this._timer=setTimeout(function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout(function(){i._operationTimeoutCb(i._attempts)},i._operationTimeout),i._options.unref&&i._timeout.unref()),i._fn(i._attempts)},r),this._options.unref&&this._timer.unref(),!0},e.prototype.attempt=function(n,t){this._fn=n,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},e.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)},e.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)},e.prototype.start=e.prototype.try,e.prototype.errors=function(){return this._errors},e.prototype.attempts=function(){return this._attempts},e.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},t=null,r=0,i=0;i<this._errors.length;i++){var o=this._errors[i],a=o.message,s=(n[a]||0)+1;n[a]=s,s>=r&&(t=o,r=s)}return t},E}var P;function ie(){return P||(P=1,(function(e){var n=re();e.operation=function(t){var r=e.timeouts(t);return new n(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},e.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in t)r[i]=t[i];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var o=[],a=0;a<r.retries;a++)o.push(this.createTimeout(a,r));return t&&t.forever&&!o.length&&o.push(this.createTimeout(a,r)),o.sort(function(s,u){return s-u}),o},e.createTimeout=function(t,r){var i=r.randomize?Math.random()+1:1,o=Math.round(i*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return o=Math.min(o,r.maxTimeout),o},e.wrap=function(t,r,i){if(r instanceof Array&&(i=r,r=null),!i){i=[];for(var o in t)typeof t[o]=="function"&&i.push(o)}for(var a=0;a<i.length;a++){var s=i[a],u=t[s];t[s]=(function(y){var _=e.operation(r),T=Array.prototype.slice.call(arguments,1),q=T.pop();T.push(function(H){_.retry(H)||(H&&(arguments[0]=_.mainError()),q.apply(this,arguments))}),_.attempt(function(){y.apply(t,T)})}).bind(t,u),t[s].options=r}}})(R)),R}var I,S;function oe(){return S||(S=1,I=ie()),I}var ae=oe();const Ve=J(ae),k={SHA2_256:18,LENGTH:32,DAG_PB:112},se=40;function v(e,n){if(!e.length)throw new Error("Unexpected end of data");const t=d.decode(e);return n.seek(d.decode.bytes),t}function ue(e){const n=new DataView(e.buffer,e.byteOffset,e.byteLength);let t=0;return{version:2,characteristics:[n.getBigUint64(t,!0),n.getBigUint64(t+=8,!0)],dataOffset:Number(n.getBigUint64(t+=8,!0)),dataSize:Number(n.getBigUint64(t+=8,!0)),indexOffset:Number(n.getBigUint64(t+=8,!0))}}function ce(e){d.decode(e);const n=d.decode.bytes,t=d.decode(e.subarray(d.decode.bytes)),r=d.decode.bytes;return n+r+t}const h={Null:e=>e===null?e:void 0,Int:e=>Number.isInteger(e)?e:void 0,Float:e=>typeof e=="number"&&Number.isFinite(e)?e:void 0,String:e=>typeof e=="string"?e:void 0,Bool:e=>typeof e=="boolean"?e:void 0,Bytes:e=>e instanceof Uint8Array?e:void 0,Link:e=>e!==null&&typeof e=="object"&&e.asCID===e?e:void 0,List:e=>Array.isArray(e)?e:void 0,Map:e=>e!==null&&typeof e=="object"&&e.asCID!==e&&!Array.isArray(e)&&!(e instanceof Uint8Array)?e:void 0},m={"CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)":h.Link,"CarV1HeaderOrV2Pragma > roots (anon)":e=>{if(h.List(e)!==void 0){for(let n=0;n<e.length;n++){let t=e[n];if(t=m["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](t),t===void 0)return;if(t!==e[n]){const r=e.slice(0,n);for(let i=n;i<e.length;i++){let o=e[i];if(o=m["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](o),o===void 0)return;r.push(o)}return r}}return e}},Int:h.Int,CarV1HeaderOrV2Pragma:e=>{if(h.Map(e)===void 0)return;const n=Object.entries(e);let t=e,r=1;for(let i=0;i<n.length;i++){const[o,a]=n[i];switch(o){case"roots":{const s=m["CarV1HeaderOrV2Pragma > roots (anon)"](e[o]);if(s===void 0)return;if(s!==a||t!==e){if(t===e){t={};for(let u=0;u<i;u++)t[n[u][0]]=n[u][1]}t.roots=s}}break;case"version":{r--;const s=m.Int(e[o]);if(s===void 0)return;if(s!==a||t!==e){if(t===e){t={};for(let u=0;u<i;u++)t[n[u][0]]=n[u][1]}t.version=s}}break;default:return}}if(!(r>0))return t}},p={"CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)":h.Link,"CarV1HeaderOrV2Pragma > roots (anon)":e=>{if(h.List(e)!==void 0){for(let n=0;n<e.length;n++){let t=e[n];if(t=p["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](t),t===void 0)return;if(t!==e[n]){const r=e.slice(0,n);for(let i=n;i<e.length;i++){let o=e[i];if(o=p["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](o),o===void 0)return;r.push(o)}return r}}return e}},Int:h.Int,CarV1HeaderOrV2Pragma:e=>{if(h.Map(e)===void 0)return;const n=Object.entries(e);let t=e,r=1;for(let i=0;i<n.length;i++){const[o,a]=n[i];switch(o){case"roots":{const s=p["CarV1HeaderOrV2Pragma > roots (anon)"](a);if(s===void 0)return;if(s!==a||t!==e){if(t===e){t={};for(let u=0;u<i;u++)t[n[u][0]]=n[u][1]}t.roots=s}}break;case"version":{r--;const s=p.Int(a);if(s===void 0)return;if(s!==a||t!==e){if(t===e){t={};for(let u=0;u<i;u++)t[n[u][0]]=n[u][1]}t.version=s}}break;default:return}}if(!(r>0))return t}},fe={toTyped:m.CarV1HeaderOrV2Pragma,toRepresentation:p.CarV1HeaderOrV2Pragma},le=z(),de={float64:!1,quickEncodeToken:W};function he(e,n=le,t=de){if(Array.isArray(e)){let r=0;for(const i of e)r+=he(i,n,t);return r}else{const r=n[e.type.major];if(r.encodedSize===void 0||typeof r.encodedSize!="function")throw new Error(`Encoder for ${e.type.name} does not have an encodedSize()`);return r.encodedSize(e,t)}}async function D(e,n){const t=v(await e.upTo(8),e);if(t===0)throw new Error("Invalid CAR header (zero length)");const r=await e.exactly(t,!0),i=G(r);if(fe.toTyped(i)===void 0)throw new Error("Invalid CAR header format");if(i.version!==1&&i.version!==2||n!==void 0&&i.version!==n)throw new Error(`Invalid CAR version: ${i.version}${n!==void 0?` (expected ${n})`:""}`);if(i.version===1){if(!Array.isArray(i.roots))throw new Error("Invalid CAR header format");return i}if(i.roots!==void 0)throw new Error("Invalid CAR header format");const o=ue(await e.exactly(se,!0));e.seek(o.dataOffset-e.pos);const a=await D(e,1);return Object.assign(a,o)}async function ye(e){const n=await e.exactly(2,!1);if(n[0]===k.SHA2_256&&n[1]===k.LENGTH){const a=await e.exactly(34,!0),s=U(a);return l.create(0,k.DAG_PB,s)}const t=v(await e.upTo(8),e);if(t!==1)throw new Error(`Unexpected CID version (${t})`);const r=v(await e.upTo(8),e),i=await e.exactly(ce(await e.upTo(8)),!0),o=U(i);return l.create(t,r,o)}async function $(e){const n=e.pos;let t=v(await e.upTo(8),e);if(t===0)throw new Error("Invalid CAR section (zero length)");t+=e.pos-n;const r=await ye(e),i=t-Number(e.pos-n);return{cid:r,length:t,blockLength:i}}async function me(e){const{cid:n,blockLength:t}=await $(e);return{bytes:await e.exactly(t,!0),cid:n}}async function pe(e){const n=e.pos,{cid:t,length:r,blockLength:i}=await $(e),o={cid:t,length:r,blockLength:i,offset:n,blockOffset:e.pos};return e.seek(o.blockLength),o}function Oe(e){const n=(async()=>{const t=await D(e);if(t.version===2){const r=e.pos-t.dataOffset;e=ve(e,t.dataSize-r)}return t})();return{header:()=>n,async*blocks(){for(await n;(await e.upTo(8)).length>0;)yield await me(e)},async*blocksIndex(){for(await n;(await e.upTo(8)).length>0;)yield await pe(e)}}}function we(e){let n=0;return{async upTo(t){return e.subarray(n,n+Math.min(t,e.length-n))},async exactly(t,r=!1){if(t>e.length-n)throw new Error("Unexpected end of data");const i=e.subarray(n,n+t);return r&&(n+=t),i},seek(t){n+=t},get pos(){return n}}}function ge(e){let n=0,t=0,r=0,i=new Uint8Array(0);const o=async a=>{t=i.length-r;const s=[i.subarray(r)];for(;t<a;){const c=await e();if(c==null)break;t<0?c.length>t&&s.push(c.subarray(-t)):s.push(c),t+=c.length}i=new Uint8Array(s.reduce((c,y)=>c+y.length,0));let u=0;for(const c of s)i.set(c,u),u+=c.length;r=0};return{async upTo(a){return i.length-r<a&&await o(a),i.subarray(r,r+Math.min(i.length-r,a))},async exactly(a,s=!1){if(i.length-r<a&&await o(a),i.length-r<a)throw new Error("Unexpected end of data");const u=i.subarray(r,r+a);return s&&(n+=a,r+=a),u},seek(a){n+=a,r+=a},get pos(){return n}}}function De(e){const n=e[Symbol.asyncIterator]();async function t(){const r=await n.next();return r.done?null:r.value}return ge(t)}function ve(e,n){let t=0;return{async upTo(r){let i=await e.upTo(r);return i.length+t>n&&(i=i.subarray(0,n-t)),i},async exactly(r,i=!1){const o=await e.exactly(r,i);if(o.length+t>n)throw new Error("Unexpected end of data");return i&&(t+=r),o},seek(r){t+=r,e.seek(r)},get pos(){return e.pos}}}const N=1;function M(e){const n=F({version:N,roots:e}),t=d.encode(n.length),r=new Uint8Array(t.length+n.length);return r.set(t,0),r.set(n,t.length),r}function _e(e){return{async setRoots(n){const t=M(n);await e.write(t)},async writeBlock(n){const{cid:t,bytes:r}=n;await e.write(new Uint8Array(d.encode(t.bytes.length+r.length))),await e.write(t.bytes),r.length&&await e.write(r)},async close(){await e.end()},version(){return N}}}function g(){}function Te(){const e=[];let n=null,t=g,r=!1,i=null,o=g;const a=()=>(n||(n=new Promise(c=>{t=()=>{n=null,t=g,c()}})),n),s={write(c){e.push(c);const y=a();return o(),y},async end(){r=!0;const c=a();o(),await c}},u={async next(){const c=e.shift();return c?(e.length===0&&t(),{done:!1,value:c}):r?(t(),{done:!0,value:void 0}):(i||(i=new Promise(y=>{o=()=>(i=null,o=g,y(u.next()))})),i)}};return{writer:s,iterator:u}}class O{constructor(n,t){this._encoder=t,this._mutex=t.setRoots(n),this._ended=!1}async put(n){if(!(n.bytes instanceof Uint8Array)||!n.cid)throw new TypeError("Can only write {cid, bytes} objects");if(this._ended)throw new Error("Already closed");const t=l.asCID(n.cid);if(!t)throw new TypeError("Can only write {cid, bytes} objects");return this._mutex=this._mutex.then(()=>this._encoder.writeBlock({cid:t,bytes:n.bytes})),this._mutex}async close(){if(this._ended)throw new Error("Already closed");return await this._mutex,this._ended=!0,this._encoder.close()}version(){return this._encoder.version()}static create(n){n=xe(n);const{encoder:t,iterator:r}=b(),i=new O(n,t),o=new L(r);return{writer:i,out:o}}static createAppender(){const{encoder:n,iterator:t}=b();n.setRoots=()=>Promise.resolve();const r=new O([],n),i=new L(t);return{writer:r,out:i}}static async updateRootsInBytes(n,t){const r=we(n);await D(r);const i=M(t);if(Number(r.pos)!==i.length)throw new Error(`updateRoots() can only overwrite a header of the same length (old header is ${r.pos} bytes, new header is ${i.length} bytes)`);return n.set(i,0),n}}class L{constructor(n){this._iterator=n}[Symbol.asyncIterator](){if(this._iterating)throw new Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}}function b(){const e=Te(),{writer:n,iterator:t}=e;return{encoder:_e(n),iterator:t}}function xe(e){if(e===void 0)return[];if(!Array.isArray(e)){const t=l.asCID(e);if(!t)throw new TypeError("roots must be a single CID or an array of CIDs");return[t]}const n=[];for(const t of e){const r=l.asCID(t);if(!r)throw new TypeError("roots must be a single CID or an array of CIDs");n.push(r)}return n}export{ne as B,fe as C,se as V,ue as a,k as b,De as c,v as d,Oe as e,we as f,ce as g,O as h,ke as i,Ae as p,Ve as r,he as t,Ie as v};
