var C=Object.defineProperty;var j=t=>{throw TypeError(t)};var U=(t,e,n)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var N=(t,e,n)=>U(t,typeof e!="symbol"?e+"":e,n),P=(t,e,n)=>e.has(t)||j("Cannot "+n);var R=(t,e,n)=>(P(t,e,"read from private field"),n?n.call(t):e.get(t)),I=(t,e,n)=>e.has(t)?j("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),M=(t,e,n,r)=>(P(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n);import{h as code$1,i as encode$1,p as prepare,f as decode$1,C as CID,s as sha256,j as from$4,k as fromHex,g as getNeo4j}from"./BM23hdiM.js";import{e as commonjsGlobal,g as getDefaultExportFromCjs}from"./D8L-8Ang.js";var indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(t,e){for(var n=new Array(arguments.length-1),r=0,i=2,o=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise(function(a,c){n[r]=function(f){if(o)if(o=!1,f)c(f);else{for(var h=new Array(arguments.length-1),p=0;p<h.length;)h[p++]=arguments[p];a.apply(null,h)}};try{t.apply(e||null,n)}catch(l){o&&(o=!1,c(l))}})}var base64$1={};(function(t){var e=t;e.length=function(a){var c=a.length;if(!c)return 0;for(var l=0;--c%4>1&&a.charAt(c)==="=";)++l;return Math.ceil(a.length*3)/4-l};for(var n=new Array(64),r=new Array(123),i=0;i<64;)r[n[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;e.encode=function(a,c,l){for(var f=null,h=[],p=0,g=0,L;c<l;){var u=a[c++];switch(g){case 0:h[p++]=n[u>>2],L=(u&3)<<4,g=1;break;case 1:h[p++]=n[L|u>>4],L=(u&15)<<2,g=2;break;case 2:h[p++]=n[L|u>>6],h[p++]=n[u&63],g=0;break}p>8191&&((f||(f=[])).push(String.fromCharCode.apply(String,h)),p=0)}return g&&(h[p++]=n[L],h[p++]=61,g===1&&(h[p++]=61)),f?(p&&f.push(String.fromCharCode.apply(String,h.slice(0,p))),f.join("")):String.fromCharCode.apply(String,h.slice(0,p))};var o="invalid encoding";e.decode=function(a,c,l){for(var f=l,h=0,p,g=0;g<a.length;){var L=a.charCodeAt(g++);if(L===61&&h>1)break;if((L=r[L])===void 0)throw Error(o);switch(h){case 0:p=L,h=1;break;case 1:c[l++]=p<<2|(L&48)>>4,p=L,h=2;break;case 2:c[l++]=(p&15)<<4|(L&60)>>2,p=L,h=3;break;case 3:c[l++]=(p&3)<<6|L,h=0;break}}if(h===1)throw Error(o);return l-f},e.test=function(a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(e,n,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:n,ctx:r||this}),this};EventEmitter.prototype.off=function(e,n){if(e===void 0)this._listeners={};else if(n===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===n?r.splice(i,1):++i;return this};EventEmitter.prototype.emit=function(e){var n=this._listeners[e];if(n){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<n.length;)n[i].fn.apply(n[i++].ctx,r)}return this};var float=factory(factory);function factory(t){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),n=new Uint8Array(e.buffer),r=n[3]===128;function i(c,l,f){e[0]=c,l[f]=n[0],l[f+1]=n[1],l[f+2]=n[2],l[f+3]=n[3]}function o(c,l,f){e[0]=c,l[f]=n[3],l[f+1]=n[2],l[f+2]=n[1],l[f+3]=n[0]}t.writeFloatLE=r?i:o,t.writeFloatBE=r?o:i;function s(c,l){return n[0]=c[l],n[1]=c[l+1],n[2]=c[l+2],n[3]=c[l+3],e[0]}function a(c,l){return n[3]=c[l],n[2]=c[l+1],n[1]=c[l+2],n[0]=c[l+3],e[0]}t.readFloatLE=r?s:a,t.readFloatBE=r?a:s}():function(){function e(r,i,o,s){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,o,s);else if(isNaN(i))r(2143289344,o,s);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,o,s);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,o,s);else{var c=Math.floor(Math.log(i)/Math.LN2),l=Math.round(i*Math.pow(2,-c)*8388608)&8388607;r((a<<31|c+127<<23|l)>>>0,o,s)}}t.writeFloatLE=e.bind(null,writeUintLE),t.writeFloatBE=e.bind(null,writeUintBE);function n(r,i,o){var s=r(i,o),a=(s>>31)*2+1,c=s>>>23&255,l=s&8388607;return c===255?l?NaN:a*(1/0):c===0?a*1401298464324817e-60*l:a*Math.pow(2,c-150)*(l+8388608)}t.readFloatLE=n.bind(null,readUintLE),t.readFloatBE=n.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),n=new Uint8Array(e.buffer),r=n[7]===128;function i(c,l,f){e[0]=c,l[f]=n[0],l[f+1]=n[1],l[f+2]=n[2],l[f+3]=n[3],l[f+4]=n[4],l[f+5]=n[5],l[f+6]=n[6],l[f+7]=n[7]}function o(c,l,f){e[0]=c,l[f]=n[7],l[f+1]=n[6],l[f+2]=n[5],l[f+3]=n[4],l[f+4]=n[3],l[f+5]=n[2],l[f+6]=n[1],l[f+7]=n[0]}t.writeDoubleLE=r?i:o,t.writeDoubleBE=r?o:i;function s(c,l){return n[0]=c[l],n[1]=c[l+1],n[2]=c[l+2],n[3]=c[l+3],n[4]=c[l+4],n[5]=c[l+5],n[6]=c[l+6],n[7]=c[l+7],e[0]}function a(c,l){return n[7]=c[l],n[6]=c[l+1],n[5]=c[l+2],n[4]=c[l+3],n[3]=c[l+4],n[2]=c[l+5],n[1]=c[l+6],n[0]=c[l+7],e[0]}t.readDoubleLE=r?s:a,t.readDoubleBE=r?a:s}():function(){function e(r,i,o,s,a,c){var l=s<0?1:0;if(l&&(s=-s),s===0)r(0,a,c+i),r(1/s>0?0:2147483648,a,c+o);else if(isNaN(s))r(0,a,c+i),r(2146959360,a,c+o);else if(s>17976931348623157e292)r(0,a,c+i),r((l<<31|2146435072)>>>0,a,c+o);else{var f;if(s<22250738585072014e-324)f=s/5e-324,r(f>>>0,a,c+i),r((l<<31|f/4294967296)>>>0,a,c+o);else{var h=Math.floor(Math.log(s)/Math.LN2);h===1024&&(h=1023),f=s*Math.pow(2,-h),r(f*4503599627370496>>>0,a,c+i),r((l<<31|h+1023<<20|f*1048576&1048575)>>>0,a,c+o)}}}t.writeDoubleLE=e.bind(null,writeUintLE,0,4),t.writeDoubleBE=e.bind(null,writeUintBE,4,0);function n(r,i,o,s,a){var c=r(s,a+i),l=r(s,a+o),f=(l>>31)*2+1,h=l>>>20&2047,p=4294967296*(l&1048575)+c;return h===2047?p?NaN:f*(1/0):h===0?f*5e-324*p:f*Math.pow(2,h-1075)*(p+4503599627370496)}t.readDoubleLE=n.bind(null,readUintLE,0,4),t.readDoubleBE=n.bind(null,readUintBE,4,0)}(),t}function writeUintLE(t,e,n){e[n]=t&255,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}function writeUintBE(t,e,n){e[n]=t>>>24,e[n+1]=t>>>16&255,e[n+2]=t>>>8&255,e[n+3]=t&255}function readUintLE(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function readUintBE(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}var utf8$5={};(function(t){var e=t;e.length=function(r){for(var i=0,o=0,s=0;s<r.length;++s)o=r.charCodeAt(s),o<128?i+=1:o<2048?i+=2:(o&64512)===55296&&(r.charCodeAt(s+1)&64512)===56320?(++s,i+=4):i+=3;return i},e.read=function(r,i,o){var s=o-i;if(s<1)return"";for(var a=null,c=[],l=0,f;i<o;)f=r[i++],f<128?c[l++]=f:f>191&&f<224?c[l++]=(f&31)<<6|r[i++]&63:f>239&&f<365?(f=((f&7)<<18|(r[i++]&63)<<12|(r[i++]&63)<<6|r[i++]&63)-65536,c[l++]=55296+(f>>10),c[l++]=56320+(f&1023)):c[l++]=(f&15)<<12|(r[i++]&63)<<6|r[i++]&63,l>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,c)),l=0);return a?(l&&a.push(String.fromCharCode.apply(String,c.slice(0,l))),a.join("")):String.fromCharCode.apply(String,c.slice(0,l))},e.write=function(r,i,o){for(var s=o,a,c,l=0;l<r.length;++l)a=r.charCodeAt(l),a<128?i[o++]=a:a<2048?(i[o++]=a>>6|192,i[o++]=a&63|128):(a&64512)===55296&&((c=r.charCodeAt(l+1))&64512)===56320?(a=65536+((a&1023)<<10)+(c&1023),++l,i[o++]=a>>18|240,i[o++]=a>>12&63|128,i[o++]=a>>6&63|128,i[o++]=a&63|128):(i[o++]=a>>12|224,i[o++]=a>>6&63|128,i[o++]=a&63|128);return o-s}})(utf8$5);var pool_1=pool;function pool(t,e,n){var r=n||8192,i=r>>>1,o=null,s=r;return function(c){if(c<1||c>i)return t(c);s+c>r&&(o=t(r),s=0);var l=e.call(o,s,s+=c);return s&7&&(s=(s|7)+1),l}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=e;var t=requireMinimal();function e(o,s){this.lo=o>>>0,this.hi=s>>>0}var n=e.zero=new e(0,0);n.toNumber=function(){return 0},n.zzEncode=n.zzDecode=function(){return this},n.length=function(){return 1};var r=e.zeroHash="\0\0\0\0\0\0\0\0";e.fromNumber=function(s){if(s===0)return n;var a=s<0;a&&(s=-s);var c=s>>>0,l=(s-c)/4294967296>>>0;return a&&(l=~l>>>0,c=~c>>>0,++c>4294967295&&(c=0,++l>4294967295&&(l=0))),new e(c,l)},e.from=function(s){if(typeof s=="number")return e.fromNumber(s);if(t.isString(s))if(t.Long)s=t.Long.fromString(s);else return e.fromNumber(parseInt(s,10));return s.low||s.high?new e(s.low>>>0,s.high>>>0):n},e.prototype.toNumber=function(s){if(!s&&this.hi>>>31){var a=~this.lo+1>>>0,c=~this.hi>>>0;return a||(c=c+1>>>0),-(a+c*4294967296)}return this.lo+this.hi*4294967296},e.prototype.toLong=function(s){return t.Long?new t.Long(this.lo|0,this.hi|0,!!s):{low:this.lo|0,high:this.hi|0,unsigned:!!s}};var i=String.prototype.charCodeAt;return e.fromHash=function(s){return s===r?n:new e((i.call(s,0)|i.call(s,1)<<8|i.call(s,2)<<16|i.call(s,3)<<24)>>>0,(i.call(s,4)|i.call(s,5)<<8|i.call(s,6)<<16|i.call(s,7)<<24)>>>0)},e.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},e.prototype.zzEncode=function(){var s=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^s)>>>0,this.lo=(this.lo<<1^s)>>>0,this},e.prototype.zzDecode=function(){var s=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^s)>>>0,this.hi=(this.hi>>>1^s)>>>0,this},e.prototype.length=function(){var s=this.lo,a=(this.lo>>>28|this.hi<<4)>>>0,c=this.hi>>>24;return c===0?a===0?s<16384?s<128?1:2:s<2097152?3:4:a<16384?a<128?5:6:a<2097152?7:8:c<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(t){var e=t;e.asPromise=aspromise,e.base64=base64$1,e.EventEmitter=eventemitter,e.float=float,e.inquire=inquire_1,e.utf8=utf8$5,e.pool=pool_1,e.LongBits=requireLongbits(),e.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),e.global=e.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(o){return typeof o=="number"&&isFinite(o)&&Math.floor(o)===o},e.isString=function(o){return typeof o=="string"||o instanceof String},e.isObject=function(o){return o&&typeof o=="object"},e.isset=e.isSet=function(o,s){var a=o[s];return a!=null&&o.hasOwnProperty(s)?typeof a!="object"||(Array.isArray(a)?a.length:Object.keys(a).length)>0:!1},e.Buffer=function(){try{var i=e.inquire("buffer").Buffer;return i.prototype.utf8Write?i:null}catch{return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(o){return typeof o=="number"?e.Buffer?e._Buffer_allocUnsafe(o):new e.Array(o):e.Buffer?e._Buffer_from(o):typeof Uint8Array>"u"?o:new Uint8Array(o)},e.Array=typeof Uint8Array<"u"?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(o){return o?e.LongBits.from(o).toHash():e.LongBits.zeroHash},e.longFromHash=function(o,s){var a=e.LongBits.fromHash(o);return e.Long?e.Long.fromBits(a.lo,a.hi,s):a.toNumber(!!s)};function n(i,o,s){for(var a=Object.keys(o),c=0;c<a.length;++c)(i[a[c]]===void 0||!s)&&(i[a[c]]=o[a[c]]);return i}e.merge=n,e.lcFirst=function(o){return o.charAt(0).toLowerCase()+o.substring(1)};function r(i){function o(s,a){if(!(this instanceof o))return new o(s,a);Object.defineProperty(this,"message",{get:function(){return s}}),Error.captureStackTrace?Error.captureStackTrace(this,o):Object.defineProperty(this,"stack",{value:new Error().stack||""}),a&&n(this,a)}return o.prototype=Object.create(Error.prototype,{constructor:{value:o,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return i},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),o}e.newError=r,e.ProtocolError=r("ProtocolError"),e.oneOfGetter=function(o){for(var s={},a=0;a<o.length;++a)s[o[a]]=1;return function(){for(var c=Object.keys(this),l=c.length-1;l>-1;--l)if(s[c[l]]===1&&this[c[l]]!==void 0&&this[c[l]]!==null)return c[l]}},e.oneOfSetter=function(o){return function(s){for(var a=0;a<o.length;++a)o[a]!==s&&delete this[o[a]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var i=e.Buffer;if(!i){e._Buffer_from=e._Buffer_allocUnsafe=null;return}e._Buffer_from=i.from!==Uint8Array.from&&i.from||function(s,a){return new i(s,a)},e._Buffer_allocUnsafe=i.allocUnsafe||function(s){return new i(s)}}}(minimal$1)),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$4=util$4.utf8;function Op(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}function noop(){}function State(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$3=function t(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$3();Writer$1.alloc=function t(e){return new util$4.Array(e)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function t(e,n,r){return this.tail=this.tail.next=new Op(e,n,r),this.len+=n,this};function writeByte(t,e,n){e[n]=t&255}function writeVarint32(t,e,n){for(;t>127;)e[n++]=t&127|128,t>>>=7;e[n]=t}function VarintOp(t,e){this.len=t,this.next=void 0,this.val=e}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function t(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Writer$1.prototype.int32=function t(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)};Writer$1.prototype.sint32=function t(e){return this.uint32((e<<1^e>>31)>>>0)};function writeVarint64(t,e,n){for(;t.hi;)e[n++]=t.lo&127|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[n++]=t.lo&127|128,t.lo=t.lo>>>7;e[n++]=t.lo}Writer$1.prototype.uint64=function t(e){var n=LongBits$1.from(e);return this._push(writeVarint64,n.length(),n)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function t(e){var n=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,n.length(),n)};Writer$1.prototype.bool=function t(e){return this._push(writeByte,1,e?1:0)};function writeFixed32(t,e,n){e[n]=t&255,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}Writer$1.prototype.fixed32=function t(e){return this._push(writeFixed32,4,e>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function t(e){var n=LongBits$1.from(e);return this._push(writeFixed32,4,n.lo)._push(writeFixed32,4,n.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function t(e){return this._push(util$4.float.writeFloatLE,4,e)};Writer$1.prototype.double=function t(e){return this._push(util$4.float.writeDoubleLE,8,e)};var writeBytes=util$4.Array.prototype.set?function t(e,n,r){n.set(e,r)}:function t(e,n,r){for(var i=0;i<e.length;++i)n[r+i]=e[i]};Writer$1.prototype.bytes=function t(e){var n=e.length>>>0;if(!n)return this._push(writeByte,1,0);if(util$4.isString(e)){var r=Writer$1.alloc(n=base64.length(e));base64.decode(e,r,0),e=r}return this.uint32(n)._push(writeBytes,n,e)};Writer$1.prototype.string=function t(e){var n=utf8$4.length(e);return n?this.uint32(n)._push(utf8$4.write,n,e):this._push(writeByte,1,0)};Writer$1.prototype.fork=function t(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this};Writer$1.prototype.reset=function t(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this};Writer$1.prototype.ldelim=function t(){var e=this.head,n=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=n,this.len+=r),this};Writer$1.prototype.finish=function t(){for(var e=this.head.next,n=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,n,r),r+=e.len,e=e.next;return n};Writer$1._configure=function(t){BufferWriter$1=t,Writer$1.create=create$3(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(e,n,r){n.set(e,r)}:function(e,n,r){if(e.copy)e.copy(n,r,0,e.length);else for(var i=0;i<e.length;)n[r++]=e[i++]}};BufferWriter.prototype.bytes=function t(e){util$3.isString(e)&&(e=util$3._Buffer_from(e,"base64"));var n=e.length>>>0;return this.uint32(n),n&&this._push(BufferWriter.writeBytesBuffer,n,e),this};function writeStringBuffer(t,e,n){t.length<40?util$3.utf8.write(t,e,n):e.utf8Write?e.utf8Write(t,n):e.write(t,n)}BufferWriter.prototype.string=function t(e){var n=util$3.Buffer.byteLength(e);return this.uint32(n),n&&this._push(writeStringBuffer,n,e),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8$3=util$2.utf8;function indexOutOfRange(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function Reader$1(t){this.buf=t,this.pos=0,this.len=t.length}var create_array=typeof Uint8Array<"u"?function t(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")}:function t(e){if(Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")},create$2=function t(){return util$2.Buffer?function(n){return(Reader$1.create=function(i){return util$2.Buffer.isBuffer(i)?new BufferReader$1(i):create_array(i)})(n)}:create_array};Reader$1.create=create$2();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function t(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return e}}();Reader$1.prototype.int32=function t(){return this.uint32()|0};Reader$1.prototype.sint32=function t(){var e=this.uint32();return e>>>1^-(e&1)|0};function readLongVarint(){var t=new LongBits(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw indexOutOfRange(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,t}if(this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw indexOutOfRange(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function t(){return this.uint32()!==0};function readFixed32_end(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}Reader$1.prototype.fixed32=function t(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function t(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function t(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Reader$1.prototype.double=function t(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Reader$1.prototype.bytes=function t(){var e=this.uint32(),n=this.pos,r=this.pos+e;if(r>this.len)throw indexOutOfRange(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(n,r);if(n===r){var i=util$2.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,n,r)};Reader$1.prototype.string=function t(){var e=this.bytes();return utf8$3.read(e,0,e.length)};Reader$1.prototype.skip=function t(e){if(typeof e=="number"){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this};Reader$1._configure=function(t){BufferReader$1=t,Reader$1.create=create$2(),BufferReader$1._configure();var e=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[e](!1)},uint64:function(){return readLongVarint.call(this)[e](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[e](!1)},fixed64:function(){return readFixed64.call(this)[e](!0)},sfixed64:function(){return readFixed64.call(this)[e](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(t){Reader.call(this,t)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function t(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(t,e,n){if(typeof t!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=!!e,this.responseDelimited=!!n}Service.prototype.rpcCall=function t(e,n,r,i,o){if(!i)throw TypeError("request must be specified");var s=this;if(!o)return util.asPromise(t,s,e,n,r,i);if(!s.rpcImpl){setTimeout(function(){o(Error("already ended"))},0);return}try{return s.rpcImpl(e,n[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(c,l){if(c)return s.emit("error",c,e),o(c);if(l===null){s.end(!0);return}if(!(l instanceof r))try{l=r[s.responseDelimited?"decodeDelimited":"decode"](l)}catch(f){return s.emit("error",f,e),o(f)}return s.emit("data",l,e),o(null,l)})}catch(a){s.emit("error",a,e),setTimeout(function(){o(a)},0);return}};Service.prototype.end=function t(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(t){var e=t;e.Service=service})(rpc);var roots={};(function(t){var e=t;e.build="minimal",e.Writer=writer,e.BufferWriter=writer_buffer,e.Reader=reader,e.BufferReader=reader_buffer,e.util=requireMinimal(),e.rpc=rpc,e.roots=roots,e.configure=n;function n(){e.util._configure(),e.Writer._configure(e.BufferWriter),e.Reader._configure(e.BufferReader)}n()})(indexMinimal);var minimal=indexMinimal;const $protobuf=getDefaultExportFromCjs(minimal),$Reader=$protobuf.Reader,$Writer=$protobuf.Writer,$util=$protobuf.util,$root=$protobuf.roots.unixfs||($protobuf.roots.unixfs={}),Data=$root.Data=(()=>{function t(e){if(this.blocksizes=[],e)for(var n=Object.keys(e),r=0;r<n.length;++r)e[n[r]]!=null&&(this[n[r]]=e[n[r]])}return t.prototype.Type=0,t.prototype.Data=$util.newBuffer([]),t.prototype.filesize=$util.Long?$util.Long.fromBits(0,0,!0):0,t.prototype.blocksizes=$util.emptyArray,t.prototype.hashType=$util.Long?$util.Long.fromBits(0,0,!0):0,t.prototype.fanout=$util.Long?$util.Long.fromBits(0,0,!0):0,t.prototype.mode=0,t.prototype.mtime=null,t.encode=function(n,r){if(r||(r=$Writer.create()),r.uint32(8).int32(n.Type),n.Data!=null&&Object.hasOwnProperty.call(n,"Data")&&r.uint32(18).bytes(n.Data),n.filesize!=null&&Object.hasOwnProperty.call(n,"filesize")&&r.uint32(24).uint64(n.filesize),n.blocksizes!=null&&n.blocksizes.length)for(var i=0;i<n.blocksizes.length;++i)r.uint32(32).uint64(n.blocksizes[i]);return n.hashType!=null&&Object.hasOwnProperty.call(n,"hashType")&&r.uint32(40).uint64(n.hashType),n.fanout!=null&&Object.hasOwnProperty.call(n,"fanout")&&r.uint32(48).uint64(n.fanout),n.mode!=null&&Object.hasOwnProperty.call(n,"mode")&&r.uint32(56).uint32(n.mode),n.mtime!=null&&Object.hasOwnProperty.call(n,"mtime")&&$root.UnixTime.encode(n.mtime,r.uint32(66).fork()).ldelim(),r},t.decode=function(n,r){n instanceof $Reader||(n=$Reader.create(n));for(var i=r===void 0?n.len:n.pos+r,o=new $root.Data;n.pos<i;){var s=n.uint32();switch(s>>>3){case 1:o.Type=n.int32();break;case 2:o.Data=n.bytes();break;case 3:o.filesize=n.uint64();break;case 4:if(o.blocksizes&&o.blocksizes.length||(o.blocksizes=[]),(s&7)===2)for(var a=n.uint32()+n.pos;n.pos<a;)o.blocksizes.push(n.uint64());else o.blocksizes.push(n.uint64());break;case 5:o.hashType=n.uint64();break;case 6:o.fanout=n.uint64();break;case 7:o.mode=n.uint32();break;case 8:o.mtime=$root.UnixTime.decode(n,n.uint32());break;default:n.skipType(s&7);break}}if(!o.hasOwnProperty("Type"))throw $util.ProtocolError("missing required 'Type'",{instance:o});return o},t.fromObject=function(n){if(n instanceof $root.Data)return n;var r=new $root.Data;switch(n.Type){case"Raw":case 0:r.Type=0;break;case"Directory":case 1:r.Type=1;break;case"File":case 2:r.Type=2;break;case"Metadata":case 3:r.Type=3;break;case"Symlink":case 4:r.Type=4;break;case"HAMTShard":case 5:r.Type=5;break}if(n.Data!=null&&(typeof n.Data=="string"?$util.base64.decode(n.Data,r.Data=$util.newBuffer($util.base64.length(n.Data)),0):n.Data.length&&(r.Data=n.Data)),n.filesize!=null&&($util.Long?(r.filesize=$util.Long.fromValue(n.filesize)).unsigned=!0:typeof n.filesize=="string"?r.filesize=parseInt(n.filesize,10):typeof n.filesize=="number"?r.filesize=n.filesize:typeof n.filesize=="object"&&(r.filesize=new $util.LongBits(n.filesize.low>>>0,n.filesize.high>>>0).toNumber(!0))),n.blocksizes){if(!Array.isArray(n.blocksizes))throw TypeError(".Data.blocksizes: array expected");r.blocksizes=[];for(var i=0;i<n.blocksizes.length;++i)$util.Long?(r.blocksizes[i]=$util.Long.fromValue(n.blocksizes[i])).unsigned=!0:typeof n.blocksizes[i]=="string"?r.blocksizes[i]=parseInt(n.blocksizes[i],10):typeof n.blocksizes[i]=="number"?r.blocksizes[i]=n.blocksizes[i]:typeof n.blocksizes[i]=="object"&&(r.blocksizes[i]=new $util.LongBits(n.blocksizes[i].low>>>0,n.blocksizes[i].high>>>0).toNumber(!0))}if(n.hashType!=null&&($util.Long?(r.hashType=$util.Long.fromValue(n.hashType)).unsigned=!0:typeof n.hashType=="string"?r.hashType=parseInt(n.hashType,10):typeof n.hashType=="number"?r.hashType=n.hashType:typeof n.hashType=="object"&&(r.hashType=new $util.LongBits(n.hashType.low>>>0,n.hashType.high>>>0).toNumber(!0))),n.fanout!=null&&($util.Long?(r.fanout=$util.Long.fromValue(n.fanout)).unsigned=!0:typeof n.fanout=="string"?r.fanout=parseInt(n.fanout,10):typeof n.fanout=="number"?r.fanout=n.fanout:typeof n.fanout=="object"&&(r.fanout=new $util.LongBits(n.fanout.low>>>0,n.fanout.high>>>0).toNumber(!0))),n.mode!=null&&(r.mode=n.mode>>>0),n.mtime!=null){if(typeof n.mtime!="object")throw TypeError(".Data.mtime: object expected");r.mtime=$root.UnixTime.fromObject(n.mtime)}return r},t.toObject=function(n,r){r||(r={});var i={};if((r.arrays||r.defaults)&&(i.blocksizes=[]),r.defaults){if(i.Type=r.enums===String?"Raw":0,r.bytes===String?i.Data="":(i.Data=[],r.bytes!==Array&&(i.Data=$util.newBuffer(i.Data))),$util.Long){var o=new $util.Long(0,0,!0);i.filesize=r.longs===String?o.toString():r.longs===Number?o.toNumber():o}else i.filesize=r.longs===String?"0":0;if($util.Long){var o=new $util.Long(0,0,!0);i.hashType=r.longs===String?o.toString():r.longs===Number?o.toNumber():o}else i.hashType=r.longs===String?"0":0;if($util.Long){var o=new $util.Long(0,0,!0);i.fanout=r.longs===String?o.toString():r.longs===Number?o.toNumber():o}else i.fanout=r.longs===String?"0":0;i.mode=0,i.mtime=null}if(n.Type!=null&&n.hasOwnProperty("Type")&&(i.Type=r.enums===String?$root.Data.DataType[n.Type]:n.Type),n.Data!=null&&n.hasOwnProperty("Data")&&(i.Data=r.bytes===String?$util.base64.encode(n.Data,0,n.Data.length):r.bytes===Array?Array.prototype.slice.call(n.Data):n.Data),n.filesize!=null&&n.hasOwnProperty("filesize")&&(typeof n.filesize=="number"?i.filesize=r.longs===String?String(n.filesize):n.filesize:i.filesize=r.longs===String?$util.Long.prototype.toString.call(n.filesize):r.longs===Number?new $util.LongBits(n.filesize.low>>>0,n.filesize.high>>>0).toNumber(!0):n.filesize),n.blocksizes&&n.blocksizes.length){i.blocksizes=[];for(var s=0;s<n.blocksizes.length;++s)typeof n.blocksizes[s]=="number"?i.blocksizes[s]=r.longs===String?String(n.blocksizes[s]):n.blocksizes[s]:i.blocksizes[s]=r.longs===String?$util.Long.prototype.toString.call(n.blocksizes[s]):r.longs===Number?new $util.LongBits(n.blocksizes[s].low>>>0,n.blocksizes[s].high>>>0).toNumber(!0):n.blocksizes[s]}return n.hashType!=null&&n.hasOwnProperty("hashType")&&(typeof n.hashType=="number"?i.hashType=r.longs===String?String(n.hashType):n.hashType:i.hashType=r.longs===String?$util.Long.prototype.toString.call(n.hashType):r.longs===Number?new $util.LongBits(n.hashType.low>>>0,n.hashType.high>>>0).toNumber(!0):n.hashType),n.fanout!=null&&n.hasOwnProperty("fanout")&&(typeof n.fanout=="number"?i.fanout=r.longs===String?String(n.fanout):n.fanout:i.fanout=r.longs===String?$util.Long.prototype.toString.call(n.fanout):r.longs===Number?new $util.LongBits(n.fanout.low>>>0,n.fanout.high>>>0).toNumber(!0):n.fanout),n.mode!=null&&n.hasOwnProperty("mode")&&(i.mode=n.mode),n.mtime!=null&&n.hasOwnProperty("mtime")&&(i.mtime=$root.UnixTime.toObject(n.mtime,r)),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t.DataType=function(){const e={},n=Object.create(e);return n[e[0]="Raw"]=0,n[e[1]="Directory"]=1,n[e[2]="File"]=2,n[e[3]="Metadata"]=3,n[e[4]="Symlink"]=4,n[e[5]="HAMTShard"]=5,n}(),t})();$root.UnixTime=(()=>{function t(e){if(e)for(var n=Object.keys(e),r=0;r<n.length;++r)e[n[r]]!=null&&(this[n[r]]=e[n[r]])}return t.prototype.Seconds=$util.Long?$util.Long.fromBits(0,0,!1):0,t.prototype.FractionalNanoseconds=0,t.encode=function(n,r){return r||(r=$Writer.create()),r.uint32(8).int64(n.Seconds),n.FractionalNanoseconds!=null&&Object.hasOwnProperty.call(n,"FractionalNanoseconds")&&r.uint32(21).fixed32(n.FractionalNanoseconds),r},t.decode=function(n,r){n instanceof $Reader||(n=$Reader.create(n));for(var i=r===void 0?n.len:n.pos+r,o=new $root.UnixTime;n.pos<i;){var s=n.uint32();switch(s>>>3){case 1:o.Seconds=n.int64();break;case 2:o.FractionalNanoseconds=n.fixed32();break;default:n.skipType(s&7);break}}if(!o.hasOwnProperty("Seconds"))throw $util.ProtocolError("missing required 'Seconds'",{instance:o});return o},t.fromObject=function(n){if(n instanceof $root.UnixTime)return n;var r=new $root.UnixTime;return n.Seconds!=null&&($util.Long?(r.Seconds=$util.Long.fromValue(n.Seconds)).unsigned=!1:typeof n.Seconds=="string"?r.Seconds=parseInt(n.Seconds,10):typeof n.Seconds=="number"?r.Seconds=n.Seconds:typeof n.Seconds=="object"&&(r.Seconds=new $util.LongBits(n.Seconds.low>>>0,n.Seconds.high>>>0).toNumber())),n.FractionalNanoseconds!=null&&(r.FractionalNanoseconds=n.FractionalNanoseconds>>>0),r},t.toObject=function(n,r){r||(r={});var i={};if(r.defaults){if($util.Long){var o=new $util.Long(0,0,!1);i.Seconds=r.longs===String?o.toString():r.longs===Number?o.toNumber():o}else i.Seconds=r.longs===String?"0":0;i.FractionalNanoseconds=0}return n.Seconds!=null&&n.hasOwnProperty("Seconds")&&(typeof n.Seconds=="number"?i.Seconds=r.longs===String?String(n.Seconds):n.Seconds:i.Seconds=r.longs===String?$util.Long.prototype.toString.call(n.Seconds):r.longs===Number?new $util.LongBits(n.Seconds.low>>>0,n.Seconds.high>>>0).toNumber():n.Seconds),n.FractionalNanoseconds!=null&&n.hasOwnProperty("FractionalNanoseconds")&&(i.FractionalNanoseconds=n.FractionalNanoseconds),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t})();$root.Metadata=(()=>{function t(e){if(e)for(var n=Object.keys(e),r=0;r<n.length;++r)e[n[r]]!=null&&(this[n[r]]=e[n[r]])}return t.prototype.MimeType="",t.encode=function(n,r){return r||(r=$Writer.create()),n.MimeType!=null&&Object.hasOwnProperty.call(n,"MimeType")&&r.uint32(10).string(n.MimeType),r},t.decode=function(n,r){n instanceof $Reader||(n=$Reader.create(n));for(var i=r===void 0?n.len:n.pos+r,o=new $root.Metadata;n.pos<i;){var s=n.uint32();switch(s>>>3){case 1:o.MimeType=n.string();break;default:n.skipType(s&7);break}}return o},t.fromObject=function(n){if(n instanceof $root.Metadata)return n;var r=new $root.Metadata;return n.MimeType!=null&&(r.MimeType=String(n.MimeType)),r},t.toObject=function(n,r){r||(r={});var i={};return r.defaults&&(i.MimeType=""),n.MimeType!=null&&n.hasOwnProperty("MimeType")&&(i.MimeType=n.MimeType),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t})();const NodeType=Data.DataType,EMPTY$3=Object.freeze([]),EMPTY_BUFFER$1=new Uint8Array(0),BLANK$2=Object.freeze({}),DEFAULT_FILE_MODE=parseInt("0644",8),DEFAULT_DIRECTORY_MODE=parseInt("0755",8),code=code$1,name$1="UnixFS",encodePB=(t,e)=>(Object(globalThis).debug&&console.log({data:t,links:e}),encode$1(prepare({Data:Data.encode(t).finish(),Links:e}))),createRaw=t=>({type:NodeType.Raw,content:t}),createEmptyFile=t=>createSimpleFile(EMPTY_BUFFER$1,t),createSimpleFile=(t,e)=>({type:NodeType.File,layout:"simple",content:t,metadata:decodeMetadata(e)}),createFileChunk=t=>({type:NodeType.File,layout:"simple",content:t}),createAdvancedFile=(t,e)=>({type:NodeType.File,layout:"advanced",parts:t,metadata:decodeMetadata(e)}),createFileShard=t=>({type:NodeType.File,layout:"advanced",parts:t}),createComplexFile=(t,e,n)=>({type:NodeType.File,layout:"complex",content:t,parts:e,metadata:decodeMetadata(n)}),createFlatDirectory=(t,e)=>({type:NodeType.Directory,metadata:decodeMetadata(e),entries:t}),createShardedDirectory=(t,e,n,r,i=BLANK$2)=>({type:NodeType.HAMTShard,bitfield:e,fanout:readFanout(n),hashType:readInt(r),entries:t,metadata:decodeMetadata(i)}),createDirectoryShard=(t,e,n,r)=>({type:NodeType.HAMTShard,bitfield:e,fanout:readFanout(n),hashType:readInt(r),entries:t}),encodeRaw=t=>encodePB({Type:NodeType.Raw,Data:t.byteLength>0?t:void 0,filesize:t.byteLength,blocksizes:EMPTY$3},[]),encodeFile=(t,e=!1)=>{const n=e?BLANK$2:Object(t).metadata;switch(t.layout){case"simple":return encodeSimpleFile(t.content,n);case"advanced":return encodeAdvancedFile(t.parts,n);case"complex":return encodeComplexFile(t.content,t.parts,n);default:throw new TypeError(`File with unknown layout "${Object(t).layout}" was passed`)}},encodeFileChunk=t=>encodeSimpleFile(t,BLANK$2),encodeFileShard=t=>encodePB({Type:NodeType.File,blocksizes:t.map(contentByteLength),filesize:cumulativeContentByteLength(t)},t.map(encodeLink)),encodeAdvancedFile=(t,e=BLANK$2)=>encodePB({Type:NodeType.File,blocksizes:t.map(contentByteLength),filesize:cumulativeContentByteLength(t),...encodeMetadata(e)},t.map(encodeLink)),encodeLink=t=>({Name:"",Tsize:t.dagByteLength,Hash:t.cid}),encodeSimpleFile=(t,e=BLANK$2)=>encodePB({Type:NodeType.File,Data:t.byteLength>0?t:void 0,filesize:t.byteLength,blocksizes:[],...encodeMetadata(e)},[]),encodeComplexFile=(t,e,n=BLANK$2)=>encodePB({Type:NodeType.File,Data:t,filesize:t.byteLength+cumulativeContentByteLength(e),blocksizes:e.map(contentByteLength)},e.map(encodeLink)),encodeDirectory=t=>encodePB({Type:t.type,...encodeDirectoryMetadata(t.metadata||BLANK$2)},t.entries.map(encodeNamedLink)),encodeHAMTShard=({bitfield:t,fanout:e,hashType:n,entries:r,metadata:i=BLANK$2})=>encodePB({Type:NodeType.HAMTShard,Data:t.byteLength>0?t:void 0,fanout:readFanout(e),hashType:readInt(n),...encodeDirectoryMetadata(i)},r.map(encodeNamedLink)),readFanout=t=>{if(Math.log2(t)%1===0)return t;throw new TypeError(`Expected hamt size to be a power of two instead got ${t}`)},readInt=t=>{if(Number.isInteger(t))return t;throw new TypeError(`Expected an integer value instead got ${t}`)},createSymlink=(t,e=BLANK$2)=>({type:NodeType.Symlink,content:t,metadata:decodeMetadata(e)}),encodeSymlink=(t,e=!1)=>{const n=e?BLANK$2:Object(t).metadata;return encodePB({Type:NodeType.Symlink,Data:t.content,...encodeMetadata(n||BLANK$2)},[])},encode=(t,e=!0)=>{switch(t.type){case NodeType.Raw:return encodeRaw(t.content);case NodeType.File:return encodeFile(t);case NodeType.Directory:return encodeDirectory(t);case NodeType.HAMTShard:return encodeHAMTShard(t);case NodeType.Symlink:return encodeSymlink(t);default:throw new Error(`Unknown node type ${Object(t).type}`)}},decode=t=>{const e=decode$1(t),n=Data.decode(e.Data),{Type:r,Data:i,mtime:o,mode:s,blocksizes:a,...c}=Data.toObject(n,{defaults:!1,arrays:!0,longs:Number,objects:!1}),l={...s&&{mode:s},...decodeMtime(o)},f=e.Links;switch(n.Type){case NodeType.Raw:return createRaw(i);case NodeType.File:return f.length===0?new SimpleFileView(i,l):i.byteLength===0?new AdvancedFileView(decodeFileLinks(c.blocksizes,f),l):new ComplexFileView(i,decodeFileLinks(c.blocksizes,f),l);case NodeType.Directory:return createFlatDirectory(decodeDirectoryLinks(f),l);case NodeType.HAMTShard:return createShardedDirectory(decodeDirectoryLinks(f),i||EMPTY_BUFFER$1,c.fanout,c.hashType,l);case NodeType.Symlink:return createSymlink(i,l);default:throw new TypeError(`Unsupported node type ${n.Type}`)}},decodeMtime=t=>t==null?void 0:{mtime:{secs:t.Seconds,nsecs:t.FractionalNanoseconds||0}},decodeFileLinks=(t,e)=>{const n=[],r=t.length;let i=0;for(;i<r;)n.push({cid:e[i].Hash,dagByteLength:e[i].Tsize||0,contentByteLength:t[i]});return n},decodeDirectoryLinks=t=>t.map(e=>({cid:e.Hash,name:e.Name||"",dagByteLength:e.Tsize||0})),cumulativeContentByteLength=t=>t.reduce((e,n)=>e+n.contentByteLength,0),cumulativeDagByteLength=(t,e)=>e.reduce((n,r)=>n+r.dagByteLength,t.byteLength),contentByteLength=t=>t.contentByteLength,encodeNamedLink=({name:t,dagByteLength:e,cid:n})=>({Name:t,Tsize:e,Hash:n}),encodeDirectoryMetadata=t=>encodeMetadata(t,DEFAULT_DIRECTORY_MODE),encodeMetadata=({mode:t,mtime:e},n=DEFAULT_FILE_MODE)=>({mode:t!=null?encodeMode(t,n):void 0,mtime:e!=null?encodeMTime(e):void 0}),decodeMetadata=t=>t==null?BLANK$2:{...t.mode==null?void 0:{mode:decodeMode(t.mode)},...t.mtime==null?void 0:{mtime:t.mtime}},encodeMTime=t=>t==null?void 0:t.nsecs!==0?{Seconds:t.secs,FractionalNanoseconds:t.nsecs}:{Seconds:t.secs},encodeMode=(t,e)=>{const n=t==null?void 0:decodeMode(t);return n===e||n==null?void 0:n},decodeMode=t=>t&4095|t&4294963200,matchFile=({content:t=EMPTY_BUFFER$1,parts:e=EMPTY$3,metadata:n=BLANK$2,...r})=>e.length===0?new SimpleFileView(t,n):t.byteLength===0?new AdvancedFileView(e,n):new ComplexFileView(t,e,n);class SimpleFileView{constructor(e,n){this.content=e,this.metadata=n,this.layout="simple",this.type=NodeType.File}get filesize(){return this.content.byteLength}encode(){return encodeSimpleFile(this.content,this.metadata)}}class AdvancedFileView{constructor(e,n){this.parts=e,this.metadata=n}get layout(){return"advanced"}get type(){return NodeType.File}get fileSize(){return cumulativeContentByteLength(this.parts)}get blockSizes(){return this.parts.map(contentByteLength)}encode(){return encodeAdvancedFile(this.parts,this.metadata)}}class ComplexFileView{constructor(e,n,r){this.content=e,this.parts=n,this.metadata=r}get layout(){return"complex"}get type(){return NodeType.File}get fileSize(){return this.content.byteLength+cumulativeContentByteLength(this.parts)}get blockSizes(){return this.parts.map(contentByteLength)}encode(){return encodeComplexFile(this.content,this.parts,this.metadata)}}const filesize=t=>{switch(t.type){case NodeType.Raw:case NodeType.Symlink:return t.content.byteLength;case NodeType.File:switch(t.layout){case"simple":return t.content.byteLength;case"advanced":return cumulativeContentByteLength(t.parts);case"complex":return t.content.byteLength+cumulativeContentByteLength(t.parts)}default:return 0}},UnixFS=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_DIRECTORY_MODE,DEFAULT_FILE_MODE,NodeType,code,createAdvancedFile,createComplexFile,createDirectoryShard,createEmptyFile,createFileChunk,createFileShard,createFlatDirectory,createRaw,createShardedDirectory,createSimpleFile,createSymlink,cumulativeContentByteLength,cumulativeDagByteLength,decode,decodeMetadata,encode,encodeAdvancedFile,encodeComplexFile,encodeDirectory,encodeDirectoryMetadata,encodeFile,encodeFileChunk,encodeFileShard,encodeHAMTShard,encodeLink,encodeMetadata,encodeMode,encodeRaw,encodeSimpleFile,encodeSymlink,filesize,matchFile,name:name$1},Symbol.toStringTag,{value:"Module"})),effect=function*(t){const e=yield*t;yield*send(e)};function*current(){return yield CURRENT}const suspend=function*(){yield SUSPEND},wait=function*(t){const e=yield*current();if(isAsync(t)){let n=!1,r;if(t.then(i=>{n=!1,r=i,enqueue(e)},i=>{n=!0,r=i,enqueue(e)}),yield*suspend(),n)throw r;return r}else return main(wake(e)),yield*suspend(),t};function*wake(t){enqueue(t)}const isAsync=t=>t!=null&&typeof t.then=="function",send=function*(t){yield t},listen=function*(t){const e=[];for(const n of Object.entries(t)){const[r,i]=n;i!==NONE&&e.push(yield*fork$1(tag(i,r)))}yield*group(e)},effects=t=>t.length>0?batch(t.map(effect)):NONE;function*batch(t){const e=[];for(const n of t)e.push(yield*fork$1(n));yield*group(e)}const tag=(t,e)=>t===NONE?NONE:t instanceof Tagger?new Tagger([...t.tags,e],t.source):new Tagger([e],t);class Tagger{constructor(e,n){this.tags=e,this.source=n,this.controller}[Symbol.iterator](){return this.controller||(this.controller=this.source[Symbol.iterator]()),this}box(e){if(e.done)return e;switch(e.value){case SUSPEND:case CURRENT:return e;default:{const n=e;let{value:r}=n;for(const i of this.tags)r=withTag(i,r);return n.value=r,n}}}next(e){return this.box(this.controller.next(e))}throw(e){return this.box(this.controller.throw(e))}return(e){return this.box(this.controller.return(e))}get[Symbol.toStringTag](){return"TaggedEffect"}}const none=()=>NONE,withTag=(t,e)=>({type:t,[t]:e}),CURRENT=Symbol("current"),SUSPEND=Symbol("suspend");class Group{static of(e){return e.group||MAIN}static enqueue(e,n){e.group=n,n.stack.active.push(e)}constructor(e,n=[],r=new Set,i=new Stack(n,r)){this.driver=e,this.parent=Group.of(e),this.stack=i,this.id=++ID}}class Main{constructor(){this.status=IDLE,this.stack=new Stack,this.id=0}}class Stack{constructor(e=[],n=new Set){this.active=e,this.idle=n}static size({active:e,idle:n}){return e.length+n.size}}const main=t=>enqueue(t[Symbol.iterator]()),enqueue=t=>{let e=Group.of(t);for(e.stack.active.push(t),e.stack.idle.delete(t);e.parent;){const{idle:n,active:r}=e.parent.stack;if(n.has(e.driver))n.delete(e.driver),r.push(e.driver);else break;e=e.parent}if(MAIN.status===IDLE)for(MAIN.status=ACTIVE;;)try{for(const n of step(MAIN));MAIN.status=IDLE;break}catch{MAIN.stack.active.shift()}},resume=t=>enqueue(t),step=function*(t){const{active:e}=t.stack;let n=e[0];for(t.stack.idle.delete(n);n;){let r=INIT;e:for(;!r.done&&n===e[0];){const i=r.value;switch(i){case SUSPEND:t.stack.idle.add(n);break e;case CURRENT:r=n.next(n);break;default:r=n.next(yield i);break}}e.shift(),n=e[0],t.stack.idle.delete(n)}},fork$1=(t,e)=>new Fork(t,e),exit=(t,e)=>conclude(t,{ok:!0,value:e}),abort=(t,e)=>conclude(t,{ok:!1,error:e});function*conclude(t,e){try{const n=t,r=e.ok?n.return(e.value):n.throw(e.error);if(!r.done)if(r.value===SUSPEND){const{idle:i}=Group.of(n).stack;i.add(n)}else enqueue(n)}catch{}}function*group(t){if(t.length===0)return;const e=yield*current(),n=new Group(e);let r=null;for(const i of t){const{result:o}=i;if(o){!o.ok&&!r&&(r=o);continue}move(i,n)}try{if(r)throw r.error;for(;yield*step(n),Stack.size(n.stack)>0;)yield*suspend()}catch(i){for(const o of n.stack.active)yield*abort(o,i);for(const o of n.stack.idle)yield*abort(o,i),enqueue(o);throw i}}const move=(t,e)=>{const n=Group.of(t);if(n!==e){const{active:r,idle:i}=n.stack,o=e.stack;if(t.group=e,i.has(t))i.delete(t),o.idle.add(t);else{const s=r.indexOf(t);s>=0&&(r.splice(s,1),o.active.push(t))}}};function*join(t){t.status===IDLE&&(yield*t),t.result||(yield*group([t]));const e=t.result;if(e.ok)return e.value;throw e.error}class Future{constructor(e){this.handler=e,this.result}get promise(){const{result:e}=this,n=e==null?new Promise((r,i)=>{this.handler.onsuccess=r,this.handler.onfailure=i}):e.ok?Promise.resolve(e.value):Promise.reject(e.error);return Object.defineProperty(this,"promise",{value:n}),n}then(e,n){return this.activate().promise.then(e,n)}catch(e){return this.activate().promise.catch(e)}finally(e){return this.activate().promise.finally(e)}activate(){return this}}class Fork extends Future{constructor(e,n=BLANK$1,r={},i=INIT){super(r),this.id=++ID,this.name=n.name||"",this.task=e,this.state=i,this.status=IDLE,this.result,this.handler=r,this.controller}*resume(){resume(this)}join(){return join(this)}abort(e){return abort(this,e)}exit(e){return exit(this,e)}get[Symbol.toStringTag](){return"Fork"}*[Symbol.iterator](){return this.activate()}activate(){return this.controller=this.task[Symbol.iterator](),this.status=ACTIVE,enqueue(this),this}panic(e){this.result={ok:!1,error:e},this.status=FINISHED;const{handler:n}=this;throw n.onfailure&&n.onfailure(e),e}step(e){if(this.state=e,e.done){this.result={ok:!0,value:e.value},this.status=FINISHED;const{handler:n}=this;n.onsuccess&&n.onsuccess(e.value)}return e}next(e){try{return this.step(this.controller.next(e))}catch(n){return this.panic(n)}}return(e){try{return this.step(this.controller.return(e))}catch(n){return this.panic(n)}}throw(e){try{return this.step(this.controller.throw(e))}catch(n){return this.panic(n)}}}const loop=function*(t,e){const n=yield*current(),r=new Group(n);for(Group.enqueue(t[Symbol.iterator](),r);;){for(const i of step(r))Group.enqueue(e(i)[Symbol.iterator](),r);if(Stack.size(r.stack)>0)yield*suspend();else break}};let ID=0;const IDLE="idle",ACTIVE="active",FINISHED="finished",INIT={done:!1,value:CURRENT},BLANK$1={},NONE=function*t(){}(),MAIN=new Main;function Indexed(){}Object.defineProperties(Indexed,{prototype:{value:new Proxy(Object.prototype,{get(t,e,n){return typeof e=="symbol"?Reflect.get(t,e,n):n.get(e)}})}});const empty$2=()=>new BufferView,slice=(t,e=0,n=t.byteLength)=>{const r=[],i=e<0?t.byteLength-e:e,o=n<0?t.byteLength-n:n;if(i===0&&o>=t.byteLength)return t;if(i>o||i>t.byteLength||o<=0)return empty$2();let s=0,a=0;for(const c of t.segments){const l=a+c.byteLength;if(s===0){if(o<=l){const f=c.subarray(i-a,o-a);r.push(f),s=f.byteLength;break}else if(i<l){const f=i===a?c:c.subarray(i-a);r.push(f),s=f.byteLength}}else if(o<=l){const f=o===l?c:c.subarray(0,o-a);r.push(f),s+=f.byteLength;break}else r.push(c),s+=c.byteLength;a=l}return new BufferView(r,t.byteOffset+i,s)},push=(t,e)=>e.byteLength>0?(t.segments.push(e),new BufferView(t.segments,t.byteOffset,t.byteLength+e.byteLength)):t,get$4=(t,e)=>{if(e<t.byteLength){let n=0;for(const r of t.segments){if(e<n+r.byteLength)return r[e-n];n+=r.byteLength}}},copyTo=(t,e,n)=>{let r=n;for(const i of t.segments)e.set(i,r),r+=i.byteLength;return e};function*iterate$1(t){for(const e of t.segments)yield*e}class BufferView extends Indexed{constructor(e=[],n=0,r=0){super(),this.segments=e,this.byteLength=r,this.length=r,this.byteOffset=n}[Symbol.iterator](){return iterate$1(this)}slice(e,n){return slice(this,e,n)}subarray(e,n){return slice(this,e,n)}push(e){return push(this,e)}get(e){return get$4(this,e)}copyTo(e,n){return copyTo(this,e,n)}}const panic=t=>{throw new Error(t)},unreachable=(t,e,...n)=>panic(String.raw(t,JSON.stringify(e),...n)),EMPTY_BUFFER=new Uint8Array(0),EMPTY$2=[],open$1=t=>({config:t,buffer:empty$2()}),write$3=(t,e)=>e.byteLength>0?split(t.config,t.buffer.push(e),!1):{...t,chunks:EMPTY$2},close$3=t=>split(t.config,t.buffer,!0),split=(t,e,n)=>{const r=t.chunker,i=[];let o=0;for(const s of r.cut(r.context,e,n))if(s>0){const a=e.subarray(o,o+s);i.push(a),o+=s}return{config:t,chunks:i,buffer:e.subarray(o)}},mutable=()=>({mutable:!0,needs:{},nodes:{},links:{},linked:EMPTY$1}),addNodes=(t,e)=>{let n=patch(e,{});for(const r of t){const{ready:i,has:o,wants:s}=collect(r.children,n.links);s.length===0?n=patch(n,{links:assign(void 0,o),linked:[{id:r.id,links:i}]}):n=patch(n,{needs:assign(r.id,s),nodes:{[r.id]:{children:r.children,count:s.length}}})}return n},addLink=(t,e,n)=>{const r=n.needs[t],i=n.nodes[r];if(i!=null)if(i.count===1){const{ready:o,has:s}=collect(i.children,{...n.links,[t]:e});return patch(n,{needs:{[t]:void 0},links:assign(void 0,s),nodes:{[r]:void 0},linked:[{id:r,links:o}]})}else return patch(n,{needs:{[t]:void 0},links:{[t]:e},nodes:{[r]:{...i,count:i.count-1}}});else return patch(n,{links:{[t]:e}})},patch=(t,{needs:e,nodes:n,links:r,linked:i})=>{const o=t.mutable?t:{...t},s=t.mutable?BLANK:void 0;return e&&(o.needs=patchDict(t.needs,e,s)),n&&(o.nodes=patchDict(t.nodes,n,s)),r&&(o.links=patchDict(t.links,r,s)),o.linked=i?append(t.linked||EMPTY$1,i,EMPTY$1):t.linked||[],o},assign=(t,e)=>{const n={};for(const r of e)n[r]=t;return n},patchDict=(t,e,n=t)=>{const r=t===n?{...t}:t;for(const i of Object.entries(e)){const[o,s]=i;s==null?delete r[o]:r[o]=s}return r},append=(t,e,n=t)=>{if(t===n)return[...t,...e];for(const r of e)t.push(r);return t},collect=(t,e)=>{const n=[],r=[],i=[];for(const o of t){const s=e[o];s?(n.push(o),i.push(s)):r.push(o)}return{has:n,wants:r,ready:i}},EMPTY$1=Object.freeze([]),BLANK=Object.freeze({}),update=(t,e)=>{switch(t.type){case"write":return write$2(e,t.bytes);case"link":return link(e,t.link);case"block":return{state:e,effect:none()};case"close":return close$2(e);case"end":return{state:e,effect:none()};default:return unreachable`File Writer got unknown message ${t}`}},init=(t,e,n)=>({status:"open",metadata:e,config:n,writer:t,chunker:open$1({chunker:n.chunker}),layout:n.fileLayout.open(),nodeQueue:mutable()}),write$2=(t,e)=>{if(t.status==="open"){const{chunks:n,...r}=write$3(t.chunker,e),{nodes:i,leaves:o,layout:s}=t.config.fileLayout.write(t.layout,n),{linked:a,...c}=addNodes(i,t.nodeQueue),l=[...encodeLeaves(o,t.config),...encodeBranches(a,t.config)];return{state:{...t,chunker:r,layout:s,nodeQueue:c},effect:listen({link:effects(l)})}}else return panic("Unable to perform write on closed file")},link=(t,{id:e,link:n,block:r})=>{let{linked:i,...o}=addLink(e,n,t.nodeQueue);const s=encodeBranches(i,t.config),a=t.status==="closed"&&e===t.rootID?{...t,status:"linked",link:n,nodeQueue:o}:{...t,nodeQueue:o},c=t.status==="closed"&&e===t.rootID&&t.end?t.end.resume():none();return{state:a,effect:listen({link:effects(s),block:writeBlock(t.writer,r),end:c})}},close$2=t=>{if(t.status==="open"){const{chunks:e}=close$3(t.chunker),{layout:n,...r}=t.config.fileLayout.write(t.layout,e),{root:i,...o}=t.config.fileLayout.close(n,t.metadata),[s,a]=isLeafNode(i)?[[...r.nodes,...o.nodes],[...r.leaves,...o.leaves,i]]:[[...r.nodes,...o.nodes,i],[...r.leaves,...o.leaves]],{linked:c,...l}=addNodes(s,t.nodeQueue),f=[...encodeLeaves(a,t.config),...encodeBranches(c,t.config)],h=fork$1(suspend());return{state:{...t,chunker:null,layout:null,rootID:i.id,status:"closed",end:h,nodeQueue:l},effect:listen({link:effects(f),end:join(h)})}}else return{state:t,effect:none()}},encodeLeaves=(t,e)=>t.map(n=>encodeLeaf(e,n,e.fileChunkEncoder)),encodeLeaf=function*({hasher:t,linker:e},{id:n,content:r},i){const o=i.encode(r?asUint8Array(r):EMPTY_BUFFER),s=yield*wait(t.digest(o)),a=e.createLink(i.code,s),c={cid:a,bytes:o},l={cid:a,contentByteLength:r?r.byteLength:0,dagByteLength:o.byteLength};return{id:n,block:c,link:l}},encodeBranches=(t,e)=>t.map(n=>encodeBranch(e,n)),encodeBranch=function*(t,{id:e,links:n},r){const i=t.fileEncoder.encode({type:NodeType.File,layout:"advanced",parts:n,metadata:r}),o=yield*wait(Promise.resolve(t.hasher.digest(i))),s=t.linker.createLink(t.fileEncoder.code,o),a={bytes:i,cid:s},c={cid:s,contentByteLength:cumulativeContentByteLength(n),dagByteLength:cumulativeDagByteLength(i,n)};return{id:e,block:a,link:c}},writeBlock=function*(t,e){(t.desiredSize||0)<=0&&(yield*wait(t.ready)),t.write(e)},asUint8Array=t=>t instanceof Uint8Array?t:t.copyTo(new Uint8Array(t.byteLength),0),isLeafNode=t=>t.children==null,name="fixed",context={maxChunkSize:262144},type="Stateless",withMaxChunkSize=t=>({type:"Stateless",context:{maxChunkSize:t},name,cut}),cut=({maxChunkSize:t},{byteLength:e},n)=>{const r=e/t|0,i=new Array(r).fill(t),o=n?e-r*t:0;return o>0&&i.push(o),i},FixedSize=Object.freeze(Object.defineProperty({__proto__:null,context,cut,name,type,withMaxChunkSize},Symbol.toStringTag,{value:"Module"}));class Node{constructor(e,n,r){this.id=e,this.children=n,this.metadata=r}}const withWidth=t=>({open:()=>open({width:t}),write:write$1,close:close$1}),defaults$1={width:174},open=({width:t}=defaults$1)=>({width:t,head:null,leafIndex:[],nodeIndex:[],lastID:0}),write$1=(t,e)=>{if(e.length===0)return{layout:t,nodes:EMPTY,leaves:EMPTY};{let{lastID:n}=t;const[r,i]=t.head?[null,(e.unshift(t.head),e)]:e.length===1&&t.leafIndex.length===0?[e[0],EMPTY]:[null,e];if(i.length===0)return{layout:{...t,head:r},nodes:EMPTY,leaves:EMPTY};{const o=[...t.leafIndex],s=[];for(const a of i){const c={id:++n,content:a};s.push(c),o.push(c.id)}return o.length>t.width?flush({...t,leafIndex:o,head:r,lastID:n},s):{layout:{...t,head:r,leafIndex:o,lastID:n},leaves:s,nodes:EMPTY}}}},flush=(t,e=EMPTY,n=[],r=!1)=>{let{lastID:i}=t;const o=t.nodeIndex.map(l=>[...l]),s=[...t.leafIndex],{width:a}=t;for(;s.length>a||s.length>0&&r;){grow(o,1);const l=new Node(++i,s.splice(0,a));o[0].push(l.id),n.push(l)}let c=0;for(;c<o.length;){const l=o[c];for(c++;l.length>a||l.length>0&&r&&c<o.length;){const f=new Node(++i,l.splice(0,a));grow(o,c+1),o[c].push(f.id),n.push(f)}}return{layout:{...t,lastID:i,leafIndex:s,nodeIndex:o},leaves:e,nodes:n}},close$1=(t,e)=>{const n=t;if(t.head)return{root:{id:1,content:t.head,metadata:e},leaves:EMPTY,nodes:EMPTY};if(t.leafIndex.length===0)return{root:{id:1,metadata:e},leaves:EMPTY,nodes:EMPTY};{const{nodes:r,layout:i}=flush(n,EMPTY,[],!0),{nodeIndex:o}=i,s=o.length-1,a=o[s];if(a.length===1){const c=r[r.length-1];return r.length=r.length-1,{root:c,nodes:r,leaves:EMPTY}}else return{root:new Node(i.lastID+1,a,e),nodes:r,leaves:EMPTY}}},grow=(t,e)=>{for(;t.length<e;)t.push([]);return t},EMPTY=[],defaults=()=>({chunker:FixedSize,fileChunkEncoder:UnixFSLeaf,smallFileEncoder:UnixFSLeaf,fileEncoder:UnixFS,fileLayout:withWidth(174),hasher:sha256,linker:{createLink:CID.createV1}}),configure$4=t=>({...defaults(),...t}),UnixFSLeaf={code,name:name$1,encode:encodeFileChunk},create$1=({writer:t,metadata:e={},settings:n=defaults()})=>new FileWriterView(init(t,e,configure$4(n))),write=async(t,e)=>(await perform(t,send({type:"write",bytes:e})),t),close=async(t,{releaseLock:e=!1,closeWriter:n=!1}={})=>{await perform(t,send({type:"close"}));const{state:r}=t;if(r.status==="linked")return n?await t.state.writer.close():e&&t.state.writer.releaseLock(),r.link;panic(`Expected writer to be in 'linked' state after close, but it is in "${r.status}" instead`)},perform=(t,e)=>fork$1(loop(e,n=>{const{state:r,effect:i}=update(n,t.state);return t.state=r,i}));class FileWriterView{constructor(e){this.state=e}get writer(){return this.state.writer}get settings(){return this.state.config}write(e){return write(this,e)}close(e){return close(this,e)}}const api=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),empty$1=(t=32)=>{if(t!==32)throw new Error(`Uint32 BitField does not support size: ${t}`);return 0},from$3=(t,e)=>{let n=empty$1(e);for(const r of t)n=set$2(n,r);return n},size$1=t=>32,mask=(t,e)=>t>>>e&31,offset=(t,e)=>1<<mask(t,e),popcount$1=(t,e=31)=>bitCount(t&offset(e,0)-1),set$2=(t,e)=>t|1<<e,unset$1=(t,e)=>t&(255^1<<e),get$3=(t,e)=>(t>>e&1)!==0,bitCount=t=>{const e=t-(t>>1&1431655765),n=(e&858993459)+(e>>2&858993459);return(n+(n>>4)&252645135)*16843009>>24},and$1=(t,e)=>t&e,or$1=(t,e)=>t|e,toBytes$1=t=>Uint8Array.of(t>>24&255,t>>16&255,t>>8&255,t&255),fromBytes$1=t=>{if(t.length!==4)throw new Error(`Expected 4 bytes instead got ${t.length}`);return(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3]},Uint32BitField=Object.freeze(Object.defineProperty({__proto__:null,API:api,and:and$1,bitCount,empty:empty$1,from:from$3,fromBytes:fromBytes$1,get:get$3,or:or$1,popcount:popcount$1,set:set$2,size:size$1,toBytes:toBytes$1,unset:unset$1},Symbol.toStringTag,{value:"Module"}));var murmurHash3js={exports:{}};(function(t,e){(function(n,r){var i={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function o(u){if(!Array.isArray(u)&&!ArrayBuffer.isView(u))return!1;for(var d=0;d<u.length;d++)if(!Number.isInteger(u[d])||u[d]<0||u[d]>255)return!1;return!0}function s(u,d){return(u&65535)*d+(((u>>>16)*d&65535)<<16)}function a(u,d){return u<<d|u>>>32-d}function c(u){return u^=u>>>16,u=s(u,2246822507),u^=u>>>13,u=s(u,3266489909),u^=u>>>16,u}function l(u,d){u=[u[0]>>>16,u[0]&65535,u[1]>>>16,u[1]&65535],d=[d[0]>>>16,d[0]&65535,d[1]>>>16,d[1]&65535];var w=[0,0,0,0];return w[3]+=u[3]+d[3],w[2]+=w[3]>>>16,w[3]&=65535,w[2]+=u[2]+d[2],w[1]+=w[2]>>>16,w[2]&=65535,w[1]+=u[1]+d[1],w[0]+=w[1]>>>16,w[1]&=65535,w[0]+=u[0]+d[0],w[0]&=65535,[w[0]<<16|w[1],w[2]<<16|w[3]]}function f(u,d){u=[u[0]>>>16,u[0]&65535,u[1]>>>16,u[1]&65535],d=[d[0]>>>16,d[0]&65535,d[1]>>>16,d[1]&65535];var w=[0,0,0,0];return w[3]+=u[3]*d[3],w[2]+=w[3]>>>16,w[3]&=65535,w[2]+=u[2]*d[3],w[1]+=w[2]>>>16,w[2]&=65535,w[2]+=u[3]*d[2],w[1]+=w[2]>>>16,w[2]&=65535,w[1]+=u[1]*d[3],w[0]+=w[1]>>>16,w[1]&=65535,w[1]+=u[2]*d[2],w[0]+=w[1]>>>16,w[1]&=65535,w[1]+=u[3]*d[1],w[0]+=w[1]>>>16,w[1]&=65535,w[0]+=u[0]*d[3]+u[1]*d[2]+u[2]*d[1]+u[3]*d[0],w[0]&=65535,[w[0]<<16|w[1],w[2]<<16|w[3]]}function h(u,d){return d%=64,d===32?[u[1],u[0]]:d<32?[u[0]<<d|u[1]>>>32-d,u[1]<<d|u[0]>>>32-d]:(d-=32,[u[1]<<d|u[0]>>>32-d,u[0]<<d|u[1]>>>32-d])}function p(u,d){return d%=64,d===0?u:d<32?[u[0]<<d|u[1]>>>32-d,u[1]<<d]:[u[1]<<d-32,0]}function g(u,d){return[u[0]^d[0],u[1]^d[1]]}function L(u){return u=g(u,[0,u[0]>>>1]),u=f(u,[4283543511,3981806797]),u=g(u,[0,u[0]>>>1]),u=f(u,[3301882366,444984403]),u=g(u,[0,u[0]>>>1]),u}i.x86.hash32=function(u,d){if(i.inputValidation&&!o(u))return r;d=d||0;for(var w=u.length%4,O=u.length-w,m=d,y=0,b=3432918353,k=461845907,S=0;S<O;S=S+4)y=u[S]|u[S+1]<<8|u[S+2]<<16|u[S+3]<<24,y=s(y,b),y=a(y,15),y=s(y,k),m^=y,m=a(m,13),m=s(m,5)+3864292196;switch(y=0,w){case 3:y^=u[S+2]<<16;case 2:y^=u[S+1]<<8;case 1:y^=u[S],y=s(y,b),y=a(y,15),y=s(y,k),m^=y}return m^=u.length,m=c(m),m>>>0},i.x86.hash128=function(u,d){if(i.inputValidation&&!o(u))return r;d=d||0;for(var w=u.length%16,O=u.length-w,m=d,y=d,b=d,k=d,S=0,B=0,$=0,T=0,_=597399067,F=2869860233,z=951274213,D=2716044179,v=0;v<O;v=v+16)S=u[v]|u[v+1]<<8|u[v+2]<<16|u[v+3]<<24,B=u[v+4]|u[v+5]<<8|u[v+6]<<16|u[v+7]<<24,$=u[v+8]|u[v+9]<<8|u[v+10]<<16|u[v+11]<<24,T=u[v+12]|u[v+13]<<8|u[v+14]<<16|u[v+15]<<24,S=s(S,_),S=a(S,15),S=s(S,F),m^=S,m=a(m,19),m+=y,m=s(m,5)+1444728091,B=s(B,F),B=a(B,16),B=s(B,z),y^=B,y=a(y,17),y+=b,y=s(y,5)+197830471,$=s($,z),$=a($,17),$=s($,D),b^=$,b=a(b,15),b+=k,b=s(b,5)+2530024501,T=s(T,D),T=a(T,18),T=s(T,_),k^=T,k=a(k,13),k+=m,k=s(k,5)+850148119;switch(S=0,B=0,$=0,T=0,w){case 15:T^=u[v+14]<<16;case 14:T^=u[v+13]<<8;case 13:T^=u[v+12],T=s(T,D),T=a(T,18),T=s(T,_),k^=T;case 12:$^=u[v+11]<<24;case 11:$^=u[v+10]<<16;case 10:$^=u[v+9]<<8;case 9:$^=u[v+8],$=s($,z),$=a($,17),$=s($,D),b^=$;case 8:B^=u[v+7]<<24;case 7:B^=u[v+6]<<16;case 6:B^=u[v+5]<<8;case 5:B^=u[v+4],B=s(B,F),B=a(B,16),B=s(B,z),y^=B;case 4:S^=u[v+3]<<24;case 3:S^=u[v+2]<<16;case 2:S^=u[v+1]<<8;case 1:S^=u[v],S=s(S,_),S=a(S,15),S=s(S,F),m^=S}return m^=u.length,y^=u.length,b^=u.length,k^=u.length,m+=y,m+=b,m+=k,y+=m,b+=m,k+=m,m=c(m),y=c(y),b=c(b),k=c(k),m+=y,m+=b,m+=k,y+=m,b+=m,k+=m,("00000000"+(m>>>0).toString(16)).slice(-8)+("00000000"+(y>>>0).toString(16)).slice(-8)+("00000000"+(b>>>0).toString(16)).slice(-8)+("00000000"+(k>>>0).toString(16)).slice(-8)},i.x64.hash128=function(u,d){if(i.inputValidation&&!o(u))return r;d=d||0;for(var w=u.length%16,O=u.length-w,m=[0,d],y=[0,d],b=[0,0],k=[0,0],S=[2277735313,289559509],B=[1291169091,658871167],$=0;$<O;$=$+16)b=[u[$+4]|u[$+5]<<8|u[$+6]<<16|u[$+7]<<24,u[$]|u[$+1]<<8|u[$+2]<<16|u[$+3]<<24],k=[u[$+12]|u[$+13]<<8|u[$+14]<<16|u[$+15]<<24,u[$+8]|u[$+9]<<8|u[$+10]<<16|u[$+11]<<24],b=f(b,S),b=h(b,31),b=f(b,B),m=g(m,b),m=h(m,27),m=l(m,y),m=l(f(m,[0,5]),[0,1390208809]),k=f(k,B),k=h(k,33),k=f(k,S),y=g(y,k),y=h(y,31),y=l(y,m),y=l(f(y,[0,5]),[0,944331445]);switch(b=[0,0],k=[0,0],w){case 15:k=g(k,p([0,u[$+14]],48));case 14:k=g(k,p([0,u[$+13]],40));case 13:k=g(k,p([0,u[$+12]],32));case 12:k=g(k,p([0,u[$+11]],24));case 11:k=g(k,p([0,u[$+10]],16));case 10:k=g(k,p([0,u[$+9]],8));case 9:k=g(k,[0,u[$+8]]),k=f(k,B),k=h(k,33),k=f(k,S),y=g(y,k);case 8:b=g(b,p([0,u[$+7]],56));case 7:b=g(b,p([0,u[$+6]],48));case 6:b=g(b,p([0,u[$+5]],40));case 5:b=g(b,p([0,u[$+4]],32));case 4:b=g(b,p([0,u[$+3]],24));case 3:b=g(b,p([0,u[$+2]],16));case 2:b=g(b,p([0,u[$+1]],8));case 1:b=g(b,[0,u[$]]),b=f(b,S),b=h(b,31),b=f(b,B),m=g(m,b)}return m=g(m,[0,u.length]),y=g(y,[0,u.length]),m=l(m,y),y=l(y,m),m=L(m),y=L(y),m=l(m,y),y=l(y,m),("00000000"+(m[0]>>>0).toString(16)).slice(-8)+("00000000"+(m[1]>>>0).toString(16)).slice(-8)+("00000000"+(y[0]>>>0).toString(16)).slice(-8)+("00000000"+(y[1]>>>0).toString(16)).slice(-8)},t.exports&&(e=t.exports=i),e.murmurHash3=i})()})(murmurHash3js,murmurHash3js.exports);var murmurHash3jsExports=murmurHash3js.exports,murmurhash3jsRevisited=murmurHash3jsExports;const mur=getDefaultExportFromCjs(murmurhash3jsRevisited),utf8$2=new TextEncoder,hash32=mur.x64.hash126,configure$3=({bitWidth:t=5,hash:e=hash32})=>{if(t>4*8)throw new RangeError(`Can not use bitWidth ${t} which exceeds the hashSize 4`);const r=4294967295>>>32-t;return{at:(s,a)=>s>>>a*t&r,from:s=>e(utf8$2.encode(s)),size:Math.ceil(4*8/t)}};class BitmapIndexedNode{constructor(e,n,r,i,o){this.edit=e,this.config=o,this.datamap=n,this.nodemap=r,this.children=i}get nodeArity(){return this.config.BitField.popcount(this.nodemap)}get dataArity(){return this.config.BitField.popcount(this.datamap)}empty(){return create(this.config)}lookup(e,n,r,i){return lookup(this,e,n,r,i)}associate(e,n,r,i,o,s){return associate(this,e,n,r,i,o,s)}dissociate(e,n,r,i,o){return dissociate(this,e,n,r,i,o)}fork(e=null){return fork(this,e)}entries(){return entries(this)}keys(){return keys(this)}values(){return values(this)}}class HashCollisionNode{constructor(e,n,r,i){this.edit=e,this.count=n,this.children=r,this.config=i}get nodeArity(){return 0}get dataArity(){return this.count}lookup(e,n,r,i){return lookupCollision(this,r,i)}associate(e,n,r,i,o,s){return associateCollision(this,e,r,i,o,s)}dissociate(e,n,r,i,o){return dissociateCollision(this,e,r,i,o)}fork(e=null){return forkCollision(this,e)}entries(){return entries(this)}keys(){return keys(this)}values(){return values(this)}}const lookupCollision=(t,e,n)=>{const{children:r,count:i}=t,o=findHashCollisionNodeIndex(r,i,e);return r[o]===e?r[o+1]:n},associateCollision=(t,e,n,r,i,o)=>{const{children:s,count:a}=t,c=findHashCollisionNodeIndex(s,a,r);if(s[c]!==r){const l=t.fork(e);return o.value=!0,l.count+=1,l.children.splice(c,n,i),l}else if(s[c+1]!==i){const l=t.fork(e);return l.children[c+1]=i,l}else return t},dissociateCollision=(t,e,n,r,i)=>{const{children:o,count:s,config:a}=t,c=findHashCollisionNodeIndex(o,s,r);if(o[c]!==r)return t;if(i.value=!0,s===2){const l=c===0?2:0;return associate(create(a),e,0,n,o[l],o[l+1],i)}else{const l=t.fork(e);return l.children.splice(c,2),l.count-=1,l}},forkCollision=(t,e=null)=>canEdit(t.edit,e)?t:new HashCollisionNode(e,t.count,t.children.slice(),t.config),findHashCollisionNodeIndex=(t,e,n)=>{let r=0;for(;r<e&&t[r]>n;)r+=2;return r},create=(t,e=null)=>new BitmapIndexedNode(e,t.BitField.empty(Math.pow(2,t.bitWidth)),t.BitField.empty(Math.pow(2,t.bitWidth)),[],t),get$2=(t,e,n)=>lookup(t,0,t.config.Path.from(e),e,n),lookup=(t,e,n,r,i)=>{const{datamap:o,nodemap:s,config:a}=t,{Path:c,BitField:l}=a,f=c.at(n,e);if(l.get(o,f)){const h=l.popcount(o,f);return keyAt(t,h)===r?valueAt(t,h):i}else return l.get(s,f)?resolveNode(t,f).lookup(e+1,n,r,i):i},set$1=(t,e,n,r,i)=>associate(t,e,0,t.config.Path.from(n),n,r,i),associate=(t,e,n,r,i,o,s)=>{const{datamap:a,nodemap:c,config:l}=t,{Path:f,BitField:h}=l,p=f.at(r,n);if(h.get(a,p)){const g=h.popcount(a,p),L=keyAt(t,g);if(i===L)return valueAt(t,g)===o?t:forkAndSet(t,e,g,o);{const u=mergeTwoLeaves(l,e,n+1,f.from(L),L,valueAt(t,g),r,i,o);return s.value=!0,migrateLeafToBranch(t,e,p,u)}}else if(h.get(c,p)){const g=resolveNode(t,p),L=g.associate(e,n+1,r,i,o,s);return g===L?t:copyAndSetChild(t,e,p,L)}else{const g=h.popcount(a,p);s.value=!0;const L=t.fork(e);return L.datamap=h.set(a,p),L.children.splice(keyPosition(g),0,i,o),L}},remove=(t,e,n,r)=>dissociate(t,e,0,t.config.Path.from(n),n,r),dissociate=(t,e,n,r,i,o)=>{const{datamap:s,nodemap:a,config:c}=t,{BitField:l,Path:f}=c,h=f.at(r,n);if(l.get(s,h)){const p=l.popcount(s,h);if(i===keyAt(t,p)){o.value=!0;const g=fork(t,e);return g.datamap=l.unset(t.datamap,h),g.children.splice(keyPosition(p),2),g}else return t}else if(l.get(a,h)){const p=resolveNode(t,h),g=p.dissociate(e,n+1,r,i,o);return hasSingleLeaf(g)?hasSingleNode(t)?g:inlineChild(t,e,h,g):p===g?t:copyAndSetChild(t,e,h,g)}else return t},entries=function*({children:t}){let e=0;const n=t.length;for(;e<n;){const r=t[e];if(typeof r=="string"){e+=1;const i=t[e];yield[r,i],e+=1}else break}for(;e<n;)yield*t[e].entries(),e+=1},fork=(t,e)=>canEdit(t.edit,e)?t:new BitmapIndexedNode(e,t.datamap,t.nodemap,t.children.slice(),t.config),keys=function*({children:t}){let e=0;const n=t.length;for(;e<n;){const r=t[e];if(typeof r=="string")yield r,e+=2;else break}for(;e<n;)yield*t[e].keys(),e+=1},values=function*({children:t}){let e=0;const n=t.length;for(;e<n&&typeof t[e]=="string";)e+=1,yield t[e],e+=1;for(;e<n;)yield*t[e].values(),e+=1},forkAndSet=(t,e,n,r)=>{const i=t.fork(e);return i.children[valuePosition(n)]=r,i},inlineChild=(t,e,n,r)=>{const{datamap:i,nodemap:o,config:s}=t,{BitField:a}=s,c=fork(t,e);return c.children.splice(nodePosition(t,n),1),c.children.splice(keyPosition(a.popcount(i,n)),0,r.children[0],r.children[1]),c.datamap=a.set(i,n),c.nodemap=a.unset(o,n),c},copyAndSetChild=(t,e,n,r)=>{const i=fork(t,e);return i.children[nodePosition(t,n)]=r,i},migrateLeafToBranch=(t,e,n,r)=>{const{nodemap:i,datamap:o,config:s}=t,{BitField:a}=s,c=a.popcount(o,n),l=keyPosition(c),f=nodePosition(t,n),h=fork(t,e);return h.datamap=a.unset(o,n),h.children.splice(l,2),h.nodemap=a.set(i,n),h.children.splice(f-1,0,r),h},mergeTwoLeaves=(t,e,n,r,i,o,s,a,c)=>{const{BitField:l,Path:f}=t;if(f.size<n)return new HashCollisionNode(e,2,[i,o,a,c],t);{const h=f.at(r,n),p=f.at(s,n);return h===p?new BitmapIndexedNode(e,l.empty(Math.pow(2,t.bitWidth)),l.from([h],Math.pow(2,t.bitWidth)),[mergeTwoLeaves(t,e,n+1,r,i,o,s,a,c)],t):new BitmapIndexedNode(e,l.from([h,p],Math.pow(2,t.bitWidth)),l.empty(Math.pow(2,t.bitWidth)),h<p?[i,o,a,c]:[a,c,i,o],t)}},keyAt=({children:t},e)=>t[keyPosition(e)],keyPosition=t=>t*2,valueAt=({children:t},e)=>t[valuePosition(e)],valuePosition=t=>t*2+1,resolveNode=(t,e)=>t.children[nodePosition(t,e)],nodePosition=({children:t,nodemap:e,config:n},r)=>t.length-1-n.BitField.popcount(e,r),canEdit=(t,e)=>t!=null&&t===e,hasSingleLeaf=t=>t.nodeArity===0&&t.dataArity===1,hasSingleNode=({config:{BitField:t},datamap:e,nodemap:n})=>t.popcount(e)===0&&t.popcount(n)===1,murmur364=from$4({name:"murmur3-x64-64",code:34,encode:t=>fromHex(mur.x64.hash128(t)).subarray(0,8)}),utf8$1=new TextEncoder,hash64$1=t=>murmur364.encode(t),configure$2=({bitWidth:t=8,hash:e=hash64$1}={})=>{const n=e(new Uint8Array).byteLength;return{from:o=>e(utf8$1.encode(o)),at:(o,s)=>{const a=s*t;if(a>n)throw new RangeError("Out of bounds");return toInt(o,a,t)},size:Math.ceil(n*8/t)}},toInt=(t,e,n)=>{let r=e/8|0,i=e%8,o=n,s=0;for(;o>0&&r<t.byteLength;){const a=t[r],c=8-i,l=c<o?c:o,f=8-i-l,p=(255>>i&a)>>f;s=(s<<l)+p,o-=l,r++,i=0}return s},empty=(t=256)=>{if(t%8!==0)throw new Error("Must be multiple of 8");return new Uint8Array(t/8)},from$2=(t,e)=>{let n=empty(e);for(const r of t){const{byte:i,byteOffset:o,bitOffset:s}=at(n,r);n[o]=i|1<<s}return n},size=t=>t.byteLength*8,at=(t,e)=>{const n=t.byteLength-1-(e/8|0),r=e%8;return{byte:t[n],byteOffset:n,bitOffset:r}},setByte=(t,e,n)=>{if(t[e]!==n){const r=t.slice(0);return r[e]=n,r}return t},set=(t,e)=>{const{byte:n,byteOffset:r,bitOffset:i}=at(t,e);return setByte(t,r,n|1<<i)},unset=(t,e)=>{const{byte:n,byteOffset:r,bitOffset:i}=at(t,e);return setByte(t,r,n&(255^1<<i))},get$1=(t,e)=>{var{byte:n,bitOffset:r}=at(t,e);return(n>>r&1)!==0},toBytes=t=>t,fromBytes=t=>t,popcount=(t,e=t.byteLength*8)=>{const{byteOffset:n,bitOffset:r,byte:i}=at(t,e);let o=popcount$1(i,r),s=t.byteLength-1;for(;s>n;){const a=t[s];o+=bitCount(a),s--}return o},or=(t,e)=>{const n=t.slice();let r=0;for(;r<t.length;)n[r]|=e[r],r++;return n},and=(t,e)=>{const n=t.slice();let r=0;for(;r<t.length;)n[r]&=e[r],r++;return n},Uint8ArrayBitField=Object.freeze(Object.defineProperty({__proto__:null,API:api,and,empty,from:from$2,fromBytes,get:get$1,or,popcount,set,size,toBytes,unset},Symbol.toStringTag,{value:"Module"})),NOT_FOUND=new RangeError("Not Found"),configure$1=({bitWidth:t=5,BitField:e=t===5?Uint32BitField:Uint8ArrayBitField,Path:n=t===5?configure$3({bitWidth:t}):configure$2({bitWidth:t})}={})=>({bitWidth:t,BitField:e,Path:n}),from$1=(t,e)=>{const n=builder$1(e);for(const[r,i]of t)n.set(r,i);return n.build()},has=(t,e)=>get$2(t.root,e,NOT_FOUND)!==NOT_FOUND,get=(t,e,n=void 0)=>get$2(t.root,e,n),builder$1=t=>{const e={},n=configure$1(t);return new HashMapBuilder(e,0,create(n,e),n)};class PersistentHashMap{constructor(e=0,n,r){this.count=e,this.root=n,this.config=r}get size(){return this.count}clone(){return new PersistentHashMap(this.count,this.root,this.config)}empty(){return new PersistentHashMap(0,create(this.config,null),this.config)}has(e){return has(this,e)}get(e){return get$2(this.root,e,void 0)}set(e,n){const r={value:!1},i=set$1(this.root,null,e,n,r);return i===this.root?this:new PersistentHashMap(r.value?this.count+1:this.count,i,this.config)}delete(e){const n=remove(this.root,null,e,{value:!1});return n===this.root?this:new PersistentHashMap(this.count-1,n,this.config)}get bitField(){return this.config.BitField.or(this.root.datamap,this.root.nodemap)}[Symbol.iterator](){return this.entries()}entries(){return this.root.entries()}keys(){return this.root.keys()}values(){return this.root.values()}createBuilder(){return new HashMapBuilder({},this.count,this.root,this.config)}}class HashMapBuilder{constructor(e,n,r,i){this.edit=e,this.count=n,this.root=r,this.config=i}get size(){if(this.edit)return this.count;throw new Error(".size was accessed on the finalized builder")}set(e,n){if(this.edit){const r={value:!1},i=set$1(this.root,this.edit,e,n,r);return this.root!==i&&(this.root=i),r.value&&(this.count+=1),this}else throw new Error(".set was called on the finalized builder")}delete(e){if(this.edit){if(this.count===0)return this;const n={value:!1},r=remove(this.root,this.edit,e,n);return r!==this.root&&(this.root=r),n.value&&(this.count-=1),this}else throw new Error(".delete was called on the finalized builder")}build(){if(this.edit)return this.edit=null,new PersistentHashMap(this.count,this.root,this.config);throw new Error(".build was called on the finalized builder")}}const utf8=new TextEncoder,hash64=t=>murmur364.encode(t),configure=({bitWidth:t=8,hash:e=hash64})=>{const n=e(new Uint8Array).byteLength,r={bitWidth:t,hash:e,hashSize:n};return{at:(s,a)=>read(s,a,r),from:s=>utf8.encode(s),size:1/0}},read=(t,e=0,{bitWidth:n=8,hash:r,hashSize:i})=>{const o=i*8;let s=0,a=n,c=n*e;for(;a>0;){const l=c/o>>0,f=r(l===0?t:appendByte(t,l)),h=o<=c?c%o:c,p=o-h,g=p<a?p:a;s=(s<<g)+toInt(f,h,g),a-=g,c+=g}return s},appendByte=(t,e)=>{const n=new Uint8Array(t.byteLength+1).fill(e,t.byteLength);return n.set(t),n},bitWidth=8,config={bitWidth,Path:configure({bitWidth})},tableSize=t=>Math.pow(2,t.config.bitWidth),builder=(t=config)=>builder$1(t),from=(t,e=config)=>from$1(t,e),bitField=({datamap:t,nodemap:e,config:{BitField:n}})=>withoutLeadingZeros(n.toBytes(n.or(t,e))),withoutLeadingZeros=t=>{let e=0;for(;e<t.byteLength;){if(t[e]!==0)return t.subarray(e);e+=1}return t.subarray(e)},iterate=function*(t){const{config:e,datamap:n,nodemap:r}=t,{BitField:i}=e,o=i.size(n);let s=0,a=0;for(;s<o;){const c=s.toString(16).toUpperCase().padStart(2,"0");if(i.get(n,s)){const l=keyAt(t,a);yield{prefix:c,key:l,value:valueAt(t,a)},a++}else i.get(r,s)&&(yield{prefix:c,node:resolveNode(t,s)});s++}};class UninitializedError extends Error{}function toggle({condition:t=()=>!0,branch:e={if:()=>{},else:()=>{}}}){return()=>{var n,r;return t!=null&&t()?(n=e==null?void 0:e.if)==null?void 0:n.call(e):(r=e==null?void 0:e.else)==null?void 0:r.call(e)}}const records2Objects=t=>t.map(record2Object),records2Object=t=>records2Objects(t)[0],record2Object=t=>Object.fromEntries(t.keys.map(e=>[e,t.get(e)]));let count=0;const identify=t=>t.map((e,n)=>({id:++count,...e}));var A,E;const x=class x{constructor(e){N(this,"point",this);N(this,"neo4j",null);I(this,A,null);M(this,A,e)}static get root(){return R(this,E)||M(this,E,this.get.root().then(e=>M(this,E,e))),R(this,E)}};A=new WeakMap,E=new WeakMap,I(x,E,null),N(x,"gen",{child:e=>{const n=x.create({path:e??"/sys/points/new/"});if(!Array.isArray(n))throw new Error(`\`this.create()\` didnt return an \`Array\` (${typeof n}).`);if(n.length!==1)throw new Error(`\`this.create()\` returned ${n.length} points.`);if(n.length===1)return n[0]}}),N(x,"create",async({path:e,sep:n="/"})=>{const r=getNeo4j();if(!r)throw new Error("`neo4j` is unset.");const i=r.session();typeof e=="string"&&(e=e.split(n));let o=await x.get.root();for(const s in e){const a=`
        MERGE (current)-[:CONTAINS { path: $elem }]->(new:Nopoint)
        WHERE elementId(current) = $current
        RETURN elementId(new)
      `,{records:c}=await i.run(a,{current:o,elem:s});if(c.length!=1)throw new Error(`${c.length} records returned.`);o=c[0].get("id")}}),N(x,"get",{root:async()=>{const e=getNeo4j();if(!e)throw new Error("`neo4j` is unset.");const n=e.session();try{const r=`
          MERGE (root:Root)
          RETURN elementId(root)
        `,{records:i}=await n.run(r);if(i.length!=1)throw new Error(`${i.length} records returned.`);return record2Object(i[0])}finally{n.close(),e.close()}},children:async(e,{offset:n=0,limit:r,onlyCurrent:i=!1,sep:o="/",parent:s}={})=>{const a=getNeo4j(),c=a.session();try{typeof e=="string"&&(e=e.split(o).filter(Boolean));let l=!1;for(;!l;)try{let f=s==null?void 0:s.id;f==null&&(l=!0,f=x.root);const h={limit:r!=null?Number(r):0,offset:Number(n)},p=`
              WITH $elems as pathElems
              MATCH path = (start)-[:CONTAINS*]->(terminal)
              WHERE elementId(start) = $rootId
              MATCH (terminal)-[:REPRESENTED_BY]->(point)
              ${i?"WHERE NOT ()-[:PREVIOUS]->(point)":""}
              WITH pathElems, path, terminal, point, [
                rel in relationships(path)
                WHERE NOT isEmpty(rel.path)
                | rel.path
              ] as elements
              WHERE size(elements) = size(pathElems)
              AND ALL(
                i IN range(0, size(pathElems) - 1)
                WHERE (
                  pathElems[i] = '*'
                  OR elements[i] = pathElems[i]
                )
              )
              ${h.limit>0?`LIMIT ${h.offset+h.limit}`:""}
              SKIP ${h.offset}
              RETURN DISTINCT
                elements as path,
                terminal as pathEnd,
                point as nopoint
            `,{records:g}=await c.run(p,{elems:e,rootId:f});return records2Object(g)}catch(f){if(!(f instanceof UninitializedError))throw f;l=!1}}finally{await c.close(),await a.close()}},partial:async e=>{const n=getNeo4j(),r=n.session();try{}finally{await r.close(),await n.close()}}});let Nopoint=x;const timestamp=(t=new Date)=>t.toISOString().slice(0,19).replace("T","@").replace(/-/g,"");export{Nopoint as N,withMaxChunkSize as a,createFlatDirectory as b,configure$4 as c,defaults as d,encodeDirectory as e,code as f,cumulativeDagByteLength as g,create$1 as h,builder as i,get as j,has as k,from as l,iterate as m,createDirectoryShard as n,murmur364 as o,tableSize as p,bitField as q,encodeHAMTShard as r,records2Object as s,timestamp as t,identify as u,toggle as v,withWidth as w};
