var at=Object.defineProperty;var ut=(e,t,n)=>t in e?at(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var h=(e,t,n)=>ut(e,typeof t!="symbol"?t+"":t,n);import{g as re,C as ft,s as dt}from"./n2082k40.js";import{C as lt}from"./CKpznFAq.js";import{v as oe}from"./Dqe3hTdN.js";const ht=["string","number","bigint","symbol"],wt=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function yt(e){if(e===null)return"null";if(e===void 0)return"undefined";if(e===!0||e===!1)return"boolean";const t=typeof e;if(ht.includes(t))return t;if(t==="function")return"Function";if(Array.isArray(e))return"Array";if(pt(e))return"Buffer";const n=gt(e);return n||"Object"}function pt(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}function gt(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(wt.includes(t))return t}class s{constructor(t,n,r){this.major=t,this.majorEncoded=t<<5,this.name=n,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(t){return this.major<t.major?-1:this.major>t.major?1:0}}s.uint=new s(0,"uint",!0);s.negint=new s(1,"negint",!0);s.bytes=new s(2,"bytes",!0);s.string=new s(3,"string",!0);s.array=new s(4,"array",!1);s.map=new s(5,"map",!1);s.tag=new s(6,"tag",!1);s.float=new s(7,"float",!0);s.false=new s(7,"false",!0);s.true=new s(7,"true",!0);s.null=new s(7,"null",!0);s.undefined=new s(7,"undefined",!0);s.break=new s(7,"break",!0);class u{constructor(t,n,r){this.type=t,this.value=n,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const P=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",xt=new TextDecoder,mt=new TextEncoder;function ie(e){return P&&globalThis.Buffer.isBuffer(e)}function Pe(e){return e instanceof Uint8Array?ie(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const bt=P?(e,t,n)=>n-t>64?globalThis.Buffer.from(e.subarray(t,n)).toString("utf8"):Oe(e,t,n):(e,t,n)=>n-t>64?xt.decode(e.subarray(t,n)):Oe(e,t,n),Et=P?e=>e.length>64?globalThis.Buffer.from(e):ze(e):e=>e.length>64?mt.encode(e):ze(e),B=e=>Uint8Array.from(e),Ae=P?(e,t,n)=>ie(e)?new Uint8Array(e.subarray(t,n)):e.slice(t,n):(e,t,n)=>e.slice(t,n),vt=P?(e,t)=>(e=e.map(n=>n instanceof Uint8Array?n:globalThis.Buffer.from(n)),Pe(globalThis.Buffer.concat(e,t))):(e,t)=>{const n=new Uint8Array(t);let r=0;for(let o of e)r+o.length>n.length&&(o=o.subarray(0,n.length-r)),n.set(o,r),r+=o.length;return n},At=P?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function St(e,t){if(ie(e)&&ie(t))return e.compare(t);for(let n=0;n<e.length;n++)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return 0}function ze(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let o=e.charCodeAt(r);o<128?t[n++]=o:o<2048?(t[n++]=o>>6|192,t[n++]=o&63|128):(o&64512)===55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)===56320?(o=65536+((o&1023)<<10)+(e.charCodeAt(++r)&1023),t[n++]=o>>18|240,t[n++]=o>>12&63|128,t[n++]=o>>6&63|128,t[n++]=o&63|128):(t[n++]=o>>12|224,t[n++]=o>>6&63|128,t[n++]=o&63|128)}return t}function Oe(e,t,n){const r=[];for(;t<n;){const o=e[t];let i=null,a=o>239?4:o>223?3:o>191?2:1;if(t+a<=n){let f,w,m,p;switch(a){case 1:o<128&&(i=o);break;case 2:f=e[t+1],(f&192)===128&&(p=(o&31)<<6|f&63,p>127&&(i=p));break;case 3:f=e[t+1],w=e[t+2],(f&192)===128&&(w&192)===128&&(p=(o&15)<<12|(f&63)<<6|w&63,p>2047&&(p<55296||p>57343)&&(i=p));break;case 4:f=e[t+1],w=e[t+2],m=e[t+3],(f&192)===128&&(w&192)===128&&(m&192)===128&&(p=(o&15)<<18|(f&63)<<12|(w&63)<<6|m&63,p>65535&&p<1114112&&(i=p))}}i===null?(i=65533,a=1):i>65535&&(i-=65536,r.push(i>>>10&1023|55296),i=56320|i&1023),r.push(i),t+=a}return kt(r)}const Re=4096;function kt(e){const t=e.length;if(t<=Re)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=Re));return n}const _t=256;class Ge{constructor(t=_t){this.chunkSize=t,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(t){let n=this.chunks[this.chunks.length-1];if(this.cursor+t.length<=this.maxCursor+1){const o=n.length-(this.maxCursor-this.cursor)-1;n.set(t,o)}else{if(n){const o=n.length-(this.maxCursor-this.cursor)-1;o<n.length&&(this.chunks[this.chunks.length-1]=n.subarray(0,o),this.maxCursor=this.cursor-1)}t.length<64&&t.length<this.chunkSize?(n=At(this.chunkSize),this.chunks.push(n),this.maxCursor+=n.length,this._initReuseChunk===null&&(this._initReuseChunk=n),n.set(t,0)):(this.chunks.push(t),this.maxCursor+=t.length)}this.cursor+=t.length}toBytes(t=!1){let n;if(this.chunks.length===1){const r=this.chunks[0];t&&this.cursor>r.length/2?(n=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):n=Ae(r,0,this.cursor)}else n=vt(this.chunks,this.cursor);return t&&this.reset(),n}}const d="CBOR decode error:",We="CBOR encode error:";function G(e,t,n){if(e.length-t<n)throw new Error(`${d} not enough data for type`)}const x=[24,256,65536,4294967296,BigInt("18446744073709551616")];function F(e,t,n){G(e,t,1);const r=e[t];if(n.strict===!0&&r<x[0])throw new Error(`${d} integer encoded in more bytes than necessary (strict decode)`);return r}function j(e,t,n){G(e,t,2);const r=e[t]<<8|e[t+1];if(n.strict===!0&&r<x[1])throw new Error(`${d} integer encoded in more bytes than necessary (strict decode)`);return r}function L(e,t,n){G(e,t,4);const r=e[t]*16777216+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(n.strict===!0&&r<x[2])throw new Error(`${d} integer encoded in more bytes than necessary (strict decode)`);return r}function V(e,t,n){G(e,t,8);const r=e[t]*16777216+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],o=e[t+4]*16777216+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],i=(BigInt(r)<<BigInt(32))+BigInt(o);if(n.strict===!0&&i<x[3])throw new Error(`${d} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(n.allowBigInt===!0)return i;throw new Error(`${d} integers outside of the safe integer range are not supported`)}function Tt(e,t,n,r){return new u(s.uint,F(e,t+1,r),2)}function Ut(e,t,n,r){return new u(s.uint,j(e,t+1,r),3)}function Ct(e,t,n,r){return new u(s.uint,L(e,t+1,r),5)}function It(e,t,n,r){return new u(s.uint,V(e,t+1,r),9)}function q(e,t){return A(e,0,t.value)}function A(e,t,n){if(n<x[0]){const r=Number(n);e.push([t|r])}else if(n<x[1]){const r=Number(n);e.push([t|24,r])}else if(n<x[2]){const r=Number(n);e.push([t|25,r>>>8,r&255])}else if(n<x[3]){const r=Number(n);e.push([t|26,r>>>24&255,r>>>16&255,r>>>8&255,r&255])}else{const r=BigInt(n);if(r<x[4]){const o=[t|27,0,0,0,0,0,0,0];let i=Number(r&BigInt(4294967295)),a=Number(r>>BigInt(32)&BigInt(4294967295));o[8]=i&255,i=i>>8,o[7]=i&255,i=i>>8,o[6]=i&255,i=i>>8,o[5]=i&255,o[4]=a&255,a=a>>8,o[3]=a&255,a=a>>8,o[2]=a&255,a=a>>8,o[1]=a&255,e.push(o)}else throw new Error(`${d} encountered BigInt larger than allowable range`)}}q.encodedSize=function(t){return A.encodedSize(t.value)};A.encodedSize=function(t){return t<x[0]?1:t<x[1]?2:t<x[2]?3:t<x[3]?5:9};q.compareTokens=function(t,n){return t.value<n.value?-1:t.value>n.value?1:0};function $t(e,t,n,r){return new u(s.negint,-1-F(e,t+1,r),2)}function Bt(e,t,n,r){return new u(s.negint,-1-j(e,t+1,r),3)}function Nt(e,t,n,r){return new u(s.negint,-1-L(e,t+1,r),5)}const Se=BigInt(-1),Ke=BigInt(1);function Mt(e,t,n,r){const o=V(e,t+1,r);if(typeof o!="bigint"){const i=-1-o;if(i>=Number.MIN_SAFE_INTEGER)return new u(s.negint,i,9)}if(r.allowBigInt!==!0)throw new Error(`${d} integers outside of the safe integer range are not supported`);return new u(s.negint,Se-BigInt(o),9)}function ke(e,t){const n=t.value,r=typeof n=="bigint"?n*Se-Ke:n*-1-1;A(e,t.type.majorEncoded,r)}ke.encodedSize=function(t){const n=t.value,r=typeof n=="bigint"?n*Se-Ke:n*-1-1;return r<x[0]?1:r<x[1]?2:r<x[2]?3:r<x[3]?5:9};ke.compareTokens=function(t,n){return t.value<n.value?1:t.value>n.value?-1:0};function X(e,t,n,r){G(e,t,n+r);const o=Ae(e,t+n,t+n+r);return new u(s.bytes,o,n+r)}function zt(e,t,n,r){return X(e,t,1,n)}function Ot(e,t,n,r){return X(e,t,2,F(e,t+1,r))}function Rt(e,t,n,r){return X(e,t,3,j(e,t+1,r))}function Dt(e,t,n,r){return X(e,t,5,L(e,t+1,r))}function Ft(e,t,n,r){const o=V(e,t+1,r);if(typeof o=="bigint")throw new Error(`${d} 64-bit integer bytes lengths not supported`);return X(e,t,9,o)}function se(e){return e.encodedBytes===void 0&&(e.encodedBytes=e.type===s.string?Et(e.value):e.value),e.encodedBytes}function le(e,t){const n=se(t);A(e,t.type.majorEncoded,n.length),e.push(n)}le.encodedSize=function(t){const n=se(t);return A.encodedSize(n.length)+n.length};le.compareTokens=function(t,n){return jt(se(t),se(n))};function jt(e,t){return e.length<t.length?-1:e.length>t.length?1:St(e,t)}function Z(e,t,n,r,o){const i=n+r;G(e,t,i);const a=new u(s.string,bt(e,t+n,t+i),i);return o.retainStringBytes===!0&&(a.byteValue=Ae(e,t+n,t+i)),a}function Lt(e,t,n,r){return Z(e,t,1,n,r)}function Vt(e,t,n,r){return Z(e,t,2,F(e,t+1,r),r)}function qt(e,t,n,r){return Z(e,t,3,j(e,t+1,r),r)}function Pt(e,t,n,r){return Z(e,t,5,L(e,t+1,r),r)}function Gt(e,t,n,r){const o=V(e,t+1,r);if(typeof o=="bigint")throw new Error(`${d} 64-bit integer string lengths not supported`);return Z(e,t,9,o,r)}const Wt=le;function W(e,t,n,r){return new u(s.array,r,n)}function Kt(e,t,n,r){return W(e,t,1,n)}function Ht(e,t,n,r){return W(e,t,2,F(e,t+1,r))}function Qt(e,t,n,r){return W(e,t,3,j(e,t+1,r))}function Jt(e,t,n,r){return W(e,t,5,L(e,t+1,r))}function Xt(e,t,n,r){const o=V(e,t+1,r);if(typeof o=="bigint")throw new Error(`${d} 64-bit integer array lengths not supported`);return W(e,t,9,o)}function Zt(e,t,n,r){if(r.allowIndefinite===!1)throw new Error(`${d} indefinite length items not allowed`);return W(e,t,1,1/0)}function _e(e,t){A(e,s.array.majorEncoded,t.value)}_e.compareTokens=q.compareTokens;_e.encodedSize=function(t){return A.encodedSize(t.value)};function K(e,t,n,r){return new u(s.map,r,n)}function Yt(e,t,n,r){return K(e,t,1,n)}function en(e,t,n,r){return K(e,t,2,F(e,t+1,r))}function tn(e,t,n,r){return K(e,t,3,j(e,t+1,r))}function nn(e,t,n,r){return K(e,t,5,L(e,t+1,r))}function rn(e,t,n,r){const o=V(e,t+1,r);if(typeof o=="bigint")throw new Error(`${d} 64-bit integer map lengths not supported`);return K(e,t,9,o)}function on(e,t,n,r){if(r.allowIndefinite===!1)throw new Error(`${d} indefinite length items not allowed`);return K(e,t,1,1/0)}function Te(e,t){A(e,s.map.majorEncoded,t.value)}Te.compareTokens=q.compareTokens;Te.encodedSize=function(t){return A.encodedSize(t.value)};function sn(e,t,n,r){return new u(s.tag,n,1)}function cn(e,t,n,r){return new u(s.tag,F(e,t+1,r),2)}function an(e,t,n,r){return new u(s.tag,j(e,t+1,r),3)}function un(e,t,n,r){return new u(s.tag,L(e,t+1,r),5)}function fn(e,t,n,r){return new u(s.tag,V(e,t+1,r),9)}function Ue(e,t){A(e,s.tag.majorEncoded,t.value)}Ue.compareTokens=q.compareTokens;Ue.encodedSize=function(t){return A.encodedSize(t.value)};const dn=20,ln=21,hn=22,wn=23;function yn(e,t,n,r){if(r.allowUndefined===!1)throw new Error(`${d} undefined values are not supported`);return r.coerceUndefinedToNull===!0?new u(s.null,null,1):new u(s.undefined,void 0,1)}function pn(e,t,n,r){if(r.allowIndefinite===!1)throw new Error(`${d} indefinite length items not allowed`);return new u(s.break,void 0,1)}function Ce(e,t,n){if(n){if(n.allowNaN===!1&&Number.isNaN(e))throw new Error(`${d} NaN values are not supported`);if(n.allowInfinity===!1&&(e===1/0||e===-1/0))throw new Error(`${d} Infinity values are not supported`)}return new u(s.float,e,t)}function gn(e,t,n,r){return Ce($e(e,t+1),3,r)}function xn(e,t,n,r){return Ce(Be(e,t+1),5,r)}function mn(e,t,n,r){return Ce(Xe(e,t+1),9,r)}function Ie(e,t,n){const r=t.value;if(r===!1)e.push([s.float.majorEncoded|dn]);else if(r===!0)e.push([s.float.majorEncoded|ln]);else if(r===null)e.push([s.float.majorEncoded|hn]);else if(r===void 0)e.push([s.float.majorEncoded|wn]);else{let o,i=!1;(!n||n.float64!==!0)&&(Qe(r),o=$e(_,1),r===o||Number.isNaN(r)?(_[0]=249,e.push(_.slice(0,3)),i=!0):(Je(r),o=Be(_,1),r===o&&(_[0]=250,e.push(_.slice(0,5)),i=!0))),i||(bn(r),o=Xe(_,1),_[0]=251,e.push(_.slice(0,9)))}}Ie.encodedSize=function(t,n){const r=t.value;if(r===!1||r===!0||r===null||r===void 0)return 1;if(!n||n.float64!==!0){Qe(r);let o=$e(_,1);if(r===o||Number.isNaN(r))return 3;if(Je(r),o=Be(_,1),r===o)return 5}return 9};const He=new ArrayBuffer(9),v=new DataView(He,1),_=new Uint8Array(He,0);function Qe(e){if(e===1/0)v.setUint16(0,31744,!1);else if(e===-1/0)v.setUint16(0,64512,!1);else if(Number.isNaN(e))v.setUint16(0,32256,!1);else{v.setFloat32(0,e);const t=v.getUint32(0),n=(t&2139095040)>>23,r=t&8388607;if(n===255)v.setUint16(0,31744,!1);else if(n===0)v.setUint16(0,(e&2147483648)>>16|r>>13,!1);else{const o=n-127;o<-24?v.setUint16(0,0):o<-14?v.setUint16(0,(t&2147483648)>>16|1<<24+o,!1):v.setUint16(0,(t&2147483648)>>16|o+15<<10|r>>13,!1)}}}function $e(e,t){if(e.length-t<2)throw new Error(`${d} not enough data for float16`);const n=(e[t]<<8)+e[t+1];if(n===31744)return 1/0;if(n===64512)return-1/0;if(n===32256)return NaN;const r=n>>10&31,o=n&1023;let i;return r===0?i=o*2**-24:r!==31?i=(o+1024)*2**(r-25):i=o===0?1/0:NaN,n&32768?-i:i}function Je(e){v.setFloat32(0,e,!1)}function Be(e,t){if(e.length-t<4)throw new Error(`${d} not enough data for float32`);const n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,4).getFloat32(0,!1)}function bn(e){v.setFloat64(0,e,!1)}function Xe(e,t){if(e.length-t<8)throw new Error(`${d} not enough data for float64`);const n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,8).getFloat64(0,!1)}Ie.compareTokens=q.compareTokens;function l(e,t,n){throw new Error(`${d} encountered invalid minor (${n}) for major ${e[t]>>>5}`)}function he(e){return()=>{throw new Error(`${d} ${e}`)}}const c=[];for(let e=0;e<=23;e++)c[e]=l;c[24]=Tt;c[25]=Ut;c[26]=Ct;c[27]=It;c[28]=l;c[29]=l;c[30]=l;c[31]=l;for(let e=32;e<=55;e++)c[e]=l;c[56]=$t;c[57]=Bt;c[58]=Nt;c[59]=Mt;c[60]=l;c[61]=l;c[62]=l;c[63]=l;for(let e=64;e<=87;e++)c[e]=zt;c[88]=Ot;c[89]=Rt;c[90]=Dt;c[91]=Ft;c[92]=l;c[93]=l;c[94]=l;c[95]=he("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)c[e]=Lt;c[120]=Vt;c[121]=qt;c[122]=Pt;c[123]=Gt;c[124]=l;c[125]=l;c[126]=l;c[127]=he("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)c[e]=Kt;c[152]=Ht;c[153]=Qt;c[154]=Jt;c[155]=Xt;c[156]=l;c[157]=l;c[158]=l;c[159]=Zt;for(let e=160;e<=183;e++)c[e]=Yt;c[184]=en;c[185]=tn;c[186]=nn;c[187]=rn;c[188]=l;c[189]=l;c[190]=l;c[191]=on;for(let e=192;e<=215;e++)c[e]=sn;c[216]=cn;c[217]=an;c[218]=un;c[219]=fn;c[220]=l;c[221]=l;c[222]=l;c[223]=l;for(let e=224;e<=243;e++)c[e]=he("simple values are not supported");c[244]=l;c[245]=l;c[246]=l;c[247]=yn;c[248]=he("simple values are not supported");c[249]=gn;c[250]=xn;c[251]=mn;c[252]=l;c[253]=l;c[254]=l;c[255]=pn;const I=[];for(let e=0;e<24;e++)I[e]=new u(s.uint,e,1);for(let e=-1;e>=-24;e--)I[31-e]=new u(s.negint,e,1);I[64]=new u(s.bytes,new Uint8Array(0),1);I[96]=new u(s.string,"",1);I[128]=new u(s.array,0,1);I[160]=new u(s.map,0,1);I[244]=new u(s.false,!1,1);I[245]=new u(s.true,!0,1);I[246]=new u(s.null,null,1);function En(e){switch(e.type){case s.false:return B([244]);case s.true:return B([245]);case s.null:return B([246]);case s.bytes:return e.value.length?void 0:B([64]);case s.string:return e.value===""?B([96]):void 0;case s.array:return e.value===0?B([128]):void 0;case s.map:return e.value===0?B([160]):void 0;case s.uint:return e.value<24?B([Number(e.value)]):void 0;case s.negint:if(e.value>=-24)return B([31-Number(e.value)])}}const vn={float64:!1,mapSorter:kn,quickEncodeToken:En};function An(){const e=[];return e[s.uint.major]=q,e[s.negint.major]=ke,e[s.bytes.major]=le,e[s.string.major]=Wt,e[s.array.major]=_e,e[s.map.major]=Te,e[s.tag.major]=Ue,e[s.float.major]=Ie,e}const Ze=An(),ge=new Ge;class ce{constructor(t,n){this.obj=t,this.parent=n}includes(t){let n=this;do if(n.obj===t)return!0;while(n=n.parent);return!1}static createCheck(t,n){if(t&&t.includes(n))throw new Error(`${We} object contains circular references`);return new ce(n,t)}}const z={null:new u(s.null,null),undefined:new u(s.undefined,void 0),true:new u(s.true,!0),false:new u(s.false,!1),emptyArray:new u(s.array,0),emptyMap:new u(s.map,0)},R={number(e,t,n,r){return!Number.isInteger(e)||!Number.isSafeInteger(e)?new u(s.float,e):e>=0?new u(s.uint,e):new u(s.negint,e)},bigint(e,t,n,r){return e>=BigInt(0)?new u(s.uint,e):new u(s.negint,e)},Uint8Array(e,t,n,r){return new u(s.bytes,e)},string(e,t,n,r){return new u(s.string,e)},boolean(e,t,n,r){return e?z.true:z.false},null(e,t,n,r){return z.null},undefined(e,t,n,r){return z.undefined},ArrayBuffer(e,t,n,r){return new u(s.bytes,new Uint8Array(e))},DataView(e,t,n,r){return new u(s.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength))},Array(e,t,n,r){if(!e.length)return n.addBreakTokens===!0?[z.emptyArray,new u(s.break)]:z.emptyArray;r=ce.createCheck(r,e);const o=[];let i=0;for(const a of e)o[i++]=te(a,n,r);return n.addBreakTokens?[new u(s.array,e.length),o,new u(s.break)]:[new u(s.array,e.length),o]},Object(e,t,n,r){const o=t!=="Object",i=o?e.keys():Object.keys(e),a=o?e.size:i.length;if(!a)return n.addBreakTokens===!0?[z.emptyMap,new u(s.break)]:z.emptyMap;r=ce.createCheck(r,e);const f=[];let w=0;for(const m of i)f[w++]=[te(m,n,r),te(o?e.get(m):e[m],n,r)];return Sn(f,n),n.addBreakTokens?[new u(s.map,a),f,new u(s.break)]:[new u(s.map,a),f]}};R.Map=R.Object;R.Buffer=R.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))R[`${e}Array`]=R.DataView;function te(e,t={},n){const r=yt(e),o=t&&t.typeEncoders&&t.typeEncoders[r]||R[r];if(typeof o=="function"){const a=o(e,r,t,n);if(a!=null)return a}const i=R[r];if(!i)throw new Error(`${We} unsupported type: ${r}`);return i(e,r,t,n)}function Sn(e,t){t.mapSorter&&e.sort(t.mapSorter)}function kn(e,t){const n=Array.isArray(e[0])?e[0][0]:e[0],r=Array.isArray(t[0])?t[0][0]:t[0];if(n.type!==r.type)return n.type.compare(r.type);const o=n.type.major,i=Ze[o].compareTokens(n,r);return i===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function Ye(e,t,n,r){if(Array.isArray(t))for(const o of t)Ye(e,o,n,r);else n[t.type.major](e,t,r)}function _n(e,t,n){const r=te(e,n);if(!Array.isArray(r)&&n.quickEncodeToken){const o=n.quickEncodeToken(r);if(o)return o;const i=t[r.type.major];if(i.encodedSize){const a=i.encodedSize(r,n),f=new Ge(a);if(i(f,r,n),f.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${r} was wrong`);return Pe(f.chunks[0])}}return ge.reset(),Ye(ge,r,t,n),ge.toBytes(!0)}function Tn(e,t){return t=Object.assign({},vn,t),_n(e,Ze,t)}const Un={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Cn{constructor(t,n={}){this._pos=0,this.data=t,this.options=n}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const t=this.data[this._pos];let n=I[t];if(n===void 0){const r=c[t];if(!r)throw new Error(`${d} no decoder for major type ${t>>>5} (byte 0x${t.toString(16).padStart(2,"0")})`);const o=t&31;n=r(this.data,this._pos,o,this.options)}return this._pos+=n.encodedLength,n}}const Q=Symbol.for("DONE"),we=Symbol.for("BREAK");function In(e,t,n){const r=[];for(let o=0;o<e.value;o++){const i=J(t,n);if(i===we){if(e.value===1/0)break;throw new Error(`${d} got unexpected break to lengthed array`)}if(i===Q)throw new Error(`${d} found array but not enough entries (got ${o}, expected ${e.value})`);r[o]=i}return r}function $n(e,t,n){const r=n.useMaps===!0,o=r?void 0:{},i=r?new Map:void 0;for(let a=0;a<e.value;a++){const f=J(t,n);if(f===we){if(e.value===1/0)break;throw new Error(`${d} got unexpected break to lengthed map`)}if(f===Q)throw new Error(`${d} found map but not enough entries (got ${a} [no key], expected ${e.value})`);if(r!==!0&&typeof f!="string")throw new Error(`${d} non-string keys not supported (got ${typeof f})`);if(n.rejectDuplicateMapKeys===!0&&(r&&i.has(f)||!r&&f in o))throw new Error(`${d} found repeat map key "${f}"`);const w=J(t,n);if(w===Q)throw new Error(`${d} found map but not enough entries (got ${a} [no value], expected ${e.value})`);r?i.set(f,w):o[f]=w}return r?i:o}function J(e,t){if(e.done())return Q;const n=e.next();if(n.type===s.break)return we;if(n.type.terminal)return n.value;if(n.type===s.array)return In(n,e,t);if(n.type===s.map)return $n(n,e,t);if(n.type===s.tag){if(t.tags&&typeof t.tags[n.value]=="function"){const r=J(e,t);return t.tags[n.value](r)}throw new Error(`${d} tag not supported (${n.value})`)}throw new Error("unsupported")}function Bn(e,t){if(!(e instanceof Uint8Array))throw new Error(`${d} data to decode must be a Uint8Array`);t=Object.assign({},Un,t);const n=t.tokenizer||new Cn(e,t),r=J(n,t);if(r===Q)throw new Error(`${d} did not find any content to decode`);if(r===we)throw new Error(`${d} got unexpected break`);return[r,e.subarray(n.pos())]}function Nn(e,t){const[n,r]=Bn(e,t);if(r.length>0)throw new Error(`${d} too many terminals, data makes no sense`);return n}function Mn(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0}function Ne(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function zn(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var o=0;o<e.length;o++){var i=e.charAt(o),a=i.charCodeAt(0);if(n[a]!==255)throw new TypeError(i+" is ambiguous");n[a]=o}var f=e.length,w=e.charAt(0),m=Math.log(f)/Math.log(256),p=Math.log(256)/Math.log(f);function pe(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(y.length===0)return"";for(var b=0,D=0,S=0,T=y.length;S!==T&&y[S]===0;)S++,b++;for(var U=(T-S)*p+1>>>0,E=new Uint8Array(U);S!==T;){for(var C=y[S],M=0,k=U-1;(C!==0||M<D)&&k!==-1;k--,M++)C+=256*E[k]>>>0,E[k]=C%f>>>0,C=C/f>>>0;if(C!==0)throw new Error("Non-zero carry");D=M,S++}for(var $=U-D;$!==U&&E[$]===0;)$++;for(var ee=w.repeat(b);$<U;++$)ee+=e.charAt(E[$]);return ee}function Y(y){if(typeof y!="string")throw new TypeError("Expected String");if(y.length===0)return new Uint8Array;var b=0;if(y[b]!==" "){for(var D=0,S=0;y[b]===w;)D++,b++;for(var T=(y.length-b)*m+1>>>0,U=new Uint8Array(T);y[b];){var E=n[y.charCodeAt(b)];if(E===255)return;for(var C=0,M=T-1;(E!==0||C<S)&&M!==-1;M--,C++)E+=f*U[M]>>>0,U[M]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");S=C,b++}if(y[b]!==" "){for(var k=T-S;k!==T&&U[k]===0;)k++;for(var $=new Uint8Array(D+(T-k)),ee=D;k!==T;)$[ee++]=U[k++];return $}}}function ct(y){var b=Y(y);if(b)return b;throw new Error(`Non-${t} character`)}return{encode:pe,decodeUnsafe:Y,decode:ct}}var On=zn,Rn=On;class Dn{constructor(t,n,r){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=t,this.prefix=n,this.baseEncode=r}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Fn{constructor(t,n,r){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=t,this.prefix=n;const o=n.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=r}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return et(this,t)}}class jn{constructor(t){h(this,"decoders");this.decoders=t}or(t){return et(this,t)}decode(t){const n=t[0],r=this.decoders[n];if(r!=null)return r.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function et(e,t){return new jn({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}class Ln{constructor(t,n,r,o){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=t,this.prefix=n,this.baseEncode=r,this.baseDecode=o,this.encoder=new Dn(t,n,r),this.decoder=new Fn(t,n,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}function tt({name:e,prefix:t,encode:n,decode:r}){return new Ln(e,t,n,r)}function ye({name:e,prefix:t,alphabet:n}){const{encode:r,decode:o}=Rn(n,e);return tt({prefix:t,name:e,encode:r,decode:i=>Ne(o(i))})}function Vn(e,t,n,r){let o=e.length;for(;e[o-1]==="=";)--o;const i=new Uint8Array(o*n/8|0);let a=0,f=0,w=0;for(let m=0;m<o;++m){const p=t[e[m]];if(p===void 0)throw new SyntaxError(`Non-${r} character`);f=f<<n|p,a+=n,a>=8&&(a-=8,i[w++]=255&f>>a)}if(a>=n||255&f<<8-a)throw new SyntaxError("Unexpected end of data");return i}function qn(e,t,n){const r=t[t.length-1]==="=",o=(1<<n)-1;let i="",a=0,f=0;for(let w=0;w<e.length;++w)for(f=f<<8|e[w],a+=8;a>n;)a-=n,i+=t[o&f>>a];if(a!==0&&(i+=t[o&f<<n-a]),r)for(;i.length*n&7;)i+="=";return i}function Pn(e){const t={};for(let n=0;n<e.length;++n)t[e[n]]=n;return t}function N({name:e,prefix:t,bitsPerChar:n,alphabet:r}){const o=Pn(r);return tt({prefix:t,name:e,encode(i){return qn(i,r,n)},decode(i){return Vn(i,o,n,e)}})}const ne=N({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});N({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});N({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});N({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});N({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});N({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});N({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});N({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});N({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const xe=ye({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});ye({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const O=ye({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});ye({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Gn=nt,De=128,Wn=-128,Kn=Math.pow(2,31);function nt(e,t,n){t=t||[],n=n||0;for(var r=n;e>=Kn;)t[n++]=e&255|De,e/=128;for(;e&Wn;)t[n++]=e&255|De,e>>>=7;return t[n]=e|0,nt.bytes=n-r+1,t}var Hn=me,Qn=128,Fe=127;function me(e,r){var n=0,r=r||0,o=0,i=r,a,f=e.length;do{if(i>=f)throw me.bytes=0,new RangeError("Could not decode varint");a=e[i++],n+=o<28?(a&Fe)<<o:(a&Fe)*Math.pow(2,o),o+=7}while(a>=Qn);return me.bytes=i-r,n}var Jn=Math.pow(2,7),Xn=Math.pow(2,14),Zn=Math.pow(2,21),Yn=Math.pow(2,28),er=Math.pow(2,35),tr=Math.pow(2,42),nr=Math.pow(2,49),rr=Math.pow(2,56),or=Math.pow(2,63),ir=function(e){return e<Jn?1:e<Xn?2:e<Zn?3:e<Yn?4:e<er?5:e<tr?6:e<nr?7:e<rr?8:e<or?9:10},sr={encode:Gn,decode:Hn,encodingLength:ir},ae=sr;function be(e,t=0){return[ae.decode(e,t),ae.decode.bytes]}function ue(e,t,n=0){return ae.encode(e,t,n),t}function fe(e){return ae.encodingLength(e)}function cr(e,t){const n=t.byteLength,r=fe(e),o=r+fe(n),i=new Uint8Array(o+n);return ue(e,i,0),ue(n,i,r),i.set(t,o),new Me(e,n,t,i)}function ar(e){const t=Ne(e),[n,r]=be(t),[o,i]=be(t.subarray(r)),a=t.subarray(r+i);if(a.byteLength!==o)throw new Error("Incorrect length");return new Me(n,o,a,t)}function ur(e,t){if(e===t)return!0;{const n=t;return e.code===n.code&&e.size===n.size&&n.bytes instanceof Uint8Array&&Mn(e.bytes,n.bytes)}}class Me{constructor(t,n,r,o){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=t,this.size=n,this.digest=r,this.bytes=o}}function je(e,t){const{bytes:n,version:r}=e;switch(r){case 0:return dr(n,Ee(e),t??O.encoder);default:return lr(n,Ee(e),t??ne.encoder)}}const Le=new WeakMap;function Ee(e){const t=Le.get(e);if(t==null){const n=new Map;return Le.set(e,n),n}return t}var qe;class g{constructor(t,n,r,o){h(this,"code");h(this,"version");h(this,"multihash");h(this,"bytes");h(this,"/");h(this,qe,"CID");this.code=n,this.version=t,this.multihash=r,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:t,multihash:n}=this;if(t!==H)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(n.code!==hr)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return g.createV0(n)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:t,digest:n}=this.multihash,r=cr(t,n);return g.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return g.equals(this,t)}static equals(t,n){const r=n;return r!=null&&t.code===r.code&&t.version===r.version&&ur(t.multihash,r.multihash)}toString(t){return je(this,t)}toJSON(){return{"/":je(this)}}link(){return this}[(qe=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;const n=t;if(n instanceof g)return n;if(n["/"]!=null&&n["/"]===n.bytes||n.asCID===n){const{version:r,code:o,multihash:i,bytes:a}=n;return new g(r,o,i,a??Ve(r,o,i.bytes))}else if(n[wr]===!0){const{version:r,multihash:o,code:i}=n,a=ar(o);return g.create(r,i,a)}else return null}static create(t,n,r){if(typeof n!="number")throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(n!==H)throw new Error(`Version 0 CID must use dag-pb (code: ${H}) block encoding`);return new g(t,n,r,r.bytes)}case 1:{const o=Ve(t,n,r.bytes);return new g(t,n,r,o)}default:throw new Error("Invalid version")}}static createV0(t){return g.create(0,H,t)}static createV1(t,n){return g.create(1,t,n)}static decode(t){const[n,r]=g.decodeFirst(t);if(r.length!==0)throw new Error("Incorrect length");return n}static decodeFirst(t){const n=g.inspectBytes(t),r=n.size-n.multihashSize,o=Ne(t.subarray(r,r+n.multihashSize));if(o.byteLength!==n.multihashSize)throw new Error("Incorrect length");const i=o.subarray(n.multihashSize-n.digestSize),a=new Me(n.multihashCode,n.digestSize,i,o);return[n.version===0?g.createV0(a):g.createV1(n.codec,a),t.subarray(n.size)]}static inspectBytes(t){let n=0;const r=()=>{const[pe,Y]=be(t.subarray(n));return n+=Y,pe};let o=r(),i=H;if(o===18?(o=0,n=0):i=r(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);const a=n,f=r(),w=r(),m=n+w,p=m-a;return{version:o,codec:i,multihashCode:f,digestSize:w,multihashSize:p,size:m}}static parse(t,n){const[r,o]=fr(t,n),i=g.decode(o);if(i.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Ee(i).set(r,t),i}}function fr(e,t){switch(e[0]){case"Q":{const n=t??O;return[O.prefix,n.decode(`${O.prefix}${e}`)]}case O.prefix:{const n=t??O;return[O.prefix,n.decode(e)]}case ne.prefix:{const n=t??ne;return[ne.prefix,n.decode(e)]}case xe.prefix:{const n=t??xe;return[xe.prefix,n.decode(e)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}}function dr(e,t,n){const{prefix:r}=n;if(r!==O.prefix)throw Error(`Cannot string encode V0 in ${n.name} encoding`);const o=t.get(r);if(o==null){const i=n.encode(e).slice(1);return t.set(r,i),i}else return o}function lr(e,t,n){const{prefix:r}=n,o=t.get(r);if(o==null){const i=n.encode(e);return t.set(r,i),i}else return o}const H=112,hr=18;function Ve(e,t,n){const r=fe(e),o=r+fe(t),i=new Uint8Array(o+n.byteLength);return ue(e,i,0),ue(t,i,r),i.set(n,o),i}const wr=Symbol.for("@ipld/js-cid/CID"),rt=42;function ot(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}function yr(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;const t=g.asCID(e);if(!t)return null;const n=new Uint8Array(t.bytes.byteLength+1);return n.set(t.bytes,1),[new u(s.tag,rt),new u(s.bytes,n)]}function pr(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function gr(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const ve={float64:!0,typeEncoders:{Object:yr,undefined:pr,number:gr}},xr={...ve,typeEncoders:{...ve.typeEncoders}};function mr(e){if(e[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return g.decode(e.subarray(1))}const de={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};de.tags[rt]=mr;const br={...de,tags:de.tags.slice()},Er="dag-cbor",it=113,st=e=>Tn(e,ve),vr=e=>Nn(ot(e),de),Cr=Object.freeze(Object.defineProperty({__proto__:null,code:it,decode:vr,decodeOptions:br,encode:st,encodeOptions:xr,name:Er,toByteView:ot},Symbol.toStringTag,{value:"Module"}));async function Ir(e){const t=re();e=e.filter(Boolean);const n=e.pop();await Promise.all(e.map(async r=>{const o=t.session();try{await o.run(`
        MATCH (e) WHERE elementId(e) = $equivId
        MATCH (t) WHERE elementId(t) = $targetId
        MERGE (e)-[eq:EQUALS]->(t)
        ON CREATE SET eq.mimis_id = $uuid
        RETURN $uuid
      `,{equivId:r,targetId:n,uuid:oe()})}finally{o.close()}}))}async function $r({path:e}){const t=re().session();try{const n="MERGE (r:Root) RETURN elementId(r) AS id",{records:[r]}=await t.run(n);let o=r.get("id");const i=[...e];for(;i.length>0;){const a=i.shift(),f=`
        MATCH (base) WHERE elementId(base) = $current
        MERGE (base)-[cont:CONTAINS { path: $elem }]->(node:Spot)
        ON CREATE SET cont.mimis_id = $contUUID
        ON CREATE SET node.mimis_id = $nodeUUID
        RETURN elementId(node) AS id
      `,{records:[w]}=await t.run(f,{current:o,elem:a,contUUID:oe(),nodeUUID:oe()});o=w.get("id")}return o}finally{t.close()}}const Ar={sha256:async(e,{base:t=64}={})=>(typeof e=="string"&&(e=new TextEncoder().encode(e)),await dt.digest(e))};class Br{constructor(){h(this,"ops",new Map);h(this,"rec");h(this,"exec");h(this,"last",null);h(this,"car",{readable:null,writable:null,writer:null});h(this,"blocks",[]);this.rec=this.record.bind(this),this.exec=this.execute.bind(this),this.reset()}reset(){const{readable:t,writable:n}=new TransformStream;this.car.readable=t,this.car.writable=n,this.car.writer=n.getWriter();const r=this.blocks;this.car.readable.pipeTo(new WritableStream({write(o){r.push(o)}}))}async record({statement:t,params:n}){const r={statement:t.trim(),at:new Date().toISOString(),mïmid:oe()};n&&(r.params=n),this.last&&(r.previous=this.last),console.debug({Encoding:r});const o=await st(r),i=await Ar.sha256(o);return this.last=ft.create(1,it,i),this.ops.set(this.last.toString(),r),this.car.writer!=null&&await this.car.writer.write({cid:this.last,bytes:o}),r}set recording(t){t?this.car.writer||this.reset():this.car.writer=null}async execute({statement:t,params:n},{session:r=null,record:o=null}={}){o==null&&(o=!!this.car.writer);let i=!1;r==null&&(r=re().session(),i=!0);try{return o&&await this.record({statement:t,params:n}),console.debug({Running:{statement:t,params:n}}),await r.run(t,n)}finally{i&&(console.debug({Closing:r}),r.close())}}async run(){const n=re().session();try{if(this.last){let r=this.ops.get(this.last.toString())??null;do r&&(await this.execute(r,{session:n}),r=r.previous!=null?this.ops.get(r.previous.toString())??null:null);while(r)}}finally{n.close()}}generateCAR(){return Sr(this.blocks)}}async function Sr(e,{log:t=null}={}){t==null||t("Generating CAR URL…");const n=[...e],r=new ReadableStream({pull(a){n.length>0?a.enqueue(n.shift()):a.close()}});if(!n||n.length===0)throw new Error("No blocks generated.");const o=n.at(-1);if(!o)throw new Error("No root block found.");const i=[];return await r.pipeThrough(new lt([o.cid])).pipeTo(new WritableStream({write(a){i.push(a)}})),{url:URL.createObjectURL(new Blob(i)),cid:o.cid}}export{Br as R,Cr as a,$r as c,Ir as e,Sr as g};
