var C=Object.defineProperty;var j=e=>{throw TypeError(e)};var U=(e,t,n)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var N=(e,t,n)=>U(e,typeof t!="symbol"?t+"":t,n),P=(e,t,n)=>t.has(e)||j("Cannot "+n);var R=(e,t,n)=>(P(e,t,"read from private field"),n?n.call(e):t.get(e)),I=(e,t,n)=>t.has(e)?j("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),D=(e,t,n,r)=>(P(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);import{h as getDefaultExportFromCjs,g as commonjsGlobal}from"./C_jHh3BX.js";import{b as code$1,f as encode$2,p as prepare,d as decode$2,C as CID,s as sha256,h as from$4,i as fromHex,g as getNeo4j}from"./D029h9G4.js";import{l as lib}from"./8HslT92O.js";var encode_1=encode$1,MSB$1=128,MSBALL=-128,INT=Math.pow(2,31);function encode$1(e,t,n){if(Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw encode$1.bytes=0,new RangeError("Could not encode varint");t=t||[],n=n||0;for(var r=n;e>=INT;)t[n++]=e&255|MSB$1,e/=128;for(;e&MSBALL;)t[n++]=e&255|MSB$1,e>>>=7;return t[n]=e|0,encode$1.bytes=n-r+1,t}var decode$1=read$1,MSB=128,REST=127;function read$1(e,r){var n=0,r=r||0,o=0,i=r,s,a=e.length;do{if(i>=a||o>49)throw read$1.bytes=0,new RangeError("Could not decode varint");s=e[i++],n+=o<28?(s&REST)<<o:(s&REST)*Math.pow(2,o),o+=7}while(s>=MSB);return read$1.bytes=i-r,n}var N1=Math.pow(2,7),N2=Math.pow(2,14),N3=Math.pow(2,21),N4=Math.pow(2,28),N5=Math.pow(2,35),N6=Math.pow(2,42),N7=Math.pow(2,49),N8=Math.pow(2,56),N9=Math.pow(2,63),length=function(e){return e<N1?1:e<N2?2:e<N3?3:e<N4?4:e<N5?5:e<N6?6:e<N7?7:e<N8?8:e<N9?9:10},varint={encode:encode_1,decode:decode$1,encodingLength:length};const varint$1=getDefaultExportFromCjs(varint);var indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(e,t){for(var n=new Array(arguments.length-1),r=0,o=2,i=!0;o<arguments.length;)n[r++]=arguments[o++];return new Promise(function(a,c){n[r]=function(f){if(i)if(i=!1,f)c(f);else{for(var h=new Array(arguments.length-1),p=0;p<h.length;)h[p++]=arguments[p];a.apply(null,h)}};try{e.apply(t||null,n)}catch(l){i&&(i=!1,c(l))}})}var base64$1={};(function(e){var t=e;t.length=function(a){var c=a.length;if(!c)return 0;for(var l=0;--c%4>1&&a.charAt(c)==="=";)++l;return Math.ceil(a.length*3)/4-l};for(var n=new Array(64),r=new Array(123),o=0;o<64;)r[n[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;t.encode=function(a,c,l){for(var f=null,h=[],p=0,g=0,B;c<l;){var u=a[c++];switch(g){case 0:h[p++]=n[u>>2],B=(u&3)<<4,g=1;break;case 1:h[p++]=n[B|u>>4],B=(u&15)<<2,g=2;break;case 2:h[p++]=n[B|u>>6],h[p++]=n[u&63],g=0;break}p>8191&&((f||(f=[])).push(String.fromCharCode.apply(String,h)),p=0)}return g&&(h[p++]=n[B],h[p++]=61,g===1&&(h[p++]=61)),f?(p&&f.push(String.fromCharCode.apply(String,h.slice(0,p))),f.join("")):String.fromCharCode.apply(String,h.slice(0,p))};var i="invalid encoding";t.decode=function(a,c,l){for(var f=l,h=0,p,g=0;g<a.length;){var B=a.charCodeAt(g++);if(B===61&&h>1)break;if((B=r[B])===void 0)throw Error(i);switch(h){case 0:p=B,h=1;break;case 1:c[l++]=p<<2|(B&48)>>4,p=B,h=2;break;case 2:c[l++]=(p&15)<<4|(B&60)>>2,p=B,h=3;break;case 3:c[l++]=(p&3)<<6|B,h=0;break}}if(h===1)throw Error(i);return l-f},t.test=function(a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(t,n,r){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:n,ctx:r||this}),this};EventEmitter.prototype.off=function(t,n){if(t===void 0)this._listeners={};else if(n===void 0)this._listeners[t]=[];else for(var r=this._listeners[t],o=0;o<r.length;)r[o].fn===n?r.splice(o,1):++o;return this};EventEmitter.prototype.emit=function(t){var n=this._listeners[t];if(n){for(var r=[],o=1;o<arguments.length;)r.push(arguments[o++]);for(o=0;o<n.length;)n[o].fn.apply(n[o++].ctx,r)}return this};var float=factory(factory);function factory(e){return typeof Float32Array<"u"?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=n[3]===128;function o(c,l,f){t[0]=c,l[f]=n[0],l[f+1]=n[1],l[f+2]=n[2],l[f+3]=n[3]}function i(c,l,f){t[0]=c,l[f]=n[3],l[f+1]=n[2],l[f+2]=n[1],l[f+3]=n[0]}e.writeFloatLE=r?o:i,e.writeFloatBE=r?i:o;function s(c,l){return n[0]=c[l],n[1]=c[l+1],n[2]=c[l+2],n[3]=c[l+3],t[0]}function a(c,l){return n[3]=c[l],n[2]=c[l+1],n[1]=c[l+2],n[0]=c[l+3],t[0]}e.readFloatLE=r?s:a,e.readFloatBE=r?a:s}():function(){function t(r,o,i,s){var a=o<0?1:0;if(a&&(o=-o),o===0)r(1/o>0?0:2147483648,i,s);else if(isNaN(o))r(2143289344,i,s);else if(o>34028234663852886e22)r((a<<31|2139095040)>>>0,i,s);else if(o<11754943508222875e-54)r((a<<31|Math.round(o/1401298464324817e-60))>>>0,i,s);else{var c=Math.floor(Math.log(o)/Math.LN2),l=Math.round(o*Math.pow(2,-c)*8388608)&8388607;r((a<<31|c+127<<23|l)>>>0,i,s)}}e.writeFloatLE=t.bind(null,writeUintLE),e.writeFloatBE=t.bind(null,writeUintBE);function n(r,o,i){var s=r(o,i),a=(s>>31)*2+1,c=s>>>23&255,l=s&8388607;return c===255?l?NaN:a*(1/0):c===0?a*1401298464324817e-60*l:a*Math.pow(2,c-150)*(l+8388608)}e.readFloatLE=n.bind(null,readUintLE),e.readFloatBE=n.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=n[7]===128;function o(c,l,f){t[0]=c,l[f]=n[0],l[f+1]=n[1],l[f+2]=n[2],l[f+3]=n[3],l[f+4]=n[4],l[f+5]=n[5],l[f+6]=n[6],l[f+7]=n[7]}function i(c,l,f){t[0]=c,l[f]=n[7],l[f+1]=n[6],l[f+2]=n[5],l[f+3]=n[4],l[f+4]=n[3],l[f+5]=n[2],l[f+6]=n[1],l[f+7]=n[0]}e.writeDoubleLE=r?o:i,e.writeDoubleBE=r?i:o;function s(c,l){return n[0]=c[l],n[1]=c[l+1],n[2]=c[l+2],n[3]=c[l+3],n[4]=c[l+4],n[5]=c[l+5],n[6]=c[l+6],n[7]=c[l+7],t[0]}function a(c,l){return n[7]=c[l],n[6]=c[l+1],n[5]=c[l+2],n[4]=c[l+3],n[3]=c[l+4],n[2]=c[l+5],n[1]=c[l+6],n[0]=c[l+7],t[0]}e.readDoubleLE=r?s:a,e.readDoubleBE=r?a:s}():function(){function t(r,o,i,s,a,c){var l=s<0?1:0;if(l&&(s=-s),s===0)r(0,a,c+o),r(1/s>0?0:2147483648,a,c+i);else if(isNaN(s))r(0,a,c+o),r(2146959360,a,c+i);else if(s>17976931348623157e292)r(0,a,c+o),r((l<<31|2146435072)>>>0,a,c+i);else{var f;if(s<22250738585072014e-324)f=s/5e-324,r(f>>>0,a,c+o),r((l<<31|f/4294967296)>>>0,a,c+i);else{var h=Math.floor(Math.log(s)/Math.LN2);h===1024&&(h=1023),f=s*Math.pow(2,-h),r(f*4503599627370496>>>0,a,c+o),r((l<<31|h+1023<<20|f*1048576&1048575)>>>0,a,c+i)}}}e.writeDoubleLE=t.bind(null,writeUintLE,0,4),e.writeDoubleBE=t.bind(null,writeUintBE,4,0);function n(r,o,i,s,a){var c=r(s,a+o),l=r(s,a+i),f=(l>>31)*2+1,h=l>>>20&2047,p=4294967296*(l&1048575)+c;return h===2047?p?NaN:f*(1/0):h===0?f*5e-324*p:f*Math.pow(2,h-1075)*(p+4503599627370496)}e.readDoubleLE=n.bind(null,readUintLE,0,4),e.readDoubleBE=n.bind(null,readUintBE,4,0)}(),e}function writeUintLE(e,t,n){t[n]=e&255,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function writeUintBE(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=e&255}function readUintLE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function readUintBE(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8$5={};(function(e){var t=e;t.length=function(r){for(var o=0,i=0,s=0;s<r.length;++s)i=r.charCodeAt(s),i<128?o+=1:i<2048?o+=2:(i&64512)===55296&&(r.charCodeAt(s+1)&64512)===56320?(++s,o+=4):o+=3;return o},t.read=function(r,o,i){var s=i-o;if(s<1)return"";for(var a=null,c=[],l=0,f;o<i;)f=r[o++],f<128?c[l++]=f:f>191&&f<224?c[l++]=(f&31)<<6|r[o++]&63:f>239&&f<365?(f=((f&7)<<18|(r[o++]&63)<<12|(r[o++]&63)<<6|r[o++]&63)-65536,c[l++]=55296+(f>>10),c[l++]=56320+(f&1023)):c[l++]=(f&15)<<12|(r[o++]&63)<<6|r[o++]&63,l>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,c)),l=0);return a?(l&&a.push(String.fromCharCode.apply(String,c.slice(0,l))),a.join("")):String.fromCharCode.apply(String,c.slice(0,l))},t.write=function(r,o,i){for(var s=i,a,c,l=0;l<r.length;++l)a=r.charCodeAt(l),a<128?o[i++]=a:a<2048?(o[i++]=a>>6|192,o[i++]=a&63|128):(a&64512)===55296&&((c=r.charCodeAt(l+1))&64512)===56320?(a=65536+((a&1023)<<10)+(c&1023),++l,o[i++]=a>>18|240,o[i++]=a>>12&63|128,o[i++]=a>>6&63|128,o[i++]=a&63|128):(o[i++]=a>>12|224,o[i++]=a>>6&63|128,o[i++]=a&63|128);return i-s}})(utf8$5);var pool_1=pool;function pool(e,t,n){var r=n||8192,o=r>>>1,i=null,s=r;return function(c){if(c<1||c>o)return e(c);s+c>r&&(i=e(r),s=0);var l=t.call(i,s,s+=c);return s&7&&(s=(s|7)+1),l}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var e=requireMinimal();function t(i,s){this.lo=i>>>0,this.hi=s>>>0}var n=t.zero=new t(0,0);n.toNumber=function(){return 0},n.zzEncode=n.zzDecode=function(){return this},n.length=function(){return 1};var r=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(s){if(s===0)return n;var a=s<0;a&&(s=-s);var c=s>>>0,l=(s-c)/4294967296>>>0;return a&&(l=~l>>>0,c=~c>>>0,++c>4294967295&&(c=0,++l>4294967295&&(l=0))),new t(c,l)},t.from=function(s){if(typeof s=="number")return t.fromNumber(s);if(e.isString(s))if(e.Long)s=e.Long.fromString(s);else return t.fromNumber(parseInt(s,10));return s.low||s.high?new t(s.low>>>0,s.high>>>0):n},t.prototype.toNumber=function(s){if(!s&&this.hi>>>31){var a=~this.lo+1>>>0,c=~this.hi>>>0;return a||(c=c+1>>>0),-(a+c*4294967296)}return this.lo+this.hi*4294967296},t.prototype.toLong=function(s){return e.Long?new e.Long(this.lo|0,this.hi|0,!!s):{low:this.lo|0,high:this.hi|0,unsigned:!!s}};var o=String.prototype.charCodeAt;return t.fromHash=function(s){return s===r?n:new t((o.call(s,0)|o.call(s,1)<<8|o.call(s,2)<<16|o.call(s,3)<<24)>>>0,(o.call(s,4)|o.call(s,5)<<8|o.call(s,6)<<16|o.call(s,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var s=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^s)>>>0,this.lo=(this.lo<<1^s)>>>0,this},t.prototype.zzDecode=function(){var s=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^s)>>>0,this.hi=(this.hi>>>1^s)>>>0,this},t.prototype.length=function(){var s=this.lo,a=(this.lo>>>28|this.hi<<4)>>>0,c=this.hi>>>24;return c===0?a===0?s<16384?s<128?1:2:s<2097152?3:4:a<16384?a<128?5:6:a<2097152?7:8:c<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(e){var t=e;t.asPromise=aspromise,t.base64=base64$1,t.EventEmitter=eventemitter,t.float=float,t.inquire=inquire_1,t.utf8=utf8$5,t.pool=pool_1,t.LongBits=requireLongbits(),t.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(i){return typeof i=="number"&&isFinite(i)&&Math.floor(i)===i},t.isString=function(i){return typeof i=="string"||i instanceof String},t.isObject=function(i){return i&&typeof i=="object"},t.isset=t.isSet=function(i,s){var a=i[s];return a!=null&&i.hasOwnProperty(s)?typeof a!="object"||(Array.isArray(a)?a.length:Object.keys(a).length)>0:!1},t.Buffer=function(){try{var o=t.inquire("buffer").Buffer;return o.prototype.utf8Write?o:null}catch{return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(i){return typeof i=="number"?t.Buffer?t._Buffer_allocUnsafe(i):new t.Array(i):t.Buffer?t._Buffer_from(i):typeof Uint8Array>"u"?i:new Uint8Array(i)},t.Array=typeof Uint8Array<"u"?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(i){return i?t.LongBits.from(i).toHash():t.LongBits.zeroHash},t.longFromHash=function(i,s){var a=t.LongBits.fromHash(i);return t.Long?t.Long.fromBits(a.lo,a.hi,s):a.toNumber(!!s)};function n(o,i,s){for(var a=Object.keys(i),c=0;c<a.length;++c)(o[a[c]]===void 0||!s)&&(o[a[c]]=i[a[c]]);return o}t.merge=n,t.lcFirst=function(i){return i.charAt(0).toLowerCase()+i.substring(1)};function r(o){function i(s,a){if(!(this instanceof i))return new i(s,a);Object.defineProperty(this,"message",{get:function(){return s}}),Error.captureStackTrace?Error.captureStackTrace(this,i):Object.defineProperty(this,"stack",{value:new Error().stack||""}),a&&n(this,a)}return i.prototype=Object.create(Error.prototype,{constructor:{value:i,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return o},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),i}t.newError=r,t.ProtocolError=r("ProtocolError"),t.oneOfGetter=function(i){for(var s={},a=0;a<i.length;++a)s[i[a]]=1;return function(){for(var c=Object.keys(this),l=c.length-1;l>-1;--l)if(s[c[l]]===1&&this[c[l]]!==void 0&&this[c[l]]!==null)return c[l]}},t.oneOfSetter=function(i){return function(s){for(var a=0;a<i.length;++a)i[a]!==s&&delete this[i[a]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var o=t.Buffer;if(!o){t._Buffer_from=t._Buffer_allocUnsafe=null;return}t._Buffer_from=o.from!==Uint8Array.from&&o.from||function(s,a){return new o(s,a)},t._Buffer_allocUnsafe=o.allocUnsafe||function(s){return new o(s)}}}(minimal$1)),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$4=util$4.utf8;function Op(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$3=function e(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$3();Writer$1.alloc=function e(t){return new util$4.Array(t)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function e(t,n,r){return this.tail=this.tail.next=new Op(t,n,r),this.len+=n,this};function writeByte(e,t,n){t[n]=e&255}function writeVarint32(e,t,n){for(;e>127;)t[n++]=e&127|128,e>>>=7;t[n]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function e(t){return this.len+=(this.tail=this.tail.next=new VarintOp((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this};Writer$1.prototype.int32=function e(t){return t<0?this._push(writeVarint64,10,LongBits$1.fromNumber(t)):this.uint32(t)};Writer$1.prototype.sint32=function e(t){return this.uint32((t<<1^t>>31)>>>0)};function writeVarint64(e,t,n){for(;e.hi;)t[n++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=e.lo&127|128,e.lo=e.lo>>>7;t[n++]=e.lo}Writer$1.prototype.uint64=function e(t){var n=LongBits$1.from(t);return this._push(writeVarint64,n.length(),n)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function e(t){var n=LongBits$1.from(t).zzEncode();return this._push(writeVarint64,n.length(),n)};Writer$1.prototype.bool=function e(t){return this._push(writeByte,1,t?1:0)};function writeFixed32(e,t,n){t[n]=e&255,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}Writer$1.prototype.fixed32=function e(t){return this._push(writeFixed32,4,t>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function e(t){var n=LongBits$1.from(t);return this._push(writeFixed32,4,n.lo)._push(writeFixed32,4,n.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function e(t){return this._push(util$4.float.writeFloatLE,4,t)};Writer$1.prototype.double=function e(t){return this._push(util$4.float.writeDoubleLE,8,t)};var writeBytes=util$4.Array.prototype.set?function e(t,n,r){n.set(t,r)}:function e(t,n,r){for(var o=0;o<t.length;++o)n[r+o]=t[o]};Writer$1.prototype.bytes=function e(t){var n=t.length>>>0;if(!n)return this._push(writeByte,1,0);if(util$4.isString(t)){var r=Writer$1.alloc(n=base64.length(t));base64.decode(t,r,0),t=r}return this.uint32(n)._push(writeBytes,n,t)};Writer$1.prototype.string=function e(t){var n=utf8$4.length(t);return n?this.uint32(n)._push(utf8$4.write,n,t):this._push(writeByte,1,0)};Writer$1.prototype.fork=function e(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this};Writer$1.prototype.reset=function e(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this};Writer$1.prototype.ldelim=function e(){var t=this.head,n=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=t.next,this.tail=n,this.len+=r),this};Writer$1.prototype.finish=function e(){for(var t=this.head.next,n=this.constructor.alloc(this.len),r=0;t;)t.fn(t.val,n,r),r+=t.len,t=t.next;return n};Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$3(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(t,n,r){n.set(t,r)}:function(t,n,r){if(t.copy)t.copy(n,r,0,t.length);else for(var o=0;o<t.length;)n[r++]=t[o++]}};BufferWriter.prototype.bytes=function e(t){util$3.isString(t)&&(t=util$3._Buffer_from(t,"base64"));var n=t.length>>>0;return this.uint32(n),n&&this._push(BufferWriter.writeBytesBuffer,n,t),this};function writeStringBuffer(e,t,n){e.length<40?util$3.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}BufferWriter.prototype.string=function e(t){var n=util$3.Buffer.byteLength(t);return this.uint32(n),n&&this._push(writeStringBuffer,n,t),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8$3=util$2.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array=typeof Uint8Array<"u"?function e(t){if(t instanceof Uint8Array||Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")}:function e(t){if(Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")},create$2=function e(){return util$2.Buffer?function(n){return(Reader$1.create=function(o){return util$2.Buffer.isBuffer(o)?new BufferReader$1(o):create_array(o)})(n)}:create_array};Reader$1.create=create$2();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function e(){var t=4294967295;return function(){if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return t}}();Reader$1.prototype.int32=function e(){return this.uint32()|0};Reader$1.prototype.sint32=function e(){var t=this.uint32();return t>>>1^-(t&1)|0};function readLongVarint(){var e=new LongBits(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function e(){return this.uint32()!==0};function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}Reader$1.prototype.fixed32=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t};Reader$1.prototype.double=function e(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t};Reader$1.prototype.bytes=function e(){var t=this.uint32(),n=this.pos,r=this.pos+t;if(r>this.len)throw indexOutOfRange(this,t);if(this.pos+=t,Array.isArray(this.buf))return this.buf.slice(n,r);if(n===r){var o=util$2.Buffer;return o?o.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,n,r)};Reader$1.prototype.string=function e(){var t=this.bytes();return utf8$3.read(t,0,t.length)};Reader$1.prototype.skip=function e(t){if(typeof t=="number"){if(this.pos+t>this.len)throw indexOutOfRange(this,t);this.pos+=t}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this};Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create$2(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function e(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(e,t,n){if(typeof e!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}Service.prototype.rpcCall=function e(t,n,r,o,i){if(!o)throw TypeError("request must be specified");var s=this;if(!i)return util.asPromise(e,s,t,n,r,o);if(!s.rpcImpl){setTimeout(function(){i(Error("already ended"))},0);return}try{return s.rpcImpl(t,n[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),function(c,l){if(c)return s.emit("error",c,t),i(c);if(l===null){s.end(!0);return}if(!(l instanceof r))try{l=r[s.responseDelimited?"decodeDelimited":"decode"](l)}catch(f){return s.emit("error",f,t),i(f)}return s.emit("data",l,t),i(null,l)})}catch(a){s.emit("error",a,t),setTimeout(function(){i(a)},0);return}};Service.prototype.end=function e(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(e){var t=e;t.Service=service})(rpc);var roots={};(function(e){var t=e;t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=n;function n(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}n()})(indexMinimal);var minimal=indexMinimal;const $protobuf=getDefaultExportFromCjs(minimal),$Reader=$protobuf.Reader,$Writer=$protobuf.Writer,$util=$protobuf.util,$root=$protobuf.roots.unixfs||($protobuf.roots.unixfs={}),Data=$root.Data=(()=>{function e(t){if(this.blocksizes=[],t)for(var n=Object.keys(t),r=0;r<n.length;++r)t[n[r]]!=null&&(this[n[r]]=t[n[r]])}return e.prototype.Type=0,e.prototype.Data=$util.newBuffer([]),e.prototype.filesize=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.blocksizes=$util.emptyArray,e.prototype.hashType=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.fanout=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.mode=0,e.prototype.mtime=null,e.encode=function(n,r){if(r||(r=$Writer.create()),r.uint32(8).int32(n.Type),n.Data!=null&&Object.hasOwnProperty.call(n,"Data")&&r.uint32(18).bytes(n.Data),n.filesize!=null&&Object.hasOwnProperty.call(n,"filesize")&&r.uint32(24).uint64(n.filesize),n.blocksizes!=null&&n.blocksizes.length)for(var o=0;o<n.blocksizes.length;++o)r.uint32(32).uint64(n.blocksizes[o]);return n.hashType!=null&&Object.hasOwnProperty.call(n,"hashType")&&r.uint32(40).uint64(n.hashType),n.fanout!=null&&Object.hasOwnProperty.call(n,"fanout")&&r.uint32(48).uint64(n.fanout),n.mode!=null&&Object.hasOwnProperty.call(n,"mode")&&r.uint32(56).uint32(n.mode),n.mtime!=null&&Object.hasOwnProperty.call(n,"mtime")&&$root.UnixTime.encode(n.mtime,r.uint32(66).fork()).ldelim(),r},e.decode=function(n,r){n instanceof $Reader||(n=$Reader.create(n));for(var o=r===void 0?n.len:n.pos+r,i=new $root.Data;n.pos<o;){var s=n.uint32();switch(s>>>3){case 1:i.Type=n.int32();break;case 2:i.Data=n.bytes();break;case 3:i.filesize=n.uint64();break;case 4:if(i.blocksizes&&i.blocksizes.length||(i.blocksizes=[]),(s&7)===2)for(var a=n.uint32()+n.pos;n.pos<a;)i.blocksizes.push(n.uint64());else i.blocksizes.push(n.uint64());break;case 5:i.hashType=n.uint64();break;case 6:i.fanout=n.uint64();break;case 7:i.mode=n.uint32();break;case 8:i.mtime=$root.UnixTime.decode(n,n.uint32());break;default:n.skipType(s&7);break}}if(!i.hasOwnProperty("Type"))throw $util.ProtocolError("missing required 'Type'",{instance:i});return i},e.fromObject=function(n){if(n instanceof $root.Data)return n;var r=new $root.Data;switch(n.Type){case"Raw":case 0:r.Type=0;break;case"Directory":case 1:r.Type=1;break;case"File":case 2:r.Type=2;break;case"Metadata":case 3:r.Type=3;break;case"Symlink":case 4:r.Type=4;break;case"HAMTShard":case 5:r.Type=5;break}if(n.Data!=null&&(typeof n.Data=="string"?$util.base64.decode(n.Data,r.Data=$util.newBuffer($util.base64.length(n.Data)),0):n.Data.length&&(r.Data=n.Data)),n.filesize!=null&&($util.Long?(r.filesize=$util.Long.fromValue(n.filesize)).unsigned=!0:typeof n.filesize=="string"?r.filesize=parseInt(n.filesize,10):typeof n.filesize=="number"?r.filesize=n.filesize:typeof n.filesize=="object"&&(r.filesize=new $util.LongBits(n.filesize.low>>>0,n.filesize.high>>>0).toNumber(!0))),n.blocksizes){if(!Array.isArray(n.blocksizes))throw TypeError(".Data.blocksizes: array expected");r.blocksizes=[];for(var o=0;o<n.blocksizes.length;++o)$util.Long?(r.blocksizes[o]=$util.Long.fromValue(n.blocksizes[o])).unsigned=!0:typeof n.blocksizes[o]=="string"?r.blocksizes[o]=parseInt(n.blocksizes[o],10):typeof n.blocksizes[o]=="number"?r.blocksizes[o]=n.blocksizes[o]:typeof n.blocksizes[o]=="object"&&(r.blocksizes[o]=new $util.LongBits(n.blocksizes[o].low>>>0,n.blocksizes[o].high>>>0).toNumber(!0))}if(n.hashType!=null&&($util.Long?(r.hashType=$util.Long.fromValue(n.hashType)).unsigned=!0:typeof n.hashType=="string"?r.hashType=parseInt(n.hashType,10):typeof n.hashType=="number"?r.hashType=n.hashType:typeof n.hashType=="object"&&(r.hashType=new $util.LongBits(n.hashType.low>>>0,n.hashType.high>>>0).toNumber(!0))),n.fanout!=null&&($util.Long?(r.fanout=$util.Long.fromValue(n.fanout)).unsigned=!0:typeof n.fanout=="string"?r.fanout=parseInt(n.fanout,10):typeof n.fanout=="number"?r.fanout=n.fanout:typeof n.fanout=="object"&&(r.fanout=new $util.LongBits(n.fanout.low>>>0,n.fanout.high>>>0).toNumber(!0))),n.mode!=null&&(r.mode=n.mode>>>0),n.mtime!=null){if(typeof n.mtime!="object")throw TypeError(".Data.mtime: object expected");r.mtime=$root.UnixTime.fromObject(n.mtime)}return r},e.toObject=function(n,r){r||(r={});var o={};if((r.arrays||r.defaults)&&(o.blocksizes=[]),r.defaults){if(o.Type=r.enums===String?"Raw":0,r.bytes===String?o.Data="":(o.Data=[],r.bytes!==Array&&(o.Data=$util.newBuffer(o.Data))),$util.Long){var i=new $util.Long(0,0,!0);o.filesize=r.longs===String?i.toString():r.longs===Number?i.toNumber():i}else o.filesize=r.longs===String?"0":0;if($util.Long){var i=new $util.Long(0,0,!0);o.hashType=r.longs===String?i.toString():r.longs===Number?i.toNumber():i}else o.hashType=r.longs===String?"0":0;if($util.Long){var i=new $util.Long(0,0,!0);o.fanout=r.longs===String?i.toString():r.longs===Number?i.toNumber():i}else o.fanout=r.longs===String?"0":0;o.mode=0,o.mtime=null}if(n.Type!=null&&n.hasOwnProperty("Type")&&(o.Type=r.enums===String?$root.Data.DataType[n.Type]:n.Type),n.Data!=null&&n.hasOwnProperty("Data")&&(o.Data=r.bytes===String?$util.base64.encode(n.Data,0,n.Data.length):r.bytes===Array?Array.prototype.slice.call(n.Data):n.Data),n.filesize!=null&&n.hasOwnProperty("filesize")&&(typeof n.filesize=="number"?o.filesize=r.longs===String?String(n.filesize):n.filesize:o.filesize=r.longs===String?$util.Long.prototype.toString.call(n.filesize):r.longs===Number?new $util.LongBits(n.filesize.low>>>0,n.filesize.high>>>0).toNumber(!0):n.filesize),n.blocksizes&&n.blocksizes.length){o.blocksizes=[];for(var s=0;s<n.blocksizes.length;++s)typeof n.blocksizes[s]=="number"?o.blocksizes[s]=r.longs===String?String(n.blocksizes[s]):n.blocksizes[s]:o.blocksizes[s]=r.longs===String?$util.Long.prototype.toString.call(n.blocksizes[s]):r.longs===Number?new $util.LongBits(n.blocksizes[s].low>>>0,n.blocksizes[s].high>>>0).toNumber(!0):n.blocksizes[s]}return n.hashType!=null&&n.hasOwnProperty("hashType")&&(typeof n.hashType=="number"?o.hashType=r.longs===String?String(n.hashType):n.hashType:o.hashType=r.longs===String?$util.Long.prototype.toString.call(n.hashType):r.longs===Number?new $util.LongBits(n.hashType.low>>>0,n.hashType.high>>>0).toNumber(!0):n.hashType),n.fanout!=null&&n.hasOwnProperty("fanout")&&(typeof n.fanout=="number"?o.fanout=r.longs===String?String(n.fanout):n.fanout:o.fanout=r.longs===String?$util.Long.prototype.toString.call(n.fanout):r.longs===Number?new $util.LongBits(n.fanout.low>>>0,n.fanout.high>>>0).toNumber(!0):n.fanout),n.mode!=null&&n.hasOwnProperty("mode")&&(o.mode=n.mode),n.mtime!=null&&n.hasOwnProperty("mtime")&&(o.mtime=$root.UnixTime.toObject(n.mtime,r)),o},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e.DataType=function(){const t={},n=Object.create(t);return n[t[0]="Raw"]=0,n[t[1]="Directory"]=1,n[t[2]="File"]=2,n[t[3]="Metadata"]=3,n[t[4]="Symlink"]=4,n[t[5]="HAMTShard"]=5,n}(),e})();$root.UnixTime=(()=>{function e(t){if(t)for(var n=Object.keys(t),r=0;r<n.length;++r)t[n[r]]!=null&&(this[n[r]]=t[n[r]])}return e.prototype.Seconds=$util.Long?$util.Long.fromBits(0,0,!1):0,e.prototype.FractionalNanoseconds=0,e.encode=function(n,r){return r||(r=$Writer.create()),r.uint32(8).int64(n.Seconds),n.FractionalNanoseconds!=null&&Object.hasOwnProperty.call(n,"FractionalNanoseconds")&&r.uint32(21).fixed32(n.FractionalNanoseconds),r},e.decode=function(n,r){n instanceof $Reader||(n=$Reader.create(n));for(var o=r===void 0?n.len:n.pos+r,i=new $root.UnixTime;n.pos<o;){var s=n.uint32();switch(s>>>3){case 1:i.Seconds=n.int64();break;case 2:i.FractionalNanoseconds=n.fixed32();break;default:n.skipType(s&7);break}}if(!i.hasOwnProperty("Seconds"))throw $util.ProtocolError("missing required 'Seconds'",{instance:i});return i},e.fromObject=function(n){if(n instanceof $root.UnixTime)return n;var r=new $root.UnixTime;return n.Seconds!=null&&($util.Long?(r.Seconds=$util.Long.fromValue(n.Seconds)).unsigned=!1:typeof n.Seconds=="string"?r.Seconds=parseInt(n.Seconds,10):typeof n.Seconds=="number"?r.Seconds=n.Seconds:typeof n.Seconds=="object"&&(r.Seconds=new $util.LongBits(n.Seconds.low>>>0,n.Seconds.high>>>0).toNumber())),n.FractionalNanoseconds!=null&&(r.FractionalNanoseconds=n.FractionalNanoseconds>>>0),r},e.toObject=function(n,r){r||(r={});var o={};if(r.defaults){if($util.Long){var i=new $util.Long(0,0,!1);o.Seconds=r.longs===String?i.toString():r.longs===Number?i.toNumber():i}else o.Seconds=r.longs===String?"0":0;o.FractionalNanoseconds=0}return n.Seconds!=null&&n.hasOwnProperty("Seconds")&&(typeof n.Seconds=="number"?o.Seconds=r.longs===String?String(n.Seconds):n.Seconds:o.Seconds=r.longs===String?$util.Long.prototype.toString.call(n.Seconds):r.longs===Number?new $util.LongBits(n.Seconds.low>>>0,n.Seconds.high>>>0).toNumber():n.Seconds),n.FractionalNanoseconds!=null&&n.hasOwnProperty("FractionalNanoseconds")&&(o.FractionalNanoseconds=n.FractionalNanoseconds),o},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e})();$root.Metadata=(()=>{function e(t){if(t)for(var n=Object.keys(t),r=0;r<n.length;++r)t[n[r]]!=null&&(this[n[r]]=t[n[r]])}return e.prototype.MimeType="",e.encode=function(n,r){return r||(r=$Writer.create()),n.MimeType!=null&&Object.hasOwnProperty.call(n,"MimeType")&&r.uint32(10).string(n.MimeType),r},e.decode=function(n,r){n instanceof $Reader||(n=$Reader.create(n));for(var o=r===void 0?n.len:n.pos+r,i=new $root.Metadata;n.pos<o;){var s=n.uint32();switch(s>>>3){case 1:i.MimeType=n.string();break;default:n.skipType(s&7);break}}return i},e.fromObject=function(n){if(n instanceof $root.Metadata)return n;var r=new $root.Metadata;return n.MimeType!=null&&(r.MimeType=String(n.MimeType)),r},e.toObject=function(n,r){r||(r={});var o={};return r.defaults&&(o.MimeType=""),n.MimeType!=null&&n.hasOwnProperty("MimeType")&&(o.MimeType=n.MimeType),o},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e})();const NodeType=Data.DataType,EMPTY$3=Object.freeze([]),EMPTY_BUFFER$1=new Uint8Array(0),BLANK$2=Object.freeze({}),DEFAULT_FILE_MODE=parseInt("0644",8),DEFAULT_DIRECTORY_MODE=parseInt("0755",8),code=code$1,name$1="UnixFS",encodePB=(e,t)=>(Object(globalThis).debug&&console.log({data:e,links:t}),encode$2(prepare({Data:Data.encode(e).finish(),Links:t}))),createRaw=e=>({type:NodeType.Raw,content:e}),createEmptyFile=e=>createSimpleFile(EMPTY_BUFFER$1,e),createSimpleFile=(e,t)=>({type:NodeType.File,layout:"simple",content:e,metadata:decodeMetadata(t)}),createFileChunk=e=>({type:NodeType.File,layout:"simple",content:e}),createAdvancedFile=(e,t)=>({type:NodeType.File,layout:"advanced",parts:e,metadata:decodeMetadata(t)}),createFileShard=e=>({type:NodeType.File,layout:"advanced",parts:e}),createComplexFile=(e,t,n)=>({type:NodeType.File,layout:"complex",content:e,parts:t,metadata:decodeMetadata(n)}),createFlatDirectory=(e,t)=>({type:NodeType.Directory,metadata:decodeMetadata(t),entries:e}),createShardedDirectory=(e,t,n,r,o=BLANK$2)=>({type:NodeType.HAMTShard,bitfield:t,fanout:readFanout(n),hashType:readInt(r),entries:e,metadata:decodeMetadata(o)}),createDirectoryShard=(e,t,n,r)=>({type:NodeType.HAMTShard,bitfield:t,fanout:readFanout(n),hashType:readInt(r),entries:e}),encodeRaw=e=>encodePB({Type:NodeType.Raw,Data:e.byteLength>0?e:void 0,filesize:e.byteLength,blocksizes:EMPTY$3},[]),encodeFile=(e,t=!1)=>{const n=t?BLANK$2:Object(e).metadata;switch(e.layout){case"simple":return encodeSimpleFile(e.content,n);case"advanced":return encodeAdvancedFile(e.parts,n);case"complex":return encodeComplexFile(e.content,e.parts,n);default:throw new TypeError(`File with unknown layout "${Object(e).layout}" was passed`)}},encodeFileChunk=e=>encodeSimpleFile(e,BLANK$2),encodeFileShard=e=>encodePB({Type:NodeType.File,blocksizes:e.map(contentByteLength),filesize:cumulativeContentByteLength(e)},e.map(encodeLink)),encodeAdvancedFile=(e,t=BLANK$2)=>encodePB({Type:NodeType.File,blocksizes:e.map(contentByteLength),filesize:cumulativeContentByteLength(e),...encodeMetadata(t)},e.map(encodeLink)),encodeLink=e=>({Name:"",Tsize:e.dagByteLength,Hash:e.cid}),encodeSimpleFile=(e,t=BLANK$2)=>encodePB({Type:NodeType.File,Data:e.byteLength>0?e:void 0,filesize:e.byteLength,blocksizes:[],...encodeMetadata(t)},[]),encodeComplexFile=(e,t,n=BLANK$2)=>encodePB({Type:NodeType.File,Data:e,filesize:e.byteLength+cumulativeContentByteLength(t),blocksizes:t.map(contentByteLength)},t.map(encodeLink)),encodeDirectory=e=>encodePB({Type:e.type,...encodeDirectoryMetadata(e.metadata||BLANK$2)},e.entries.map(encodeNamedLink)),encodeHAMTShard=({bitfield:e,fanout:t,hashType:n,entries:r,metadata:o=BLANK$2})=>encodePB({Type:NodeType.HAMTShard,Data:e.byteLength>0?e:void 0,fanout:readFanout(t),hashType:readInt(n),...encodeDirectoryMetadata(o)},r.map(encodeNamedLink)),readFanout=e=>{if(Math.log2(e)%1===0)return e;throw new TypeError(`Expected hamt size to be a power of two instead got ${e}`)},readInt=e=>{if(Number.isInteger(e))return e;throw new TypeError(`Expected an integer value instead got ${e}`)},createSymlink=(e,t=BLANK$2)=>({type:NodeType.Symlink,content:e,metadata:decodeMetadata(t)}),encodeSymlink=(e,t=!1)=>{const n=t?BLANK$2:Object(e).metadata;return encodePB({Type:NodeType.Symlink,Data:e.content,...encodeMetadata(n||BLANK$2)},[])},encode=(e,t=!0)=>{switch(e.type){case NodeType.Raw:return encodeRaw(e.content);case NodeType.File:return encodeFile(e);case NodeType.Directory:return encodeDirectory(e);case NodeType.HAMTShard:return encodeHAMTShard(e);case NodeType.Symlink:return encodeSymlink(e);default:throw new Error(`Unknown node type ${Object(e).type}`)}},decode=e=>{const t=decode$2(e),n=Data.decode(t.Data),{Type:r,Data:o,mtime:i,mode:s,blocksizes:a,...c}=Data.toObject(n,{defaults:!1,arrays:!0,longs:Number,objects:!1}),l={...s&&{mode:s},...decodeMtime(i)},f=t.Links;switch(n.Type){case NodeType.Raw:return createRaw(o);case NodeType.File:return f.length===0?new SimpleFileView(o,l):o.byteLength===0?new AdvancedFileView(decodeFileLinks(c.blocksizes,f),l):new ComplexFileView(o,decodeFileLinks(c.blocksizes,f),l);case NodeType.Directory:return createFlatDirectory(decodeDirectoryLinks(f),l);case NodeType.HAMTShard:return createShardedDirectory(decodeDirectoryLinks(f),o||EMPTY_BUFFER$1,c.fanout,c.hashType,l);case NodeType.Symlink:return createSymlink(o,l);default:throw new TypeError(`Unsupported node type ${n.Type}`)}},decodeMtime=e=>e==null?void 0:{mtime:{secs:e.Seconds,nsecs:e.FractionalNanoseconds||0}},decodeFileLinks=(e,t)=>{const n=[],r=e.length;let o=0;for(;o<r;)n.push({cid:t[o].Hash,dagByteLength:t[o].Tsize||0,contentByteLength:e[o]});return n},decodeDirectoryLinks=e=>e.map(t=>({cid:t.Hash,name:t.Name||"",dagByteLength:t.Tsize||0})),cumulativeContentByteLength=e=>e.reduce((t,n)=>t+n.contentByteLength,0),cumulativeDagByteLength=(e,t)=>t.reduce((n,r)=>n+r.dagByteLength,e.byteLength),contentByteLength=e=>e.contentByteLength,encodeNamedLink=({name:e,dagByteLength:t,cid:n})=>({Name:e,Tsize:t,Hash:n}),encodeDirectoryMetadata=e=>encodeMetadata(e,DEFAULT_DIRECTORY_MODE),encodeMetadata=({mode:e,mtime:t},n=DEFAULT_FILE_MODE)=>({mode:e!=null?encodeMode(e,n):void 0,mtime:t!=null?encodeMTime(t):void 0}),decodeMetadata=e=>e==null?BLANK$2:{...e.mode==null?void 0:{mode:decodeMode(e.mode)},...e.mtime==null?void 0:{mtime:e.mtime}},encodeMTime=e=>e==null?void 0:e.nsecs!==0?{Seconds:e.secs,FractionalNanoseconds:e.nsecs}:{Seconds:e.secs},encodeMode=(e,t)=>{const n=e==null?void 0:decodeMode(e);return n===t||n==null?void 0:n},decodeMode=e=>e&4095|e&4294963200,matchFile=({content:e=EMPTY_BUFFER$1,parts:t=EMPTY$3,metadata:n=BLANK$2,...r})=>t.length===0?new SimpleFileView(e,n):e.byteLength===0?new AdvancedFileView(t,n):new ComplexFileView(e,t,n);class SimpleFileView{constructor(t,n){this.content=t,this.metadata=n,this.layout="simple",this.type=NodeType.File}get filesize(){return this.content.byteLength}encode(){return encodeSimpleFile(this.content,this.metadata)}}class AdvancedFileView{constructor(t,n){this.parts=t,this.metadata=n}get layout(){return"advanced"}get type(){return NodeType.File}get fileSize(){return cumulativeContentByteLength(this.parts)}get blockSizes(){return this.parts.map(contentByteLength)}encode(){return encodeAdvancedFile(this.parts,this.metadata)}}class ComplexFileView{constructor(t,n,r){this.content=t,this.parts=n,this.metadata=r}get layout(){return"complex"}get type(){return NodeType.File}get fileSize(){return this.content.byteLength+cumulativeContentByteLength(this.parts)}get blockSizes(){return this.parts.map(contentByteLength)}encode(){return encodeComplexFile(this.content,this.parts,this.metadata)}}const filesize=e=>{switch(e.type){case NodeType.Raw:case NodeType.Symlink:return e.content.byteLength;case NodeType.File:switch(e.layout){case"simple":return e.content.byteLength;case"advanced":return cumulativeContentByteLength(e.parts);case"complex":return e.content.byteLength+cumulativeContentByteLength(e.parts)}default:return 0}},UnixFS=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_DIRECTORY_MODE,DEFAULT_FILE_MODE,NodeType,code,createAdvancedFile,createComplexFile,createDirectoryShard,createEmptyFile,createFileChunk,createFileShard,createFlatDirectory,createRaw,createShardedDirectory,createSimpleFile,createSymlink,cumulativeContentByteLength,cumulativeDagByteLength,decode,decodeMetadata,encode,encodeAdvancedFile,encodeComplexFile,encodeDirectory,encodeDirectoryMetadata,encodeFile,encodeFileChunk,encodeFileShard,encodeHAMTShard,encodeLink,encodeMetadata,encodeMode,encodeRaw,encodeSimpleFile,encodeSymlink,filesize,matchFile,name:name$1},Symbol.toStringTag,{value:"Module"})),effect=function*(e){const t=yield*e;yield*send(t)};function*current(){return yield CURRENT}const suspend=function*(){yield SUSPEND},wait=function*(e){const t=yield*current();if(isAsync(e)){let n=!1,r;if(e.then(o=>{n=!1,r=o,enqueue(t)},o=>{n=!0,r=o,enqueue(t)}),yield*suspend(),n)throw r;return r}else return main(wake(t)),yield*suspend(),e};function*wake(e){enqueue(e)}const isAsync=e=>e!=null&&typeof e.then=="function",send=function*(e){yield e},listen=function*(e){const t=[];for(const n of Object.entries(e)){const[r,o]=n;o!==NONE&&t.push(yield*fork$1(tag(o,r)))}yield*group(t)},effects=e=>e.length>0?batch(e.map(effect)):NONE;function*batch(e){const t=[];for(const n of e)t.push(yield*fork$1(n));yield*group(t)}const tag=(e,t)=>e===NONE?NONE:e instanceof Tagger?new Tagger([...e.tags,t],e.source):new Tagger([t],e);class Tagger{constructor(t,n){this.tags=t,this.source=n,this.controller}[Symbol.iterator](){return this.controller||(this.controller=this.source[Symbol.iterator]()),this}box(t){if(t.done)return t;switch(t.value){case SUSPEND:case CURRENT:return t;default:{const n=t;let{value:r}=n;for(const o of this.tags)r=withTag(o,r);return n.value=r,n}}}next(t){return this.box(this.controller.next(t))}throw(t){return this.box(this.controller.throw(t))}return(t){return this.box(this.controller.return(t))}get[Symbol.toStringTag](){return"TaggedEffect"}}const none=()=>NONE,withTag=(e,t)=>({type:e,[e]:t}),CURRENT=Symbol("current"),SUSPEND=Symbol("suspend");class Group{static of(t){return t.group||MAIN}static enqueue(t,n){t.group=n,n.stack.active.push(t)}constructor(t,n=[],r=new Set,o=new Stack(n,r)){this.driver=t,this.parent=Group.of(t),this.stack=o,this.id=++ID}}class Main{constructor(){this.status=IDLE,this.stack=new Stack,this.id=0}}class Stack{constructor(t=[],n=new Set){this.active=t,this.idle=n}static size({active:t,idle:n}){return t.length+n.size}}const main=e=>enqueue(e[Symbol.iterator]()),enqueue=e=>{let t=Group.of(e);for(t.stack.active.push(e),t.stack.idle.delete(e);t.parent;){const{idle:n,active:r}=t.parent.stack;if(n.has(t.driver))n.delete(t.driver),r.push(t.driver);else break;t=t.parent}if(MAIN.status===IDLE)for(MAIN.status=ACTIVE;;)try{for(const n of step(MAIN));MAIN.status=IDLE;break}catch{MAIN.stack.active.shift()}},resume=e=>enqueue(e),step=function*(e){const{active:t}=e.stack;let n=t[0];for(e.stack.idle.delete(n);n;){let r=INIT;e:for(;!r.done&&n===t[0];){const o=r.value;switch(o){case SUSPEND:e.stack.idle.add(n);break e;case CURRENT:r=n.next(n);break;default:r=n.next(yield o);break}}t.shift(),n=t[0],e.stack.idle.delete(n)}},fork$1=(e,t)=>new Fork(e,t),exit=(e,t)=>conclude(e,{ok:!0,value:t}),abort=(e,t)=>conclude(e,{ok:!1,error:t});function*conclude(e,t){try{const n=e,r=t.ok?n.return(t.value):n.throw(t.error);if(!r.done)if(r.value===SUSPEND){const{idle:o}=Group.of(n).stack;o.add(n)}else enqueue(n)}catch{}}function*group(e){if(e.length===0)return;const t=yield*current(),n=new Group(t);let r=null;for(const o of e){const{result:i}=o;if(i){!i.ok&&!r&&(r=i);continue}move(o,n)}try{if(r)throw r.error;for(;yield*step(n),Stack.size(n.stack)>0;)yield*suspend()}catch(o){for(const i of n.stack.active)yield*abort(i,o);for(const i of n.stack.idle)yield*abort(i,o),enqueue(i);throw o}}const move=(e,t)=>{const n=Group.of(e);if(n!==t){const{active:r,idle:o}=n.stack,i=t.stack;if(e.group=t,o.has(e))o.delete(e),i.idle.add(e);else{const s=r.indexOf(e);s>=0&&(r.splice(s,1),i.active.push(e))}}};function*join(e){e.status===IDLE&&(yield*e),e.result||(yield*group([e]));const t=e.result;if(t.ok)return t.value;throw t.error}class Future{constructor(t){this.handler=t,this.result}get promise(){const{result:t}=this,n=t==null?new Promise((r,o)=>{this.handler.onsuccess=r,this.handler.onfailure=o}):t.ok?Promise.resolve(t.value):Promise.reject(t.error);return Object.defineProperty(this,"promise",{value:n}),n}then(t,n){return this.activate().promise.then(t,n)}catch(t){return this.activate().promise.catch(t)}finally(t){return this.activate().promise.finally(t)}activate(){return this}}class Fork extends Future{constructor(t,n=BLANK$1,r={},o=INIT){super(r),this.id=++ID,this.name=n.name||"",this.task=t,this.state=o,this.status=IDLE,this.result,this.handler=r,this.controller}*resume(){resume(this)}join(){return join(this)}abort(t){return abort(this,t)}exit(t){return exit(this,t)}get[Symbol.toStringTag](){return"Fork"}*[Symbol.iterator](){return this.activate()}activate(){return this.controller=this.task[Symbol.iterator](),this.status=ACTIVE,enqueue(this),this}panic(t){this.result={ok:!1,error:t},this.status=FINISHED;const{handler:n}=this;throw n.onfailure&&n.onfailure(t),t}step(t){if(this.state=t,t.done){this.result={ok:!0,value:t.value},this.status=FINISHED;const{handler:n}=this;n.onsuccess&&n.onsuccess(t.value)}return t}next(t){try{return this.step(this.controller.next(t))}catch(n){return this.panic(n)}}return(t){try{return this.step(this.controller.return(t))}catch(n){return this.panic(n)}}throw(t){try{return this.step(this.controller.throw(t))}catch(n){return this.panic(n)}}}const loop=function*(e,t){const n=yield*current(),r=new Group(n);for(Group.enqueue(e[Symbol.iterator](),r);;){for(const o of step(r))Group.enqueue(t(o)[Symbol.iterator](),r);if(Stack.size(r.stack)>0)yield*suspend();else break}};let ID=0;const IDLE="idle",ACTIVE="active",FINISHED="finished",INIT={done:!1,value:CURRENT},BLANK$1={},NONE=function*e(){}(),MAIN=new Main;function Indexed(){}Object.defineProperties(Indexed,{prototype:{value:new Proxy(Object.prototype,{get(e,t,n){return typeof t=="symbol"?Reflect.get(e,t,n):n.get(t)}})}});const empty$2=()=>new BufferView,slice=(e,t=0,n=e.byteLength)=>{const r=[],o=t<0?e.byteLength-t:t,i=n<0?e.byteLength-n:n;if(o===0&&i>=e.byteLength)return e;if(o>i||o>e.byteLength||i<=0)return empty$2();let s=0,a=0;for(const c of e.segments){const l=a+c.byteLength;if(s===0){if(i<=l){const f=c.subarray(o-a,i-a);r.push(f),s=f.byteLength;break}else if(o<l){const f=o===a?c:c.subarray(o-a);r.push(f),s=f.byteLength}}else if(i<=l){const f=i===l?c:c.subarray(0,i-a);r.push(f),s+=f.byteLength;break}else r.push(c),s+=c.byteLength;a=l}return new BufferView(r,e.byteOffset+o,s)},push=(e,t)=>t.byteLength>0?(e.segments.push(t),new BufferView(e.segments,e.byteOffset,e.byteLength+t.byteLength)):e,get$4=(e,t)=>{if(t<e.byteLength){let n=0;for(const r of e.segments){if(t<n+r.byteLength)return r[t-n];n+=r.byteLength}}},copyTo=(e,t,n)=>{let r=n;for(const o of e.segments)t.set(o,r),r+=o.byteLength;return t};function*iterate$1(e){for(const t of e.segments)yield*t}class BufferView extends Indexed{constructor(t=[],n=0,r=0){super(),this.segments=t,this.byteLength=r,this.length=r,this.byteOffset=n}[Symbol.iterator](){return iterate$1(this)}slice(t,n){return slice(this,t,n)}subarray(t,n){return slice(this,t,n)}push(t){return push(this,t)}get(t){return get$4(this,t)}copyTo(t,n){return copyTo(this,t,n)}}const panic=e=>{throw new Error(e)},unreachable=(e,t,...n)=>panic(String.raw(e,JSON.stringify(t),...n)),EMPTY_BUFFER=new Uint8Array(0),EMPTY$2=[],open$1=e=>({config:e,buffer:empty$2()}),write$3=(e,t)=>t.byteLength>0?split(e.config,e.buffer.push(t),!1):{...e,chunks:EMPTY$2},close$3=e=>split(e.config,e.buffer,!0),split=(e,t,n)=>{const r=e.chunker,o=[];let i=0;for(const s of r.cut(r.context,t,n))if(s>0){const a=t.subarray(i,i+s);o.push(a),i+=s}return{config:e,chunks:o,buffer:t.subarray(i)}},mutable=()=>({mutable:!0,needs:{},nodes:{},links:{},linked:EMPTY$1}),addNodes=(e,t)=>{let n=patch(t,{});for(const r of e){const{ready:o,has:i,wants:s}=collect(r.children,n.links);s.length===0?n=patch(n,{links:assign(void 0,i),linked:[{id:r.id,links:o}]}):n=patch(n,{needs:assign(r.id,s),nodes:{[r.id]:{children:r.children,count:s.length}}})}return n},addLink=(e,t,n)=>{const r=n.needs[e],o=n.nodes[r];if(o!=null)if(o.count===1){const{ready:i,has:s}=collect(o.children,{...n.links,[e]:t});return patch(n,{needs:{[e]:void 0},links:assign(void 0,s),nodes:{[r]:void 0},linked:[{id:r,links:i}]})}else return patch(n,{needs:{[e]:void 0},links:{[e]:t},nodes:{[r]:{...o,count:o.count-1}}});else return patch(n,{links:{[e]:t}})},patch=(e,{needs:t,nodes:n,links:r,linked:o})=>{const i=e.mutable?e:{...e},s=e.mutable?BLANK:void 0;return t&&(i.needs=patchDict(e.needs,t,s)),n&&(i.nodes=patchDict(e.nodes,n,s)),r&&(i.links=patchDict(e.links,r,s)),i.linked=o?append(e.linked||EMPTY$1,o,EMPTY$1):e.linked||[],i},assign=(e,t)=>{const n={};for(const r of t)n[r]=e;return n},patchDict=(e,t,n=e)=>{const r=e===n?{...e}:e;for(const o of Object.entries(t)){const[i,s]=o;s==null?delete r[i]:r[i]=s}return r},append=(e,t,n=e)=>{if(e===n)return[...e,...t];for(const r of t)e.push(r);return e},collect=(e,t)=>{const n=[],r=[],o=[];for(const i of e){const s=t[i];s?(n.push(i),o.push(s)):r.push(i)}return{has:n,wants:r,ready:o}},EMPTY$1=Object.freeze([]),BLANK=Object.freeze({}),update=(e,t)=>{switch(e.type){case"write":return write$2(t,e.bytes);case"link":return link(t,e.link);case"block":return{state:t,effect:none()};case"close":return close$2(t);case"end":return{state:t,effect:none()};default:return unreachable`File Writer got unknown message ${e}`}},init=(e,t,n)=>({status:"open",metadata:t,config:n,writer:e,chunker:open$1({chunker:n.chunker}),layout:n.fileLayout.open(),nodeQueue:mutable()}),write$2=(e,t)=>{if(e.status==="open"){const{chunks:n,...r}=write$3(e.chunker,t),{nodes:o,leaves:i,layout:s}=e.config.fileLayout.write(e.layout,n),{linked:a,...c}=addNodes(o,e.nodeQueue),l=[...encodeLeaves(i,e.config),...encodeBranches(a,e.config)];return{state:{...e,chunker:r,layout:s,nodeQueue:c},effect:listen({link:effects(l)})}}else return panic("Unable to perform write on closed file")},link=(e,{id:t,link:n,block:r})=>{let{linked:o,...i}=addLink(t,n,e.nodeQueue);const s=encodeBranches(o,e.config),a=e.status==="closed"&&t===e.rootID?{...e,status:"linked",link:n,nodeQueue:i}:{...e,nodeQueue:i},c=e.status==="closed"&&t===e.rootID&&e.end?e.end.resume():none();return{state:a,effect:listen({link:effects(s),block:writeBlock(e.writer,r),end:c})}},close$2=e=>{if(e.status==="open"){const{chunks:t}=close$3(e.chunker),{layout:n,...r}=e.config.fileLayout.write(e.layout,t),{root:o,...i}=e.config.fileLayout.close(n,e.metadata),[s,a]=isLeafNode(o)?[[...r.nodes,...i.nodes],[...r.leaves,...i.leaves,o]]:[[...r.nodes,...i.nodes,o],[...r.leaves,...i.leaves]],{linked:c,...l}=addNodes(s,e.nodeQueue),f=[...encodeLeaves(a,e.config),...encodeBranches(c,e.config)],h=fork$1(suspend());return{state:{...e,chunker:null,layout:null,rootID:o.id,status:"closed",end:h,nodeQueue:l},effect:listen({link:effects(f),end:join(h)})}}else return{state:e,effect:none()}},encodeLeaves=(e,t)=>e.map(n=>encodeLeaf(t,n,t.fileChunkEncoder)),encodeLeaf=function*({hasher:e,linker:t},{id:n,content:r},o){const i=o.encode(r?asUint8Array(r):EMPTY_BUFFER),s=yield*wait(e.digest(i)),a=t.createLink(o.code,s),c={cid:a,bytes:i},l={cid:a,contentByteLength:r?r.byteLength:0,dagByteLength:i.byteLength};return{id:n,block:c,link:l}},encodeBranches=(e,t)=>e.map(n=>encodeBranch(t,n)),encodeBranch=function*(e,{id:t,links:n},r){const o=e.fileEncoder.encode({type:NodeType.File,layout:"advanced",parts:n,metadata:r}),i=yield*wait(Promise.resolve(e.hasher.digest(o))),s=e.linker.createLink(e.fileEncoder.code,i),a={bytes:o,cid:s},c={cid:s,contentByteLength:cumulativeContentByteLength(n),dagByteLength:cumulativeDagByteLength(o,n)};return{id:t,block:a,link:c}},writeBlock=function*(e,t){(e.desiredSize||0)<=0&&(yield*wait(e.ready)),e.write(t)},asUint8Array=e=>e instanceof Uint8Array?e:e.copyTo(new Uint8Array(e.byteLength),0),isLeafNode=e=>e.children==null,name="fixed",context={maxChunkSize:262144},type="Stateless",withMaxChunkSize=e=>({type:"Stateless",context:{maxChunkSize:e},name,cut}),cut=({maxChunkSize:e},{byteLength:t},n)=>{const r=t/e|0,o=new Array(r).fill(e),i=n?t-r*e:0;return i>0&&o.push(i),o},FixedSize=Object.freeze(Object.defineProperty({__proto__:null,context,cut,name,type,withMaxChunkSize},Symbol.toStringTag,{value:"Module"}));class Node{constructor(t,n,r){this.id=t,this.children=n,this.metadata=r}}const withWidth=e=>({open:()=>open({width:e}),write:write$1,close:close$1}),defaults$1={width:174},open=({width:e}=defaults$1)=>({width:e,head:null,leafIndex:[],nodeIndex:[],lastID:0}),write$1=(e,t)=>{if(t.length===0)return{layout:e,nodes:EMPTY,leaves:EMPTY};{let{lastID:n}=e;const[r,o]=e.head?[null,(t.unshift(e.head),t)]:t.length===1&&e.leafIndex.length===0?[t[0],EMPTY]:[null,t];if(o.length===0)return{layout:{...e,head:r},nodes:EMPTY,leaves:EMPTY};{const i=[...e.leafIndex],s=[];for(const a of o){const c={id:++n,content:a};s.push(c),i.push(c.id)}return i.length>e.width?flush({...e,leafIndex:i,head:r,lastID:n},s):{layout:{...e,head:r,leafIndex:i,lastID:n},leaves:s,nodes:EMPTY}}}},flush=(e,t=EMPTY,n=[],r=!1)=>{let{lastID:o}=e;const i=e.nodeIndex.map(l=>[...l]),s=[...e.leafIndex],{width:a}=e;for(;s.length>a||s.length>0&&r;){grow(i,1);const l=new Node(++o,s.splice(0,a));i[0].push(l.id),n.push(l)}let c=0;for(;c<i.length;){const l=i[c];for(c++;l.length>a||l.length>0&&r&&c<i.length;){const f=new Node(++o,l.splice(0,a));grow(i,c+1),i[c].push(f.id),n.push(f)}}return{layout:{...e,lastID:o,leafIndex:s,nodeIndex:i},leaves:t,nodes:n}},close$1=(e,t)=>{const n=e;if(e.head)return{root:{id:1,content:e.head,metadata:t},leaves:EMPTY,nodes:EMPTY};if(e.leafIndex.length===0)return{root:{id:1,metadata:t},leaves:EMPTY,nodes:EMPTY};{const{nodes:r,layout:o}=flush(n,EMPTY,[],!0),{nodeIndex:i}=o,s=i.length-1,a=i[s];if(a.length===1){const c=r[r.length-1];return r.length=r.length-1,{root:c,nodes:r,leaves:EMPTY}}else return{root:new Node(o.lastID+1,a,t),nodes:r,leaves:EMPTY}}},grow=(e,t)=>{for(;e.length<t;)e.push([]);return e},EMPTY=[],defaults=()=>({chunker:FixedSize,fileChunkEncoder:UnixFSLeaf,smallFileEncoder:UnixFSLeaf,fileEncoder:UnixFS,fileLayout:withWidth(174),hasher:sha256,linker:{createLink:CID.createV1}}),configure$4=e=>({...defaults(),...e}),UnixFSLeaf={code,name:name$1,encode:encodeFileChunk},create$1=({writer:e,metadata:t={},settings:n=defaults()})=>new FileWriterView(init(e,t,configure$4(n))),write=async(e,t)=>(await perform(e,send({type:"write",bytes:t})),e),close=async(e,{releaseLock:t=!1,closeWriter:n=!1}={})=>{await perform(e,send({type:"close"}));const{state:r}=e;if(r.status==="linked")return n?await e.state.writer.close():t&&e.state.writer.releaseLock(),r.link;panic(`Expected writer to be in 'linked' state after close, but it is in "${r.status}" instead`)},perform=(e,t)=>fork$1(loop(t,n=>{const{state:r,effect:o}=update(n,e.state);return e.state=r,o}));class FileWriterView{constructor(t){this.state=t}get writer(){return this.state.writer}get settings(){return this.state.config}write(t){return write(this,t)}close(t){return close(this,t)}}const api=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),empty$1=(e=32)=>{if(e!==32)throw new Error(`Uint32 BitField does not support size: ${e}`);return 0},from$3=(e,t)=>{let n=empty$1(t);for(const r of e)n=set$2(n,r);return n},size$1=e=>32,mask=(e,t)=>e>>>t&31,offset=(e,t)=>1<<mask(e,t),popcount$1=(e,t=31)=>bitCount(e&offset(t,0)-1),set$2=(e,t)=>e|1<<t,unset$1=(e,t)=>e&(255^1<<t),get$3=(e,t)=>(e>>t&1)!==0,bitCount=e=>{const t=e-(e>>1&1431655765),n=(t&858993459)+(t>>2&858993459);return(n+(n>>4)&252645135)*16843009>>24},and$1=(e,t)=>e&t,or$1=(e,t)=>e|t,toBytes$1=e=>Uint8Array.of(e>>24&255,e>>16&255,e>>8&255,e&255),fromBytes$1=e=>{if(e.length!==4)throw new Error(`Expected 4 bytes instead got ${e.length}`);return(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3]},Uint32BitField=Object.freeze(Object.defineProperty({__proto__:null,API:api,and:and$1,bitCount,empty:empty$1,from:from$3,fromBytes:fromBytes$1,get:get$3,or:or$1,popcount:popcount$1,set:set$2,size:size$1,toBytes:toBytes$1,unset:unset$1},Symbol.toStringTag,{value:"Module"}));var murmurHash3js={exports:{}};(function(e,t){(function(n,r){var o={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function i(u){if(!Array.isArray(u)&&!ArrayBuffer.isView(u))return!1;for(var d=0;d<u.length;d++)if(!Number.isInteger(u[d])||u[d]<0||u[d]>255)return!1;return!0}function s(u,d){return(u&65535)*d+(((u>>>16)*d&65535)<<16)}function a(u,d){return u<<d|u>>>32-d}function c(u){return u^=u>>>16,u=s(u,2246822507),u^=u>>>13,u=s(u,3266489909),u^=u>>>16,u}function l(u,d){u=[u[0]>>>16,u[0]&65535,u[1]>>>16,u[1]&65535],d=[d[0]>>>16,d[0]&65535,d[1]>>>16,d[1]&65535];var w=[0,0,0,0];return w[3]+=u[3]+d[3],w[2]+=w[3]>>>16,w[3]&=65535,w[2]+=u[2]+d[2],w[1]+=w[2]>>>16,w[2]&=65535,w[1]+=u[1]+d[1],w[0]+=w[1]>>>16,w[1]&=65535,w[0]+=u[0]+d[0],w[0]&=65535,[w[0]<<16|w[1],w[2]<<16|w[3]]}function f(u,d){u=[u[0]>>>16,u[0]&65535,u[1]>>>16,u[1]&65535],d=[d[0]>>>16,d[0]&65535,d[1]>>>16,d[1]&65535];var w=[0,0,0,0];return w[3]+=u[3]*d[3],w[2]+=w[3]>>>16,w[3]&=65535,w[2]+=u[2]*d[3],w[1]+=w[2]>>>16,w[2]&=65535,w[2]+=u[3]*d[2],w[1]+=w[2]>>>16,w[2]&=65535,w[1]+=u[1]*d[3],w[0]+=w[1]>>>16,w[1]&=65535,w[1]+=u[2]*d[2],w[0]+=w[1]>>>16,w[1]&=65535,w[1]+=u[3]*d[1],w[0]+=w[1]>>>16,w[1]&=65535,w[0]+=u[0]*d[3]+u[1]*d[2]+u[2]*d[1]+u[3]*d[0],w[0]&=65535,[w[0]<<16|w[1],w[2]<<16|w[3]]}function h(u,d){return d%=64,d===32?[u[1],u[0]]:d<32?[u[0]<<d|u[1]>>>32-d,u[1]<<d|u[0]>>>32-d]:(d-=32,[u[1]<<d|u[0]>>>32-d,u[0]<<d|u[1]>>>32-d])}function p(u,d){return d%=64,d===0?u:d<32?[u[0]<<d|u[1]>>>32-d,u[1]<<d]:[u[1]<<d-32,0]}function g(u,d){return[u[0]^d[0],u[1]^d[1]]}function B(u){return u=g(u,[0,u[0]>>>1]),u=f(u,[4283543511,3981806797]),u=g(u,[0,u[0]>>>1]),u=f(u,[3301882366,444984403]),u=g(u,[0,u[0]>>>1]),u}o.x86.hash32=function(u,d){if(o.inputValidation&&!i(u))return r;d=d||0;for(var w=u.length%4,F=u.length-w,m=d,y=0,b=3432918353,k=461845907,S=0;S<F;S=S+4)y=u[S]|u[S+1]<<8|u[S+2]<<16|u[S+3]<<24,y=s(y,b),y=a(y,15),y=s(y,k),m^=y,m=a(m,13),m=s(m,5)+3864292196;switch(y=0,w){case 3:y^=u[S+2]<<16;case 2:y^=u[S+1]<<8;case 1:y^=u[S],y=s(y,b),y=a(y,15),y=s(y,k),m^=y}return m^=u.length,m=c(m),m>>>0},o.x86.hash128=function(u,d){if(o.inputValidation&&!i(u))return r;d=d||0;for(var w=u.length%16,F=u.length-w,m=d,y=d,b=d,k=d,S=0,L=0,$=0,T=0,_=597399067,O=2869860233,M=951274213,z=2716044179,v=0;v<F;v=v+16)S=u[v]|u[v+1]<<8|u[v+2]<<16|u[v+3]<<24,L=u[v+4]|u[v+5]<<8|u[v+6]<<16|u[v+7]<<24,$=u[v+8]|u[v+9]<<8|u[v+10]<<16|u[v+11]<<24,T=u[v+12]|u[v+13]<<8|u[v+14]<<16|u[v+15]<<24,S=s(S,_),S=a(S,15),S=s(S,O),m^=S,m=a(m,19),m+=y,m=s(m,5)+1444728091,L=s(L,O),L=a(L,16),L=s(L,M),y^=L,y=a(y,17),y+=b,y=s(y,5)+197830471,$=s($,M),$=a($,17),$=s($,z),b^=$,b=a(b,15),b+=k,b=s(b,5)+2530024501,T=s(T,z),T=a(T,18),T=s(T,_),k^=T,k=a(k,13),k+=m,k=s(k,5)+850148119;switch(S=0,L=0,$=0,T=0,w){case 15:T^=u[v+14]<<16;case 14:T^=u[v+13]<<8;case 13:T^=u[v+12],T=s(T,z),T=a(T,18),T=s(T,_),k^=T;case 12:$^=u[v+11]<<24;case 11:$^=u[v+10]<<16;case 10:$^=u[v+9]<<8;case 9:$^=u[v+8],$=s($,M),$=a($,17),$=s($,z),b^=$;case 8:L^=u[v+7]<<24;case 7:L^=u[v+6]<<16;case 6:L^=u[v+5]<<8;case 5:L^=u[v+4],L=s(L,O),L=a(L,16),L=s(L,M),y^=L;case 4:S^=u[v+3]<<24;case 3:S^=u[v+2]<<16;case 2:S^=u[v+1]<<8;case 1:S^=u[v],S=s(S,_),S=a(S,15),S=s(S,O),m^=S}return m^=u.length,y^=u.length,b^=u.length,k^=u.length,m+=y,m+=b,m+=k,y+=m,b+=m,k+=m,m=c(m),y=c(y),b=c(b),k=c(k),m+=y,m+=b,m+=k,y+=m,b+=m,k+=m,("00000000"+(m>>>0).toString(16)).slice(-8)+("00000000"+(y>>>0).toString(16)).slice(-8)+("00000000"+(b>>>0).toString(16)).slice(-8)+("00000000"+(k>>>0).toString(16)).slice(-8)},o.x64.hash128=function(u,d){if(o.inputValidation&&!i(u))return r;d=d||0;for(var w=u.length%16,F=u.length-w,m=[0,d],y=[0,d],b=[0,0],k=[0,0],S=[2277735313,289559509],L=[1291169091,658871167],$=0;$<F;$=$+16)b=[u[$+4]|u[$+5]<<8|u[$+6]<<16|u[$+7]<<24,u[$]|u[$+1]<<8|u[$+2]<<16|u[$+3]<<24],k=[u[$+12]|u[$+13]<<8|u[$+14]<<16|u[$+15]<<24,u[$+8]|u[$+9]<<8|u[$+10]<<16|u[$+11]<<24],b=f(b,S),b=h(b,31),b=f(b,L),m=g(m,b),m=h(m,27),m=l(m,y),m=l(f(m,[0,5]),[0,1390208809]),k=f(k,L),k=h(k,33),k=f(k,S),y=g(y,k),y=h(y,31),y=l(y,m),y=l(f(y,[0,5]),[0,944331445]);switch(b=[0,0],k=[0,0],w){case 15:k=g(k,p([0,u[$+14]],48));case 14:k=g(k,p([0,u[$+13]],40));case 13:k=g(k,p([0,u[$+12]],32));case 12:k=g(k,p([0,u[$+11]],24));case 11:k=g(k,p([0,u[$+10]],16));case 10:k=g(k,p([0,u[$+9]],8));case 9:k=g(k,[0,u[$+8]]),k=f(k,L),k=h(k,33),k=f(k,S),y=g(y,k);case 8:b=g(b,p([0,u[$+7]],56));case 7:b=g(b,p([0,u[$+6]],48));case 6:b=g(b,p([0,u[$+5]],40));case 5:b=g(b,p([0,u[$+4]],32));case 4:b=g(b,p([0,u[$+3]],24));case 3:b=g(b,p([0,u[$+2]],16));case 2:b=g(b,p([0,u[$+1]],8));case 1:b=g(b,[0,u[$]]),b=f(b,S),b=h(b,31),b=f(b,L),m=g(m,b)}return m=g(m,[0,u.length]),y=g(y,[0,u.length]),m=l(m,y),y=l(y,m),m=B(m),y=B(y),m=l(m,y),y=l(y,m),("00000000"+(m[0]>>>0).toString(16)).slice(-8)+("00000000"+(m[1]>>>0).toString(16)).slice(-8)+("00000000"+(y[0]>>>0).toString(16)).slice(-8)+("00000000"+(y[1]>>>0).toString(16)).slice(-8)},e.exports&&(t=e.exports=o),t.murmurHash3=o})()})(murmurHash3js,murmurHash3js.exports);var murmurHash3jsExports=murmurHash3js.exports,murmurhash3jsRevisited=murmurHash3jsExports;const mur=getDefaultExportFromCjs(murmurhash3jsRevisited),utf8$2=new TextEncoder,hash32=mur.x64.hash126,configure$3=({bitWidth:e=5,hash:t=hash32})=>{if(e>4*8)throw new RangeError(`Can not use bitWidth ${e} which exceeds the hashSize 4`);const r=4294967295>>>32-e;return{at:(s,a)=>s>>>a*e&r,from:s=>t(utf8$2.encode(s)),size:Math.ceil(4*8/e)}};class BitmapIndexedNode{constructor(t,n,r,o,i){this.edit=t,this.config=i,this.datamap=n,this.nodemap=r,this.children=o}get nodeArity(){return this.config.BitField.popcount(this.nodemap)}get dataArity(){return this.config.BitField.popcount(this.datamap)}empty(){return create(this.config)}lookup(t,n,r,o){return lookup(this,t,n,r,o)}associate(t,n,r,o,i,s){return associate(this,t,n,r,o,i,s)}dissociate(t,n,r,o,i){return dissociate(this,t,n,r,o,i)}fork(t=null){return fork(this,t)}entries(){return entries(this)}keys(){return keys(this)}values(){return values(this)}}class HashCollisionNode{constructor(t,n,r,o){this.edit=t,this.count=n,this.children=r,this.config=o}get nodeArity(){return 0}get dataArity(){return this.count}lookup(t,n,r,o){return lookupCollision(this,r,o)}associate(t,n,r,o,i,s){return associateCollision(this,t,r,o,i,s)}dissociate(t,n,r,o,i){return dissociateCollision(this,t,r,o,i)}fork(t=null){return forkCollision(this,t)}entries(){return entries(this)}keys(){return keys(this)}values(){return values(this)}}const lookupCollision=(e,t,n)=>{const{children:r,count:o}=e,i=findHashCollisionNodeIndex(r,o,t);return r[i]===t?r[i+1]:n},associateCollision=(e,t,n,r,o,i)=>{const{children:s,count:a}=e,c=findHashCollisionNodeIndex(s,a,r);if(s[c]!==r){const l=e.fork(t);return i.value=!0,l.count+=1,l.children.splice(c,n,o),l}else if(s[c+1]!==o){const l=e.fork(t);return l.children[c+1]=o,l}else return e},dissociateCollision=(e,t,n,r,o)=>{const{children:i,count:s,config:a}=e,c=findHashCollisionNodeIndex(i,s,r);if(i[c]!==r)return e;if(o.value=!0,s===2){const l=c===0?2:0;return associate(create(a),t,0,n,i[l],i[l+1],o)}else{const l=e.fork(t);return l.children.splice(c,2),l.count-=1,l}},forkCollision=(e,t=null)=>canEdit(e.edit,t)?e:new HashCollisionNode(t,e.count,e.children.slice(),e.config),findHashCollisionNodeIndex=(e,t,n)=>{let r=0;for(;r<t&&e[r]>n;)r+=2;return r},create=(e,t=null)=>new BitmapIndexedNode(t,e.BitField.empty(Math.pow(2,e.bitWidth)),e.BitField.empty(Math.pow(2,e.bitWidth)),[],e),get$2=(e,t,n)=>lookup(e,0,e.config.Path.from(t),t,n),lookup=(e,t,n,r,o)=>{const{datamap:i,nodemap:s,config:a}=e,{Path:c,BitField:l}=a,f=c.at(n,t);if(l.get(i,f)){const h=l.popcount(i,f);return keyAt(e,h)===r?valueAt(e,h):o}else return l.get(s,f)?resolveNode(e,f).lookup(t+1,n,r,o):o},set$1=(e,t,n,r,o)=>associate(e,t,0,e.config.Path.from(n),n,r,o),associate=(e,t,n,r,o,i,s)=>{const{datamap:a,nodemap:c,config:l}=e,{Path:f,BitField:h}=l,p=f.at(r,n);if(h.get(a,p)){const g=h.popcount(a,p),B=keyAt(e,g);if(o===B)return valueAt(e,g)===i?e:forkAndSet(e,t,g,i);{const u=mergeTwoLeaves(l,t,n+1,f.from(B),B,valueAt(e,g),r,o,i);return s.value=!0,migrateLeafToBranch(e,t,p,u)}}else if(h.get(c,p)){const g=resolveNode(e,p),B=g.associate(t,n+1,r,o,i,s);return g===B?e:copyAndSetChild(e,t,p,B)}else{const g=h.popcount(a,p);s.value=!0;const B=e.fork(t);return B.datamap=h.set(a,p),B.children.splice(keyPosition(g),0,o,i),B}},remove=(e,t,n,r)=>dissociate(e,t,0,e.config.Path.from(n),n,r),dissociate=(e,t,n,r,o,i)=>{const{datamap:s,nodemap:a,config:c}=e,{BitField:l,Path:f}=c,h=f.at(r,n);if(l.get(s,h)){const p=l.popcount(s,h);if(o===keyAt(e,p)){i.value=!0;const g=fork(e,t);return g.datamap=l.unset(e.datamap,h),g.children.splice(keyPosition(p),2),g}else return e}else if(l.get(a,h)){const p=resolveNode(e,h),g=p.dissociate(t,n+1,r,o,i);return hasSingleLeaf(g)?hasSingleNode(e)?g:inlineChild(e,t,h,g):p===g?e:copyAndSetChild(e,t,h,g)}else return e},entries=function*({children:e}){let t=0;const n=e.length;for(;t<n;){const r=e[t];if(typeof r=="string"){t+=1;const o=e[t];yield[r,o],t+=1}else break}for(;t<n;)yield*e[t].entries(),t+=1},fork=(e,t)=>canEdit(e.edit,t)?e:new BitmapIndexedNode(t,e.datamap,e.nodemap,e.children.slice(),e.config),keys=function*({children:e}){let t=0;const n=e.length;for(;t<n;){const r=e[t];if(typeof r=="string")yield r,t+=2;else break}for(;t<n;)yield*e[t].keys(),t+=1},values=function*({children:e}){let t=0;const n=e.length;for(;t<n&&typeof e[t]=="string";)t+=1,yield e[t],t+=1;for(;t<n;)yield*e[t].values(),t+=1},forkAndSet=(e,t,n,r)=>{const o=e.fork(t);return o.children[valuePosition(n)]=r,o},inlineChild=(e,t,n,r)=>{const{datamap:o,nodemap:i,config:s}=e,{BitField:a}=s,c=fork(e,t);return c.children.splice(nodePosition(e,n),1),c.children.splice(keyPosition(a.popcount(o,n)),0,r.children[0],r.children[1]),c.datamap=a.set(o,n),c.nodemap=a.unset(i,n),c},copyAndSetChild=(e,t,n,r)=>{const o=fork(e,t);return o.children[nodePosition(e,n)]=r,o},migrateLeafToBranch=(e,t,n,r)=>{const{nodemap:o,datamap:i,config:s}=e,{BitField:a}=s,c=a.popcount(i,n),l=keyPosition(c),f=nodePosition(e,n),h=fork(e,t);return h.datamap=a.unset(i,n),h.children.splice(l,2),h.nodemap=a.set(o,n),h.children.splice(f-1,0,r),h},mergeTwoLeaves=(e,t,n,r,o,i,s,a,c)=>{const{BitField:l,Path:f}=e;if(f.size<n)return new HashCollisionNode(t,2,[o,i,a,c],e);{const h=f.at(r,n),p=f.at(s,n);return h===p?new BitmapIndexedNode(t,l.empty(Math.pow(2,e.bitWidth)),l.from([h],Math.pow(2,e.bitWidth)),[mergeTwoLeaves(e,t,n+1,r,o,i,s,a,c)],e):new BitmapIndexedNode(t,l.from([h,p],Math.pow(2,e.bitWidth)),l.empty(Math.pow(2,e.bitWidth)),h<p?[o,i,a,c]:[a,c,o,i],e)}},keyAt=({children:e},t)=>e[keyPosition(t)],keyPosition=e=>e*2,valueAt=({children:e},t)=>e[valuePosition(t)],valuePosition=e=>e*2+1,resolveNode=(e,t)=>e.children[nodePosition(e,t)],nodePosition=({children:e,nodemap:t,config:n},r)=>e.length-1-n.BitField.popcount(t,r),canEdit=(e,t)=>e!=null&&e===t,hasSingleLeaf=e=>e.nodeArity===0&&e.dataArity===1,hasSingleNode=({config:{BitField:e},datamap:t,nodemap:n})=>e.popcount(t)===0&&e.popcount(n)===1,murmur364=from$4({name:"murmur3-x64-64",code:34,encode:e=>fromHex(mur.x64.hash128(e)).subarray(0,8)}),utf8$1=new TextEncoder,hash64$1=e=>murmur364.encode(e),configure$2=({bitWidth:e=8,hash:t=hash64$1}={})=>{const n=t(new Uint8Array).byteLength;return{from:i=>t(utf8$1.encode(i)),at:(i,s)=>{const a=s*e;if(a>n)throw new RangeError("Out of bounds");return toInt(i,a,e)},size:Math.ceil(n*8/e)}},toInt=(e,t,n)=>{let r=t/8|0,o=t%8,i=n,s=0;for(;i>0&&r<e.byteLength;){const a=e[r],c=8-o,l=c<i?c:i,f=8-o-l,p=(255>>o&a)>>f;s=(s<<l)+p,i-=l,r++,o=0}return s},empty=(e=256)=>{if(e%8!==0)throw new Error("Must be multiple of 8");return new Uint8Array(e/8)},from$2=(e,t)=>{let n=empty(t);for(const r of e){const{byte:o,byteOffset:i,bitOffset:s}=at(n,r);n[i]=o|1<<s}return n},size=e=>e.byteLength*8,at=(e,t)=>{const n=e.byteLength-1-(t/8|0),r=t%8;return{byte:e[n],byteOffset:n,bitOffset:r}},setByte=(e,t,n)=>{if(e[t]!==n){const r=e.slice(0);return r[t]=n,r}return e},set=(e,t)=>{const{byte:n,byteOffset:r,bitOffset:o}=at(e,t);return setByte(e,r,n|1<<o)},unset=(e,t)=>{const{byte:n,byteOffset:r,bitOffset:o}=at(e,t);return setByte(e,r,n&(255^1<<o))},get$1=(e,t)=>{var{byte:n,bitOffset:r}=at(e,t);return(n>>r&1)!==0},toBytes=e=>e,fromBytes=e=>e,popcount=(e,t=e.byteLength*8)=>{const{byteOffset:n,bitOffset:r,byte:o}=at(e,t);let i=popcount$1(o,r),s=e.byteLength-1;for(;s>n;){const a=e[s];i+=bitCount(a),s--}return i},or=(e,t)=>{const n=e.slice();let r=0;for(;r<e.length;)n[r]|=t[r],r++;return n},and=(e,t)=>{const n=e.slice();let r=0;for(;r<e.length;)n[r]&=t[r],r++;return n},Uint8ArrayBitField=Object.freeze(Object.defineProperty({__proto__:null,API:api,and,empty,from:from$2,fromBytes,get:get$1,or,popcount,set,size,toBytes,unset},Symbol.toStringTag,{value:"Module"})),NOT_FOUND=new RangeError("Not Found"),configure$1=({bitWidth:e=5,BitField:t=e===5?Uint32BitField:Uint8ArrayBitField,Path:n=e===5?configure$3({bitWidth:e}):configure$2({bitWidth:e})}={})=>({bitWidth:e,BitField:t,Path:n}),from$1=(e,t)=>{const n=builder$1(t);for(const[r,o]of e)n.set(r,o);return n.build()},has=(e,t)=>get$2(e.root,t,NOT_FOUND)!==NOT_FOUND,get=(e,t,n=void 0)=>get$2(e.root,t,n),builder$1=e=>{const t={},n=configure$1(e);return new HashMapBuilder(t,0,create(n,t),n)};class PersistentHashMap{constructor(t=0,n,r){this.count=t,this.root=n,this.config=r}get size(){return this.count}clone(){return new PersistentHashMap(this.count,this.root,this.config)}empty(){return new PersistentHashMap(0,create(this.config,null),this.config)}has(t){return has(this,t)}get(t){return get$2(this.root,t,void 0)}set(t,n){const r={value:!1},o=set$1(this.root,null,t,n,r);return o===this.root?this:new PersistentHashMap(r.value?this.count+1:this.count,o,this.config)}delete(t){const n=remove(this.root,null,t,{value:!1});return n===this.root?this:new PersistentHashMap(this.count-1,n,this.config)}get bitField(){return this.config.BitField.or(this.root.datamap,this.root.nodemap)}[Symbol.iterator](){return this.entries()}entries(){return this.root.entries()}keys(){return this.root.keys()}values(){return this.root.values()}createBuilder(){return new HashMapBuilder({},this.count,this.root,this.config)}}class HashMapBuilder{constructor(t,n,r,o){this.edit=t,this.count=n,this.root=r,this.config=o}get size(){if(this.edit)return this.count;throw new Error(".size was accessed on the finalized builder")}set(t,n){if(this.edit){const r={value:!1},o=set$1(this.root,this.edit,t,n,r);return this.root!==o&&(this.root=o),r.value&&(this.count+=1),this}else throw new Error(".set was called on the finalized builder")}delete(t){if(this.edit){if(this.count===0)return this;const n={value:!1},r=remove(this.root,this.edit,t,n);return r!==this.root&&(this.root=r),n.value&&(this.count-=1),this}else throw new Error(".delete was called on the finalized builder")}build(){if(this.edit)return this.edit=null,new PersistentHashMap(this.count,this.root,this.config);throw new Error(".build was called on the finalized builder")}}const utf8=new TextEncoder,hash64=e=>murmur364.encode(e),configure=({bitWidth:e=8,hash:t=hash64})=>{const n=t(new Uint8Array).byteLength,r={bitWidth:e,hash:t,hashSize:n};return{at:(s,a)=>read(s,a,r),from:s=>utf8.encode(s),size:1/0}},read=(e,t=0,{bitWidth:n=8,hash:r,hashSize:o})=>{const i=o*8;let s=0,a=n,c=n*t;for(;a>0;){const l=c/i>>0,f=r(l===0?e:appendByte(e,l)),h=i<=c?c%i:c,p=i-h,g=p<a?p:a;s=(s<<g)+toInt(f,h,g),a-=g,c+=g}return s},appendByte=(e,t)=>{const n=new Uint8Array(e.byteLength+1).fill(t,e.byteLength);return n.set(e),n},bitWidth=8,config={bitWidth,Path:configure({bitWidth})},tableSize=e=>Math.pow(2,e.config.bitWidth),builder=(e=config)=>builder$1(e),from=(e,t=config)=>from$1(e,t),bitField=({datamap:e,nodemap:t,config:{BitField:n}})=>withoutLeadingZeros(n.toBytes(n.or(e,t))),withoutLeadingZeros=e=>{let t=0;for(;t<e.byteLength;){if(e[t]!==0)return e.subarray(t);t+=1}return e.subarray(t)},iterate=function*(e){const{config:t,datamap:n,nodemap:r}=e,{BitField:o}=t,i=o.size(n);let s=0,a=0;for(;s<i;){const c=s.toString(16).toUpperCase().padStart(2,"0");if(o.get(n,s)){const l=keyAt(e,a);yield{prefix:c,key:l,value:valueAt(e,a)},a++}else o.get(r,s)&&(yield{prefix:c,node:resolveNode(e,s)});s++}};class UninitializedError extends Error{}function toggle({condition:e=()=>!0,branch:t={if:()=>{},else:()=>{}}}){return()=>{var n,r;return e!=null&&e()?(n=t==null?void 0:t.if)==null?void 0:n.call(t):(r=t==null?void 0:t.else)==null?void 0:r.call(t)}}const records2Objects=e=>e.map(record2Object),records2Object=e=>records2Objects(e)[0],record2Object=e=>Object.fromEntries(e.keys.map(t=>[t,e.get(t)]));let count=0;const identify=e=>e.map((t,n)=>({id:++count,...t}));var A,E;const x=class x{constructor(t){N(this,"point",this);N(this,"neo4j",null);I(this,A,null);D(this,A,t)}static get root(){return R(this,E)||D(this,E,this.get.root().then(t=>D(this,E,t))),R(this,E)}};A=new WeakMap,E=new WeakMap,I(x,E,null),N(x,"gen",{child:t=>{const n=x.create({path:t??"/sys/points/new/"});if(!Array.isArray(n))throw new Error(`\`this.create()\` didnt return an \`Array\` (${typeof n}).`);if(n.length!==1)throw new Error(`\`this.create()\` returned ${n.length} points.`);if(n.length===1)return n[0]}}),N(x,"create",async({path:t,sep:n="/"})=>{const r=getNeo4j();if(!r)throw new Error("`neo4j` is unset.");const o=r.session();typeof t=="string"&&(t=t.split(n));let i=await x.get.root();for(const s in t){const a=`
        MERGE (current)-[:CONTAINS { path: $elem }]->(new:Nopoint)
        WHERE elementId(current) = $current
        RETURN elementId(new)
      `,{records:c}=await o.run(a,{current:i,elem:s});if(c.length!=1)throw new Error(`${c.length} records returned.`);i=c[0].get("id")}}),N(x,"get",{root:async()=>{const t=getNeo4j();if(!t)throw new Error("`neo4j` is unset.");const n=t.session();try{const r=`
          MERGE (root:Root)
          RETURN elementId(root)
        `,{records:o}=await n.run(r);if(o.length!=1)throw new Error(`${o.length} records returned.`);return record2Object(o[0])}finally{n.close(),t.close()}},children:async(t,{offset:n=0,limit:r,onlyCurrent:o=!1,sep:i="/",parent:s}={})=>{const a=getNeo4j(),c=a.session();try{typeof t=="string"&&(t=t.split(i).filter(Boolean));let l=!1;for(;!l;)try{let f=s==null?void 0:s.id;f==null&&(l=!0,f=x.root);const h={limit:r!=null?Number(r):0,offset:Number(n)},p=`
              WITH $elems as pathElems
              MATCH path = (start)-[:CONTAINS*]->(terminal)
              WHERE elementId(start) = $rootId
              MATCH (terminal)-[:REPRESENTED_BY]->(point)
              ${o?"WHERE NOT ()-[:PREVIOUS]->(point)":""}
              WITH pathElems, path, terminal, point, [
                rel in relationships(path)
                WHERE NOT isEmpty(rel.path)
                | rel.path
              ] as elements
              WHERE size(elements) = size(pathElems)
              AND ALL(
                i IN range(0, size(pathElems) - 1)
                WHERE (
                  pathElems[i] = '*'
                  OR elements[i] = pathElems[i]
                )
              )
              ${h.limit>0?`LIMIT ${h.offset+h.limit}`:""}
              SKIP ${h.offset}
              RETURN DISTINCT
                elements as path,
                terminal as pathEnd,
                point as nopoint
            `,{records:g}=await c.run(p,{elems:t,rootId:f});return records2Object(g)}catch(f){if(!(f instanceof UninitializedError))throw f;l=!1}}finally{await c.close(),await a.close()}},partial:async t=>{const n=getNeo4j(),r=n.session();try{}finally{await r.close(),await n.close()}}});let Nopoint=x;const timestamp=(e=new Date)=>e.toISOString().slice(0,19).replace("T","@").replace(/-/g,"");function logger(e){return function(n){if(console.debug({msg:n}),typeof n!="string")try{n=lib.stringify(n,null,2)}catch(r){n=`Error: ${r.message}`}e.unshift(n)}}export{Nopoint as N,withMaxChunkSize as a,createFlatDirectory as b,configure$4 as c,defaults as d,encodeDirectory as e,code as f,cumulativeDagByteLength as g,create$1 as h,identify as i,toggle as j,builder as k,logger as l,get as m,has as n,from as o,iterate as p,createDirectoryShard as q,records2Object as r,murmur364 as s,timestamp as t,tableSize as u,varint$1 as v,withWidth as w,bitField as x,encodeHAMTShard as y};
