var _n=Object.defineProperty;var kn=(i,e,t)=>e in i?_n(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var A=(i,e,t)=>kn(i,typeof e!="symbol"?e+"":e,t);import{g as Cn}from"./Cpj98o6Y.js";/*!
 * Wunderbaum - debounce.ts
 * Copyright (c) 2021-2025, Martin Wendt. Released under the MIT license.
 * v0.13.0, Sat, 08 Mar 2025 14:16:31 GMT (https://github.com/mar10/wunderbaum)
 */const Nn=typeof global=="object"&&global!==null&&global.Object===Object&&global,Tn=typeof globalThis=="object"&&globalThis!==null&&globalThis.Object==Object&&globalThis,Sn=typeof self=="object"&&self!==null&&self.Object===Object&&self,Te=Tn||Nn||Sn||Function("return this")();function Ht(i){const e=typeof i;return i!=null&&(e==="object"||e==="function")}function Ve(i,e=0,t={}){let n,r,s,o,l,a,c=0,u=!1,d=!1,g=!0;const m=!e&&e!==0&&typeof Te.requestAnimationFrame=="function";if(typeof i!="function")throw new TypeError("Expected a function");e=+e||0,Ht(t)&&(u=!!t.leading,d="maxWait"in t,s=d?Math.max(+t.maxWait||0,e):s,g="trailing"in t?!!t.trailing:g);function p(D){const K=n,ie=r;return n=r=void 0,c=D,o=i.apply(ie,K),o}function h(D,K){return m?(Te.cancelAnimationFrame(l),Te.requestAnimationFrame(D)):setTimeout(D,K)}function b(D){if(m)return Te.cancelAnimationFrame(D);clearTimeout(D)}function x(D){return c=D,l=h(k,e),u?p(D):o}function _(D){const K=D-a,ie=D-c,Ct=e-K;return d?Math.min(Ct,s-ie):Ct}function I(D){const K=D-a,ie=D-c;return a===void 0||K>=e||K<0||d&&ie>=s}function k(){const D=Date.now();if(I(D))return S(D);l=h(k,_(D))}function S(D){return l=void 0,g&&n?p(D):(n=r=void 0,o)}function T(){l!==void 0&&b(l),c=0,n=a=r=l=void 0}function B(){return l===void 0?o:S(Date.now())}function F(){return l!==void 0}function Y(...D){const K=Date.now(),ie=I(K);if(n=D,r=this,a=K,ie){if(l===void 0)return x(a);if(d)return l=h(k,e),p(a)}return l===void 0&&(l=h(k,e)),o}return Y.cancel=T,Y.flush=B,Y.pending=F,Y}function Vt(i,e=0,t={}){let n=!0,r=!0;if(typeof i!="function")throw new TypeError("Expected a function");return Ht(t)&&(n="leading"in t?!!t.leading:n,r="trailing"in t?!!t.trailing:r),Ve(i,e,{leading:n,trailing:r,maxWait:e})}/*!
 * Wunderbaum - util
 * Copyright (c) 2021-2025, Martin Wendt. Released under the MIT license.
 * v0.13.0, Sat, 08 Mar 2025 14:16:31 GMT (https://github.com/mar10/wunderbaum)
 */const Kt={0:"",1:"left",2:"middle",3:"right",4:"back",5:"forward"},In=9007199254740991,An=$n(),at=An.isMac,Dn=/[&<>"'/]/g,Mn=/[<>"'/]/g,qt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};class Je extends Error{constructor(e){super(e),this.name="ValidationError"}}let Ln=class{constructor(){this.thens=[],this.catches=[],this.status=""}resolve(e){if(this.status)throw new Error("already settled");this.status="resolved",this.resolvedValue=e,this.thens.forEach(t=>t(e)),this.thens=[]}reject(e){if(this.status)throw new Error("already settled");this.status="rejected",this.rejectedError=e,this.catches.forEach(t=>t(e)),this.catches=[]}then(e){status==="resolved"?e(this.resolvedValue):this.thens.unshift(e)}catch(e){this.status==="rejected"?e(this.rejectedError):this.catches.unshift(e)}promise(){return{then:this.then,catch:this.catch}}};function w(i,e){if(!i)throw e=e||"Assertion failed.",new Error(e)}function $n(){const i=navigator;return{isMac:/Mac/.test(i.platform)}}function jt(i){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i):i()}function On(){return new Promise(i=>{jt(i)})}function Bn(i,e){if(i==null)return i;const t=i.length;let n=0;if(typeof t=="number")for(;n<t&&e.call(i[n],n,i[n])!==!1;n++);else for(const r in i)if(e.call(i[n],r,i[r])===!1)break;return i}function $(i){throw new Error(i)}function xe(i){return(""+i).replace(Dn,function(e){return qt[e]})}function ue(i){return(""+i).replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function Wt(i){return(""+i).replace(Mn,function(e){return qt[e]})}function Pn(i){return i.indexOf(">")>=0&&$("Not implemented"),i}function ct(i,e=!1){const t=i.tagName;let n=null;if(t==="SPAN"&&i.classList.contains("wb-col")){const r=i,s=r.querySelector("input,select");if(s)return ct(s,e);r.innerText=""+n}else if(t==="INPUT"){const r=i;switch(r.type){case"button":case"reset":case"submit":case"image":break;case"checkbox":n=r.indeterminate?null:r.checked;break;case"date":case"datetime":case"datetime-local":case"month":case"time":case"week":n=e?r.valueAsDate:r.value;break;case"number":case"range":n=r.valueAsNumber;break;case"radio":{const o=r.name,l=r.parentElement.querySelector(`input[name="${o}"]:checked`);n=l?l.value:void 0}break;case"text":default:n=r.value}}else t==="SELECT"&&(n=i.value);return n}function Gt(i,e){const t=i.tagName;if(t==="SPAN"&&i.classList.contains("wb-col")){const n=i,r=n.querySelector("input,select");if(r)return Gt(r,e);n.innerText=""+e}else if(t==="INPUT"){const n=i,r=n.type;switch(r){case"checkbox":n.indeterminate=e===null,n.checked=!!e;break;case"date":case"month":case"time":case"week":case"datetime":case"datetime-local":n.valueAsDate=new Date(e);break;case"number":case"range":e==null?n.value=e:n.valueAsNumber=e;break;case"radio":$(`Not yet implemented: ${r}`);break;case"button":case"reset":case"submit":case"image":break;case"text":default:n.value=e??""}}else if(t==="SELECT"){const n=i;e==null?n.selectedIndex=-1:n.value=e}}function Xt(i,e){const t=j(i).style;e?t.display==="none"&&(t.display=""):t.display===""&&(t.display="none")}function Ie(i){const e=document.createElement("template");return e.innerHTML=i.trim(),e.content.firstElementChild}const zn=new Set(["Alt","Control","Meta","Shift"]);function j(i){return i?typeof i=="string"?document.querySelector(i):i:null}function Ee(i){const e=i.key,t=i.type,n=[];return i.altKey&&n.push("Alt"),i.ctrlKey&&n.push("Control"),i.metaKey&&n.push("Meta"),i.shiftKey&&n.push("Shift"),t==="click"||t==="dblclick"?n.push(Kt[i.button]+t):t==="wheel"?n.push(t):zn.has(e)||n.push(e),n.join("+")}function W(...i){for(let e=1;e<i.length;e++){const t=i[e];if(t!=null)for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[0][n]=t[n])}return i[0]}function ve(i){return Array.isArray(i)}function Ze(i){return Object.keys(i).length===0&&i.constructor===Object}function Fn(i){return typeof i=="function"}function G(i){return Object.prototype.toString.call(i)==="[object Object]"}function Un(...i){}function R(i,e,t,n){let r,s;i=j(i),n?(r=t,s=n):(r="",s=t),e.split(" ").forEach(o=>{i.addEventListener(o,function(l){if(r){if(l.target){let a=l.target;if(a.matches(r)||(a=a.closest(r),a))return s(l)}}else return s(l)})})}function Qt(i,e,t,n){let r,s;const o=n||i,l=i[e],a=(...d)=>l.apply(o,d),c=d=>l.apply(o,d),u=(...d)=>{try{return r=o._super,s=o._superApply,o._super=a,o._superApply=c,t.apply(o,d)}finally{o._super=r,o._superApply=s}};i[e]=u}function Rn(i,e){return new Promise((t,n)=>{setTimeout(()=>{try{t(i.apply(this))}catch(r){n(r)}},e)})}async function Hn(i){return new Promise(e=>setTimeout(e,i))}function Vn(i,e,t){const n=j(i);if(w(n.type==="checkbox",`Expected a checkbox: ${n.type}`),t??(t=n.classList.contains("wb-tristate")||n.indeterminate),e===void 0)switch(n.indeterminate?null:n.checked){case!0:e=!1;break;case!1:e=t?null:!0;break;case null:e=!0;break}n.indeterminate=e==null,n.checked=!!e}function Me(i,e,t=void 0){let n;i&&e.indexOf(".")>=0&&([n,e]=e.split("."),i=i[n]);const r=i?i[e]:null;return r??t}function Yt(i,e){const t=e.indexOf(i);return e[(t+1)%e.length]}function Ke(i){if(i instanceof Set)return i;if(typeof i=="string"){const e=new Set;for(const t of i.split(" "))e.add(t.trim());return e}if(Array.isArray(i))return new Set(i);throw new Error("Cannot convert to Set<string>: "+i)}function Jt(...i){for(const e of i){if(typeof e=="number")return e;if(typeof e=="string"&&e.endsWith("px"))return parseInt(e,10);w(e==null,`Expected a number or string like '123px': ${e}`)}throw new Error(`Expected a string like '123px': ${i}`)}function ce(...i){for(const e of i)if(e!=null)return!!e;throw new Error("No default boolean value provided")}function we(i){return typeof i=="number"?!!i:i}function Kn(i){return Object.prototype.toString.call(i).replace(/^\[object (.+)\]$/,"$1").toLowerCase()}function Zt(i,e){const t=Object.assign({minDelay:16,defaultDelay:200,maxDelay:5e3,delayFactor:2},e),n=Math.max(16,+t.minDelay),r=+t.maxDelay;let s=0,o=null,l=null;const a=(...c)=>{if(s)o=c,s+=1;else{s=1;const u=c;o=null;const d=Date.now();try{i.apply(this,u)}catch(h){console.error(h)}const g=Date.now()-d,m=Math.min(Math.max(n,g*t.delayFactor),r),p=Math.max(n,m-g);l=setTimeout(()=>{l=null,s=0,o!=null&&a.apply(this,o)},p)}};return a.cancel=()=>{l&&(clearTimeout(l),l=null),o=null,s=0},a.pending=()=>!!l,a.flush=()=>{throw new Error("Not implemented")},a}var en=Object.freeze({__proto__:null,Deferred:Ln,MAX_INT:In,MOUSE_BUTTONS:Kt,ValidationError:Je,adaptiveThrottle:Zt,assert:w,debounce:Ve,documentReady:jt,documentReadyPromise:On,each:Bn,elemFromHtml:Ie,elemFromSelector:j,error:$,escapeHtml:xe,escapeRegex:ue,escapeTooltip:Wt,eventToString:Ee,extend:W,extractHtmlText:Pn,getOption:Me,getValueFromElem:ct,intToBool:we,isArray:ve,isEmptyObject:Ze,isFunction:Fn,isMac:at,isPlainObject:G,noop:Un,onEvent:R,overrideMethod:Qt,rotate:Yt,setElemDisplay:Xt,setTimeoutPromise:Rn,setValueToElem:Gt,sleep:Hn,throttle:Vt,toBool:ce,toPixel:Jt,toSet:Ke,toggleCheckbox:Vn,type:Kn});/*!
 * Wunderbaum - types
 * Copyright (c) 2021-2025, Martin Wendt. Released under the MIT license.
 * v0.13.0, Sat, 08 Mar 2025 14:16:31 GMT (https://github.com/mar10/wunderbaum)
 */var E;(function(i){i.any="any",i.data="data",i.colStructure="colStructure",i.resize="resize",i.row="row",i.structure="structure",i.status="status",i.scroll="scroll"})(E||(E={}));var Le;(function(i){i.clearMarkup="clearMarkup",i.header="header",i.redraw="redraw",i.scroll="scroll"})(Le||(Le={}));var U;(function(i){i.ok="ok",i.loading="loading",i.error="error",i.noData="noData",i.paging="paging"})(U||(U={}));var P;(function(i){i.unknown="",i.checkbox="checkbox",i.column="column",i.expander="expander",i.icon="icon",i.prefix="prefix",i.title="title"})(P||(P={}));var z;(function(i){i.startRow="startRow",i.cell="cell",i.startCell="startCell",i.row="row"})(z||(z={}));/*!
 * Wunderbaum - wb_extension_base
 * Copyright (c) 2021-2025, Martin Wendt. Released under the MIT license.
 * v0.13.0, Sat, 08 Mar 2025 14:16:31 GMT (https://github.com/mar10/wunderbaum)
 */class fe{constructor(e,t,n){this.enabled=!0,this.tree=e,this.id=t,this.treeOpts=e.options;const r=e.options;this.treeOpts[t]===void 0?r[t]=this.extensionOpts=W({},n):(this.extensionOpts=W({},n,r[t]),r[t]=this.extensionOpts),this.enabled=this.getPluginOption("enabled",!0)}init(){this.tree.element.classList.add("wb-ext-"+this.id)}getPluginOption(e,t){var n;return(n=this.extensionOpts[e])!==null&&n!==void 0?n:t}setPluginOption(e,t){this.extensionOpts[e]=t}setEnabled(e=!0){return this.setPluginOption("enabled",!!e)}onKeyEvent(e){}onRender(e){}}/*!
 * Wunderbaum - ext-filter
 * Copyright (c) 2021-2025, Martin Wendt. Released under the MIT license.
 * v0.13.0, Sat, 08 Mar 2025 14:16:31 GMT (https://github.com/mar10/wunderbaum)
 */const dt="￷",ut="￸",qn=new RegExp(ue(dt),"g"),jn=new RegExp(ue(ut),"g");class Wn extends fe{constructor(e){super(e,"filter",{autoApply:!0,autoExpand:!1,matchBranch:!1,connect:null,fuzzy:!1,hideExpanders:!1,highlight:!0,leavesOnly:!1,mode:"dim",noData:!0}),this.queryInput=null,this.prevButton=null,this.nextButton=null,this.modeButton=null,this.matchInfoElem=null,this.lastFilterArgs=null}init(){super.init(),this.getPluginOption("connect")&&this._connectControls()}setPluginOption(e,t){switch(super.setPluginOption(e,t),e){case"mode":this.tree.filterMode=t==="hide"?"hide":t==="mark"?"mark":"dim",this.tree.updateFilter();break}}_updatedConnectedControls(){var e;const t=this.tree.filterMode!==null,n=this.tree.getActiveNode(),r=t?this.countMatches():0,s=this.treeOpts.strings;let o="?";if(this.matchInfoElem)if(t){let l;r===0?l=s.noMatch:n&&n.match>=1?(o=(e=n.match)!==null&&e!==void 0?e:"?",l=s.matchIndex):l=s.queryResult,l=l.replace("${count}",this.tree.count().toLocaleString()).replace("${match}",""+o).replace("${matches}",r.toLocaleString()),this.matchInfoElem.textContent=l}else this.matchInfoElem.textContent="";this.nextButton instanceof HTMLButtonElement&&(this.nextButton.disabled=!r),this.prevButton instanceof HTMLButtonElement&&(this.prevButton.disabled=!r),this.modeButton&&(this.modeButton.disabled=!t,this.modeButton.classList.toggle("wb-filter-hide",this.tree.filterMode==="hide"))}_connectControls(){const e=this.tree,t=this.getPluginOption("connect");if(t){if(this.queryInput=j(t.inputElem),!this.queryInput)throw new Error(`Invalid 'filter.connect' option: ${t.inputElem}.`);this.prevButton=j(t.prevButton),this.nextButton=j(t.nextButton),this.modeButton=j(t.modeButton),this.matchInfoElem=j(t.matchInfoElem),this.prevButton&&R(this.prevButton,"click",()=>{e.findRelatedNode(e.getActiveNode()||e.getFirstChild(),"prevMatch"),this._updatedConnectedControls()}),this.nextButton&&R(this.nextButton,"click",()=>{e.findRelatedNode(e.getActiveNode()||e.getFirstChild(),"nextMatch"),this._updatedConnectedControls()}),this.modeButton&&R(this.modeButton,"click",n=>{this.tree.filterMode&&this.setPluginOption("mode",e.filterMode==="dim"?"hide":"dim")}),R(this.queryInput,"input",Ve(n=>{this.filterNodes(this.queryInput.value.trim(),{})},700)),this._updatedConnectedControls()}}_applyFilterNoUpdate(e,t){return this.tree.runWithDeferredUpdate(()=>this._applyFilterImpl(e,t))}_applyFilterImpl(e,t){var n;let r=0;const s=Date.now(),o=this.tree,l=o.options,a=l.autoCollapse,c=W({},l.filter,t),u=c.mode==="hide",d=!!c.matchBranch,g=!!c.leavesOnly&&!d;let m,p;if(typeof e=="string"||e instanceof RegExp){if(e==="")return o.logInfo("Passing an empty string as a filter is handled as clearFilter()."),this.clearFilter(),0;if(c.fuzzy){w(typeof e=="string","fuzzy filter must be a string");const h=e.split("").map(ue).reduce(function(b,x){return b+"([^"+x+"]*)"+x},"");m=new RegExp(h,"i")}else if(e instanceof RegExp)m=e,p=e;else{const h=ue(e);m=new RegExp(h,"i"),p=new RegExp(h,"gi")}o.logDebug(`Filtering nodes by '${m}'`),e=h=>{if(!h.title)return!1;const b=h.title,x=m.exec(b);if(x&&c.highlight){let _;c.fuzzy?_=Gn(b,x,!0):_=b.replace(p,function(I){return dt+I+ut}),h.titleWithHighlight=xe(_).replace(qn,"<mark>").replace(jn,"</mark>")}return!!x}}return o.filterMode=(n=c.mode)!==null&&n!==void 0?n:"dim",this.lastFilterArgs=arguments,o.element.classList.toggle("wb-ext-filter-hide",!!u),o.element.classList.toggle("wb-ext-filter-dim",c.mode==="dim"),o.element.classList.toggle("wb-ext-filter-hide-expanders",!!c.hideExpanders),o.root.subMatchCount=0,o.visit(h=>{delete h.match,delete h.titleWithHighlight,h.subMatchCount=0}),o.setStatus(U.ok),l.autoCollapse=!1,o.visit(h=>{if(g&&h.children!=null)return;let b=e(h);if(b==="skip")return h.visit(function(_){_.match=void 0},!0),"skip";let x=!1;(d||b==="branch")&&h.parent.match&&(b=!0,x=!0),b&&(r++,h.match=r,h.visitParents(_=>{_!==h&&(_.subMatchCount+=1),c.autoExpand&&!x&&!_.expanded&&(_.setExpanded(!0,{noAnimation:!0,noEvents:!0}),_._filterAutoExpanded=!0)},!0))}),l.autoCollapse=a,r===0&&c.noData&&u&&(typeof c.noData=="string"?o.root.setStatus(U.noData,{message:c.noData}):o.root.setStatus(U.noData)),o.logDebug(`Filter '${e}' found ${r} nodes in ${Date.now()-s} ms.`),this._updatedConnectedControls(),r}filterNodes(e,t){return this._applyFilterNoUpdate(e,t)}filterBranches(e,t){return w(t.matchBranch===void 0,"filterBranches() is deprecated."),t.matchBranch=!0,this._applyFilterNoUpdate(e,t)}countMatches(){let e=0;return this.tree.visit(t=>{t.match&&!t.statusNodeType&&e++}),e}updateFilter(){var e;const t=this.tree;t.filterMode&&this.lastFilterArgs&&(!((e=t.options.filter)===null||e===void 0)&&e.autoApply)?this._applyFilterNoUpdate.apply(this,this.lastFilterArgs):t.logWarn("updateFilter(): no filter active."),this._updatedConnectedControls()}clearFilter(){const e=this.tree;e.enableUpdate(!1),e.setStatus(U.ok),delete e.root.match,delete e.root.subMatchCount,e.visit(t=>{delete t.match,delete t.subMatchCount,delete t.titleWithHighlight,t._filterAutoExpanded&&t.expanded&&t.setExpanded(!1,{noAnimation:!0,noEvents:!0}),delete t._filterAutoExpanded}),e.filterMode=null,this.lastFilterArgs=null,e.element.classList.remove("wb-ext-filter-dim","wb-ext-filter-hide"),this._updatedConnectedControls(),e.enableUpdate(!0)}}function Gn(i,e,t=!0){const n=[];for(let s=1;s<e.length;s++){const o=e[s].length+(s===1?0:1)+(n[n.length-1]||0);n.push(o)}const r=i.split("");return t?n.forEach(function(s){r[s]=dt+r[s]+ut}):n.forEach(function(s){r[s]="<mark>"+r[s]+"</mark>"}),r.join("")}/*!
 * Wunderbaum - ext-keynav
 * Copyright (c) 2021-2025, Martin Wendt. Released under the MIT license.
 * v0.13.0, Sat, 08 Mar 2025 14:16:31 GMT (https://github.com/mar10/wunderbaum)
 */const Xn=500;class Qn extends fe{constructor(e){super(e,"keynav",{})}_getEmbeddedInputElem(e){var t;let n=null;if(e&&e.type!=null)n=e;else{const r=(t=this.tree.getActiveColElem())===null||t===void 0?void 0:t.querySelector("input,select");r&&(n=r)}return n}_isCurInputFocused(){var e;return!!((e=this.tree.getActiveColElem())===null||e===void 0?void 0:e.querySelector("input:focus,select:focus"))}onKeyEvent(e){const t=e.event,n=this.tree,r=e.options,s=!t.ctrlKey||r.autoActivate,o=this._getEmbeddedInputElem(t.target),l=o&&this._isCurInputFocused(),a=r.navigationModeOption;let c,u=Ee(t),d=e.node,g=!0;if(!n.isEnabled()||n._callEvent("keydown",e)===!1||n._callMethod("edit._preprocessKeyEvent",e)===!1)return!1;if(!d){const p=n.getFocusNode()||n.getActiveNode(),h=n.getFirstChild();if(!p&&h&&u==="ArrowDown"){h.logInfo("Keydown: activate first node."),h.setActive();return}c=p||h,c&&(c.setFocus(),d=n.getFocusNode(),d.logInfo("Keydown: force focus on active node."))}const m=d.isColspan();if(n.isRowNav()){if(l){switch(u){case"Enter":o.blur(),n.setFocus();break;case"Escape":d._render(),n.setFocus();break}return}if(r.quicksearch&&u.length===1&&/^\w$/.test(u)&&!o){const p=Date.now();p-n.lastQuicksearchTime>Xn&&(n.lastQuicksearchTerm=""),n.lastQuicksearchTime=p,n.lastQuicksearchTerm+=u;const h=n.findNextNode(n.lastQuicksearchTerm,n.getActiveNode());h&&h.setActive(!0,{event:t}),t.preventDefault();return}switch(u){case"Enter":d.isActive()&&(d.isExpanded()?u="Subtract":d.isExpandable(!0)&&(u="Add"));break;case"ArrowLeft":d.expanded&&(u="Subtract");break;case"ArrowRight":if(!d.expanded&&d.isExpandable(!0))u="Add";else if(a===z.startCell||a===z.startRow)return t.preventDefault(),n.setCellNav(),!1;break}switch(u){case"+":case"Add":d.setExpanded(!0);break;case"-":case"Subtract":d.setExpanded(!1);break;case" ":d.getOption("checkbox")?d.toggleSelected():d.setActive(!0,{event:t});break;case"Enter":d.setActive(!0,{event:t});break;case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"Backspace":case"End":case"Home":case"Control+End":case"Control+Home":case"Meta+ArrowDown":case"Meta+ArrowUp":case"PageDown":case"PageUp":d.navigate(u,{activate:s,event:t});break;default:g=!1}}else{const p=o?o.type||o.tagName:"",h=o&&p!=="checkbox";if(l){if(u==="Escape"){d.logDebug("Reset focused input on Escape"),o.setCustomValidity(""),d._render(),n.setFocus(),n.setColumn(n.activeColIdx);return}else if(u!=="Enter"){if(o&&o.checkValidity&&!o.checkValidity())return d.logDebug(`Ignored ${u} inside invalid input`),!1;d.logDebug(`Ignored ${u} inside focused input`);return}}else if(o&&u.length===1&&h)return o.focus(),o.value="",d.logDebug(`Focus input: ${u}`),!1;switch(u==="Tab"?(u="ArrowRight",g=!0):u==="Shift+Tab"&&(u=n.activeColIdx>0?"ArrowLeft":"",g=!0),u){case"+":case"Add":d.setExpanded(!0);break;case"-":case"Subtract":d.setExpanded(!1);break;case" ":n.activeColIdx===0&&d.getOption("checkbox")?(d.toggleSelected(),g=!0):o&&p==="checkbox"&&(o.click(),g=!0);break;case"F2":o&&!l&&h&&(o.focus(),g=!0);break;case"Enter":n.setFocus(),(n.activeColIdx===0||m)&&d.isExpandable()?(d.setExpanded(!d.isExpanded()),g=!0):o&&!l&&h&&(o.focus(),g=!0);break;case"Escape":n.setFocus(),d.log("keynav: focus tree..."),n.isCellNav()&&a!==z.cell&&(d.log("keynav: setCellNav(false)"),n.setCellNav(!1),n.setFocus(),g=!0);break;case"ArrowLeft":n.setFocus(),m&&d.isExpanded()?d.setExpanded(!1):!m&&n.activeColIdx>0?n.setColumn(n.activeColIdx-1):a!==z.cell&&n.setCellNav(!1),g=!0;break;case"ArrowRight":n.setFocus(),m&&!d.isExpanded()?d.setExpanded():!m&&n.activeColIdx<n.columns.length-1&&n.setColumn(n.activeColIdx+1),g=!0;break;case"Home":n.setFocus(),!m&&n.activeColIdx>0&&n.setColumn(0),g=!0;break;case"End":n.setFocus(),!m&&n.activeColIdx<n.columns.length-1&&n.setColumn(n.columns.length-1),g=!0;break;case"ArrowDown":case"ArrowUp":case"Backspace":case"Control+End":case"Control+Home":case"Meta+ArrowDown":case"Meta+ArrowUp":case"PageDown":case"PageUp":d.navigate(u,{activate:s,event:t}),g=!0;break;default:g=!1}}g&&t.preventDefault()}}/*!
 * Wunderbaum - ext-logger
 * Copyright (c) 2021-2025, Martin Wendt. Released under the MIT license.
 * v0.13.0, Sat, 08 Mar 2025 14:16:31 GMT (https://github.com/mar10/wunderbaum)
 */class Yn extends fe{constructor(e){super(e,"logger",{}),this.ignoreEvents=new Set(["iconBadge","render","discard"]),this.prefix=e+".ext-logger"}init(){const e=this.tree;if(e.getOption("debugLevel")>=4){const t=this.ignoreEvents,n=this.prefix;Qt(e,"callEvent",function(r,s){if(t.has(r))return e._superApply(arguments);const o=Date.now(),l=e._superApply(arguments);return e.logDebug(`${n}: callEvent('${r}') took ${Date.now()-o} ms.`,arguments[1]),l})}}onKeyEvent(e){this.tree.logDebug(`${this.prefix}: onKeyEvent()`,e)}}/*!
 * Wunderbaum - ext-dnd
 * Copyright (c) 2021-2025, Martin Wendt. Released under the MIT license.
 * v0.13.0, Sat, 08 Mar 2025 14:16:31 GMT (https://github.com/mar10/wunderbaum)
 */const Xe="application/x-wunderbaum-node";class Jn extends fe{constructor(e){super(e,"dnd",{autoExpandMS:1500,multiSource:!1,effectAllowed:"all",dropEffectDefault:"move",guessDropEffect:!0,preventForeignNodes:!1,preventLazyParents:!0,preventNonNodes:!1,preventRecursion:!0,preventSameParent:!1,preventVoidMoves:!0,serializeClipboardData:!0,scroll:!0,scrollSensitivity:20,scrollSpeed:5,sourceCopyHook:null,dragStart:null,drag:null,dragEnd:null,dragEnter:null,dragOver:null,dragExpand:null,drop:null,dragLeave:null}),this.srcNode=null,this.lastTargetNode=null,this.lastEnterStamp=0,this.lastAllowedDropRegions=null,this.lastDropEffect=null,this.lastDropRegion=!1,this.currentScrollDir=0,this.applyScrollDirThrottled=Vt(this._applyScrollDir,50)}init(){super.init();const e=this.tree,t=e.options.dnd;t.dragStart&&R(e.element,"dragstart drag dragend",this.onDragEvent.bind(this)),t.dragEnter&&R(e.element,"dragenter dragover dragleave drop",this.onDropEvent.bind(this))}_leaveNode(){const e=this.lastTargetNode;this.lastEnterStamp=0,e&&(e.setClass("wb-drop-target wb-drop-over wb-drop-after wb-drop-before",!1),this.lastTargetNode=null)}unifyDragover(e){if(e===!1)return!1;if(e instanceof Set)return e.size>0?e:!1;if(e===!0)return new Set(["over","before","after"]);if(typeof e=="string"||ve(e))return e=Ke(e),e.size>0?e:!1;throw new Error("Unsupported drop region definition: "+e)}_calcDropRegion(e,t){const n=this.tree.options.rowHeightPx,r=e.offsetY;return t?t.size===3?r<.25*n?"before":r>.75*n?"after":"over":t.size===1&&t.has("over")?"over":r>n/2?"after":"before":!1}_guessDropEffect(e){var t;const n=this.treeOpts.dnd,r=(t=n.effectAllowed)!==null&&t!==void 0?t:"all",s=["all","copy","copyLink","copyMove"].includes(r),o=["all","link","copyLink","linkMove"].includes(r),l=["all","move","copyMove","linkMove"].includes(r);let a=n.dropEffectDefault;return n.guessDropEffect&&(at?(e.altKey&&s&&(a="copy"),e.metaKey&&l&&(a="move"),e.altKey&&e.metaKey&&o&&(a="link")):(e.ctrlKey&&s&&(a="copy"),e.shiftKey&&l&&(a="move"),e.altKey&&o&&(a="link"))),a}_isVoidDrop(e,t,n){return!this.treeOpts.dnd.preventVoidMoves||!t?!1:n==="before"&&e===t.getNextSibling()||n==="after"&&e===t.getPrevSibling()?!0:t===e||t.parent===e}_applyScrollDir(){if(this.isDragging()&&this.currentScrollDir){const e=this.tree.options.dnd,t=this.tree.element,n=t.scrollTop;this.currentScrollDir<0?t.scrollTop=Math.max(0,n-e.scrollSpeed):this.currentScrollDir>0&&(t.scrollTop=n+e.scrollSpeed)}}_autoScroll(e){const t=this.tree,r=t.options.dnd.scrollSensitivity,s=t.element,o=t.headerElement.clientHeight,l=s.offsetHeight,a=s.scrollTop;return this.currentScrollDir=0,a>0&&e>0&&e<=r+o?this.currentScrollDir=-1:a<s.scrollHeight-l&&e>=l-r&&(this.currentScrollDir=1),this.currentScrollDir&&this.applyScrollDirThrottled(),s.scrollTop-a}isDragging(){return!!this.srcNode}onDragEvent(e){var t;const n=this.treeOpts.dnd,r=L.getNode(e);if(!r){this.tree.logWarn(`onDragEvent.${e.type}: no node`);return}if(["dragstart","dragend"].includes(e.type)&&this.tree.logDebug(`onDragEvent.${e.type} srcNode: ${r}`,e),e.type==="dragstart"){if(e.dataTransfer.effectAllowed=n.effectAllowed,r.isEditingTitle())return r.logDebug("Prevented dragging node in edit mode."),e.preventDefault(),!1;if(!r._callEvent("dnd.dragStart",{event:e}))return e.preventDefault(),!1;const o=r.toDict(!0,l=>{l._orgKey=l.key,delete l.key});o._treeId=r.tree.id,n.serializeClipboardData&&(typeof n.serializeClipboardData=="function"?e.dataTransfer.setData(Xe,n.serializeClipboardData(o,r)):e.dataTransfer.setData(Xe,JSON.stringify(o))),!((t=e.dataTransfer)===null||t===void 0)&&t.types.includes("text/plain")||e.dataTransfer.setData("text/plain",r.title),this.srcNode=r,setTimeout(()=>{r.setClass("wb-drag-source")},0)}else e.type==="drag"?n.drag&&r._callEvent("dnd.drag",{event:e}):e.type==="dragend"&&(r.setClass("wb-drag-source",!1),this.srcNode=null,this.lastTargetNode&&this._leaveNode(),r._callEvent("dnd.dragEnd",{event:e}));return!0}onDropEvent(e){var t;const n=this.srcNode,r=n?n.tree:null,s=L.getNode(e),o=this.treeOpts.dnd,l=e.dataTransfer,a=this._calcDropRegion(e,this.lastAllowedDropRegions),c=(u,d)=>(u&&this.tree.log(`Prevented drop operation (${d}).`),u);if(!s){this._leaveNode();return}if(["drop"].includes(e.type)&&this.tree.logDebug(`onDropEvent.${e.type} targetNode: ${s}, ea: ${l==null?void 0:l.effectAllowed}, de: ${l==null?void 0:l.dropEffect}, cy: ${e.offsetY}, r: ${a}, srcNode: ${n}`,e),e.type==="dragenter"){if(this.lastAllowedDropRegions=null,this.lastTargetNode&&this.lastTargetNode!==s&&this._leaveNode(),this.lastTargetNode=s,this.lastEnterStamp=Date.now(),c(s.isStatusNode(),"is status node")||c(o.preventForeignNodes&&s.tree!==r,"preventForeignNodes")||c(o.preventLazyParents&&!s.isLoaded(),"preventLazyParents")||c(o.preventNonNodes&&!n,"preventNonNodes")||c(o.preventRecursion&&(n==null?void 0:n.isAncestorOf(s)),"preventRecursion")||c(o.preventSameParent&&n&&s.parent===n.parent,"preventSameParent")||c(o.preventVoidMoves&&s===n,"preventVoidMoves"))return l.dropEffect="none",!0;l.dropEffect=this._guessDropEffect(e)||"none";let u=s._callEvent("dnd.dragEnter",{event:e,sourceNode:n});if(u=this.unifyDragover(u),!u)return l.dropEffect="none",!0;this.lastAllowedDropRegions=u,this.lastDropEffect=l.dropEffect;const d=this._calcDropRegion(e,this.lastAllowedDropRegions);return s.setClass("wb-drop-target"),s.setClass("wb-drop-over",d==="over"),s.setClass("wb-drop-before",d==="before"),s.setClass("wb-drop-after",d==="after"),e.preventDefault(),!1}else if(e.type==="dragover"){const u=e.clientY-this.tree.element.offsetTop;this._autoScroll(u),l.dropEffect=this._guessDropEffect(e)||"none",s._callEvent("dnd.dragOver",{event:e,sourceNode:n});const d=this._calcDropRegion(e,this.lastAllowedDropRegions);return this.lastDropRegion=d,this.lastDropEffect=l.dropEffect,o.autoExpandMS>0&&s.isExpandable(!0)&&!s._isLoading&&Date.now()-this.lastEnterStamp>o.autoExpandMS&&s._callEvent("dnd.dragExpand",{event:e,sourceNode:n})!==!1&&s.setExpanded(),!d||this._isVoidDrop(s,n,d)?void 0:(s.setClass("wb-drop-over",d==="over"),s.setClass("wb-drop-before",d==="before"),s.setClass("wb-drop-after",d==="after"),e.preventDefault(),!1)}else if(e.type==="dragleave")s._callEvent("dnd.dragLeave",{event:e,sourceNode:n});else if(e.type==="drop"){e.stopPropagation(),e.preventDefault(),this._leaveNode();const u=this.lastDropRegion;let d=(t=e.dataTransfer)===null||t===void 0?void 0:t.getData(Xe);d=d?JSON.parse(d):null;const g=this.srcNode,m=this.lastDropEffect;setTimeout(()=>{s._callEvent("dnd.drop",{event:e,region:u,suggestedDropMode:u==="over"?"appendChild":u,suggestedDropEffect:m,sourceNode:g,sourceNodeData:d})},10)}return!1}}/*!
 * Wunderbaum - drag_observer
 * Copyright (c) 2021-2025, Martin Wendt. Released under the MIT license.
 * v0.13.0, Sat, 08 Mar 2025 14:16:31 GMT (https://github.com/mar10/wunderbaum)
 */class Zn{constructor(e){if(this.start={event:null,x:0,y:0,altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1},this.dragElem=null,this.dragging=!1,this.customData={},this.events=["mousedown","mouseup","mousemove","keydown"],!e.root)throw new Error("Missing `root` option.");this.opts=Object.assign({thresh:5},e),this.root=e.root,this._handler=this.handleEvent.bind(this),this.events.forEach(t=>{this.root.addEventListener(t,this._handler)})}disconnect(){this.events.forEach(e=>{this.root.removeEventListener(e,this._handler)})}getDragElem(){return this.dragElem}isDragging(){return this.dragging}stopDrag(e){if(this.dragging&&this.opts.dragstop&&e){e.type="dragstop";try{this.opts.dragstop(e)}catch(t){console.error("dragstop error",t)}}this.dragElem=null,this.dragging=!1,this.start.event=null,this.customData={}}handleEvent(e){const t=e.type,n=this.opts,r={type:e.type,startEvent:t==="mousedown"?e:this.start.event,event:e,customData:this.customData,dragElem:this.dragElem,dx:e.pageX-this.start.x,dy:e.pageY-this.start.y,apply:void 0};switch(t){case"keydown":this.stopDrag(r);break;case"mousedown":if(this.dragElem){this.stopDrag(r);break}if(n.selector){let s=e.target;if(s.matches(n.selector))this.dragElem=s;else if(s=s.closest(n.selector),s)this.dragElem=s;else break}this.start.event=e,this.start.x=e.pageX,this.start.y=e.pageY,this.start.altKey=e.altKey,this.start.ctrlKey=e.ctrlKey,this.start.metaKey=e.metaKey,this.start.shiftKey=e.shiftKey;break;case"mousemove":if(!this.dragElem)break;if(!this.dragging){if(n.thresh&&r.dx*r.dx+r.dy*r.dy<n.thresh*n.thresh)break;if(r.type="dragstart",n.dragstart(r)===!1){this.stopDrag(r);break}this.dragging=!0}this.dragging&&this.opts.drag&&(r.type="drag",this.opts.drag(r));break;case"mouseup":if(!this.dragging){this.stopDrag(r);break}e.button===0?r.apply=!0:r.apply=!1,this.stopDrag(r);break}}}/*!
 * Wunderbaum - common
 * Copyright (c) 2021-2025, Martin Wendt. Released under the MIT license.
 * v0.13.0, Sat, 08 Mar 2025 14:16:31 GMT (https://github.com/mar10/wunderbaum)
 */const ei=3,Nt=22,Se=20,Tt=7,ti=5,ni=4,tn=new RegExp(/\.|\//),ii={bootstrap:{error:"bi bi-exclamation-triangle",loading:"bi bi-chevron-right wb-busy",noData:"bi bi-question-circle",expanderExpanded:"bi bi-chevron-down",expanderCollapsed:"bi bi-chevron-right",expanderLazy:"bi bi-chevron-right wb-helper-lazy-expander",checkChecked:"bi bi-check-square",checkUnchecked:"bi bi-square",checkUnknown:"bi bi-dash-square-dotted",radioChecked:"bi bi-circle-fill",radioUnchecked:"bi bi-circle",radioUnknown:"bi bi-record-circle",folder:"bi bi-folder2",folderOpen:"bi bi-folder2-open",folderLazy:"bi bi-folder-symlink",doc:"bi bi-file-earmark",colSortable:"bi bi-chevron-expand",colSortAsc:"bi bi-arrow-down",colSortDesc:"bi bi-arrow-up",colFilter:"bi bi-filter-circle",colFilterActive:"bi bi-filter-circle-fill wb-helper-invalid",colMenu:"bi bi-three-dots-vertical"},fontawesome6:{error:"fa-solid fa-triangle-exclamation",loading:"fa-solid fa-chevron-right fa-beat",noData:"fa-solid fa-circle-question",expanderExpanded:"fa-solid fa-chevron-down",expanderCollapsed:"fa-solid fa-chevron-right",expanderLazy:"fa-solid fa-chevron-right wb-helper-lazy-expander",checkChecked:"fa-regular fa-square-check",checkUnchecked:"fa-regular fa-square",checkUnknown:"fa-regular fa-square-minus",radioChecked:"fa-solid fa-circle",radioUnchecked:"fa-regular fa-circle",radioUnknown:"fa-regular fa-circle-question",folder:"fa-solid fa-folder-closed",folderOpen:"fa-regular fa-folder-open",folderLazy:"fa-solid fa-folder-plus",doc:"fa-regular fa-file",colSortable:"fa-solid fa-fw fa-sort",colSortAsc:"fa-solid fa-fw fa-sort-up",colSortDesc:"fa-solid fa-fw fa-sort-down",colFilter:"fa-solid fa-fw fa-filter",colFilterActive:"fa-solid fa-fw fa-filter wb-helper-invalid",colMenu:"fa-solid fa-fw fa-ellipsis-v"}},ri=new Set(["_format","_keyMap","_positional","_typeList","_valueMap","_version","children","columns","types"]),si={ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",Backspace:"parent",End:"lastCol",Home:"firstCol","Control+End":"last","Control+Home":"first","Meta+ArrowDown":"last","Meta+ArrowUp":"first",PageDown:"pageDown",PageUp:"pageUp"};function St(i){return i instanceof RegExp?function(e){return i.test(e.title)}:(w(typeof i=="string",`Expected a string or RegExp: ${i}`),function(e){return e.title===i})}function oi(i){i=ue(i);const e=new RegExp("^"+i,"i");return function(t){return e.test(t.title)}}function et(i,e){const t=i.title.toLowerCase(),n=e.title.toLowerCase();return t===n?0:t>n?1:-1}function li(i){var e,t,n;const{_format:r,_keyMap:s={},_positional:o=[],children:l}=i,a=o.length;if(r!=="flat")throw new Error(`Expected source._format: "flat", but got ${r}`);if(a&&o.includes("children"))throw new Error(`source._positional must not include "children": ${o}`);let c=s;if(s.t){console.warn("source._keyMap maps from long to short since v0.7.0. Flip key/value!"),c={};for(const[x,_]of Object.entries(s))c[_]=x}const u=o.map(b=>{var x;return(x=c[b])!==null&&x!==void 0?x:b}),d=[],g={},m={},p=(e=c.key)!==null&&e!==void 0?e:"key",h=(t=c.children)!==null&&t!==void 0?t:"children";for(const[b,x]of l.entries()){let _;const[I,...k]=x;if(k.length===a)_={};else if(k.length===a+1){if(_=k.pop(),typeof _!="object")throw new Error(`unflattenSource: Expected dict as last tuple element: ${x}`)}else throw new Error(`unflattenSource: unexpected tuple length: ${x}`);x[1]=null,x[2]!=null&&(x[2]=null),k.forEach((B,F)=>{_[u[F]]=B}),k.length=0,m[b]=_;const S=_[p];S!=null&&(g[S]=_);let T=null;if(I!==null){if(typeof I=="number"){if(T=m[I],T===void 0)throw new Error(`unflattenSource: Could not find parent node by index: ${I}.`)}else if(T=g[I],T===void 0)throw new Error(`unflattenSource: Could not find parent node by key: ${I}`)}T?((n=T[h])!==null&&n!==void 0||(T[h]=[]),T[h].push(_)):d.push(_)}i.children=d}function ai(i){let{_format:e,_version:t=1,_keyMap:n,_valueMap:r}=i;w(t===1,`Expected file version 1 instead of ${t}`);let s=n,o={};if(s)for(const[a,c]of Object.entries(s))o[c]=a;if(s&&s.t&&(console.warn("source._keyMap maps from long to short since v0.7.0. Flip key/value!"),[s,o]=[o,s]),i._typeList!=null){const a='source._typeList is deprecated since v0.7.0: use source._valueMap: {"type": [...]} instead.';if(r!=null)throw new Error(a);console.warn(a),r={type:i._typeList},delete i._typeList}e==="flat"&&li(i),delete i._format,delete i._version,delete i._keyMap,delete i._valueMap,delete i._positional;function l(a){for(const c of a)Object.getOwnPropertyNames(c).forEach(u=>{const d=c[u];let g=u;if(n&&o[u]!=null&&(g=o[u],g!==u&&(c[g]=d,delete c[u])),r&&typeof d=="number"&&r[g]!=null){const m=r[g][d];if(m==null)throw new Error(`Expected valueMap[${g}][${d}] entry in [${r[g]}]`);c[g]=m}}),c.children&&l(c.children)}(n||r)&&l(i.children)}/*!
 * Wunderbaum - ext-grid
 * Copyright (c) 2021-2025, Martin Wendt. Released under the MIT license.
 * v0.13.0, Sat, 08 Mar 2025 14:16:31 GMT (https://github.com/mar10/wunderbaum)
 */class ci extends fe{constructor(e){super(e,"grid",{}),this.observer=new Zn({root:window.document,selector:"span.wb-col-resizer-active",thresh:4,dragstart:t=>{const n=L.getEventInfo(t.startEvent),r=n.colDef,s=r&&this.tree.element.contains(t.dragElem)&&ce(r.resizable,e.options.columnsResizable,!1);if(this.tree.element.classList.toggle("wb-col-resizing",!!s),n.colElem.classList.toggle("wb-col-resizing",!!s),s){t.customData.colDef=r,t.customData.orgCustomWidthPx=r.customWidthPx;const o=Number.parseInt(n.colElem.style.width,10);t.customData.orgWidthPx=o,r.customWidthPx=o,this.tree.update(E.colStructure)}return s},drag:t=>this.handleDrag(t),dragstop:t=>this.handleDrag(t)})}init(){super.init()}handleDrag(e){const t=e.customData,n=t.colDef;if(e.type==="dragstop"||e.type==="drag"){if(this.tree.element.classList.remove("wb-col-resizing"),e.apply||e.type==="drag"){const r=Jt(n.minWidth,ni),s=Math.max(r,t.orgWidthPx+e.dx);n.customWidthPx=s}else this.tree.log("Column resize cancelled",e),n.customWidthPx=t.orgCustomWidthPx;this.tree.update(E.colStructure)}}}/*!
 * Wunderbaum - deferred
 * Copyright (c) 2021-2025, Martin Wendt. Released under the MIT license.
 * v0.13.0, Sat, 08 Mar 2025 14:16:31 GMT (https://github.com/mar10/wunderbaum)
 */class nn{constructor(){this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}resolve(e){this._resolve(e)}reject(e){this._reject(e)}promise(){return this._promise}then(e){return this._promise.then(e)}catch(e){return this._promise.catch(e)}finally(e){return this._promise.finally(e)}}/*!
 * Wunderbaum - wunderbaum_node
 * Copyright (c) 2021-2025, Martin Wendt. Released under the MIT license.
 * v0.13.0, Sat, 08 Mar 2025 14:16:31 GMT (https://github.com/mar10/wunderbaum)
 */const rn=new Set(["checkbox","classes","expanded","icon","iconTooltip","key","lazy","_partsel","radiogroup","refKey","selected","statusNodeType","title","tooltip","type","unselectable"]),$e=new Set(rn);$e.delete("_partsel");$e.delete("unselectable");class X{constructor(e,t,n){var r,s;this.refKey=void 0,this.children=null,this.classes=null,this.data={},this._isLoading=!1,this._requestId=0,this._errorInfo=null,this._partsel=!1,this._partload=!1,this.subMatchCount=0,this._rowIdx=0,this._rowElem=void 0,w(!t||t.tree===e,`Invalid parent: ${t}`),w(!n.children,"'children' not allowed here"),this.tree=e,this.parent=t,this.key=""+((r=n.key)!==null&&r!==void 0?r:++X.sequence),this.title=""+((s=n.title)!==null&&s!==void 0?s:"<"+this.key+">"),this.expanded=!!n.expanded,this.lazy=!!n.lazy,n.refKey!=null&&(this.refKey=""+n.refKey),n.type!=null&&(this.type=""+n.type),n.icon!=null&&(this.icon=we(n.icon)),n.tooltip!=null&&(this.tooltip=we(n.tooltip)),n.iconTooltip!=null&&(this.iconTooltip=we(n.iconTooltip)),n.statusNodeType!=null&&(this.statusNodeType=""+n.statusNodeType),n.colspan!=null&&(this.colspan=!!n.colspan),n.checkbox!=null&&we(n.checkbox),n.radiogroup!=null&&(this.radiogroup=!!n.radiogroup),n.selected!=null&&(this.selected=!!n.selected),n.unselectable!=null&&(this.unselectable=!!n.unselectable),n.classes&&this.setClass(n.classes);for(const[o,l]of Object.entries(n))rn.has(o)||(this.data[o]=l);t&&!this.statusNodeType&&e._registerNode(this)}toString(){return`WunderbaumNode@${this.key}<'${this.title}'>`}*[Symbol.iterator](){const e=this.children;if(e)for(let t=0,n=e.length;t<n;t++){const r=e[t];yield r,r.children&&(yield*r)}}_callEvent(e,t){var n;return(n=this.tree)===null||n===void 0?void 0:n._callEvent(e,W({node:this,typeInfo:this.type?this.tree.types[this.type]:{}},t))}addChildren(e,t){const n=this.tree;let{before:r=null,applyMinExpanLevel:s=!0,_level:o}=t??{};o??(o=this.getLevel());const l=[];try{n.enableUpdate(!1),G(e)&&(e=[e]);const a=s&&o<n.options.minExpandLevel;for(const c of e){const u=c.children;delete c.children;const d=new X(n,this,c);a&&!d.isUnloaded()&&(d.expanded=!0),l.push(d),u&&d.addChildren(u,{_level:o+1})}if(!this.children)this.children=l;else if(r==null||this.children.length===0)this.children=this.children.concat(l);else{r=this.findDirectChild(r);const c=this.children.indexOf(r);w(c>=0,`options.before must be a direct child of ${this}`),this.children.splice(c,0,...l)}n.update(E.structure)}finally{n.enableUpdate(!0)}return l[0]}addNode(e,t="appendChild"){switch(t==="over"&&(t="appendChild"),t){case"after":return this.parent.addChildren(e,{before:this.getNextSibling()});case"before":return this.parent.addChildren(e,{before:this});case"prependChild":return this.addChildren(e,{before:0});case"appendChild":return this.addChildren(e)}w(!1,`Invalid mode: ${t}`)}applyCommand(e,t){return this.tree.applyCommand(e,this,t)}collapseSiblings(e){for(const t of this.parent.children)t!==this&&t.expanded&&t.setExpanded(!1,e)}setClass(e,t=!0){const n=Ke(e);if(t)this.classes===null&&(this.classes=new Set),n.forEach(r=>{var s;this.classes.add(r),(s=this._rowElem)===null||s===void 0||s.classList.toggle(r,t)});else{if(this.classes===null)return;n.forEach(r=>{var s;this.classes.delete(r),(s=this._rowElem)===null||s===void 0||s.classList.toggle(r,t)}),this.classes.size===0&&(this.classes=null)}}startEditTitle(){this.tree._callMethod("edit.startEditTitle",this)}async expandAll(e=!0,t){const n=this.tree,{collapseOthers:r,deep:s,depth:o,force:l,keepActiveNodeVisible:a=!0,loadLazy:c,resetLazy:u}=t??{},d=this.tree.options.minExpandLevel||null,g=o??(l?null:d),m={deep:s,force:l,loadLazy:c,resetLazy:u,scrollIntoView:!1};this.logInfo(`expandAll(${e}, depth=${o}, minLevel=${g})`),w(!(e&&s!=null&&!r),"Expanding with `deep` option is not supported (implied by the `depth` option).");async function p(b,x){var _;const I=[];return(_=b.children)===null||_===void 0||_.forEach(k=>{if(e)if(!k.expanded&&(g==null||x<g)&&(k.children||c&&k.lazy)){const S=k.setExpanded(!0,m);I.push(S),o==null&&S.then(async()=>{await p(k,x+1)})}else I.push(p(k,x+1));else(g==null||x>=g)&&k.setExpanded(!1,m),(g!=null&&x<g||s)&&p(k,x+1)}),new Promise(k=>{Promise.all(I).then(()=>{k(!0)})})}const h=n.logTime(`${this}.expandAll(${e}, depth=${o})`);try{n.enableUpdate(!1),await p(this,0),r&&(w(e,"Option `collapseOthers` requires flag=true"),w(g!=null,"Option `collapseOthers` requires `depth` or `minExpandLevel`"),this.expandAll(!1,{depth:g}))}finally{n.enableUpdate(!0),n.logTimeEnd(h)}n.activeNode&&a&&n.activeNode.scrollIntoView()}findAll(e){const t=typeof e=="function"?e:St(e),n=[];return this.visit(r=>{t(r)&&n.push(r)}),n}findDirectChild(e){const t=this.children;if(!t)return null;if(typeof e=="string"){for(let n=0,r=t.length;n<r;n++)if(t[n].key===e)return t[n]}else{if(typeof e=="number")return t[e];if(e.parent===this)return e}return null}findFirst(e){const t=typeof e=="function"?e:St(e);let n=null;return this.visit(r=>{if(t(r))return n=r,!1}),n}findRelatedNode(e,t=!1){return this.tree.findRelatedNode(this,e,t)}*format_iter(e,t){t??(t=["    "," |  "," ╰─ "," ├─ "]),e??(e=s=>""+s);function n(s){const o=s.parent.children;return s===o[o.length-1]}const r=s=>{const o=[e(s)];o.unshift(t[n(s)?2:3]);let l=s.parent;for(;l&&l!==this;)o.unshift(t[n(l)?0:1]),l=l.parent;return o.join("")};yield e(this);for(const s of this)yield r(s)}format(e,t){const n=[];for(const r of this.format_iter(e,t))n.push(r);return n.join(`
`)}getColElem(e){var t;typeof e=="string"&&(e=this.tree.columns.findIndex(r=>r.id===e));const n=(t=this._rowElem)===null||t===void 0?void 0:t.querySelectorAll("span.wb-col");return n?n[e]:null}getCloneList(e=!1){if(!this.refKey)return[];const t=this.tree.findByRefKey(this.refKey);return e?t:[...t].filter(n=>n!==this)}getFirstChild(){return this.children?this.children[0]:null}getLastChild(){return this.children?this.children[this.children.length-1]:null}getLevel(){let e=0,t=this.parent;for(;t;)e++,t=t.parent;return e}getNextSibling(){const e=this.parent.children,t=e.indexOf(this);return e[t+1]||null}getParent(){return this.parent}getParentList(e=!1,t=!1){const n=[];let r=t?this:this.parent;for(;r;)(e||r.parent)&&n.unshift(r),r=r.parent;return n}getPath(e=!0,t="title",n="/"){let r;const s=[],o=typeof t=="function";return this.visitParents(l=>{l.parent&&(r=o?t(l):l[t],s.unshift(r))},e),s.join(n)}getPrevSibling(){const e=this.parent.children,t=e.indexOf(this);return e[t-1]||null}hasChildren(){return this.lazy?this.children==null?void 0:this.children.length===0?!1:this.children.length===1&&this.children[0].isStatusNode()?void 0:!0:!!(this.children&&this.children.length)}hasClass(e){return this.classes?this.classes.has(e):!1}hasFocus(){return this.tree.focusNode===this}isActive(){return this.tree.activeNode===this}isAncestorOf(e){return e&&e.isDescendantOf(this)}isChildOf(e){return e&&this.parent===e}isClone(){return!!this.refKey&&this.tree.findByRefKey(this.refKey).length>1}isColspan(){return!!this.getOption("colspan")}isDescendantOf(e){if(!e||e.tree!==this.tree)return!1;let t=this.parent;for(;t;){if(t===e)return!0;t===t.parent&&$(`Recursive parent link: ${t}`),t=t.parent}return!1}isExpandable(e=!1){return e&&this.expanded||this.children===!1?!1:this.children==null?!!this.lazy:this.children.length===0?!!this.tree.options.emptyChildListExpandable:!0}isEditingTitle(){return this.tree._callMethod("edit.isEditingTitle",this)}isExpanded(){return!!this.expanded}isFirstSibling(){const e=this.parent;return!e||e.children[0]===this}isLastSibling(){const e=this.parent;return!e||e.children[e.children.length-1]===this}isLazy(){return!!this.lazy}isLoaded(){return!this.lazy||this.hasChildren()!==void 0}isLoading(){return this._isLoading}isPagingNode(){return this.statusNodeType==="paging"}isParentOf(e){return e&&e.parent===this}isPartload(){return!!this._partload}isPartsel(){return!this.selected&&!!this._partsel}isRadio(){return!!this.parent.radiogroup||this.getOption("checkbox")==="radio"}isRendered(){return!!this._rowElem}isRootNode(){return this.tree.root===this}isSelected(){return this.selected?!0:this._partsel?void 0:!1}isStatusNode(){return!!this.statusNodeType}isTopLevel(){return this.tree.root===this.parent}isUnloaded(){return this.hasChildren()===void 0}isVisible(){const e=this.tree.filterMode==="hide",t=this.getParentList(!1,!1);if(e&&!this.match&&!this.subMatchCount)return!1;for(let n=0,r=t.length;n<r;n++)if(!t[n].expanded)return!1;return!0}_loadSourceObject(e,t){var n;const r=this.tree;t??(t=this.getLevel());const s=this._callEvent("receive",{response:e});s!=null&&(e=s),ve(e)&&(e={children:e}),w(G(e),`Expected an array or plain object: ${e}`);const o=(n=e.format)!==null&&n!==void 0?n:"nested";w(o==="nested"||o==="flat",`Expected source.format = 'nested' or 'flat': ${o}`),ai(e),w(e.children,"If `source` is an object, it must have a `children` property"),e.types&&(r.logInfo("Redefine types",e.columns),r.setTypes(e.types,!1),delete e.types),e.columns&&(r.logInfo("Redefine columns",e.columns),r.columns=e.columns,delete e.columns,r.update(E.colStructure)),this.addChildren(e.children);for(const[l,a]of Object.entries(e))ri.has(l)||(r.data[l]=a);r.options.selectMode==="hier"&&this.fixSelection3FromEndNodes(),this.resetNativeChildOrder(),this._callEvent("load")}async _fetchWithOptions(e){var t,n;let r,s,o,l,a,c={};typeof e=="string"?(r=e,c.method="GET"):G(e)?({url:r,params:s,body:o,options:l,...a}=e,w(!a||Object.keys(a).length===0,`Unexpected source properties: ${Object.keys(a)}. Use 'options' instead.`),w(typeof r=="string","expected source.url as string"),G(l)&&(c=l),G(o)&&(w(!c.body,"options.body should be passed as source.body"),c.body=JSON.stringify(c.body),(t=c.method)!==null&&t!==void 0||(c.method="POST")),G(s)&&(r+="?"+new URLSearchParams(s),(n=c.method)!==null&&n!==void 0||(c.method="GET"))):(r="",$(`Unsupported source format: ${e}`)),this.setStatus(U.loading);const u=await fetch(r,c);return u.ok||$(`GET ${r} returned ${u.status}, ${u}`),await u.json()}async load(e){const t=this.tree,n=Date.now(),r=this.parent,s=Date.now();let o=0,l=0,a=0;this._requestId&&this.logWarn(`Recursive load request #${n} while #${this._requestId} is pending. The previous request will be ignored.`),this._requestId=n;try{if(typeof e=="string"?e:e.url){const u=await this._fetchWithOptions(e);if(l=Date.now()-s,this._requestId&&this._requestId>n){this.logWarn(`Ignored load response #${n} because #${this._requestId} is pending.`);return}else this.logDebug(`Received response for load request #${n}`);if(this.parent===null&&r!==null){this.logWarn("Lazy parent node was removed while loading: discarding response.");return}this.setStatus(U.ok);const d=Date.now();this._loadSourceObject(u),a=Date.now()-d}else{if(typeof e.then=="function"){const u=t.logTime(`Resolve thenable ${e}`);e=await Promise.resolve(e),t.logTimeEnd(u)}this._loadSourceObject(e),a=Date.now()-s}}catch(c){throw this.logError("Error during load()",e,c),this._callEvent("error",{error:c}),this.setStatus(U.error,{message:""+c}),c}finally{this._requestId=0,o=Date.now()-s,t.options.debugLevel>=3&&t.logInfo(`Load source took ${o/1e3} seconds (transfer: ${l/1e3}s, processing: ${a/1e3}s)`)}}async loadLazy(e=!1){const t=this.expanded;if(w(this.lazy,"load() requires a lazy node"),!(!e&&!this.isUnloaded())){if(this.isLoading()){this.logWarn("loadLazy() called while already loading: ignored.");return}this.isLoaded()&&this.resetLazy(),this.setStatus(U.loading);try{const n=await this._callEvent("lazyLoad");if(n===!1){this.setStatus(U.ok);return}w(ve(n)||n&&n.url,"The lazyLoad event must return a node list, `{url: ...}`, or false."),await this.load(n),this.setStatus(U.ok),t?(this.expanded=!0,this.tree.update(E.structure)):this.update()}catch(n){this.logError("Error during loadLazy()",n),this._callEvent("error",{error:n}),this.setStatus(U.error,{message:""+n})}}}log(...e){this.tree.options.debugLevel>=4&&console.log(this.toString(),...e)}logDebug(...e){this.tree.options.debugLevel>=4&&console.debug(this.toString(),...e)}logError(...e){this.tree.options.debugLevel>=1&&console.error(this.toString(),...e)}logInfo(...e){this.tree.options.debugLevel>=3&&console.info(this.toString(),...e)}logWarn(...e){this.tree.options.debugLevel>=2&&console.warn(this.toString(),...e)}async makeVisible(e){let t;const n=new nn,r=[],s=this.getParentList(!1,!1),o=s.length,l=Me(e,"noAnimation",!1),a=Me(e,"scrollIntoView",!0);for(t=o-1;t>=0;t--){const c={noAnimation:l};r.push(s[t].setExpanded(!0,c))}return Promise.all(r).then(()=>{a&&this.tree?(this.tree.updatePendingModifications(),this.scrollIntoView().then(()=>{n.resolve()})):n.resolve()}),n.promise()}moveTo(e,t="appendChild",n){t==="over"&&(t="appendChild"),t==="prependChild"&&(e.children&&e.children.length?(t="before",e=e.children[0]):t="appendChild");let r;const s=this.tree,o=this.parent,l=t==="appendChild"?e:e.parent;if(this!==e){if(this.parent?l.isDescendantOf(this)&&$("Cannot move a node to its own descendant"):$("Cannot move system root"),l!==o&&o.triggerModifyChild("remove",this),this.parent.children.length===1){if(this.parent===l)return;this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1}else r=this.parent.children.indexOf(this),w(r>=0,"invalid source parent"),this.parent.children.splice(r,1);if(this.parent=l,l.hasChildren())switch(t){case"appendChild":l.children.push(this);break;case"before":r=l.children.indexOf(e),w(r>=0,"invalid target parent"),l.children.splice(r,0,this);break;case"after":r=l.children.indexOf(e),w(r>=0,"invalid target parent"),l.children.splice(r+1,0,this);break;default:$(`Invalid mode '${t}'.`)}else l.children=[this];n&&e.visit(n,!0),l===o?l.triggerModifyChild("move",this):l.triggerModifyChild("add",this),s!==e.tree&&(this.logWarn("Cross-tree moveTo is experimental!"),this.visit(a=>{a.tree=e.tree},!0)),setTimeout(()=>{s.update(E.any)},0)}}async navigate(e,t){var n;const r=(n=si[e])!==null&&n!==void 0?n:e,s=this.findRelatedNode(r);if(!s)return this.logWarn(`Could not find related node '${e}'.`),Promise.resolve(this);try{s.makeVisible({scrollIntoView:!1})}catch{}return s.setFocus(),(t==null?void 0:t.activate)===!1?Promise.resolve(this):s.setActive(!0,{event:t==null?void 0:t.event})}remove(){const e=this.tree,t=this.parent.children.indexOf(this);this.triggerModify("remove"),this.parent.children.splice(t,1),this.visit(n=>{n.removeMarkup(),e._unregisterNode(n)},!0),e.update(E.structure)}removeChildren(){var e,t;const n=this.tree;this.children&&(!((e=n.activeNode)===null||e===void 0)&&e.isDescendantOf(this)&&n.activeNode.setActive(!1),!((t=n.focusNode)===null||t===void 0)&&t.isDescendantOf(this)&&n._setFocusNode(null),this.triggerModifyChild("remove",null),this.visit(r=>{n._unregisterNode(r)}),this.lazy?this.children=[]:this.children=null,this.isRootNode()||(this.expanded=!1),this.tree.update(E.structure))}removeMarkup(){this._rowElem&&(delete this._rowElem._wb_node,this._rowElem.remove(),this._rowElem=void 0)}_getRenderInfo(){const e={},t={},n=this.isColspan(),r=this._rowElem?this._rowElem.querySelectorAll("span.wb-col"):null;let s=0;for(const o of this.tree.columns)e[o.id]={id:o.id,idx:s,elem:r?r[s]:null,info:o},!n&&o.id!=="*"&&(t[o.id]=e[o.id]),s++;return{allColInfosById:e,renderColInfosById:t}}_createIcon(e,t,n){const r=this.tree._createNodeIcon(this,n,!0);return r&&(t?e.replaceChild(r,t):e.appendChild(r)),r}_render_markup(e){const t=this.tree,n=t.options,r=n.rowHeightPx,s=this.getOption("checkbox"),o=t.columns,l=this.getLevel(),a=t.isRowNav()?null:t.activeColIdx;let c,u=this._rowElem,d=null,g=null;const m=!u;w(m,"Expected unrendered node"),w(!m||e&&e.after,"opts.after expected, unless updating"),w(!this.isRootNode(),"Root node not allowed"),u=document.createElement("div"),u.classList.add("wb-row"),u.style.top=this._rowIdx*r+"px",this._rowElem=u,u._wb_node=this;const p=document.createElement("span");p.classList.add("wb-node","wb-col"),u.appendChild(p);let h=0;s&&(d=document.createElement("i"),d.classList.add("wb-checkbox"),(s==="radio"||this.parent.radiogroup)&&d.classList.add("wb-radio"),p.appendChild(d),h+=Se);for(let k=l-1;k>0;k--)c=document.createElement("i"),c.classList.add("wb-indent"),p.appendChild(c),h+=Se;(!n.minExpandLevel||l>n.minExpandLevel)&&(g=document.createElement("i"),g.classList.add("wb-expander"),p.appendChild(g),h+=Se),this._createIcon(p,null,!g)&&(h+=Se);const x=document.createElement("span");if(x.classList.add("wb-title"),p.appendChild(x),p._ofsTitlePx=h,t.options.dnd.dragStart&&(p.draggable=!0),!this.isColspan()&&o.length>1){let k=0;for(const S of o){k++;let T;S.id==="*"?T=p:(T=document.createElement("span"),T.classList.add("wb-col"),u.appendChild(T)),k===a&&T.classList.add("wb-active"),S.classes&&T.classList.add(...S.classes.split(" ")),T.style.left=S._ofsPx+"px",T.style.width=S._widthPx+"px",m&&S.html&&typeof S.html=="string"&&(T.innerHTML=S.html)}}switch(e?e.after:"last"){case"first":t.nodeListElement.prepend(u);break;case"last":t.nodeListElement.appendChild(u);break;default:e.after.after(u)}e.isNew=!0,this._render_data(e)}_render_data(e){w(this._rowElem,"No _rowElem");const t=this.tree,n=t.options,r=this._rowElem,s=!!e.isNew,o=!!e.preventScroll,l=t.columns,a=this.isColspan(),c=r.querySelector("span.wb-node"),u=c.querySelector("span.wb-title"),d=t.element.scrollTop;this.titleWithHighlight?u.innerHTML=this.titleWithHighlight:u.textContent=this.title;const g=this.getOption("tooltip",!1);if(g&&(u.title=g===!0?this.title:g),o&&(t.element.scrollTop=d),!n.skeleton)if(a){const m=t.element.clientWidth;u.style.width=m-c._ofsTitlePx-Tt+"px"}else u.style.width=l[0]._widthPx-c._ofsTitlePx-Tt+"px";if(e.isDataChange=!0,this._render_status(e),this.statusNodeType)this._callEvent("renderStatusNode",{isNew:s,nodeElem:c,isColspan:a});else if(this.parent){const m=this._getRenderInfo();this._callEvent("render",{isNew:s,nodeElem:c,isColspan:a,allColInfosById:m.allColInfosById,renderColInfosById:m.renderColInfosById})}}_render_status(e){const t=this.tree,n=t.iconMap,r=t.options,s=this.type?t.types[this.type]:null,o=this._rowElem,l=o.querySelector("span.wb-node"),a=l.querySelector("i.wb-expander"),c=l.querySelector("i.wb-checkbox"),u=["wb-row"];if(this.expanded&&u.push("wb-expanded"),this.lazy&&u.push("wb-lazy"),this.selected&&u.push("wb-selected"),this._partsel&&u.push("wb-partsel"),this===t.activeNode&&u.push("wb-active"),this===t.focusNode&&u.push("wb-focus"),this._errorInfo&&u.push("wb-error"),this._isLoading&&u.push("wb-loading"),this.isColspan()&&u.push("wb-colspan"),this.statusNodeType&&u.push("wb-status-"+this.statusNodeType),this.match&&u.push("wb-match"),this.subMatchCount&&u.push("wb-submatch"),r.skeleton&&u.push("wb-skeleton"),o.className=u.join(" "),this.classes&&o.classList.add(...this.classes),s&&s.classes&&o.classList.add(...s.classes),a){let d=null;this._isLoading?d=n.loading:this.isExpandable(!1)?this.expanded?d=n.expanderExpanded:d=n.expanderCollapsed:this.lazy&&this.children==null&&(d=n.expanderLazy),d==null?a.classList.add("wb-indent"):tn.test(d)?a.style.backgroundImage=`url('${d}')`:a.className="wb-expander "+d}if(c){let d="wb-checkbox ";this.isRadio()?(d+="wb-radio ",this.selected?d+=n.radioChecked:d+=n.radioUnchecked):this.selected?d+=n.checkChecked:this._partsel?d+=n.checkUnknown:d+=n.checkUnchecked,c.className=d}if(!e.isNew){let d=0;for(const m of o.children)m.classList.toggle("wb-active",d++===t.activeColIdx),m.classList.remove("wb-error","wb-invalid");const g=l.querySelector("i.wb-icon");g&&this._createIcon(l,g,!a)}if(e.resizeCols!==!1&&!this.isColspan()){const d=o.querySelectorAll("span.wb-col");let g=0,m=0;for(const p of this.tree.columns){const h=d[g];h.style.left=`${m}px`,h.style.width=`${p._widthPx}px`,g++,m+=p._widthPx}}}_render(e){const t=Object.assign({change:E.data},e);switch(this._rowElem||(t.change=E.row),t.change){case"status":this._render_status(t);break;case"data":this._render_data(t);break;case"row":this._render_markup(t);break;default:$(`Invalid change type '${t.change}'.`)}}resetLazy(){this.removeChildren(),this.expanded=!1,this.lazy=!0,this.children=null,this.tree.update(E.structure)}toDict(e=!1,t){const n={};if($e.forEach(r=>{const s=this[r];s instanceof Set?s.size&&(n[r]=Array.prototype.join.call(s.keys()," ")):(s||s===!1||s===0)&&(n[r]=s)}),Ze(this.data)||(n.data=W({},this.data),Ze(n.data)&&delete n.data),t){const r=t(n,this);if(r===!1)return!1;r==="skip"&&(e=!1)}if(e&&ve(this.children)){n.children=[];for(let r=0,s=this.children.length;r<s;r++){const o=this.children[r];if(!o.isStatusNode()){const l=o.toDict(!0,t);l!==!1&&n.children.push(l)}}}return n}getOption(e,t){const n=this.tree;let r=n.options;e.indexOf(".")>=0&&([r,e]=e.split("."));const s=r[e];if(typeof s=="function"){const a=s.call(n,{type:"resolve",tree:n,node:this});if(a!==void 0)return a}if(this[e]!==void 0)return this[e];const o=this.type?n.types[this.type]:void 0,l=o?o[e]:void 0;return l!==void 0?l:s??t}async scrollIntoView(e){const t=Object.assign({node:this},e);return this.tree.scrollTo(t)}async setActive(e=!0,t){const n=this.tree,r=n.getActiveNode(),s=t==null?void 0:t.retrigger,o=t==null?void 0:t.focusTree,l=t==null?void 0:t.noEvents,a=t==null?void 0:t.event,c=t==null?void 0:t.colIdx,u=t==null?void 0:t.edit;if(w(!u||c!=null,"edit requires colIdx"),!l)if(e){if(r!==this||s){if((r==null?void 0:r._callEvent("deactivate",{nextNode:this,event:a}))===!1||this._callEvent("beforeActivate",{prevNode:r,event:a})===!1)return;n._setActiveNode(null),r==null||r.update(E.status)}}else(r===this||s)&&this._callEvent("deactivate",{nextNode:null,event:a});return r!==this&&(e&&n._setActiveNode(this),r==null||r.update(E.status),this.update(E.status)),this.makeVisible().then(()=>{e&&((o||u)&&(n.setFocus(),n._setFocusNode(this),n.focusNode.setFocus()),c!=null&&n.isCellNav()&&n.setColumn(c,{edit:u}),l||this._callEvent("activate",{prevNode:r,event:a}))})}async setExpanded(e=!0,t){const{force:n,scrollIntoView:r,immediate:s,resetLazy:o}=t??{},l=!(t!=null&&t.noEvents);if(!e&&this.isExpanded()&&this.getLevel()<=this.tree.getOption("minExpandLevel")&&!n){this.logDebug("Ignored collapse request below minExpandLevel.");return}if(!e==!this.expanded||l&&this._callEvent("beforeExpand",{flag:e})===!1)return;e&&this.getOption("autoCollapse")&&this.collapseSiblings(t),e&&this.lazy&&this.children==null?await this.loadLazy():!e&&o&&this.lazy&&this.children&&this.resetLazy(),this.expanded=e;const a={immediate:s};if(this.tree.update(E.structure,a),e&&r){const c=this.getLastChild();c&&(this.tree.updatePendingModifications(),c.scrollIntoView({topNode:this}))}l&&this._callEvent("expand",{flag:e})}setFocus(e=!0){w(!!e,"Blur is not yet implemented");const t=this.tree.focusNode;this.tree._setFocusNode(this),t==null||t.update(),this.update()}setIcon(e){this.icon=e,this.update()}setKey(e,t){throw new Error("Not yet implemented")}update(e=E.data){w(e===E.status||e===E.data,`Invalid change type ${e}`),this.tree.update(e,this)}getSelectedNodes(e=!1){const t=[];return this.visit(n=>{if(n.selected&&(t.push(n),e===!0))return"skip"}),t}toggleSelected(e){let t=this.isSelected();return t===void 0&&!this.isRadio()?t=this._anySelectable():t=!t,this.setSelected(t,e)}_anySelectable(){let e=!1;return this.visit(t=>{if(t.selected===!1&&!t.unselectable&&!t.hasChildren()&&!t.parent.radiogroup)return e=!0,!1}),e}_changeSelectStatusProps(e){let t=!1;switch(e){case!1:t=this.selected||this._partsel,this.selected=!1,this._partsel=!1;break;case!0:t=!this.selected||!this._partsel,this.selected=!0,this._partsel=!0;break;case void 0:t=this.selected||!this._partsel,this.selected=!1,this._partsel=!!this.hasChildren();break;default:$(`Invalid state: ${e}`)}return t&&this.update(),t}fixSelection3AfterClick(e){const t=!!(e!=null&&e.force),n=this.isSelected();this.visit(r=>{if(r.radiogroup)return"skip";(t||!r.getOption("unselectable"))&&r._changeSelectStatusProps(n)}),this.fixSelection3FromEndNodes()}fixSelection3FromEndNodes(e){const t=!!(e!=null&&e.force);w(this.tree.options.selectMode==="hier","expected selectMode 'hier'");const n=r=>{let s;const o=r.children;if(o&&o.length){let l=!0,a=!1;for(let c=0,u=o.length;c<u;c++){const d=o[c],g=n(d);g!==!1&&(a=!0),g!==!0&&(l=!1)}s=l?!0:a?void 0:!1}else s=!!r.selected;return r._partsel&&!r.selected&&r.lazy&&r.children==null&&(s=void 0),(t||!r.getOption("unselectable"))&&r._changeSelectStatusProps(s),s};n(this),this.visitParents(r=>{let s;const o=r.children;let l=!0,a=!1;for(let c=0,u=o.length;c<u;c++){const d=o[c];s=!!d.selected,(s||d._partsel)&&(a=!0),s||(l=!1)}s=l?!0:a?void 0:!1,r._changeSelectStatusProps(s)})}setSelected(e=!0,t){const n=this.tree,r=!(t!=null&&t.noEvents),s=this.isSelected(),o=this.parent&&this.parent.radiogroup,l=n.options.selectMode,a=(t==null?void 0:t.force)||!this.getOption("unselectable");return e=!!e,a?t!=null&&t.propagateDown&&l==="multi"?(n.runWithDeferredUpdate(()=>{this.visit(c=>{c.setSelected(e)})}),s):(e===s||r&&this._callEvent("beforeSelect",{flag:e})===!1||(n.runWithDeferredUpdate(()=>{if(o){if(!e&&!(t!=null&&t.force))return s;for(const c of this.parent.children)c.selected=c===this}else this.selected=e,l==="hier"?this.fixSelection3AfterClick():l==="single"&&n.visit(c=>{c.selected=!1})}),r&&this._callEvent("select",{flag:e})),s):s}setStatus(e,t){const n=this.tree,r=t==null?void 0:t.message,s=t==null?void 0:t.details;let o=null;const l=()=>{const c=this.children;c&&c.length&&c[0].isStatusNode()&&c[0].remove()},a=c=>{const u=this.children,d=u?u[0]:null;return w(c.statusNodeType,"Not a status node"),w(!d||!d.isStatusNode(),"Child must not be a status node"),o=this.addNode(c,"prependChild"),o.match=-1,n.update(E.structure),o};switch(l(),e){case"ok":this._isLoading=!1,this._errorInfo=null;break;case"loading":this._isLoading=!0,this._errorInfo=null,this.parent?this.update(E.status):a({statusNodeType:e,title:n.options.strings.loading+(r?" ("+r+")":""),checkbox:!1,colspan:!0,tooltip:s});break;case"error":a({statusNodeType:e,title:n.options.strings.loadError+(r?" ("+r+")":""),checkbox:!1,colspan:!0,tooltip:s}),this._isLoading=!1,this._errorInfo={message:r,details:s};break;case"noData":a({statusNodeType:e,title:r||n.options.strings.noData,checkbox:!1,colspan:!0,tooltip:s}),this._isLoading=!1,this._errorInfo=null;break;default:$("invalid node status "+e)}return n.update(E.structure),o}setTitle(e){this.title=e,this.update()}setTooltip(e){this.tooltip=e,this.update()}_sortChildren(e,t){const n=this.children;if(n&&(n.sort(e),t))for(let r=0,s=n.length;r<s;r++)n[r].children&&n[r]._sortChildren(e,t)}sortChildren(e=et,t=!1){this._sortChildren(e||et,t),this.tree.update(E.structure)}resetNativeChildOrder(e){const{recursive:t=!0,propName:n="_nativeIndex"}=e??{};this.children&&this.children.forEach((r,s)=>{r.data[n]=s,t&&r.children&&r.resetNativeChildOrder(e)})}sortByProperty(e){var t,n,r;const{caseInsensitive:s=!0,deep:o=!0,nativeOrderPropName:l="_nativeIndex",updateColInfo:a=!1}=e;let c,u;if(a){u=this.tree._columnsById[e.colId],w(u,`Invalid colId specified: ${e.colId}`),c=(t=e.order)!==null&&t!==void 0?t:Yt(u.sortOrder,["asc","desc",void 0]);for(const m of this.tree.columns)m.sortOrder=m===u?c:void 0;this.tree.update(E.colStructure)}else c=(n=e.order)!==null&&n!==void 0?n:"asc";let d=(r=e.propName)!==null&&r!==void 0?r:e.colId||"";d==="*"&&(d="title"),c==null&&(d=l,c="asc"),this.logDebug(`sortByProperty(), propName=${d}, ${c}`,e),w(d,"No property name specified");const g=(m,p)=>{let h,b;return $e.has(d)?(h=m[d],b=p[d]):(h=m.data[d],b=p.data[d]),h==null&&b==null?0:(h==null?h=typeof b=="string"?"":0:typeof h=="boolean"&&(h=h?1:0),b==null?b=typeof h=="string"?"":0:typeof b=="boolean"&&(b=b?1:0),s&&(typeof h=="string"&&(h=h.toLowerCase()),typeof b=="string"&&(b=b.toLowerCase())),c==="desc"?h===b?0:h>b?-1:1:h===b?0:h>b?1:-1)};return this.sortChildren(g,o)}triggerModifyChild(e,t,n){this.logDebug(`modifyChild(${e})`,n,t),this.tree.options.modifyChild&&(t&&t.parent!==this&&$("child "+t+" is not a child of "+this),this._callEvent("modifyChild",W({operation:e,child:t},n)))}triggerModify(e,t){this.parent.triggerModifyChild(e,this,t)}visit(e,t=!1){let n=!0;const r=this.children;if(t===!0&&(n=e(this),n===!1||n==="skip"))return n;if(r)for(let s=0,o=r.length;s<o&&(n=r[s].visit(e,!0),n!==!1);s++);return n}visitParents(e,t=!1){if(t&&e(this)===!1)return!1;let n=this.parent;for(;n;){if(e(n)===!1)return!1;n=n.parent}return!0}visitSiblings(e,t=!1){const n=this.parent.children;for(let r=0,s=n.length;r<s;r++){const o=n[r];if((t||o!==this)&&e(o)===!1)return!1}return!0}isMatched(){return!(this.tree.filterMode&&!this.match)}}X.sequence=0;/*!
 * Wunderbaum - ext-edit
 * Copyright (c) 2021-2025, Martin Wendt. Released under the MIT license.
 * v0.13.0, Sat, 08 Mar 2025 14:16:31 GMT (https://github.com/mar10/wunderbaum)
 */class di extends fe{constructor(e){super(e,"edit",{debounce:100,minlength:1,maxlength:null,trigger:[],trim:!0,select:!0,slowClickDelay:1e3,validity:!0,beforeEdit:null,edit:null,apply:null}),this.curEditNode=null,this.relatedNode=null,this.debouncedOnChange=Ve(this._onChange.bind(this),this.getPluginOption("debounce"))}async _applyChange(e,t,n,r,s){return t.log(`_applyChange(${e})`,s),n.classList.add("wb-busy"),n.classList.remove("wb-error","wb-invalid"),r.setCustomValidity(""),new Promise((o,l)=>{const a=t._callEvent(e,s);Promise.resolve(a).then(c=>{o(c)}).catch(c=>{l(c)})}).then(o=>{if(!r.checkValidity())throw t.logWarn("inputElem.checkValidity() failed: throwing...."),new Je(r.validationMessage);return o}).catch(o=>{if(o instanceof Je)t.logWarn("catched ",o),n.classList.add("wb-invalid"),r.setCustomValidity&&!r.validationMessage&&r.setCustomValidity(o.message),r.validationMessage&&r.reportValidity();else throw t.logError(`Error in ${e} event handler (throw e.util.ValidationError instead if this was intended)`,o),n.classList.add("wb-error"),o}).finally(()=>{n.classList.remove("wb-busy")})}_onChange(e){const t=L.getEventInfo(e),n=t.node,r=t.colElem;if(!n||t.colIdx===0){this.tree.log("Ignored change event for removed element or node title");return}this._applyChange("change",n,r,e.target,{info:t,event:e,inputElem:e.target,inputValue:L.util.getValueFromElem(e.target),inputValid:e.target.checkValidity()})}init(){super.init(),R(this.tree.element,"change",".contenteditable,input,textarea,select",e=>this._onChange(e))}_preprocessKeyEvent(e){const t=e.event,n=Ee(t),r=this.tree,s=this.getPluginOption("trigger");if(this.isEditingTitle()){switch(n){case"Enter":return this._stopEditTitle(!0,{event:t}),!1;case"Escape":return this._stopEditTitle(!1,{event:t}),!1}return!1}if(r.isRowNav()||r.activeColIdx===0){switch(n){case"Enter":if(s.indexOf("macEnter")>=0&&at)return this.startEditTitle(),!1;break;case"F2":if(s.indexOf("F2")>=0)return this.startEditTitle(),!1;break}return!0}return!0}isEditingTitle(e){return e?this.curEditNode===e:!!this.curEditNode}startEditTitle(e){e=e??this.tree.getActiveNode();const t=this.getPluginOption("validity"),n=this.getPluginOption("select");if(!e)return;if(e.isStatusNode()){e.logWarn("Cannot edit status node.");return}this.tree.logDebug(`startEditTitle(node=${e})`);let r=e._callEvent("edit.beforeEdit");if(r===!1){e.logDebug("beforeEdit canceled operation.");return}if(r===!0||!r){const l=xe(e.title);let a=this.getPluginOption("maxlength");const c=a?` maxlength="${a}"`:"";a=this.getPluginOption("minlength");const u=a?` minlength="${a}"`:"",d=a>0?" required":"";r=`<input type=text class="wb-input-edit" tabindex=-1 value="${l}" autocorrect="off"${d}${u}${c} >`}const s=e.getColElem(0).querySelector(".wb-title");s.innerHTML=r;const o=s.firstElementChild;t&&o.addEventListener("keydown",l=>{o.setCustomValidity(""),o.reportValidity()||e.logWarn(`Invalid input: '${o.value}'`)}),o.focus(),n&&o.select(),this.curEditNode=e,e._callEvent("edit.edit",{inputElem:o})}stopEditTitle(e){return this._stopEditTitle(e,{})}_stopEditTitle(e,t){var n;t??(t={});const r=document.activeElement;let s=r?ct(r):null;const o=this.curEditNode,l=!!t.forceClose,a=this.getPluginOption("validity");if(s&&this.getPluginOption("trim")&&(s=s.trim()),!o){this.tree.logDebug("stopEditTitle: not in edit mode.");return}if(o.logDebug(`stopEditTitle(${e})`,t,r,s),e&&s!==null&&s!==o.title){const c=r.validationMessage;if(c)throw new Error(`Input validation failed for "${s}": ${c}.`);const u=o.getColElem(0);this._applyChange("edit.apply",o,u,r,{oldValue:o.title,newValue:s,inputElem:r,inputValid:r.checkValidity()}).then(d=>{var g;const m=r.validationMessage;if(a&&m&&d!==!1)throw new Error(`Edit apply validation failed for "${s}": ${m}.`);!l&&d===!1||(o==null||o.setTitle(s),(g=this.curEditNode)===null||g===void 0||g._render({preventScroll:!0}),this.curEditNode=null,this.relatedNode=null,this.tree.setFocus())})}else(n=this.curEditNode)===null||n===void 0||n._render({preventScroll:!0}),this.curEditNode=null,this.relatedNode=null,this.tree.setFocus()}createNode(e="after",t,n){const r=this.tree;if(t=t??r.getActiveNode(),w(t,"No node was passed, or no node is currently active."),e=e||"prependChild",n==null?n={title:""}:typeof n=="string"?n={title:n}:w(G(n),`Expected a plain object: ${n}`),(e==="prependChild"||e==="appendChild")&&(t!=null&&t.isExpandable(!0))){t.setExpanded().then(()=>{this.createNode(e,t,n)});return}const s=t.addNode(n,e);s.setClass("wb-edit-new"),this.relatedNode=t,s.match=-1,s.makeVisible({noAnimation:!0}).then(()=>{this.startEditTitle(s)})}}/*!
 * wunderbaum.ts
 *
 * A treegrid control.
 *
 * Copyright (c) 2021-2025, Martin Wendt (https://wwWendt.de).
 * https://github.com/mar10/wunderbaum
 *
 * Released under the MIT license.
 * @version v0.13.0
 * @date Sat, 08 Mar 2025 14:16:31 GMT
 */class ui extends X{constructor(e){super(e,null,{key:"__root__",title:e.id})}toString(){return`WbSystemRoot@${this.key}<'${this.tree.id}'>`}}class L{get activeNode(){var e;return!((e=this._activeNode)===null||e===void 0)&&e.tree?this._activeNode:null}get focusNode(){var e;return!((e=this._focusNode)===null||e===void 0)&&e.tree?this._focusNode:null}constructor(e){this.enabled=!0,this.data={},this.extensionList=[],this.extensions={},this.keyMap=new Map,this.refKeyMap=new Map,this.treeRowCount=0,this._disableUpdateCount=0,this._disableUpdateIgnoreCount=0,this._activeNode=null,this._focusNode=null,this.types={},this.columns=[],this._columnsById={},this.pendingChangeTypes=new Set,this._util=en,this.breadcrumb=null,this.filterMode=null,this.activeColIdx=0,this._cellNavMode=!1,this.lastQuicksearchTime=0,this.lastQuicksearchTerm="",this.lastClickTime=0;const t=this.options=W({id:null,source:null,element:null,debugLevel:ei,header:null,rowHeightPx:Nt,iconMap:"bootstrap",columns:null,types:null,enabled:!0,fixedCol:!1,showSpinner:!1,checkbox:!1,minExpandLevel:0,emptyChildListExpandable:!1,skeleton:!1,connectTopBreadcrumb:null,selectMode:"multi",navigationModeOption:null,quicksearch:!0,iconBadge:null,change:null,error:null,receive:null,strings:{loadError:"Error",loading:"Loading...",noData:"No data",breadcrumbDelimiter:" » ",queryResult:"Found ${matches} of ${count}",noMatch:"No results",matchIndex:"${match} of ${matches}"}},e),n=new nn;this.ready=n.promise();let r=!1;if(this.ready.then(()=>{r=!0;try{this._callEvent("init")}catch(o){this.logError("Exception inside `init(e)` event:",o)}}).catch(o=>{if(r)throw o;this._callEvent("init",{error:o})}),this.id=t.id||"wb_"+ ++L.sequence,this.root=new ui(this),this._registerExtension(new Qn(this)),this._registerExtension(new di(this)),this._registerExtension(new Wn(this)),this._registerExtension(new Jn(this)),this._registerExtension(new ci(this)),this._registerExtension(new Yn(this)),this._updateViewportThrottled=Zt(this._updateViewportImmediately.bind(this),{}),this.columns=t.columns,delete t.columns,!this.columns||!this.columns.length){const o=typeof t.header=="string"?t.header:this.id;this.columns=[{id:"*",title:o,width:"*"}]}t.types&&this.setTypes(t.types,!0),delete t.types,this.element=j(t.element),w(!!this.element,`Invalid 'element' option: ${t.element}`),this.element.classList.add("wunderbaum"),this.element.getAttribute("tabindex")||(this.element.tabIndex=0),t.rowHeightPx!==Nt&&(this.element.style.setProperty("--wb-row-outer-height",t.rowHeightPx+"px"),this.element.style.setProperty("--wb-row-inner-height",t.rowHeightPx-2+"px")),this.element._wb_tree=this,this.headerElement=this.element.querySelector("div.wb-header");const s=t.header==null?this.columns.length>1:!!t.header;if(this.headerElement){w(!this.columns,"`opts.columns` must not be set if table markup already contains a header"),this.columns=[];const o=this.headerElement.querySelector("div.wb-row");for(const l of o.querySelectorAll("div"))this.columns.push({id:l.dataset.id||`col_${this.columns.length}`,title:""+l.textContent,width:"*"})}else{const o="<span class='wb-col'></span>".repeat(this.columns.length);if(this.element.innerHTML=`
        <div class='wb-header'>
          <div class='wb-row'>
            ${o}
          </div>
        </div>`,!s){const l=this.element.querySelector("div.wb-header");l.style.display="none"}}this.element.innerHTML+=`
      <div class="wb-list-container">
        <div class="wb-node-list"></div>
      </div>`,this.listContainerElement=this.element.querySelector("div.wb-list-container"),this.nodeListElement=this.listContainerElement.querySelector("div.wb-node-list"),this.headerElement=this.element.querySelector("div.wb-header"),this.element.classList.toggle("wb-grid",this.columns.length>1),this.options.connectTopBreadcrumb&&(this.breadcrumb=j(this.options.connectTopBreadcrumb),w(!this.breadcrumb||this.breadcrumb.innerHTML!=null,`Invalid 'connectTopBreadcrumb' option: ${this.breadcrumb}.`),this.breadcrumb.addEventListener("click",o=>{const l=o.target;if(l&&l.matches("a.wb-breadcrumb")){const a=this.keyMap.get(l.dataset.key);a==null||a.setActive(),o.preventDefault()}})),this._initExtensions(),["enabled","fixedCol"].forEach(o=>{t[o]!=null&&this.setOption(o,t[o])}),t.source?(t.showSpinner&&(this.nodeListElement.innerHTML=`<progress class='spinner'>${t.strings.loading}</progress>`),this.load(t.source).then(()=>{t.navigationModeOption==null?this.isGrid()?this.setNavigationOption(z.cell):this.setNavigationOption(z.row):this.setNavigationOption(t.navigationModeOption),this.update(E.structure,{immediate:!0}),n.resolve()}).catch(o=>{n.reject(o)}).finally(()=>{var o;(o=this.element.querySelector("progress.spinner"))===null||o===void 0||o.remove(),this.element.classList.remove("wb-initializing")})):n.resolve(),this.update(E.any),this.element.addEventListener("scroll",o=>{this.update(E.scroll)}),this.resizeObserver=new ResizeObserver(o=>{this.update(E.resize)}),this.resizeObserver.observe(this.element),R(this.element,"click",".wb-button,.wb-col-icon",o=>{var l,a;const c=L.getEventInfo(o),u=(a=(l=o.target)===null||l===void 0?void 0:l.dataset)===null||a===void 0?void 0:a.command;this._callEvent("buttonClick",{event:o,info:c,command:u})}),R(this.nodeListElement,"click","div.wb-row",o=>{const l=L.getEventInfo(o),a=l.node,c=o;if(this._callEvent("click",{event:o,node:a,info:l})===!1)return this.lastClickTime=Date.now(),!1;if(a){if(c.ctrlKey){a.toggleSelected();return}const u=this.getOption("edit.trigger"),d=this.getOption("edit.slowClickDelay");u.indexOf("clickActive")>=0&&l.region==="title"&&a.isActive()&&(!d||Date.now()-this.lastClickTime<d)&&a.startEditTitle(),l.colIdx>=0?a.setActive(!0,{colIdx:l.colIdx,event:o}):a.setActive(!0,{event:o}),l.region===P.expander?a.setExpanded(!a.isExpanded(),{scrollIntoView:e.scrollIntoViewOnExpandClick!==!1}):l.region===P.checkbox&&a.toggleSelected()}this.lastClickTime=Date.now()}),R(this.nodeListElement,"dblclick","div.wb-row",o=>{const l=L.getEventInfo(o),a=l.node;if(this._callEvent("dblclick",{event:o,node:a,info:l})===!1)return!1;a&&l.colIdx===0&&a.isExpandable()&&l.region!==P.expander&&(this._callMethod("edit._stopEditTitle"),a.setExpanded(!a.isExpanded()))}),R(this.element,"keydown",o=>{const l=L.getEventInfo(o),a=Ee(o),c=l.node||this.getFocusNode();this._callHook("onKeyEvent",{event:o,node:c,info:l,eventName:a})}),R(this.element,"focusin focusout",o=>{const l=o.type==="focusin",a=L.getNode(o);this._callEvent("focus",{flag:l,event:o}),l&&this.isRowNav()&&!this.isEditingTitle()&&(t.navigationModeOption===z.row?a==null||a.setActive():this.setCellNav()),l||this._callMethod("edit._stopEditTitle",!0,{event:o,forceClose:!0})})}static getTree(e){if(e instanceof L)return e;if(e instanceof X)return e.tree;if(e===void 0&&(e=0),typeof e=="number")e=document.querySelectorAll(".wunderbaum")[e];else if(typeof e=="string"){for(const t of document.querySelectorAll(".wunderbaum")){const n=t._wb_tree;if(n&&n.id===e)return n}if(e=document.querySelector(e),!e)return null}else e.target&&(e=e.target);return w(e instanceof Element,`Invalid el type: ${e}`),e.matches(".wunderbaum")||(e=e.closest(".wunderbaum")),e&&e._wb_tree?e._wb_tree:null}get iconMap(){const e=this.options.iconMap;return typeof e=="string"?ii[e]:e}static getNode(e){if(e){if(e instanceof X)return e;e.target!==void 0&&(e=e.target)}else return null;for(;e;){if(e._wb_node)return e._wb_node;e=e.parentElement}return null}*[Symbol.iterator](){yield*this.root}_registerExtension(e){this.extensionList.push(e),this.extensions[e.id]=e}_initExtensions(){for(const e of this.extensionList)e.init()}_registerNode(e){const t=e.key;w(t!=null,`Missing key: '${e}'.`),w(!this.keyMap.has(t),`Duplicate key: '${t}': ${e}.`),this.keyMap.set(t,e);const n=e.refKey;if(n!=null){const r=this.refKeyMap.get(n);r?r.add(e):this.refKeyMap.set(n,new Set([e]))}}_unregisterNode(e){const t=e.refKey;if(t!=null){const n=this.refKeyMap.get(t);n&&n.delete(e)&&!n.size&&this.refKeyMap.delete(t)}this.keyMap.delete(e.key),e.tree=null,e.parent=null,e.removeMarkup()}_callHook(e,t={}){let n;const r=W({},{tree:this,options:this.options,result:void 0},t);for(const s of this.extensionList){if(n=s[e].call(s,r),n===!1)break;r.result!==void 0&&(n=r.result)}return n}_callMethod(e,...t){const[n,r]=e.split("."),s=r?this.extensions[n]:this,o=s[r];if(o)return o.apply(s,t);this.logError(`Calling undefined method '${e}()'.`)}_callEvent(e,t){const[n,r]=e.split("."),s=this.options,o=r?s[n][r]:s[n];if(o)return o.call(this,W({type:e,tree:this,util:this._util},t))}_getNodeByRowIdx(e){let t=null;return this.visitRows(n=>{if(n._rowIdx===e)return t=n,!1}),t}getTopmostVpNode(e=!0){const t=this.options.rowHeightPx,n=1,s=this.element.scrollTop;let o;return e?o=Math.ceil((s-n)/t):o=Math.floor(s/t),this._getNodeByRowIdx(o)}getLowestVpNode(e=!0){const t=this.options.rowHeightPx,n=this.element,r=this.headerElement.clientHeight,s=n.scrollTop,o=n.clientHeight-r;let l;return e?l=Math.floor((s+o)/t)-1:l=Math.ceil((s+o)/t)-1,l=Math.min(l,this.count(!0)-1),this._getNodeByRowIdx(l)}_getNextNodeInView(e,t){let n=(t==null?void 0:t.ofs)||1;const r=!!(t!=null&&t.reverse);return this.visitRows(s=>{if(e=s,t!=null&&t.cb&&t.cb(s)||n--<=0)return!1},{reverse:r,start:e||this.getActiveNode()}),e}addChildren(e,t){return this.root.addChildren(e,t)}applyCommand(e,t,n){let r,s;switch(t instanceof X?r=t:(r=this.getActiveNode(),w(n===void 0,`Unexpected options: ${n}`),n=t),e){case"moveUp":s=r.getPrevSibling(),s&&(r.moveTo(s,"before"),r.setActive());break;case"moveDown":s=r.getNextSibling(),s&&(r.moveTo(s,"after"),r.setActive());break;case"indent":s=r.getPrevSibling(),s&&(r.moveTo(s,"appendChild"),s.setExpanded(),r.setActive());break;case"outdent":r.isTopLevel()||(r.moveTo(r.getParent(),"after"),r.setActive());break;case"remove":s=r.getPrevSibling()||r.getParent(),r.remove(),s&&s.setActive();break;case"addChild":this._callMethod("edit.createNode","prependChild");break;case"addSibling":this._callMethod("edit.createNode","after");break;case"rename":r.startEditTitle();break;case"down":case"first":case"last":case"left":case"nextMatch":case"pageDown":case"pageUp":case"parent":case"prevMatch":case"right":case"up":return r.navigate(e);default:$(`Unhandled command: '${e}'`)}}clear(){this.root.removeChildren(),this.root.children=null,this.keyMap.clear(),this.refKeyMap.clear(),this.treeRowCount=0,this._activeNode=null,this._focusNode=null,this.update(E.structure)}destroy(){this.logInfo("destroy()..."),this.clear(),this.resizeObserver.disconnect(),this.element.innerHTML="",this.element.outerHTML=this.element.outerHTML}getOption(e,t){let n,r=this.options;e.indexOf(".")>=0&&([n,e]=e.split("."),r=r[n]);let s=r[e];return typeof s=="function"&&(s=s({type:"resolve",tree:this})),s??t}setOption(e,t){if(e.indexOf(".")>=0){const n=e.split(".");this.extensions[n[0]].setPluginOption(n[1],t);return}switch(this.options[e]=t,e){case"checkbox":this.update(E.any);break;case"enabled":this.setEnabled(!!t);break;case"fixedCol":this.element.classList.toggle("wb-fixed-col",!!t);break}}hasFocus(){return this.element.contains(document.activeElement)}hasHeader(){const e=this.options.header;return this.isGrid()?e!==!1:!!e}runWithDeferredUpdate(e,t=null){try{this.enableUpdate(!1);const n=e();return w(!(n instanceof Promise),`Promise return not allowed: ${n}`),n}finally{this.enableUpdate(!0)}}async expandAll(e=!0,t){await this.root.expandAll(e,t)}selectAll(e=!0){return this.root.setSelected(e,{propagateDown:!0})}toggleSelect(){this.selectAll(this.root._anySelectable())}getSelectedNodes(e=!1){return this.root.getSelectedNodes(e)}_selectRange(e){this.logDebug("_selectRange",e),$("Not yet implemented.")}count(e=!1){return e?this.treeRowCount:this.keyMap.size}countUnique(){return this.refKeyMap.size}_check(){let e=0;this.visit(t=>{e++}),this.keyMap.size!==e&&this.logWarn(`_check failed: ${this.keyMap.size} !== ${e}`)}findAll(e){return this.root.findAll(e)}findByRefKey(e){const t=this.refKeyMap.get(e);return t?Array.from(t):[]}findFirst(e){return this.root.findFirst(e)}findKey(e){return this.keyMap.get(e)||null}findNextNode(e,t,n=!1){let r=null;const s=this.getFirstChild(),o=n?this.findRelatedNode(s,"last"):null,l=typeof e=="string"?oi(e):e;t=t||(n?o:s);function a(c){if(l(c)&&(r=c),r||c===t)return!1}return this.visitRows(a,{start:t,includeSelf:!1,reverse:n}),!r&&t!==s&&this.visitRows(a,{start:n?o:s,includeSelf:!0,reverse:n}),r}findRelatedNode(e,t,n=!1){const r=this.options.rowHeightPx;let s=null;const o=Math.floor(this.listContainerElement.clientHeight/r);switch(t){case"parent":e.parent&&e.parent.parent&&(s=e.parent);break;case"first":this.visit(l=>{if(l.isVisible())return s=l,!1});break;case"last":this.visit(l=>{l.isVisible()&&(s=l)});break;case"left":e.parent&&e.parent.parent&&(s=e.parent);break;case"right":e.children&&e.children.length&&(s=e.children[0]);break;case"up":s=this._getNextNodeInView(e,{reverse:!0});break;case"down":s=this._getNextNodeInView(e);break;case"pageDown":{const l=this.getLowestVpNode();e._rowIdx<l._rowIdx?s=l:s=this._getNextNodeInView(e,{reverse:!1,ofs:o})}break;case"pageUp":if(e._rowIdx===0)s=e;else{const l=this.getTopmostVpNode();e._rowIdx>l._rowIdx?s=l:s=this._getNextNodeInView(e,{reverse:!0,ofs:o})}break;case"prevMatch":case"nextMatch":if(!this.isFilterActive){this.logWarn(`${t}: Filter is not active.`);break}s=this.findNextNode(l=>l.isMatched(),e,t==="prevMatch"),s==null||s.setActive();break;default:this.logWarn("Unknown relation '"+t+"'.")}return s}*format_iter(e,t){yield*this.root.format_iter(e,t)}format(e,t){return this.root.format(e,t)}getActiveColElem(){return this.activeNode&&this.activeColIdx>=0?this.activeNode.getColElem(this.activeColIdx):null}getActiveNode(){return this.activeNode}getFirstChild(){return this.root.getFirstChild()}getLastChild(){return this.root.getLastChild()}getFocusNode(){return this.focusNode}static getEventInfo(e){const t=e.target,n=t.classList,r=t.closest("span.wb-col"),s=L.getNode(t),o=s?s.tree:L.getTree(e),l={event:e,canonicalName:Ee(e),tree:o,node:s,region:P.unknown,colDef:void 0,colIdx:-1,colId:void 0,colElem:r};if(n.contains("wb-title"))l.region=P.title;else if(n.contains("wb-expander"))l.region=s.isExpandable()?P.expander:P.prefix;else if(n.contains("wb-checkbox"))l.region=P.checkbox;else if(n.contains("wb-icon"))l.region=P.icon;else if(n.contains("wb-node"))l.region=P.title;else if(r){l.region=P.column;const a=Array.prototype.indexOf.call(r.parentNode.children,r);l.colIdx=a}else if(n.contains("wb-row"))l.region=P.title;else return e.type!=="mousemove"&&!(e instanceof KeyboardEvent)&&(o==null||o.logWarn("getEventInfo(): not found",e,l)),l;return l.colIdx===-1&&(l.colIdx=0),l.colDef=o==null?void 0:o.columns[l.colIdx],l.colDef!=null&&(l.colId=l.colDef.id),l}toString(){return`Wunderbaum<'${this.id}'>`}isEditing(){return!!this.nodeListElement.querySelector("input:focus,select:focus")}isEditingTitle(){return this._callMethod("edit.isEditingTitle")}isLoading(){let e=!1;return this.root.visit(t=>{if(t._isLoading||t._requestId)return e=!0,!1},!0),e}log(...e){this.options.debugLevel>=4&&console.log(this.toString(),...e)}logDebug(...e){this.options.debugLevel>=4&&console.debug(this.toString(),...e)}logError(...e){this.options.debugLevel>=1&&console.error(this.toString(),...e)}logInfo(...e){this.options.debugLevel>=3&&console.info(this.toString(),...e)}logTime(e){return this.options.debugLevel>=4&&console.time(this+": "+e),e}logTimeEnd(e){this.options.debugLevel>=4&&console.timeEnd(this+": "+e)}logWarn(...e){this.options.debugLevel>=2&&console.warn(this.toString(),...e)}resetColumns(){this.columns.forEach(e=>{delete e.customWidthPx}),this.update(E.colStructure)}scrollTo(e){let n,r;e instanceof X?n=e:(r=e,n=r.node),w(n&&n._rowIdx!=null,`Invalid node: ${n}`);const s=this.options.rowHeightPx,o=this.element,l=this.headerElement.clientHeight,a=o.scrollTop,c=o.clientHeight,u=n._rowIdx*s+l,d=l,g=u-a,m=g+s,p=r==null?void 0:r.topNode;let h=null;g>=d?m<=c||(h=u+s-c+2):h=u-d-2,h!=null&&(this.log(`scrollTo(${u}): ${a} => ${h}`),o.scrollTop=h,p&&this.scrollTo(p))}scrollToHorz(){const e=this.columns[0]._widthPx,t=this.element.clientWidth,n=this.element.scrollLeft,r=this.getActiveColElem(),s=Number.parseInt(r==null?void 0:r.style.left,10),o=s+Number.parseInt(r==null?void 0:r.style.width,10);let l=n;s-n<e?l=s-e:o-n>t&&(l=o-t),l=Math.max(0,l),this.log(`scrollToHorz(${this.activeColIdx}): ${s}..${o}, fixedOfs=${e}, vpWidth=${t}, curLeft=${n} -> ${l}`),this.element.scrollLeft=l}setColumn(e,t){var n,r,s;const o=t==null?void 0:t.edit,l=(t==null?void 0:t.scrollIntoView)!==!1;if(w(this.isCellNav(),"Expected cellNav mode"),typeof e=="string"){const a=e;e=this.columns.findIndex(c=>c.id===e),w(e>=0,`Invalid colId: ${a}`)}if(w(0<=e&&e<this.columns.length,`Invalid colIdx: ${e}`),this.activeColIdx=e,this.hasHeader())for(const a of this.headerElement.children){let c=0;for(const u of a.children)u.classList.toggle("wb-active",c++===e)}(n=this.activeNode)===null||n===void 0||n.update(E.status);for(const a of this.nodeListElement.children){let c=0;for(const u of a.children)u.classList.toggle("wb-active",c++===e)}(l||o)&&this.scrollToHorz(),o&&this.activeNode&&(e===0?this.activeNode.startEditTitle():(s=(r=this.getActiveColElem())===null||r===void 0?void 0:r.querySelector("input,select"))===null||s===void 0||s.focus())}_setActiveNode(e){this._activeNode=e}setActiveNode(e,t=!0,n){var r;(r=this.findKey(e))===null||r===void 0||r.setActive(t,n)}setFocus(e=!0){e?this.element.focus():this.element.blur()}_setFocusNode(e){this._focusNode=e}getState(e){var t,n;let r;if(e.expandedKeys!==!1){r=[];for(const o of this)o.expanded&&r.push(o.key)}return{activeKey:(n=(t=this.activeNode)===null||t===void 0?void 0:t.key)!==null&&n!==void 0?n:null,activeColIdx:this.activeColIdx,selectedKeys:e.selectedKeys===!1?void 0:this.getSelectedNodes().flatMap(o=>o.key),expandedKeys:r}}setState(e,t){this.runWithDeferredUpdate(()=>{var n,r;if(e.selectedKeys){this.selectAll(!1);for(const s of e.selectedKeys)(n=this.findKey(s))===null||n===void 0||n.setSelected(!0)}if(e.expandedKeys)for(const s of e.expandedKeys)(r=this.findKey(s))===null||r===void 0||r.setExpanded(!0);e.activeKey&&this.setActiveNode(e.activeKey),e.activeColIdx!=null&&this.setColumn(e.activeColIdx)})}update(e,t,n){t instanceof X||(n=t,t=void 0);const r=!!Me(n,"immediate"),s=Le,o=this.pendingChangeTypes;if(this._disableUpdateCount){this._disableUpdateIgnoreCount++;return}switch(e){case E.any:case E.colStructure:o.add(s.header),o.add(s.clearMarkup),o.add(s.redraw),o.add(s.scroll);break;case E.resize:o.add(s.header),o.add(s.redraw);break;case E.structure:o.add(s.redraw);break;case E.scroll:o.add(s.scroll);break;case E.row:case E.data:case E.status:w(t,`Option '${e}' requires a node.`),t._rowElem&&t._render({change:e});break;default:$(`Invalid change type '${e}'.`)}if(e===E.colStructure){const l=this.isGrid();this.element.classList.toggle("wb-grid",l),!l&&this.isCellNav()&&this.setCellNav(!1)}o.size>0&&(r?this._updateViewportImmediately():this._updateViewportThrottled())}setEnabled(e=!0){const t=this.enabled;return this.enabled=!!e,this.element.classList.toggle("wb-disabled",!e),t}isEnabled(){return this.enabled}isGrid(){return this.columns&&this.columns.length>1}isCellNav(){return!!this._cellNavMode}isRowNav(){return!this._cellNavMode}setCellNav(e=!0){var t;const n=this._cellNavMode;this._cellNavMode=!!e,e&&!n&&this.setColumn(0),this.element.classList.toggle("wb-cell-mode",e),(t=this.activeNode)===null||t===void 0||t.update(E.status)}setNavigationOption(e,t=!1){if(!this.isGrid()&&e!==z.row){this.logWarn("Plain trees only support row navigation mode.");return}switch(this.options.navigationModeOption=e,e){case z.cell:this.setCellNav(!0);break;case z.row:this.setCellNav(!1);break;case z.startCell:t&&this.setCellNav(!0);break;case z.startRow:t&&this.setCellNav(!1);break;default:$(`Invalid mode '${e}'.`)}}setStatus(e,t){return this.root.setStatus(e,t)}setTypes(e,t=!0){w(G(e),`Expected plain objext: ${e}`),t?this.types=e:W(this.types,e);for(const n of Object.values(this.types))n.classes&&(n.classes=Ke(n.classes))}sortChildren(e=et,t=!1){this.root.sortChildren(e,t)}sortByProperty(e){this.root.sortByProperty(e)}toDictArray(e){var t;return(t=this.root.toDict(!0,e).children)!==null&&t!==void 0?t:[]}_updateColumnWidths(){const t=this.element.clientWidth,n=1,r=this.columns,s=r[0];let o=0,l=0,a=0,c=!1;if(s.id!=="*")throw new Error(`First column must have  id '*': got '${s.id}'.`);this._columnsById={};for(const m of r){this._columnsById[m.id]=m;const p=m.customWidthPx?`${m.customWidthPx}px`:m.width;if(m.id==="*"&&m!==s)throw new Error(`Column id '*' must be defined only once: '${m.title}'.`);if(!p||p==="*")m._weight=1,l+=1;else if(typeof p=="number")m._weight=p,l+=p;else if(typeof p=="string"&&p.endsWith("px")){m._weight=0;const h=parseFloat(p.slice(0,-2));m._widthPx!=h&&(c=!0,m._widthPx=h),a+=h}else $(`Invalid column width: ${p} (expected string ending with 'px' or number, e.g. "<num>px" or <int>).`)}const u=Math.max(0,t-a);let d=0;for(const m of r){let p;if(m._weight){const h=m.minWidth;typeof h=="number"?p=h:typeof h=="string"&&h.endsWith("px")?p=parseFloat(h.slice(0,-2)):p=4;const b=Math.max(p,u*m._weight/l);m._widthPx!=b&&(c=!0,m._widthPx=b)}m._ofsPx=d,d+=m._widthPx}r[r.length-1]._widthPx-=n,o=d-n;const g=`${o}px`;return this.headerElement.style.width=g,this.listContainerElement.style.width=g,c}_renderHeaderMarkup(){w(this.headerElement,"Expected a headerElement");const e=this.hasHeader();if(Xt(this.headerElement,e),!e)return;const t=this.iconMap,n=this.columns.length,r=this.headerElement.querySelector(".wb-row");w(r,"Expected a row in header element"),r.innerHTML="<span class='wb-col'></span>".repeat(n);for(let s=0;s<n;s++){const o=this.columns[s],l=r.children[s];l.style.left=o._ofsPx+"px",l.style.width=o._widthPx+"px",typeof o.headerClasses=="string"?o.headerClasses&&l.classList.add(...o.headerClasses.split(" ")):o.classes&&l.classList.add(...o.classes.split(" "));let a="";o.tooltip&&(a=Wt(o.tooltip),a=` title="${a}"`);let c="";if(ce(o.menu,this.options.columnsMenu,!1)){const g=`<i data-command=menu class="wb-col-icon ${"wb-col-icon-menu "+t.colMenu}"></i>`;c+=g}if(ce(o.sortable,this.options.columnsSortable,!1)){let d="wb-col-icon-sort "+t.colSortable;o.sortOrder&&(d+=`wb-col-sort-${o.sortOrder}`,d+=o.sortOrder==="asc"?t.colSortAsc:t.colSortDesc);const g=`<i data-command=sort class="wb-col-icon ${d}"></i>`;c+=g}if(ce(o.filterable,this.options.columnsFilterable,!1)){l.classList.toggle("wb-col-filter",!!o.filterActive);let d="wb-col-icon-filter "+t.colFilter;o.filterActive&&(d+=t.colFilterActive);const g=`<i data-command=filter class="wb-col-icon ${d}"></i>`;c+=g}s<n-1&&(ce(o.resizable,this.options.columnsResizable,!1)?c+='<span class="wb-col-resizer wb-col-resizer-active"></span>':c+='<span class="wb-col-resizer"></span>');const u=xe(o.title||o.id);l.innerHTML=`<span class="wb-col-title"${a}>${u}</span>${c}`,this.isCellNav()&&l.classList.toggle("wb-active",s===this.activeColIdx)}}updatePendingModifications(){this.pendingChangeTypes.size>0&&this._updateViewportImmediately()}_createNodeIcon(e,t,n){const r=this.iconMap;let s,o=e.getOption("icon");if(e._errorInfo?o=r.error:e._isLoading&&t&&(o=r.loading),o===!1)return null;typeof o=="string"||(e.statusNodeType?o=r[e.statusNodeType]:e.expanded?o=r.folderOpen:e.children?o=r.folder:e.lazy?o=r.folderLazy:o=r.doc),o?o.indexOf("<")>=0?s=Ie(o):tn.test(o)?s=Ie(`<i class="wb-icon" style="background-image: url('${o}');">`):(s=document.createElement("i"),s.className="wb-icon "+o):(s=document.createElement("i"),s.className="wb-icon");const l=n&&e._callEvent("iconBadge",{iconSpan:s});let a=null;if(l!=null&&l!==!1){let c="",u="";G(l)?(a=""+l.badge,c=l.badgeClass?" "+l.badgeClass:"",u=l.badgeTooltip?` title="${l.badgeTooltip}"`:""):typeof l=="number"?a=""+l:a=l,typeof a=="string"&&(a=Ie(`<span class="wb-badge${c}"${u}>${xe(a)}</span>`)),a&&s.append(a)}return s}_updateTopBreadcrumb(){const e=this.breadcrumb,t=this.getTopmostVpNode(!0),n=t==null?void 0:t.getParentList(!1,!1);if(n!=null&&n.length){e.innerHTML="";for(const r of t.getParentList(!1,!1)){const s=this._createNodeIcon(r,!1,!1);s&&e.append(s," ");const o=document.createElement("a");o.textContent=r.title,o.href="#",o.classList.add("wb-breadcrumb"),o.dataset.key=r.key,e.append(o,this.options.strings.breadcrumbDelimiter)}}else e.innerHTML="&nbsp;"}_updateViewportImmediately(){if(this._disableUpdateCount){this.log(`_updateViewportImmediately() IGNORED (disable level: ${this._disableUpdateCount}).`),this._disableUpdateIgnoreCount++;return}this._updateViewportThrottled.pending()&&this._updateViewportThrottled.cancel();const e=1,t=Le,n=new Set(this.pendingChangeTypes);if(this.pendingChangeTypes.clear(),n.has(t.scroll)&&n.size===1)this._updateRows({newNodesOnly:!0});else{if(this.log("_updateViewportImmediately():",n),this.options.adjustHeight!==!1){let s=this.listContainerElement.clientHeight;const o=this.headerElement.clientHeight,l=this.element.clientHeight-o-e;Math.abs(s-l)>1&&(this.listContainerElement.style.height=l+"px",s=l)}n.has(t.clearMarkup)&&this.visit(s=>{s.removeMarkup()}),n.has(t.header)&&(this._updateColumnWidths(),this._renderHeaderMarkup()),this._updateRows()}this.breadcrumb&&this._updateTopBreadcrumb(),this._callEvent("update")}_updateRows(e){e=Object.assign({newNodesOnly:!1},e);const t=!!e.newNodesOnly,n=this.options.rowHeightPx,r=this.element.clientHeight,s=ti,o=this.element.scrollTop;let l=Math.max(0,o/n-s);l=Math.floor(l),l%2&&l--;let a=Math.max(0,(o+r)/n+s);a=Math.ceil(a);const c=new Set;this.nodeListElement.childNodes.forEach(p=>{p._wb_node&&c.add(p._wb_node)});let u=0,d=0,g=!1,m="first";this.visitRows(function(p){const h=p._rowElem;p._rowIdx!==u&&(p._rowIdx=u,g=!0),u<l||u>a?h&&(m=h):h&&t?(c.delete(p),h.style.top=u*n+"px",m=h):(c.delete(p),h&&(h.style.top=u*n+"px"),p._render({top:d,after:m}),m=p._rowElem),u++,d+=n}),this.treeRowCount=u;for(const p of c)p._callEvent("discard"),p.removeMarkup();return this.nodeListElement.style.height=`${d}px`,g}visit(e){return this.root.visit(e,!1)}visitRows(e,t){if(!this.root.hasChildren())return!1;if(t&&t.reverse)return delete t.reverse,this._visitRowsUp(e,t);t=t||{};let n,r,s,o,l,a,c=0,u=t.includeSelf===!1,d=t.start||this.root.children[0];const g=!!t.includeHidden,m=!g&&this.filterMode==="hide";for(s=d.parent;s;){for(l=s.children,r=l.indexOf(d)+c,w(r>=0,`Could not find ${d} in parent's children: ${s}`),n=r;n<l.length;n++){if(d=l[n],d===a)return!1;if(!(m&&!d.statusNodeType&&!d.match&&!d.subMatchCount)&&(!u&&e(d)===!1||(u=!1,d.children&&d.children.length&&(g||d.expanded)&&(o=d.visit(p=>{if(p===a)return!1;if(m&&!p.match&&!p.subMatchCount)return"skip";if(e(p)===!1)return!1;if(!g&&p.children&&!p.expanded)return"skip"},!1),o===!1))))return!1}d=s,s=s.parent,c=1,!s&&t.wrap&&(this.logDebug("visitRows(): wrap around"),w(t.start,"`wrap` option requires `start`"),a=t.start,t.wrap=!1,s=this.root,c=0)}return!0}_visitRowsUp(e,t){let n,r,s,o=t.start||this.root.children[0];const l=!!t.includeHidden;if(t.includeSelf!==!1&&e(o)===!1)return!1;for(;;){if(s=o.parent,n=s.children,n[0]===o){if(o=s,!o.parent)break;n=s.children}else for(r=n.indexOf(o),o=n[r-1];(l||o.expanded)&&o.children&&o.children.length;)n=o.children,s=o,o=n[n.length-1];if(!(!l&&!o.isVisible())&&e(o)===!1)return!1}return!0}load(e){return this.clear(),this.root.load(e)}enableUpdate(e){e?(w(this._disableUpdateCount>0,"enableUpdate(true) was called too often"),this._disableUpdateCount--,this._disableUpdateCount===0&&(this.logDebug(`enableUpdate(): active again. Re-painting to catch up with ${this._disableUpdateIgnoreCount} ignored update requests...`),this._disableUpdateIgnoreCount=0,this.update(E.any,{immediate:!0}))):this._disableUpdateCount++}filterNodes(e,t){return this.extensions.filter.filterNodes(e,t)}countMatches(){return this.extensions.filter.countMatches()}filterBranches(e,t){return this.extensions.filter.filterBranches(e,t)}clearFilter(){return this.extensions.filter.clearFilter()}isFilterActive(){return!!this.filterMode}updateFilter(){return this.extensions.filter.updateFilter()}}L.sequence=0;L.version="v0.13.0";L.util=en;function fi(i,e=2){if(i===0)return"0 Bytes";const t=1024,n=e<0?0:e,r=["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],s=Math.floor(Math.log(i)/Math.log(t));return`${parseFloat((i/Math.pow(t,s)).toFixed(n))} ${r[s]}`}const Zs=({mount:i,...e})=>{var r;const t=document.getElementById(i);t.replaceChildren();const n=[{id:"*",title:"Path",width:"300px"},{id:"childCount",title:"Count",width:"95px",classes:"wb-numeric"},{id:"size",title:"Size",width:"120px",classes:"wb-numeric"}];return((r=e.source)==null?void 0:r[0]).cid&&n.push({id:"cid",title:"CID",width:"200px"}),new L({element:t,selectMode:"hier",checkbox:!0,columnsFilterable:!0,columnsResizable:!0,columnsSortable:!0,columnsMenu:!0,fixedCol:!1,columns:n,render:s=>{const{node:o}=s;for(const l of Object.values(s.renderColInfosById))if(l.elem){let a=o.data[l.id];a&&l.id==="size"&&(a=fi(a)),typeof a=="number"&&(a=a.toLocaleString()),a&&l.id==="cid"&&(a=`${a.slice(0,10)}…${a.slice(-13)}`),l.elem.textContent=a}},...e})};function eo(i){const e=t=>{t.selected=!0;for(const n of t.children??[])e(n);return t};return i.map(t=>e(t))}const hi=["string","number","bigint","symbol"],pi=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function gi(i){if(i===null)return"null";if(i===void 0)return"undefined";if(i===!0||i===!1)return"boolean";const e=typeof i;if(hi.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(i))return"Array";if(mi(i))return"Buffer";const t=yi(i);return t||"Object"}function mi(i){return i&&i.constructor&&i.constructor.isBuffer&&i.constructor.isBuffer.call(null,i)}function yi(i){const e=Object.prototype.toString.call(i).slice(8,-1);if(pi.includes(e))return e}class f{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}f.uint=new f(0,"uint",!0);f.negint=new f(1,"negint",!0);f.bytes=new f(2,"bytes",!0);f.string=new f(3,"string",!0);f.array=new f(4,"array",!1);f.map=new f(5,"map",!1);f.tag=new f(6,"tag",!1);f.float=new f(7,"float",!0);f.false=new f(7,"false",!0);f.true=new f(7,"true",!0);f.null=new f(7,"null",!0);f.undefined=new f(7,"undefined",!0);f.break=new f(7,"break",!0);class v{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const he=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",wi=new TextDecoder,vi=new TextEncoder;function Oe(i){return he&&globalThis.Buffer.isBuffer(i)}function sn(i){return i instanceof Uint8Array?Oe(i)?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):i:Uint8Array.from(i)}const bi=he?(i,e,t)=>t-e>64?globalThis.Buffer.from(i.subarray(e,t)).toString("utf8"):At(i,e,t):(i,e,t)=>t-e>64?wi.decode(i.subarray(e,t)):At(i,e,t),xi=he?i=>i.length>64?globalThis.Buffer.from(i):It(i):i=>i.length>64?vi.encode(i):It(i),J=i=>Uint8Array.from(i),ft=he?(i,e,t)=>Oe(i)?new Uint8Array(i.subarray(e,t)):i.slice(e,t):(i,e,t)=>i.slice(e,t),Ei=he?(i,e)=>(i=i.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),sn(globalThis.Buffer.concat(i,e))):(i,e)=>{const t=new Uint8Array(e);let n=0;for(let r of i)n+r.length>t.length&&(r=r.subarray(0,t.length-n)),t.set(r,n),n+=r.length;return t},_i=he?i=>globalThis.Buffer.allocUnsafe(i):i=>new Uint8Array(i);function ki(i,e){if(Oe(i)&&Oe(e))return i.compare(e);for(let t=0;t<i.length;t++)if(i[t]!==e[t])return i[t]<e[t]?-1:1;return 0}function It(i){const e=[];let t=0;for(let n=0;n<i.length;n++){let r=i.charCodeAt(n);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&n+1<i.length&&(i.charCodeAt(n+1)&64512)===56320?(r=65536+((r&1023)<<10)+(i.charCodeAt(++n)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e}function At(i,e,t){const n=[];for(;e<t;){const r=i[e];let s=null,o=r>239?4:r>223?3:r>191?2:1;if(e+o<=t){let l,a,c,u;switch(o){case 1:r<128&&(s=r);break;case 2:l=i[e+1],(l&192)===128&&(u=(r&31)<<6|l&63,u>127&&(s=u));break;case 3:l=i[e+1],a=i[e+2],(l&192)===128&&(a&192)===128&&(u=(r&15)<<12|(l&63)<<6|a&63,u>2047&&(u<55296||u>57343)&&(s=u));break;case 4:l=i[e+1],a=i[e+2],c=i[e+3],(l&192)===128&&(a&192)===128&&(c&192)===128&&(u=(r&15)<<18|(l&63)<<12|(a&63)<<6|c&63,u>65535&&u<1114112&&(s=u))}}s===null?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|s&1023),n.push(s),e+=o}return Ci(n)}const Dt=4096;function Ci(i){const e=i.length;if(e<=Dt)return String.fromCharCode.apply(String,i);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,i.slice(n,n+=Dt));return t}const Ni=256;class on{constructor(e=Ni){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){const r=t.length-(this.maxCursor-this.cursor)-1;r<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,r),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=_i(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=ft(n,0,this.cursor)}else t=Ei(this.chunks,this.cursor);return e&&this.reset(),t}}const C="CBOR decode error:",ln="CBOR encode error:";function pe(i,e,t){if(i.length-e<t)throw new Error(`${C} not enough data for type`)}const O=[24,256,65536,4294967296,BigInt("18446744073709551616")];function re(i,e,t){pe(i,e,1);const n=i[e];if(t.strict===!0&&n<O[0])throw new Error(`${C} integer encoded in more bytes than necessary (strict decode)`);return n}function se(i,e,t){pe(i,e,2);const n=i[e]<<8|i[e+1];if(t.strict===!0&&n<O[1])throw new Error(`${C} integer encoded in more bytes than necessary (strict decode)`);return n}function oe(i,e,t){pe(i,e,4);const n=i[e]*16777216+(i[e+1]<<16)+(i[e+2]<<8)+i[e+3];if(t.strict===!0&&n<O[2])throw new Error(`${C} integer encoded in more bytes than necessary (strict decode)`);return n}function le(i,e,t){pe(i,e,8);const n=i[e]*16777216+(i[e+1]<<16)+(i[e+2]<<8)+i[e+3],r=i[e+4]*16777216+(i[e+5]<<16)+(i[e+6]<<8)+i[e+7],s=(BigInt(n)<<BigInt(32))+BigInt(r);if(t.strict===!0&&s<O[3])throw new Error(`${C} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(t.allowBigInt===!0)return s;throw new Error(`${C} integers outside of the safe integer range are not supported`)}function Ti(i,e,t,n){return new v(f.uint,re(i,e+1,n),2)}function Si(i,e,t,n){return new v(f.uint,se(i,e+1,n),3)}function Ii(i,e,t,n){return new v(f.uint,oe(i,e+1,n),5)}function Ai(i,e,t,n){return new v(f.uint,le(i,e+1,n),9)}function ae(i,e){return V(i,0,e.value)}function V(i,e,t){if(t<O[0]){const n=Number(t);i.push([e|n])}else if(t<O[1]){const n=Number(t);i.push([e|24,n])}else if(t<O[2]){const n=Number(t);i.push([e|25,n>>>8,n&255])}else if(t<O[3]){const n=Number(t);i.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{const n=BigInt(t);if(n<O[4]){const r=[e|27,0,0,0,0,0,0,0];let s=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));r[8]=s&255,s=s>>8,r[7]=s&255,s=s>>8,r[6]=s&255,s=s>>8,r[5]=s&255,r[4]=o&255,o=o>>8,r[3]=o&255,o=o>>8,r[2]=o&255,o=o>>8,r[1]=o&255,i.push(r)}else throw new Error(`${C} encountered BigInt larger than allowable range`)}}ae.encodedSize=function(e){return V.encodedSize(e.value)};V.encodedSize=function(e){return e<O[0]?1:e<O[1]?2:e<O[2]?3:e<O[3]?5:9};ae.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function Di(i,e,t,n){return new v(f.negint,-1-re(i,e+1,n),2)}function Mi(i,e,t,n){return new v(f.negint,-1-se(i,e+1,n),3)}function Li(i,e,t,n){return new v(f.negint,-1-oe(i,e+1,n),5)}const ht=BigInt(-1),an=BigInt(1);function $i(i,e,t,n){const r=le(i,e+1,n);if(typeof r!="bigint"){const s=-1-r;if(s>=Number.MIN_SAFE_INTEGER)return new v(f.negint,s,9)}if(n.allowBigInt!==!0)throw new Error(`${C} integers outside of the safe integer range are not supported`);return new v(f.negint,ht-BigInt(r),9)}function pt(i,e){const t=e.value,n=typeof t=="bigint"?t*ht-an:t*-1-1;V(i,e.type.majorEncoded,n)}pt.encodedSize=function(e){const t=e.value,n=typeof t=="bigint"?t*ht-an:t*-1-1;return n<O[0]?1:n<O[1]?2:n<O[2]?3:n<O[3]?5:9};pt.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function Ce(i,e,t,n){pe(i,e,t+n);const r=ft(i,e+t,e+t+n);return new v(f.bytes,r,t+n)}function Oi(i,e,t,n){return Ce(i,e,1,t)}function Bi(i,e,t,n){return Ce(i,e,2,re(i,e+1,n))}function Pi(i,e,t,n){return Ce(i,e,3,se(i,e+1,n))}function zi(i,e,t,n){return Ce(i,e,5,oe(i,e+1,n))}function Fi(i,e,t,n){const r=le(i,e+1,n);if(typeof r=="bigint")throw new Error(`${C} 64-bit integer bytes lengths not supported`);return Ce(i,e,9,r)}function Be(i){return i.encodedBytes===void 0&&(i.encodedBytes=i.type===f.string?xi(i.value):i.value),i.encodedBytes}function qe(i,e){const t=Be(e);V(i,e.type.majorEncoded,t.length),i.push(t)}qe.encodedSize=function(e){const t=Be(e);return V.encodedSize(t.length)+t.length};qe.compareTokens=function(e,t){return Ui(Be(e),Be(t))};function Ui(i,e){return i.length<e.length?-1:i.length>e.length?1:ki(i,e)}function Ne(i,e,t,n,r){const s=t+n;pe(i,e,s);const o=new v(f.string,bi(i,e+t,e+s),s);return r.retainStringBytes===!0&&(o.byteValue=ft(i,e+t,e+s)),o}function Ri(i,e,t,n){return Ne(i,e,1,t,n)}function Hi(i,e,t,n){return Ne(i,e,2,re(i,e+1,n),n)}function Vi(i,e,t,n){return Ne(i,e,3,se(i,e+1,n),n)}function Ki(i,e,t,n){return Ne(i,e,5,oe(i,e+1,n),n)}function qi(i,e,t,n){const r=le(i,e+1,n);if(typeof r=="bigint")throw new Error(`${C} 64-bit integer string lengths not supported`);return Ne(i,e,9,r,n)}const ji=qe;function ge(i,e,t,n){return new v(f.array,n,t)}function Wi(i,e,t,n){return ge(i,e,1,t)}function Gi(i,e,t,n){return ge(i,e,2,re(i,e+1,n))}function Xi(i,e,t,n){return ge(i,e,3,se(i,e+1,n))}function Qi(i,e,t,n){return ge(i,e,5,oe(i,e+1,n))}function Yi(i,e,t,n){const r=le(i,e+1,n);if(typeof r=="bigint")throw new Error(`${C} 64-bit integer array lengths not supported`);return ge(i,e,9,r)}function Ji(i,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${C} indefinite length items not allowed`);return ge(i,e,1,1/0)}function gt(i,e){V(i,f.array.majorEncoded,e.value)}gt.compareTokens=ae.compareTokens;gt.encodedSize=function(e){return V.encodedSize(e.value)};function me(i,e,t,n){return new v(f.map,n,t)}function Zi(i,e,t,n){return me(i,e,1,t)}function er(i,e,t,n){return me(i,e,2,re(i,e+1,n))}function tr(i,e,t,n){return me(i,e,3,se(i,e+1,n))}function nr(i,e,t,n){return me(i,e,5,oe(i,e+1,n))}function ir(i,e,t,n){const r=le(i,e+1,n);if(typeof r=="bigint")throw new Error(`${C} 64-bit integer map lengths not supported`);return me(i,e,9,r)}function rr(i,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${C} indefinite length items not allowed`);return me(i,e,1,1/0)}function mt(i,e){V(i,f.map.majorEncoded,e.value)}mt.compareTokens=ae.compareTokens;mt.encodedSize=function(e){return V.encodedSize(e.value)};function sr(i,e,t,n){return new v(f.tag,t,1)}function or(i,e,t,n){return new v(f.tag,re(i,e+1,n),2)}function lr(i,e,t,n){return new v(f.tag,se(i,e+1,n),3)}function ar(i,e,t,n){return new v(f.tag,oe(i,e+1,n),5)}function cr(i,e,t,n){return new v(f.tag,le(i,e+1,n),9)}function yt(i,e){V(i,f.tag.majorEncoded,e.value)}yt.compareTokens=ae.compareTokens;yt.encodedSize=function(e){return V.encodedSize(e.value)};const dr=20,ur=21,fr=22,hr=23;function pr(i,e,t,n){if(n.allowUndefined===!1)throw new Error(`${C} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new v(f.null,null,1):new v(f.undefined,void 0,1)}function gr(i,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${C} indefinite length items not allowed`);return new v(f.break,void 0,1)}function wt(i,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(i))throw new Error(`${C} NaN values are not supported`);if(t.allowInfinity===!1&&(i===1/0||i===-1/0))throw new Error(`${C} Infinity values are not supported`)}return new v(f.float,i,e)}function mr(i,e,t,n){return wt(bt(i,e+1),3,n)}function yr(i,e,t,n){return wt(xt(i,e+1),5,n)}function wr(i,e,t,n){return wt(fn(i,e+1),9,n)}function vt(i,e,t){const n=e.value;if(n===!1)i.push([f.float.majorEncoded|dr]);else if(n===!0)i.push([f.float.majorEncoded|ur]);else if(n===null)i.push([f.float.majorEncoded|fr]);else if(n===void 0)i.push([f.float.majorEncoded|hr]);else{let r,s=!1;(!t||t.float64!==!0)&&(dn(n),r=bt(q,1),n===r||Number.isNaN(n)?(q[0]=249,i.push(q.slice(0,3)),s=!0):(un(n),r=xt(q,1),n===r&&(q[0]=250,i.push(q.slice(0,5)),s=!0))),s||(vr(n),r=fn(q,1),q[0]=251,i.push(q.slice(0,9)))}}vt.encodedSize=function(e,t){const n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){dn(n);let r=bt(q,1);if(n===r||Number.isNaN(n))return 3;if(un(n),r=xt(q,1),n===r)return 5}return 9};const cn=new ArrayBuffer(9),H=new DataView(cn,1),q=new Uint8Array(cn,0);function dn(i){if(i===1/0)H.setUint16(0,31744,!1);else if(i===-1/0)H.setUint16(0,64512,!1);else if(Number.isNaN(i))H.setUint16(0,32256,!1);else{H.setFloat32(0,i);const e=H.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)H.setUint16(0,31744,!1);else if(t===0)H.setUint16(0,(i&2147483648)>>16|n>>13,!1);else{const r=t-127;r<-24?H.setUint16(0,0):r<-14?H.setUint16(0,(e&2147483648)>>16|1<<24+r,!1):H.setUint16(0,(e&2147483648)>>16|r+15<<10|n>>13,!1)}}}function bt(i,e){if(i.length-e<2)throw new Error(`${C} not enough data for float16`);const t=(i[e]<<8)+i[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const n=t>>10&31,r=t&1023;let s;return n===0?s=r*2**-24:n!==31?s=(r+1024)*2**(n-25):s=r===0?1/0:NaN,t&32768?-s:s}function un(i){H.setFloat32(0,i,!1)}function xt(i,e){if(i.length-e<4)throw new Error(`${C} not enough data for float32`);const t=(i.byteOffset||0)+e;return new DataView(i.buffer,t,4).getFloat32(0,!1)}function vr(i){H.setFloat64(0,i,!1)}function fn(i,e){if(i.length-e<8)throw new Error(`${C} not enough data for float64`);const t=(i.byteOffset||0)+e;return new DataView(i.buffer,t,8).getFloat64(0,!1)}vt.compareTokens=ae.compareTokens;function N(i,e,t){throw new Error(`${C} encountered invalid minor (${t}) for major ${i[e]>>>5}`)}function je(i){return()=>{throw new Error(`${C} ${i}`)}}const y=[];for(let i=0;i<=23;i++)y[i]=N;y[24]=Ti;y[25]=Si;y[26]=Ii;y[27]=Ai;y[28]=N;y[29]=N;y[30]=N;y[31]=N;for(let i=32;i<=55;i++)y[i]=N;y[56]=Di;y[57]=Mi;y[58]=Li;y[59]=$i;y[60]=N;y[61]=N;y[62]=N;y[63]=N;for(let i=64;i<=87;i++)y[i]=Oi;y[88]=Bi;y[89]=Pi;y[90]=zi;y[91]=Fi;y[92]=N;y[93]=N;y[94]=N;y[95]=je("indefinite length bytes/strings are not supported");for(let i=96;i<=119;i++)y[i]=Ri;y[120]=Hi;y[121]=Vi;y[122]=Ki;y[123]=qi;y[124]=N;y[125]=N;y[126]=N;y[127]=je("indefinite length bytes/strings are not supported");for(let i=128;i<=151;i++)y[i]=Wi;y[152]=Gi;y[153]=Xi;y[154]=Qi;y[155]=Yi;y[156]=N;y[157]=N;y[158]=N;y[159]=Ji;for(let i=160;i<=183;i++)y[i]=Zi;y[184]=er;y[185]=tr;y[186]=nr;y[187]=ir;y[188]=N;y[189]=N;y[190]=N;y[191]=rr;for(let i=192;i<=215;i++)y[i]=sr;y[216]=or;y[217]=lr;y[218]=ar;y[219]=cr;y[220]=N;y[221]=N;y[222]=N;y[223]=N;for(let i=224;i<=243;i++)y[i]=je("simple values are not supported");y[244]=N;y[245]=N;y[246]=N;y[247]=pr;y[248]=je("simple values are not supported");y[249]=mr;y[250]=yr;y[251]=wr;y[252]=N;y[253]=N;y[254]=N;y[255]=gr;const Q=[];for(let i=0;i<24;i++)Q[i]=new v(f.uint,i,1);for(let i=-1;i>=-24;i--)Q[31-i]=new v(f.negint,i,1);Q[64]=new v(f.bytes,new Uint8Array(0),1);Q[96]=new v(f.string,"",1);Q[128]=new v(f.array,0,1);Q[160]=new v(f.map,0,1);Q[244]=new v(f.false,!1,1);Q[245]=new v(f.true,!0,1);Q[246]=new v(f.null,null,1);function br(i){switch(i.type){case f.false:return J([244]);case f.true:return J([245]);case f.null:return J([246]);case f.bytes:return i.value.length?void 0:J([64]);case f.string:return i.value===""?J([96]):void 0;case f.array:return i.value===0?J([128]):void 0;case f.map:return i.value===0?J([160]):void 0;case f.uint:return i.value<24?J([Number(i.value)]):void 0;case f.negint:if(i.value>=-24)return J([31-Number(i.value)])}}const xr={float64:!1,mapSorter:_r,quickEncodeToken:br};function hn(){const i=[];return i[f.uint.major]=ae,i[f.negint.major]=pt,i[f.bytes.major]=qe,i[f.string.major]=ji,i[f.array.major]=gt,i[f.map.major]=mt,i[f.tag.major]=yt,i[f.float.major]=vt,i}const pn=hn(),Qe=new on;class Pe{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${ln} object contains circular references`);return new Pe(t,e)}}const ee={null:new v(f.null,null),undefined:new v(f.undefined,void 0),true:new v(f.true,!0),false:new v(f.false,!1),emptyArray:new v(f.array,0),emptyMap:new v(f.map,0)},ne={number(i,e,t,n){return!Number.isInteger(i)||!Number.isSafeInteger(i)?new v(f.float,i):i>=0?new v(f.uint,i):new v(f.negint,i)},bigint(i,e,t,n){return i>=BigInt(0)?new v(f.uint,i):new v(f.negint,i)},Uint8Array(i,e,t,n){return new v(f.bytes,i)},string(i,e,t,n){return new v(f.string,i)},boolean(i,e,t,n){return i?ee.true:ee.false},null(i,e,t,n){return ee.null},undefined(i,e,t,n){return ee.undefined},ArrayBuffer(i,e,t,n){return new v(f.bytes,new Uint8Array(i))},DataView(i,e,t,n){return new v(f.bytes,new Uint8Array(i.buffer,i.byteOffset,i.byteLength))},Array(i,e,t,n){if(!i.length)return t.addBreakTokens===!0?[ee.emptyArray,new v(f.break)]:ee.emptyArray;n=Pe.createCheck(n,i);const r=[];let s=0;for(const o of i)r[s++]=Ae(o,t,n);return t.addBreakTokens?[new v(f.array,i.length),r,new v(f.break)]:[new v(f.array,i.length),r]},Object(i,e,t,n){const r=e!=="Object",s=r?i.keys():Object.keys(i),o=r?i.size:s.length;if(!o)return t.addBreakTokens===!0?[ee.emptyMap,new v(f.break)]:ee.emptyMap;n=Pe.createCheck(n,i);const l=[];let a=0;for(const c of s)l[a++]=[Ae(c,t,n),Ae(r?i.get(c):i[c],t,n)];return Er(l,t),t.addBreakTokens?[new v(f.map,o),l,new v(f.break)]:[new v(f.map,o),l]}};ne.Map=ne.Object;ne.Buffer=ne.Uint8Array;for(const i of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))ne[`${i}Array`]=ne.DataView;function Ae(i,e={},t){const n=gi(i),r=e&&e.typeEncoders&&e.typeEncoders[n]||ne[n];if(typeof r=="function"){const o=r(i,n,e,t);if(o!=null)return o}const s=ne[n];if(!s)throw new Error(`${ln} unsupported type: ${n}`);return s(i,n,e,t)}function Er(i,e){e.mapSorter&&i.sort(e.mapSorter)}function _r(i,e){const t=Array.isArray(i[0])?i[0][0]:i[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);const r=t.type.major,s=pn[r].compareTokens(t,n);return s===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),s}function gn(i,e,t,n){if(Array.isArray(e))for(const r of e)gn(i,r,t,n);else t[e.type.major](i,e,n)}function kr(i,e,t){const n=Ae(i,t);if(!Array.isArray(n)&&t.quickEncodeToken){const r=t.quickEncodeToken(n);if(r)return r;const s=e[n.type.major];if(s.encodedSize){const o=s.encodedSize(n,t),l=new on(o);if(s(l,n,t),l.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return sn(l.chunks[0])}}return Qe.reset(),gn(Qe,n,e,t),Qe.toBytes(!0)}function Cr(i,e){return e=Object.assign({},xr,e),kr(i,pn,e)}const Nr={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Tr{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=Q[e];if(t===void 0){const n=y[e];if(!n)throw new Error(`${C} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const r=e&31;t=n(this.data,this._pos,r,this.options)}return this._pos+=t.encodedLength,t}}const _e=Symbol.for("DONE"),We=Symbol.for("BREAK");function Sr(i,e,t){const n=[];for(let r=0;r<i.value;r++){const s=ke(e,t);if(s===We){if(i.value===1/0)break;throw new Error(`${C} got unexpected break to lengthed array`)}if(s===_e)throw new Error(`${C} found array but not enough entries (got ${r}, expected ${i.value})`);n[r]=s}return n}function Ir(i,e,t){const n=t.useMaps===!0,r=n?void 0:{},s=n?new Map:void 0;for(let o=0;o<i.value;o++){const l=ke(e,t);if(l===We){if(i.value===1/0)break;throw new Error(`${C} got unexpected break to lengthed map`)}if(l===_e)throw new Error(`${C} found map but not enough entries (got ${o} [no key], expected ${i.value})`);if(n!==!0&&typeof l!="string")throw new Error(`${C} non-string keys not supported (got ${typeof l})`);if(t.rejectDuplicateMapKeys===!0&&(n&&s.has(l)||!n&&l in r))throw new Error(`${C} found repeat map key "${l}"`);const a=ke(e,t);if(a===_e)throw new Error(`${C} found map but not enough entries (got ${o} [no value], expected ${i.value})`);n?s.set(l,a):r[l]=a}return n?s:r}function ke(i,e){if(i.done())return _e;const t=i.next();if(t.type===f.break)return We;if(t.type.terminal)return t.value;if(t.type===f.array)return Sr(t,i,e);if(t.type===f.map)return Ir(t,i,e);if(t.type===f.tag){if(e.tags&&typeof e.tags[t.value]=="function"){const n=ke(i,e);return e.tags[t.value](n)}throw new Error(`${C} tag not supported (${t.value})`)}throw new Error("unsupported")}function Ar(i,e){if(!(i instanceof Uint8Array))throw new Error(`${C} data to decode must be a Uint8Array`);e=Object.assign({},Nr,e);const t=e.tokenizer||new Tr(i,e),n=ke(t,e);if(n===_e)throw new Error(`${C} did not find any content to decode`);if(n===We)throw new Error(`${C} got unexpected break`);return[n,i.subarray(t.pos())]}function Dr(i,e){const[t,n]=Ar(i,e);if(n.length>0)throw new Error(`${C} too many terminals, data makes no sense`);return t}const Mr=new Uint8Array(0);function to(i){const e=i.match(/../g);return e!=null?new Uint8Array(e.map(t=>parseInt(t,16))):Mr}function Lr(i,e){if(i===e)return!0;if(i.byteLength!==e.byteLength)return!1;for(let t=0;t<i.byteLength;t++)if(i[t]!==e[t])return!1;return!0}function Et(i){if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")}function $r(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var r=0;r<i.length;r++){var s=i.charAt(r),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=r}var l=i.length,a=i.charAt(0),c=Math.log(l)/Math.log(256),u=Math.log(256)/Math.log(l);function d(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var h=0,b=0,x=0,_=p.length;x!==_&&p[x]===0;)x++,h++;for(var I=(_-x)*u+1>>>0,k=new Uint8Array(I);x!==_;){for(var S=p[x],T=0,B=I-1;(S!==0||T<b)&&B!==-1;B--,T++)S+=256*k[B]>>>0,k[B]=S%l>>>0,S=S/l>>>0;if(S!==0)throw new Error("Non-zero carry");b=T,x++}for(var F=I-b;F!==I&&k[F]===0;)F++;for(var Y=a.repeat(h);F<I;++F)Y+=i.charAt(k[F]);return Y}function g(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var h=0;if(p[h]!==" "){for(var b=0,x=0;p[h]===a;)b++,h++;for(var _=(p.length-h)*c+1>>>0,I=new Uint8Array(_);p[h];){var k=t[p.charCodeAt(h)];if(k===255)return;for(var S=0,T=_-1;(k!==0||S<x)&&T!==-1;T--,S++)k+=l*I[T]>>>0,I[T]=k%256>>>0,k=k/256>>>0;if(k!==0)throw new Error("Non-zero carry");x=S,h++}if(p[h]!==" "){for(var B=_-x;B!==_&&I[B]===0;)B++;for(var F=new Uint8Array(b+(_-B)),Y=b;B!==_;)F[Y++]=I[B++];return F}}}function m(p){var h=g(p);if(h)return h;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:g,decode:m}}var Or=$r,Br=Or;class Pr{constructor(e,t,n){A(this,"name");A(this,"prefix");A(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class zr{constructor(e,t,n){A(this,"name");A(this,"prefix");A(this,"baseDecode");A(this,"prefixCodePoint");this.name=e,this.prefix=t;const r=t.codePointAt(0);if(r===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return mn(this,e)}}class Fr{constructor(e){A(this,"decoders");this.decoders=e}or(e){return mn(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function mn(i,e){return new Fr({...i.decoders??{[i.prefix]:i},...e.decoders??{[e.prefix]:e}})}class Ur{constructor(e,t,n,r){A(this,"name");A(this,"prefix");A(this,"baseEncode");A(this,"baseDecode");A(this,"encoder");A(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new Pr(e,t,n),this.decoder=new zr(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function yn({name:i,prefix:e,encode:t,decode:n}){return new Ur(i,e,t,n)}function Ge({name:i,prefix:e,alphabet:t}){const{encode:n,decode:r}=Br(t,i);return yn({prefix:e,name:i,encode:n,decode:s=>Et(r(s))})}function Rr(i,e,t,n){let r=i.length;for(;i[r-1]==="=";)--r;const s=new Uint8Array(r*t/8|0);let o=0,l=0,a=0;for(let c=0;c<r;++c){const u=e[i[c]];if(u===void 0)throw new SyntaxError(`Non-${n} character`);l=l<<t|u,o+=t,o>=8&&(o-=8,s[a++]=255&l>>o)}if(o>=t||255&l<<8-o)throw new SyntaxError("Unexpected end of data");return s}function Hr(i,e,t){const n=e[e.length-1]==="=",r=(1<<t)-1;let s="",o=0,l=0;for(let a=0;a<i.length;++a)for(l=l<<8|i[a],o+=8;o>t;)o-=t,s+=e[r&l>>o];if(o!==0&&(s+=e[r&l<<t-o]),n)for(;s.length*t&7;)s+="=";return s}function Vr(i){const e={};for(let t=0;t<i.length;++t)e[i[t]]=t;return e}function Z({name:i,prefix:e,bitsPerChar:t,alphabet:n}){const r=Vr(n);return yn({prefix:e,name:i,encode(s){return Hr(s,n,t)},decode(s){return Rr(s,r,t,i)}})}const De=Z({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});Z({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});Z({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});Z({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});Z({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});Z({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});Z({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});Z({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});Z({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const Ye=Ge({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});Ge({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const te=Ge({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Ge({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Kr=wn,Mt=128,qr=-128,jr=Math.pow(2,31);function wn(i,e,t){e=e||[],t=t||0;for(var n=t;i>=jr;)e[t++]=i&255|Mt,i/=128;for(;i&qr;)e[t++]=i&255|Mt,i>>>=7;return e[t]=i|0,wn.bytes=t-n+1,e}var Wr=tt,Gr=128,Lt=127;function tt(i,n){var t=0,n=n||0,r=0,s=n,o,l=i.length;do{if(s>=l)throw tt.bytes=0,new RangeError("Could not decode varint");o=i[s++],t+=r<28?(o&Lt)<<r:(o&Lt)*Math.pow(2,r),r+=7}while(o>=Gr);return tt.bytes=s-n,t}var Xr=Math.pow(2,7),Qr=Math.pow(2,14),Yr=Math.pow(2,21),Jr=Math.pow(2,28),Zr=Math.pow(2,35),es=Math.pow(2,42),ts=Math.pow(2,49),ns=Math.pow(2,56),is=Math.pow(2,63),rs=function(i){return i<Xr?1:i<Qr?2:i<Yr?3:i<Jr?4:i<Zr?5:i<es?6:i<ts?7:i<ns?8:i<is?9:10},ss={encode:Kr,decode:Wr,encodingLength:rs},ze=ss;function nt(i,e=0){return[ze.decode(i,e),ze.decode.bytes]}function Fe(i,e,t=0){return ze.encode(i,e,t),e}function Ue(i){return ze.encodingLength(i)}function os(i,e){const t=e.byteLength,n=Ue(i),r=n+Ue(t),s=new Uint8Array(r+t);return Fe(i,s,0),Fe(t,s,n),s.set(e,r),new _t(i,t,e,s)}function ls(i){const e=Et(i),[t,n]=nt(e),[r,s]=nt(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==r)throw new Error("Incorrect length");return new _t(t,r,o,e)}function as(i,e){if(i===e)return!0;{const t=e;return i.code===t.code&&i.size===t.size&&t.bytes instanceof Uint8Array&&Lr(i.bytes,t.bytes)}}class _t{constructor(e,t,n,r){A(this,"code");A(this,"size");A(this,"digest");A(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=r}}function $t(i,e){const{bytes:t,version:n}=i;switch(n){case 0:return ds(t,it(i),e??te.encoder);default:return us(t,it(i),e??De.encoder)}}const Ot=new WeakMap;function it(i){const e=Ot.get(i);if(e==null){const t=new Map;return Ot.set(i,t),t}return e}var Rt;class M{constructor(e,t,n,r){A(this,"code");A(this,"version");A(this,"multihash");A(this,"bytes");A(this,"/");A(this,Rt,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==ye)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==fs)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return M.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=os(e,t);return M.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return M.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&as(e.multihash,n.multihash)}toString(e){return $t(this,e)}toJSON(){return{"/":$t(this)}}link(){return this}[(Rt=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof M)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:r,multihash:s,bytes:o}=t;return new M(n,r,s,o??Bt(n,r,s.bytes))}else if(t[hs]===!0){const{version:n,multihash:r,code:s}=t,o=ls(r);return M.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==ye)throw new Error(`Version 0 CID must use dag-pb (code: ${ye}) block encoding`);return new M(e,t,n,n.bytes)}case 1:{const r=Bt(e,t,n.bytes);return new M(e,t,n,r)}default:throw new Error("Invalid version")}}static createV0(e){return M.create(0,ye,e)}static createV1(e,t){return M.create(1,e,t)}static decode(e){const[t,n]=M.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=M.inspectBytes(e),n=t.size-t.multihashSize,r=Et(e.subarray(n,n+t.multihashSize));if(r.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=r.subarray(t.multihashSize-t.digestSize),o=new _t(t.multihashCode,t.digestSize,s,r);return[t.version===0?M.createV0(o):M.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[d,g]=nt(e.subarray(t));return t+=g,d};let r=n(),s=ye;if(r===18?(r=0,t=0):s=n(),r!==0&&r!==1)throw new RangeError(`Invalid CID version ${r}`);const o=t,l=n(),a=n(),c=t+a,u=c-o;return{version:r,codec:s,multihashCode:l,digestSize:a,multihashSize:u,size:c}}static parse(e,t){const[n,r]=cs(e,t),s=M.decode(r);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return it(s).set(n,e),s}}function cs(i,e){switch(i[0]){case"Q":{const t=e??te;return[te.prefix,t.decode(`${te.prefix}${i}`)]}case te.prefix:{const t=e??te;return[te.prefix,t.decode(i)]}case De.prefix:{const t=e??De;return[De.prefix,t.decode(i)]}case Ye.prefix:{const t=e??Ye;return[Ye.prefix,t.decode(i)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[i[0],e.decode(i)]}}}function ds(i,e,t){const{prefix:n}=t;if(n!==te.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const r=e.get(n);if(r==null){const s=t.encode(i).slice(1);return e.set(n,s),s}else return r}function us(i,e,t){const{prefix:n}=t,r=e.get(n);if(r==null){const s=t.encode(i);return e.set(n,s),s}else return r}const ye=112,fs=18;function Bt(i,e,t){const n=Ue(i),r=n+Ue(e),s=new Uint8Array(r+t.byteLength);return Fe(i,s,0),Fe(e,s,n),s.set(t,r),s}const hs=Symbol.for("@ipld/js-cid/CID"),vn=42;function ps(i){return i instanceof ArrayBuffer?new Uint8Array(i,0,i.byteLength):i}function gs(i){if(i.asCID!==i&&i["/"]!==i.bytes)return null;const e=M.asCID(i);if(!e)return null;const t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new v(f.tag,vn),new v(f.bytes,t)]}function ms(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function ys(i){if(Number.isNaN(i))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(i===1/0||i===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const rt={float64:!0,typeEncoders:{Object:gs,undefined:ms,number:ys}};({...rt,typeEncoders:{...rt.typeEncoders}});function ws(i){if(i[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return M.decode(i.subarray(1))}const Re={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Re.tags[vn]=ws;({...Re,tags:Re.tags.slice()});const no=i=>Cr(i,rt),io=i=>Dr(ps(i),Re);var vs=st,Pt=128,bs=-128,xs=Math.pow(2,31);function st(i,e,t){if(Number.MAX_SAFE_INTEGER&&i>Number.MAX_SAFE_INTEGER)throw st.bytes=0,new RangeError("Could not encode varint");e=e||[],t=t||0;for(var n=t;i>=xs;)e[t++]=i&255|Pt,i/=128;for(;i&bs;)e[t++]=i&255|Pt,i>>>=7;return e[t]=i|0,st.bytes=t-n+1,e}var Es=ot,_s=128,zt=127;function ot(i,n){var t=0,n=n||0,r=0,s=n,o,l=i.length;do{if(s>=l||r>49)throw ot.bytes=0,new RangeError("Could not decode varint");o=i[s++],t+=r<28?(o&zt)<<r:(o&zt)*Math.pow(2,r),r+=7}while(o>=_s);return ot.bytes=s-n,t}var ks=Math.pow(2,7),Cs=Math.pow(2,14),Ns=Math.pow(2,21),Ts=Math.pow(2,28),Ss=Math.pow(2,35),Is=Math.pow(2,42),As=Math.pow(2,49),Ds=Math.pow(2,56),Ms=Math.pow(2,63),Ls=function(i){return i<ks?1:i<Cs?2:i<Ns?3:i<Ts?4:i<Ss?5:i<Is?6:i<As?7:i<Ds?8:i<Ms?9:10},$s={encode:vs,decode:Es,encodingLength:Ls};const ro=Cn($s);hn();const Os=new TextDecoder;function kt(i,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=i.length)throw new Error("protobuf: unexpected end of data");const r=i[e++];if(t+=n<28?(r&127)<<n:(r&127)*2**n,r<128)break}return[t,e]}function He(i,e){let t;[t,e]=kt(i,e);const n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>i.length)throw new Error("protobuf: unexpected end of data");return[i.subarray(e,n),n]}function bn(i,e){let t;return[t,e]=kt(i,e),[t&7,t>>3,e]}function Bs(i){const e={},t=i.length;let n=0;for(;n<t;){let r,s;if([r,s,n]=bn(i,n),s===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(r!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=He(i,n)}else if(s===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(r!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=He(i,n),e.Name=Os.decode(o)}else if(s===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(r!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Tsize`);[e.Tsize,n]=kt(i,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${s}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function Ps(i){const e=i.length;let t=0,n,r=!1,s;for(;t<e;){let l,a;if([l,a,t]=bn(i,t),l!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${l}`);if(a===1){if(s)throw new Error("protobuf: (PBNode) duplicate Data section");[s,t]=He(i,t),n&&(r=!0)}else if(a===2){if(r)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let c;[c,t]=He(i,t),n.push(Bs(c))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${a}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");const o={};return s&&(o.Data=s),o.Links=n||[],o}const xn=new TextEncoder,Ft=2**32,zs=2**31;function Fs(i,e){let t=e.length;if(typeof i.Tsize=="number"){if(i.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(i.Tsize))throw new Error("Tsize too large for encoding");t=be(e,t,i.Tsize)-1,e[t]=24}if(typeof i.Name=="string"){const n=xn.encode(i.Name);t-=n.length,e.set(n,t),t=be(e,t,n.length)-1,e[t]=18}return i.Hash&&(t-=i.Hash.length,e.set(i.Hash,t),t=be(e,t,i.Hash.length)-1,e[t]=10),e.length-t}function Us(i){const e=Hs(i),t=new Uint8Array(e);let n=e;if(i.Data&&(n-=i.Data.length,t.set(i.Data,n),n=be(t,n,i.Data.length)-1,t[n]=10),i.Links)for(let r=i.Links.length-1;r>=0;r--){const s=Fs(i.Links[r],t.subarray(0,n));n-=s,n=be(t,n,s)-1,t[n]=18}return t}function Rs(i){let e=0;if(i.Hash){const t=i.Hash.length;e+=1+t+de(t)}if(typeof i.Name=="string"){const t=xn.encode(i.Name).length;e+=1+t+de(t)}return typeof i.Tsize=="number"&&(e+=1+de(i.Tsize)),e}function Hs(i){let e=0;if(i.Data){const t=i.Data.length;e+=1+t+de(t)}if(i.Links)for(const t of i.Links){const n=Rs(t);e+=1+n+de(n)}return e}function be(i,e,t){e-=de(t);const n=e;for(;t>=zs;)i[e++]=t&127|128,t/=128;for(;t>=128;)i[e++]=t&127|128,t>>>=7;return i[e]=t,n}function de(i){return i%2===0&&i++,Math.floor((Vs(i)+6)/7)}function Vs(i){let e=0;return i>=Ft&&(i=Math.floor(i/Ft),e=32),i>=65536&&(i>>>=16,e+=16),i>=256&&(i>>>=8,e+=8),e+Ks[i]}const Ks=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],qs=["Data","Links"],js=["Hash","Name","Tsize"],lt=new TextEncoder;function En(i,e){if(i===e)return 0;const t=i.Name?lt.encode(i.Name):[],n=e.Name?lt.encode(e.Name):[];let r=t.length,s=n.length;for(let o=0,l=Math.min(r,s);o<l;++o)if(t[o]!==n[o]){r=t[o],s=n[o];break}return r<s?-1:s<r?1:0}function Ut(i,e){return!Object.keys(i).some(t=>!e.includes(t))}function Ws(i){if(typeof i.asCID=="object"){const t=M.asCID(i);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof i!="object"||Array.isArray(i))throw new TypeError("Invalid DAG-PB form");const e={};if(i.Hash){let t=M.asCID(i.Hash);try{t||(typeof i.Hash=="string"?t=M.parse(i.Hash):i.Hash instanceof Uint8Array&&(t=M.decode(i.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof i.Name=="string"&&(e.Name=i.Name),typeof i.Tsize=="number"&&(e.Tsize=i.Tsize),e}function so(i){if((i instanceof Uint8Array||typeof i=="string")&&(i={Data:i}),typeof i!="object"||Array.isArray(i))throw new TypeError("Invalid DAG-PB form");const e={};if(i.Data!==void 0)if(typeof i.Data=="string")e.Data=lt.encode(i.Data);else if(i.Data instanceof Uint8Array)e.Data=i.Data;else throw new TypeError("Invalid DAG-PB form");if(i.Links!==void 0)if(Array.isArray(i.Links))e.Links=i.Links.map(Ws),e.Links.sort(En);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function Gs(i){if(!i||typeof i!="object"||Array.isArray(i)||i instanceof Uint8Array||i["/"]&&i["/"]===i.bytes)throw new TypeError("Invalid DAG-PB form");if(!Ut(i,qs))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(i.Data!==void 0&&!(i.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(i.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<i.Links.length;e++){const t=i.Links[e];if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!Ut(t,js))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash==null||!t.Hash["/"]||t.Hash["/"]!==t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0){if(typeof t.Tsize!="number"||t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&En(t,i.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function Xs(i){return i instanceof ArrayBuffer?new Uint8Array(i,0,i.byteLength):i}const oo=112;function lo(i){Gs(i);const e={};return i.Links&&(e.Links=i.Links.map(t=>{const n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),i.Data&&(e.Data=i.Data),Us(e)}function ao(i){const e=Xs(i),t=Ps(e),n={};return t.Data&&(n.Data=t.Data),t.Links&&(n.Links=t.Links.map(r=>{const s={};try{s.Hash=M.decode(r.Hash)}catch{}if(!s.Hash)throw new Error("Invalid Hash field found in link, expected CID");return r.Name!==void 0&&(s.Name=r.Name),r.Tsize!==void 0&&(s.Tsize=r.Tsize),s})),n}export{M as C,ls as a,ao as b,oo as c,io as d,lo as e,os as f,to as g,Et as h,no as i,so as p,eo as s,ro as v,Zs as w};
